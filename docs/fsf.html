<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Case Study: French-Severn Forest | Integration of Photo Interpreted and LiDAR Attributes into a Polygonal Forest Inventory Framework</title>
  <meta name="description" content="A place to find background information and follow updates related to the project." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Case Study: French-Severn Forest | Integration of Photo Interpreted and LiDAR Attributes into a Polygonal Forest Inventory Framework" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A place to find background information and follow updates related to the project." />
  <meta name="github-repo" content="bermane/ontario-inventory" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Case Study: French-Severn Forest | Integration of Photo Interpreted and LiDAR Attributes into a Polygonal Forest Inventory Framework" />
  
  <meta name="twitter:description" content="A place to find background information and follow updates related to the project." />
  



<meta name="date" content="2023-05-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="imputation.html"/>
<link rel="next" href="perf.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Integration of Photo Interpreted and LiDAR Attributes Into a Polygonal Forest Inventory Framework</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><strong>1</strong> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#summary"><i class="fa fa-check"></i><strong>1.1</strong> Project Summary</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#partners"><i class="fa fa-check"></i><strong>1.2</strong> Project Partners</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html"><i class="fa fa-check"></i><strong>2</strong> People</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ubc"><i class="fa fa-check"></i><strong>2.1</strong> University of British Columbia</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ncc"><i class="fa fa-check"></i>Prof.Â Nicholas Coops, <em>project lead</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#eb"><i class="fa fa-check"></i>Ethan Berman, <em>research scientist</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#greenfirst"><i class="fa fa-check"></i><strong>2.2</strong> GreenFirst Forest Products</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#cm"><i class="fa fa-check"></i>Chris McDonell, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#gm"><i class="fa fa-check"></i>Grant McCartney, <em>partner</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ministry"><i class="fa fa-check"></i><strong>2.3</strong> Ontario Ministry of Natural Resources and Forestry</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#is"><i class="fa fa-check"></i>Ian Sinclair, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#grm"><i class="fa fa-check"></i>Geordie Robere-McGugan, <em>partner</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#laval"><i class="fa fa-check"></i><strong>2.4</strong> Laval University</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#aachim"><i class="fa fa-check"></i>Alexis Achim, <em>advisor</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html"><i class="fa fa-check"></i><strong>3</strong> Project Details</a>
<ul>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#objective"><i class="fa fa-check"></i><strong>3.1</strong> Objective</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#themes"><i class="fa fa-check"></i><strong>3.2</strong> Themes</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#description"><i class="fa fa-check"></i><strong>3.3</strong> Description</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#study-area"><i class="fa fa-check"></i><strong>3.4</strong> Study Area</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#methodology"><i class="fa fa-check"></i><strong>3.5</strong> Methodology</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#knowledge-transfer"><i class="fa fa-check"></i><strong>3.6</strong> Knowledge &amp; Technology Transfer</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html"><i class="fa fa-check"></i><strong>4</strong> Segmentation: Romeo Malette Forest</a>
<ul>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation41"><i class="fa fa-check"></i><strong>4.1</strong> Introduction</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation42"><i class="fa fa-check"></i><strong>4.2</strong> Generic Region Merging Parameters</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation43"><i class="fa fa-check"></i><strong>4.3</strong> Data Requirements</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation44"><i class="fa fa-check"></i><strong>4.4</strong> Set Code and File Parameters</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation45"><i class="fa fa-check"></i><strong>4.5</strong> Pre-processing</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation46"><i class="fa fa-check"></i><strong>4.6</strong> Execute GRM Segmentation</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation47"><i class="fa fa-check"></i><strong>4.7</strong> Post-processing</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation48"><i class="fa fa-check"></i><strong>4.8</strong> Performance Analysis</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation49"><i class="fa fa-check"></i><strong>4.9</strong> Results: GRM Algorithm</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation410"><i class="fa fa-check"></i><strong>4.10</strong> Results: Summary Statisics</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation411"><i class="fa fa-check"></i><strong>4.11</strong> Results: Visual examples of GRM and FRI Polygons</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation412"><i class="fa fa-check"></i><strong>4.12</strong> Results: Distribution Plots</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation413"><i class="fa fa-check"></i><strong>4.13</strong> Caveats</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation414"><i class="fa fa-check"></i><strong>4.14</strong> Future Work</a></li>
<li class="chapter" data-level="" data-path="segmentation.html"><a href="segmentation.html#segmentation415"><i class="fa fa-check"></i><strong>4.15</strong> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html"><i class="fa fa-check"></i><strong>5</strong> Imputation: Romeo Malette Forest</a>
<ul>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation51"><i class="fa fa-check"></i><strong>5.1</strong> Introduction</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation52"><i class="fa fa-check"></i><strong>5.2</strong> Imputation Parameters</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation53"><i class="fa fa-check"></i><strong>5.3</strong> Data Requirements</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation54"><i class="fa fa-check"></i><strong>5.4</strong> Set Code and File Parameters</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation55"><i class="fa fa-check"></i><strong>5.5</strong> Pre-processing: Extract Variables into Polygons</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation56"><i class="fa fa-check"></i><strong>5.6</strong> Pre-processing: Calculate Species Attributes</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation57"><i class="fa fa-check"></i><strong>5.7</strong> Pre-processing: Forest Data Screening</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation58"><i class="fa fa-check"></i><strong>5.8</strong> Execute Imputation Algorithm Over FRI Polygons ONLY</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation59"><i class="fa fa-check"></i><strong>5.9</strong> Results: Imputation over FRI</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation510"><i class="fa fa-check"></i><strong>5.10</strong> Execute Imputation Algorithm From FRI to GRM Polygons</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation511"><i class="fa fa-check"></i><strong>5.11</strong> Results: Imputation X-Variable Performance</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation512"><i class="fa fa-check"></i><strong>5.12</strong> Results: Distribution of Age</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation513"><i class="fa fa-check"></i><strong>5.13</strong> Results: Distribution of Species</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation516"><i class="fa fa-check"></i><strong>5.16</strong> Caveats</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation517"><i class="fa fa-check"></i><strong>5.17</strong> Future Work</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputation518"><i class="fa fa-check"></i><strong>5.18</strong> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html"><i class="fa fa-check"></i><strong>6</strong> Case Study: French-Severn Forest</a>
<ul>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf61"><i class="fa fa-check"></i><strong>6.1</strong> Segmentation</a>
<ul>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf611"><i class="fa fa-check"></i><strong>6.1.1</strong> Run Algorithm</a></li>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf612"><i class="fa fa-check"></i><strong>6.1.2</strong> Results: Summary Statistics</a></li>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf613"><i class="fa fa-check"></i><strong>6.1.3</strong> Results: Distribution Plots</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf62"><i class="fa fa-check"></i><strong>6.2</strong> Imputation Over FRI</a>
<ul>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf621"><i class="fa fa-check"></i><strong>6.2.1</strong> Run Algorithm</a></li>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf622"><i class="fa fa-check"></i><strong>6.2.2</strong> Results: Imputation Over FRI</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf63"><i class="fa fa-check"></i><strong>6.3</strong> Imputation from FRI to GRM</a>
<ul>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf631"><i class="fa fa-check"></i><strong>6.3.1</strong> Run Algorithm</a></li>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf632"><i class="fa fa-check"></i><strong>6.3.2</strong> Results: Imputation X-Variable Performance</a></li>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf633"><i class="fa fa-check"></i><strong>6.3.3</strong> Results: Distribution of Age</a></li>
<li class="chapter" data-level="" data-path="fsf.html"><a href="fsf.html#fsf634"><i class="fa fa-check"></i><strong>6.3.4</strong> Results: Distribution of Species</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="perf.html"><a href="perf.html"><i class="fa fa-check"></i><strong>7</strong> Imputation Performance Analysis: Comparing RMF and FSF</a>
<ul>
<li class="chapter" data-level="" data-path="perf.html"><a href="perf.html#perf71"><i class="fa fa-check"></i><strong>7.1</strong> Introduction</a></li>
<li class="chapter" data-level="" data-path="perf.html"><a href="perf.html#perf72"><i class="fa fa-check"></i><strong>7.2</strong> Results in RMF</a></li>
<li class="chapter" data-level="" data-path="perf.html"><a href="perf.html#perf73"><i class="fa fa-check"></i><strong>7.3</strong> Results in FSF</a></li>
<li class="chapter" data-level="" data-path="perf.html"><a href="perf.html#perf74"><i class="fa fa-check"></i><strong>7.4</strong> Comparing Results</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="contact.html"><a href="contact.html"><i class="fa fa-check"></i><strong>8</strong> Contact Info and Thank You</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><strong>9</strong> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Integration of Photo Interpreted and LiDAR Attributes into a Polygonal Forest Inventory Framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fsf" class="section level1 unnumbered hasAnchor">
<h1><strong>6</strong> Case Study: French-Severn Forest<a href="fsf.html#fsf" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Now that we have walked through the segmentation and imputation processes, we can do an additional case study by applying the same algorithms and code to the French-Severn Forest in the Great Lakes region of Ontario. Instead of separating the code into distinct sections, we will run the entire segmentation and imputation codes as single chunks and present results.</p>
<div id="fsf61" class="section level2 unnumbered hasAnchor">
<h2><strong>6.1</strong> Segmentation<a href="fsf.html#fsf61" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="fsf611" class="section level3 unnumbered hasAnchor">
<h3><strong>6.1.1</strong> Run Algorithm<a href="fsf.html#fsf611" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="fsf.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb34-2"><a href="fsf.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="do">### INSTALL PACKAGES IF NEEDED </span><span class="al">###</span></span>
<span id="cb34-3"><a href="fsf.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb34-4"><a href="fsf.html#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="fsf.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c(&#39;terra&#39;,</span></span>
<span id="cb34-6"><a href="fsf.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;tidyverse&#39;,</span></span>
<span id="cb34-7"><a href="fsf.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;exactextractr&#39;,</span></span>
<span id="cb34-8"><a href="fsf.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;sf&#39;,</span></span>
<span id="cb34-9"><a href="fsf.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;janitor&#39;,</span></span>
<span id="cb34-10"><a href="fsf.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;berryFunctions&#39;,</span></span>
<span id="cb34-11"><a href="fsf.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;lwgeom&#39;,</span></span>
<span id="cb34-12"><a href="fsf.html#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;magrittr&#39;,</span></span>
<span id="cb34-13"><a href="fsf.html#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;gridExtra&#39;,</span></span>
<span id="cb34-14"><a href="fsf.html#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;knitr&#39;))</span></span>
<span id="cb34-15"><a href="fsf.html#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="fsf.html#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure to have OTB installed from here:</span></span>
<span id="cb34-17"><a href="fsf.html#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.orfeo-toolbox.org/</span></span>
<span id="cb34-18"><a href="fsf.html#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="fsf.html#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb34-20"><a href="fsf.html#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="do">### LOAD PACKAGES </span><span class="al">###</span></span>
<span id="cb34-21"><a href="fsf.html#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb34-22"><a href="fsf.html#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="fsf.html#cb34-23" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb34-24"><a href="fsf.html#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb34-25"><a href="fsf.html#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb34-26"><a href="fsf.html#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span>
<span id="cb34-27"><a href="fsf.html#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb34-28"><a href="fsf.html#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb34-29"><a href="fsf.html#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(berryFunctions)</span>
<span id="cb34-30"><a href="fsf.html#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lwgeom)</span>
<span id="cb34-31"><a href="fsf.html#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb34-32"><a href="fsf.html#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb34-33"><a href="fsf.html#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb34-34"><a href="fsf.html#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="fsf.html#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb34-36"><a href="fsf.html#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="do">### SET CODE AND FILE PARAMETERS </span><span class="al">###</span></span>
<span id="cb34-37"><a href="fsf.html#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb34-38"><a href="fsf.html#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="fsf.html#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="co"># set file names for ALS input variables</span></span>
<span id="cb34-40"><a href="fsf.html#cb34-40" aria-hidden="true" tabindex="-1"></a><span class="co"># these should be gridded raster data with the same CRS and extent</span></span>
<span id="cb34-41"><a href="fsf.html#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="co"># p95 = 95th percentile of returns height &gt; 1.3 m</span></span>
<span id="cb34-42"><a href="fsf.html#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="co"># cc = canopy cover (% of firest returns &gt; 2 m)</span></span>
<span id="cb34-43"><a href="fsf.html#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="co"># cv = coefficient of variation of returns height &gt; 1.3 m</span></span>
<span id="cb34-44"><a href="fsf.html#cb34-44" aria-hidden="true" tabindex="-1"></a>p95_f <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/FSF/ALS/zq95.img&#39;</span></span>
<span id="cb34-45"><a href="fsf.html#cb34-45" aria-hidden="true" tabindex="-1"></a>cc_f <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/FSF/ALS/cov_2m.img&#39;</span></span>
<span id="cb34-46"><a href="fsf.html#cb34-46" aria-hidden="true" tabindex="-1"></a>cv_f <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/FSF/ALS/cv.img&#39;</span></span>
<span id="cb34-47"><a href="fsf.html#cb34-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-48"><a href="fsf.html#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="co"># set file location of roads shape file (spatial lines)</span></span>
<span id="cb34-49"><a href="fsf.html#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="co"># roads will be polygonized, masked from segmentation</span></span>
<span id="cb34-50"><a href="fsf.html#cb34-50" aria-hidden="true" tabindex="-1"></a><span class="co"># and re-added to final dataset as polygons</span></span>
<span id="cb34-51"><a href="fsf.html#cb34-51" aria-hidden="true" tabindex="-1"></a>roads_f <span class="ot">&lt;-</span></span>
<span id="cb34-52"><a href="fsf.html#cb34-52" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;D:/ontario_inventory/FSF/roads/FS_roads.shp&#39;</span></span>
<span id="cb34-53"><a href="fsf.html#cb34-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-54"><a href="fsf.html#cb34-54" aria-hidden="true" tabindex="-1"></a><span class="co"># set file location of FRI polygons shape file</span></span>
<span id="cb34-55"><a href="fsf.html#cb34-55" aria-hidden="true" tabindex="-1"></a><span class="co"># FRI POLYTYPE should have a &quot;WAT&quot; classification to mask water polygons</span></span>
<span id="cb34-56"><a href="fsf.html#cb34-56" aria-hidden="true" tabindex="-1"></a>fri <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/FSF/FRI/FSF_opi_polygon_CSRS_NAD83_17.shp&#39;</span></span>
<span id="cb34-57"><a href="fsf.html#cb34-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-58"><a href="fsf.html#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="co"># set output folder for files generated</span></span>
<span id="cb34-59"><a href="fsf.html#cb34-59" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure no &quot;/&quot; at end of folder location!</span></span>
<span id="cb34-60"><a href="fsf.html#cb34-60" aria-hidden="true" tabindex="-1"></a>out_dir <span class="ot">&lt;-</span> <span class="st">&#39;C:/Users/bermane/Desktop/FSF&#39;</span></span>
<span id="cb34-61"><a href="fsf.html#cb34-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-62"><a href="fsf.html#cb34-62" aria-hidden="true" tabindex="-1"></a><span class="co"># set folder location of OTB (where you installed OTB earlier)</span></span>
<span id="cb34-63"><a href="fsf.html#cb34-63" aria-hidden="true" tabindex="-1"></a>otb_dir <span class="ot">&lt;-</span> <span class="st">&quot;C:/OTB/bin&quot;</span></span>
<span id="cb34-64"><a href="fsf.html#cb34-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-65"><a href="fsf.html#cb34-65" aria-hidden="true" tabindex="-1"></a><span class="co"># set GRM segmentation parameters</span></span>
<span id="cb34-66"><a href="fsf.html#cb34-66" aria-hidden="true" tabindex="-1"></a><span class="co"># the default are listed below</span></span>
<span id="cb34-67"><a href="fsf.html#cb34-67" aria-hidden="true" tabindex="-1"></a><span class="co"># refer to paper or OTB GRM webpage for description of parameters</span></span>
<span id="cb34-68"><a href="fsf.html#cb34-68" aria-hidden="true" tabindex="-1"></a>thresh <span class="ot">&lt;-</span> <span class="st">&quot;10&quot;</span></span>
<span id="cb34-69"><a href="fsf.html#cb34-69" aria-hidden="true" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="st">&quot;0.1&quot;</span></span>
<span id="cb34-70"><a href="fsf.html#cb34-70" aria-hidden="true" tabindex="-1"></a>spat <span class="ot">&lt;-</span> <span class="st">&quot;0.5&quot;</span></span>
<span id="cb34-71"><a href="fsf.html#cb34-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-72"><a href="fsf.html#cb34-72" aria-hidden="true" tabindex="-1"></a><span class="co"># set file location of 2018 VLCE 2.0 landcover data</span></span>
<span id="cb34-73"><a href="fsf.html#cb34-73" aria-hidden="true" tabindex="-1"></a><span class="co"># using 2018 because it is the year of Romeo ALS acquisition</span></span>
<span id="cb34-74"><a href="fsf.html#cb34-74" aria-hidden="true" tabindex="-1"></a><span class="co"># can change based on ALS acquisition year</span></span>
<span id="cb34-75"><a href="fsf.html#cb34-75" aria-hidden="true" tabindex="-1"></a><span class="co"># download here:</span></span>
<span id="cb34-76"><a href="fsf.html#cb34-76" aria-hidden="true" tabindex="-1"></a><span class="co"># https://opendata.nfis.org/mapserver/nfis-change_eng.html</span></span>
<span id="cb34-77"><a href="fsf.html#cb34-77" aria-hidden="true" tabindex="-1"></a>lc_f <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/VLCE/CA_forest_VLCE2_2018.tif&#39;</span></span>
<span id="cb34-78"><a href="fsf.html#cb34-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-79"><a href="fsf.html#cb34-79" aria-hidden="true" tabindex="-1"></a><span class="do">###################################################</span></span>
<span id="cb34-80"><a href="fsf.html#cb34-80" aria-hidden="true" tabindex="-1"></a><span class="do">### LOAD MULTI BAND ALS RASTER FOR SEGMENTATION </span><span class="al">###</span></span>
<span id="cb34-81"><a href="fsf.html#cb34-81" aria-hidden="true" tabindex="-1"></a><span class="do">###################################################</span></span>
<span id="cb34-82"><a href="fsf.html#cb34-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-83"><a href="fsf.html#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="co"># stack rasters</span></span>
<span id="cb34-84"><a href="fsf.html#cb34-84" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">c</span>(p95_f, cc_f, cv_f))</span>
<span id="cb34-85"><a href="fsf.html#cb34-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-86"><a href="fsf.html#cb34-86" aria-hidden="true" tabindex="-1"></a><span class="co"># apply smoothing function on 5 cell square</span></span>
<span id="cb34-87"><a href="fsf.html#cb34-87" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">focal</span>(spl[[<span class="dv">1</span>]], <span class="at">w =</span> <span class="dv">5</span>, <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span>)</span>
<span id="cb34-88"><a href="fsf.html#cb34-88" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">focal</span>(spl[[<span class="dv">2</span>]], <span class="at">w =</span> <span class="dv">5</span>, <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span>)</span>
<span id="cb34-89"><a href="fsf.html#cb34-89" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">focal</span>(spl[[<span class="dv">3</span>]], <span class="at">w =</span> <span class="dv">5</span>, <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span>)</span>
<span id="cb34-90"><a href="fsf.html#cb34-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-91"><a href="fsf.html#cb34-91" aria-hidden="true" tabindex="-1"></a><span class="co"># create ALS template with all values equal to 1</span></span>
<span id="cb34-92"><a href="fsf.html#cb34-92" aria-hidden="true" tabindex="-1"></a>spl_temp <span class="ot">&lt;-</span> spl[[<span class="dv">1</span>]]</span>
<span id="cb34-93"><a href="fsf.html#cb34-93" aria-hidden="true" tabindex="-1"></a>spl_temp[] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb34-94"><a href="fsf.html#cb34-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-95"><a href="fsf.html#cb34-95" aria-hidden="true" tabindex="-1"></a><span class="do">##################</span></span>
<span id="cb34-96"><a href="fsf.html#cb34-96" aria-hidden="true" tabindex="-1"></a><span class="do">### MASK ROADS </span><span class="al">###</span></span>
<span id="cb34-97"><a href="fsf.html#cb34-97" aria-hidden="true" tabindex="-1"></a><span class="do">##################</span></span>
<span id="cb34-98"><a href="fsf.html#cb34-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-99"><a href="fsf.html#cb34-99" aria-hidden="true" tabindex="-1"></a><span class="co"># load roads layer</span></span>
<span id="cb34-100"><a href="fsf.html#cb34-100" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">vect</span>(roads_f)</span>
<span id="cb34-101"><a href="fsf.html#cb34-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-102"><a href="fsf.html#cb34-102" aria-hidden="true" tabindex="-1"></a><span class="co"># reproject to match lidar</span></span>
<span id="cb34-103"><a href="fsf.html#cb34-103" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">project</span>(roads, spl)</span>
<span id="cb34-104"><a href="fsf.html#cb34-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-105"><a href="fsf.html#cb34-105" aria-hidden="true" tabindex="-1"></a><span class="co"># create roads polygon</span></span>
<span id="cb34-106"><a href="fsf.html#cb34-106" aria-hidden="true" tabindex="-1"></a>spl_r <span class="ot">&lt;-</span> <span class="fu">mask</span>(spl_temp, roads, <span class="at">touches =</span> T)</span>
<span id="cb34-107"><a href="fsf.html#cb34-107" aria-hidden="true" tabindex="-1"></a>npix <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">values</span>(spl_r), <span class="at">na.rm =</span> T)</span>
<span id="cb34-108"><a href="fsf.html#cb34-108" aria-hidden="true" tabindex="-1"></a>spl_r <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(spl_r)</span>
<span id="cb34-109"><a href="fsf.html#cb34-109" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(spl_r) <span class="ot">&lt;-</span> <span class="st">&#39;POLYTYPE&#39;</span></span>
<span id="cb34-110"><a href="fsf.html#cb34-110" aria-hidden="true" tabindex="-1"></a>spl_r<span class="sc">$</span>POLYTYPE <span class="ot">&lt;-</span> <span class="st">&#39;RDS&#39;</span></span>
<span id="cb34-111"><a href="fsf.html#cb34-111" aria-hidden="true" tabindex="-1"></a>spl_r<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> npix</span>
<span id="cb34-112"><a href="fsf.html#cb34-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-113"><a href="fsf.html#cb34-113" aria-hidden="true" tabindex="-1"></a><span class="co"># mask road pixels to NA</span></span>
<span id="cb34-114"><a href="fsf.html#cb34-114" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> spl <span class="sc">%&gt;%</span></span>
<span id="cb34-115"><a href="fsf.html#cb34-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(., roads, <span class="at">inverse =</span> T, <span class="at">touches =</span> T)</span>
<span id="cb34-116"><a href="fsf.html#cb34-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-117"><a href="fsf.html#cb34-117" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb34-118"><a href="fsf.html#cb34-118" aria-hidden="true" tabindex="-1"></a><span class="do">### MASK WATER POLYGONS </span><span class="al">###</span></span>
<span id="cb34-119"><a href="fsf.html#cb34-119" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb34-120"><a href="fsf.html#cb34-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-121"><a href="fsf.html#cb34-121" aria-hidden="true" tabindex="-1"></a><span class="co"># water polygons from the FRI are masked and re-added after segmentation</span></span>
<span id="cb34-122"><a href="fsf.html#cb34-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-123"><a href="fsf.html#cb34-123" aria-hidden="true" tabindex="-1"></a><span class="co"># load photo interpreted polygons</span></span>
<span id="cb34-124"><a href="fsf.html#cb34-124" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(fri)</span>
<span id="cb34-125"><a href="fsf.html#cb34-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-126"><a href="fsf.html#cb34-126" aria-hidden="true" tabindex="-1"></a><span class="co"># subset polygons that are WAT</span></span>
<span id="cb34-127"><a href="fsf.html#cb34-127" aria-hidden="true" tabindex="-1"></a>poly_sub <span class="ot">&lt;-</span> poly[poly<span class="sc">$</span>POLYTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;WAT&#39;</span>)]</span>
<span id="cb34-128"><a href="fsf.html#cb34-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-129"><a href="fsf.html#cb34-129" aria-hidden="true" tabindex="-1"></a><span class="co"># reproject to match lidar</span></span>
<span id="cb34-130"><a href="fsf.html#cb34-130" aria-hidden="true" tabindex="-1"></a>poly_sub <span class="ot">&lt;-</span> <span class="fu">project</span>(poly_sub, spl)</span>
<span id="cb34-131"><a href="fsf.html#cb34-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-132"><a href="fsf.html#cb34-132" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through water polygons, mask raster, and vectorize</span></span>
<span id="cb34-133"><a href="fsf.html#cb34-133" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(poly_sub)) {</span>
<span id="cb34-134"><a href="fsf.html#cb34-134" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> poly_sub<span class="sc">$</span>POLYTYPE[i]</span>
<span id="cb34-135"><a href="fsf.html#cb34-135" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb34-136"><a href="fsf.html#cb34-136" aria-hidden="true" tabindex="-1"></a>    spl_pt <span class="ot">&lt;-</span> spl_temp <span class="sc">%&gt;%</span> <span class="fu">crop</span>(poly_sub[i], <span class="at">snap =</span> <span class="st">&#39;out&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-137"><a href="fsf.html#cb34-137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mask</span>(poly_sub[i], <span class="at">touches =</span> T)</span>
<span id="cb34-138"><a href="fsf.html#cb34-138" aria-hidden="true" tabindex="-1"></a>    npix <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">values</span>(spl_pt), <span class="at">na.rm =</span> T)</span>
<span id="cb34-139"><a href="fsf.html#cb34-139" aria-hidden="true" tabindex="-1"></a>    spl_pt <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(spl_pt)</span>
<span id="cb34-140"><a href="fsf.html#cb34-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(spl_pt) <span class="ot">&lt;-</span> <span class="st">&#39;POLYTYPE&#39;</span></span>
<span id="cb34-141"><a href="fsf.html#cb34-141" aria-hidden="true" tabindex="-1"></a>    spl_pt<span class="sc">$</span>POLYTYPE <span class="ot">&lt;-</span> pt</span>
<span id="cb34-142"><a href="fsf.html#cb34-142" aria-hidden="true" tabindex="-1"></a>    spl_pt<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> npix</span>
<span id="cb34-143"><a href="fsf.html#cb34-143" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb34-144"><a href="fsf.html#cb34-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.error</span>(spl_temp <span class="sc">%&gt;%</span> <span class="fu">crop</span>(poly_sub[i], <span class="at">snap =</span> <span class="st">&#39;out&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-145"><a href="fsf.html#cb34-145" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mask</span>(poly_sub[i], <span class="at">touches =</span> T)) <span class="sc">==</span> F) {</span>
<span id="cb34-146"><a href="fsf.html#cb34-146" aria-hidden="true" tabindex="-1"></a>      spl_hold <span class="ot">&lt;-</span> spl_temp <span class="sc">%&gt;%</span> <span class="fu">crop</span>(poly_sub[i], <span class="at">snap =</span> <span class="st">&#39;out&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-147"><a href="fsf.html#cb34-147" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mask</span>(poly_sub[i], <span class="at">touches =</span> T)</span>
<span id="cb34-148"><a href="fsf.html#cb34-148" aria-hidden="true" tabindex="-1"></a>      npix <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">values</span>(spl_hold), <span class="at">na.rm =</span> T)</span>
<span id="cb34-149"><a href="fsf.html#cb34-149" aria-hidden="true" tabindex="-1"></a>      spl_hold <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(spl_hold)</span>
<span id="cb34-150"><a href="fsf.html#cb34-150" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(spl_hold) <span class="ot">&lt;-</span> <span class="st">&#39;POLYTYPE&#39;</span></span>
<span id="cb34-151"><a href="fsf.html#cb34-151" aria-hidden="true" tabindex="-1"></a>      spl_hold<span class="sc">$</span>POLYTYPE <span class="ot">&lt;-</span> pt</span>
<span id="cb34-152"><a href="fsf.html#cb34-152" aria-hidden="true" tabindex="-1"></a>      spl_hold<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> npix</span>
<span id="cb34-153"><a href="fsf.html#cb34-153" aria-hidden="true" tabindex="-1"></a>      spl_pt <span class="ot">&lt;-</span> <span class="fu">rbind</span>(spl_pt, spl_hold)</span>
<span id="cb34-154"><a href="fsf.html#cb34-154" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-155"><a href="fsf.html#cb34-155" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-156"><a href="fsf.html#cb34-156" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-157"><a href="fsf.html#cb34-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-158"><a href="fsf.html#cb34-158" aria-hidden="true" tabindex="-1"></a><span class="co"># reproject whole FRI to match lidar</span></span>
<span id="cb34-159"><a href="fsf.html#cb34-159" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">project</span>(poly, spl)</span>
<span id="cb34-160"><a href="fsf.html#cb34-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-161"><a href="fsf.html#cb34-161" aria-hidden="true" tabindex="-1"></a><span class="co"># mask lidar outside of FRI</span></span>
<span id="cb34-162"><a href="fsf.html#cb34-162" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> <span class="fu">mask</span>(spl, poly, <span class="at">inverse =</span> F, <span class="at">touches =</span> T)</span>
<span id="cb34-163"><a href="fsf.html#cb34-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-164"><a href="fsf.html#cb34-164" aria-hidden="true" tabindex="-1"></a><span class="co"># mask WAT polygons</span></span>
<span id="cb34-165"><a href="fsf.html#cb34-165" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> <span class="fu">mask</span>(spl, poly_sub, <span class="at">inverse =</span> T, <span class="at">touches =</span> T)</span>
<span id="cb34-166"><a href="fsf.html#cb34-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-167"><a href="fsf.html#cb34-167" aria-hidden="true" tabindex="-1"></a><span class="do">###############################################</span></span>
<span id="cb34-168"><a href="fsf.html#cb34-168" aria-hidden="true" tabindex="-1"></a><span class="do">### COMBINE ROAD AND WATER POLYGON DATASETS </span><span class="al">###</span></span>
<span id="cb34-169"><a href="fsf.html#cb34-169" aria-hidden="true" tabindex="-1"></a><span class="do">###############################################</span></span>
<span id="cb34-170"><a href="fsf.html#cb34-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-171"><a href="fsf.html#cb34-171" aria-hidden="true" tabindex="-1"></a>spl_pt <span class="ot">&lt;-</span> <span class="fu">rbind</span>(spl_pt, spl_r)</span>
<span id="cb34-172"><a href="fsf.html#cb34-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-173"><a href="fsf.html#cb34-173" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################</span></span>
<span id="cb34-174"><a href="fsf.html#cb34-174" aria-hidden="true" tabindex="-1"></a><span class="do">### DEAL WITH MISSING DATA AND RESCALE </span><span class="al">###</span></span>
<span id="cb34-175"><a href="fsf.html#cb34-175" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################</span></span>
<span id="cb34-176"><a href="fsf.html#cb34-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-177"><a href="fsf.html#cb34-177" aria-hidden="true" tabindex="-1"></a><span class="co"># if any band is missing values set all to NA</span></span>
<span id="cb34-178"><a href="fsf.html#cb34-178" aria-hidden="true" tabindex="-1"></a>spl[<span class="fu">is.na</span>(spl[[<span class="dv">1</span>]])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb34-179"><a href="fsf.html#cb34-179" aria-hidden="true" tabindex="-1"></a>spl[<span class="fu">is.na</span>(spl[[<span class="dv">2</span>]])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb34-180"><a href="fsf.html#cb34-180" aria-hidden="true" tabindex="-1"></a>spl[<span class="fu">is.na</span>(spl[[<span class="dv">3</span>]])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb34-181"><a href="fsf.html#cb34-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-182"><a href="fsf.html#cb34-182" aria-hidden="true" tabindex="-1"></a><span class="co"># create function to rescale values from 0 to 100 using 1 and 99 percentile</span></span>
<span id="cb34-183"><a href="fsf.html#cb34-183" aria-hidden="true" tabindex="-1"></a>scale_100 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-184"><a href="fsf.html#cb34-184" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate 1st and 99th percentile of input raster</span></span>
<span id="cb34-185"><a href="fsf.html#cb34-185" aria-hidden="true" tabindex="-1"></a>  perc <span class="ot">&lt;-</span></span>
<span id="cb34-186"><a href="fsf.html#cb34-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">values</span>(x, <span class="at">mat =</span> F) <span class="sc">%&gt;%</span> <span class="fu">quantile</span>(., <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="at">na.rm =</span> T)</span>
<span id="cb34-187"><a href="fsf.html#cb34-187" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-188"><a href="fsf.html#cb34-188" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rescale raster using 1st and 99th %</span></span>
<span id="cb34-189"><a href="fsf.html#cb34-189" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> (x <span class="sc">-</span> perc[<span class="dv">1</span>]) <span class="sc">/</span> (perc[<span class="dv">2</span>] <span class="sc">-</span> perc[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb34-190"><a href="fsf.html#cb34-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-191"><a href="fsf.html#cb34-191" aria-hidden="true" tabindex="-1"></a>  <span class="co">#reset values below 0 and above 100</span></span>
<span id="cb34-192"><a href="fsf.html#cb34-192" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-193"><a href="fsf.html#cb34-193" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">&gt;</span> <span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb34-194"><a href="fsf.html#cb34-194" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-195"><a href="fsf.html#cb34-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb34-196"><a href="fsf.html#cb34-196" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-197"><a href="fsf.html#cb34-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-198"><a href="fsf.html#cb34-198" aria-hidden="true" tabindex="-1"></a><span class="co"># rescale rasters from 0 to 100</span></span>
<span id="cb34-199"><a href="fsf.html#cb34-199" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">scale_100</span>(spl[[<span class="dv">1</span>]])</span>
<span id="cb34-200"><a href="fsf.html#cb34-200" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">scale_100</span>(spl[[<span class="dv">2</span>]])</span>
<span id="cb34-201"><a href="fsf.html#cb34-201" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">scale_100</span>(spl[[<span class="dv">3</span>]])</span>
<span id="cb34-202"><a href="fsf.html#cb34-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-203"><a href="fsf.html#cb34-203" aria-hidden="true" tabindex="-1"></a><span class="co"># check if main dir exists and create</span></span>
<span id="cb34-204"><a href="fsf.html#cb34-204" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">dir.exists</span>(out_dir) <span class="sc">==</span> F) {</span>
<span id="cb34-205"><a href="fsf.html#cb34-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(out_dir)</span>
<span id="cb34-206"><a href="fsf.html#cb34-206" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-207"><a href="fsf.html#cb34-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-208"><a href="fsf.html#cb34-208" aria-hidden="true" tabindex="-1"></a><span class="co"># check if temp dir exists and create</span></span>
<span id="cb34-209"><a href="fsf.html#cb34-209" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">dir.exists</span>(<span class="fu">file.path</span>(out_dir, <span class="st">&#39;temp&#39;</span>)) <span class="sc">==</span> F) {</span>
<span id="cb34-210"><a href="fsf.html#cb34-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">file.path</span>(out_dir, <span class="st">&#39;temp&#39;</span>))</span>
<span id="cb34-211"><a href="fsf.html#cb34-211" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-212"><a href="fsf.html#cb34-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-213"><a href="fsf.html#cb34-213" aria-hidden="true" tabindex="-1"></a><span class="co"># write raster to tif</span></span>
<span id="cb34-214"><a href="fsf.html#cb34-214" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(spl,</span>
<span id="cb34-215"><a href="fsf.html#cb34-215" aria-hidden="true" tabindex="-1"></a>            <span class="at">filename =</span> <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/spl_stack.tif&#39;</span>),</span>
<span id="cb34-216"><a href="fsf.html#cb34-216" aria-hidden="true" tabindex="-1"></a>            <span class="at">overwrite =</span> T)</span>
<span id="cb34-217"><a href="fsf.html#cb34-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-218"><a href="fsf.html#cb34-218" aria-hidden="true" tabindex="-1"></a><span class="co"># write spl_pt</span></span>
<span id="cb34-219"><a href="fsf.html#cb34-219" aria-hidden="true" tabindex="-1"></a><span class="fu">writeVector</span>(spl_pt,</span>
<span id="cb34-220"><a href="fsf.html#cb34-220" aria-hidden="true" tabindex="-1"></a>            <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/water_roads_polygons.shp&#39;</span>),</span>
<span id="cb34-221"><a href="fsf.html#cb34-221" aria-hidden="true" tabindex="-1"></a>            <span class="at">overwrite =</span> T)</span>
<span id="cb34-222"><a href="fsf.html#cb34-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-223"><a href="fsf.html#cb34-223" aria-hidden="true" tabindex="-1"></a><span class="co"># SET PARAMETERS</span></span>
<span id="cb34-224"><a href="fsf.html#cb34-224" aria-hidden="true" tabindex="-1"></a>rast_in <span class="ot">&lt;-</span> <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/spl_stack.tif&#39;</span>)</span>
<span id="cb34-225"><a href="fsf.html#cb34-225" aria-hidden="true" tabindex="-1"></a>out_p <span class="ot">&lt;-</span> <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp&#39;</span>)</span>
<span id="cb34-226"><a href="fsf.html#cb34-226" aria-hidden="true" tabindex="-1"></a>name_out <span class="ot">&lt;-</span> <span class="fu">str_c</span>(</span>
<span id="cb34-227"><a href="fsf.html#cb34-227" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;grm_&#39;</span>,</span>
<span id="cb34-228"><a href="fsf.html#cb34-228" aria-hidden="true" tabindex="-1"></a>  thresh,</span>
<span id="cb34-229"><a href="fsf.html#cb34-229" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;_&#39;</span>,</span>
<span id="cb34-230"><a href="fsf.html#cb34-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;&quot;</span>, spec, <span class="at">fixed =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-231"><a href="fsf.html#cb34-231" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;_&#39;</span>,</span>
<span id="cb34-232"><a href="fsf.html#cb34-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">&quot;.&quot;</span>, <span class="st">&quot;&quot;</span>, spat, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-233"><a href="fsf.html#cb34-233" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-234"><a href="fsf.html#cb34-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-235"><a href="fsf.html#cb34-235" aria-hidden="true" tabindex="-1"></a><span class="co"># create function to run generic region merging</span></span>
<span id="cb34-236"><a href="fsf.html#cb34-236" aria-hidden="true" tabindex="-1"></a>grm_otb <span class="ot">&lt;-</span></span>
<span id="cb34-237"><a href="fsf.html#cb34-237" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(<span class="at">otb_path =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb34-238"><a href="fsf.html#cb34-238" aria-hidden="true" tabindex="-1"></a>           <span class="at">raster_in =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb34-239"><a href="fsf.html#cb34-239" aria-hidden="true" tabindex="-1"></a>           <span class="at">out_path =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb34-240"><a href="fsf.html#cb34-240" aria-hidden="true" tabindex="-1"></a>           <span class="at">name =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb34-241"><a href="fsf.html#cb34-241" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">&quot;bs&quot;</span>,</span>
<span id="cb34-242"><a href="fsf.html#cb34-242" aria-hidden="true" tabindex="-1"></a>           <span class="at">thresh =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb34-243"><a href="fsf.html#cb34-243" aria-hidden="true" tabindex="-1"></a>           <span class="at">spec =</span> <span class="st">&quot;0.5&quot;</span>,</span>
<span id="cb34-244"><a href="fsf.html#cb34-244" aria-hidden="true" tabindex="-1"></a>           <span class="at">spat =</span> <span class="st">&quot;0.5&quot;</span>) {</span>
<span id="cb34-245"><a href="fsf.html#cb34-245" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set configuration</span></span>
<span id="cb34-246"><a href="fsf.html#cb34-246" aria-hidden="true" tabindex="-1"></a>    conf <span class="ot">&lt;-</span></span>
<span id="cb34-247"><a href="fsf.html#cb34-247" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(</span>
<span id="cb34-248"><a href="fsf.html#cb34-248" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;-in&quot;</span>,</span>
<span id="cb34-249"><a href="fsf.html#cb34-249" aria-hidden="true" tabindex="-1"></a>        raster_in,</span>
<span id="cb34-250"><a href="fsf.html#cb34-250" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;-out&quot;</span>,</span>
<span id="cb34-251"><a href="fsf.html#cb34-251" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(out_path, <span class="st">&quot;/&quot;</span>, name, <span class="st">&quot;.tif&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb34-252"><a href="fsf.html#cb34-252" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;-criterion&quot;</span>,</span>
<span id="cb34-253"><a href="fsf.html#cb34-253" aria-hidden="true" tabindex="-1"></a>        method,</span>
<span id="cb34-254"><a href="fsf.html#cb34-254" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;-threshold&quot;</span>,</span>
<span id="cb34-255"><a href="fsf.html#cb34-255" aria-hidden="true" tabindex="-1"></a>        thresh,</span>
<span id="cb34-256"><a href="fsf.html#cb34-256" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;-cw&quot;</span>,</span>
<span id="cb34-257"><a href="fsf.html#cb34-257" aria-hidden="true" tabindex="-1"></a>        spec,</span>
<span id="cb34-258"><a href="fsf.html#cb34-258" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;-sw&quot;</span>,</span>
<span id="cb34-259"><a href="fsf.html#cb34-259" aria-hidden="true" tabindex="-1"></a>        spat</span>
<span id="cb34-260"><a href="fsf.html#cb34-260" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb34-261"><a href="fsf.html#cb34-261" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-262"><a href="fsf.html#cb34-262" aria-hidden="true" tabindex="-1"></a>    <span class="co"># apply function in command line</span></span>
<span id="cb34-263"><a href="fsf.html#cb34-263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">system</span>(<span class="fu">paste</span>(otb_path, <span class="st">&quot;/otbcli_GenericRegionMerging&quot;</span>, <span class="st">&quot; &quot;</span>, conf, <span class="at">sep =</span></span>
<span id="cb34-264"><a href="fsf.html#cb34-264" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;&quot;</span>))</span>
<span id="cb34-265"><a href="fsf.html#cb34-265" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-266"><a href="fsf.html#cb34-266" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save configuration for further use</span></span>
<span id="cb34-267"><a href="fsf.html#cb34-267" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(</span>
<span id="cb34-268"><a href="fsf.html#cb34-268" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> conf,</span>
<span id="cb34-269"><a href="fsf.html#cb34-269" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">paste</span>(out_path, <span class="st">&quot;/&quot;</span>, name, <span class="st">&quot;_conf.txt&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb34-270"><a href="fsf.html#cb34-270" aria-hidden="true" tabindex="-1"></a>      <span class="at">row.names =</span> F,</span>
<span id="cb34-271"><a href="fsf.html#cb34-271" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> F</span>
<span id="cb34-272"><a href="fsf.html#cb34-272" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-273"><a href="fsf.html#cb34-273" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-274"><a href="fsf.html#cb34-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-275"><a href="fsf.html#cb34-275" aria-hidden="true" tabindex="-1"></a><span class="co"># run grm</span></span>
<span id="cb34-276"><a href="fsf.html#cb34-276" aria-hidden="true" tabindex="-1"></a><span class="fu">grm_otb</span>(</span>
<span id="cb34-277"><a href="fsf.html#cb34-277" aria-hidden="true" tabindex="-1"></a>  <span class="at">otb_path =</span> otb_dir,</span>
<span id="cb34-278"><a href="fsf.html#cb34-278" aria-hidden="true" tabindex="-1"></a>  <span class="at">raster_in =</span> rast_in,</span>
<span id="cb34-279"><a href="fsf.html#cb34-279" aria-hidden="true" tabindex="-1"></a>  <span class="at">out_path =</span> out_p,</span>
<span id="cb34-280"><a href="fsf.html#cb34-280" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> name_out,</span>
<span id="cb34-281"><a href="fsf.html#cb34-281" aria-hidden="true" tabindex="-1"></a>  <span class="at">thresh =</span> thresh,</span>
<span id="cb34-282"><a href="fsf.html#cb34-282" aria-hidden="true" tabindex="-1"></a>  <span class="at">spec =</span> spec,</span>
<span id="cb34-283"><a href="fsf.html#cb34-283" aria-hidden="true" tabindex="-1"></a>  <span class="at">spat =</span> spat</span>
<span id="cb34-284"><a href="fsf.html#cb34-284" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-285"><a href="fsf.html#cb34-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-286"><a href="fsf.html#cb34-286" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb34-287"><a href="fsf.html#cb34-287" aria-hidden="true" tabindex="-1"></a><span class="do">### MASK MISSING VALUES </span><span class="al">###</span></span>
<span id="cb34-288"><a href="fsf.html#cb34-288" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb34-289"><a href="fsf.html#cb34-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-290"><a href="fsf.html#cb34-290" aria-hidden="true" tabindex="-1"></a><span class="co"># load grm raster</span></span>
<span id="cb34-291"><a href="fsf.html#cb34-291" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">str_c</span>(out_p, <span class="st">&quot;/&quot;</span>, name_out, <span class="st">&quot;.tif&quot;</span>))</span>
<span id="cb34-292"><a href="fsf.html#cb34-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-293"><a href="fsf.html#cb34-293" aria-hidden="true" tabindex="-1"></a><span class="co"># load seg raster</span></span>
<span id="cb34-294"><a href="fsf.html#cb34-294" aria-hidden="true" tabindex="-1"></a>mask <span class="ot">&lt;-</span> <span class="fu">rast</span>(rast_in) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb34-295"><a href="fsf.html#cb34-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-296"><a href="fsf.html#cb34-296" aria-hidden="true" tabindex="-1"></a><span class="co"># mask grm raster</span></span>
<span id="cb34-297"><a href="fsf.html#cb34-297" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">mask</span>(p, mask)</span>
<span id="cb34-298"><a href="fsf.html#cb34-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-299"><a href="fsf.html#cb34-299" aria-hidden="true" tabindex="-1"></a><span class="co"># write grm raster</span></span>
<span id="cb34-300"><a href="fsf.html#cb34-300" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(p, <span class="fu">paste</span>(out_p, <span class="st">&quot;/&quot;</span>, name_out, <span class="st">&quot;.tif&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb34-301"><a href="fsf.html#cb34-301" aria-hidden="true" tabindex="-1"></a>            <span class="at">overwrite =</span> T)</span>
<span id="cb34-302"><a href="fsf.html#cb34-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-303"><a href="fsf.html#cb34-303" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to vector based on cell value</span></span>
<span id="cb34-304"><a href="fsf.html#cb34-304" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(p)</span>
<span id="cb34-305"><a href="fsf.html#cb34-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-306"><a href="fsf.html#cb34-306" aria-hidden="true" tabindex="-1"></a><span class="co"># create table of number of pixels in each polygon</span></span>
<span id="cb34-307"><a href="fsf.html#cb34-307" aria-hidden="true" tabindex="-1"></a>num <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">values</span>(p))</span>
<span id="cb34-308"><a href="fsf.html#cb34-308" aria-hidden="true" tabindex="-1"></a>num_pix <span class="ot">&lt;-</span> <span class="fu">tabyl</span>(num)</span>
<span id="cb34-309"><a href="fsf.html#cb34-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-310"><a href="fsf.html#cb34-310" aria-hidden="true" tabindex="-1"></a><span class="co"># drop na row</span></span>
<span id="cb34-311"><a href="fsf.html#cb34-311" aria-hidden="true" tabindex="-1"></a>num_pix <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(num_pix)</span>
<span id="cb34-312"><a href="fsf.html#cb34-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-313"><a href="fsf.html#cb34-313" aria-hidden="true" tabindex="-1"></a><span class="co"># get pixel ids from vector</span></span>
<span id="cb34-314"><a href="fsf.html#cb34-314" aria-hidden="true" tabindex="-1"></a>vec_dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id =</span> <span class="fu">values</span>(vec)[, <span class="dv">1</span>])</span>
<span id="cb34-315"><a href="fsf.html#cb34-315" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(vec_dat) <span class="ot">&lt;-</span> <span class="st">&#39;id&#39;</span></span>
<span id="cb34-316"><a href="fsf.html#cb34-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-317"><a href="fsf.html#cb34-317" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through values and add to vector data</span></span>
<span id="cb34-318"><a href="fsf.html#cb34-318" aria-hidden="true" tabindex="-1"></a>vec_dat<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb34-319"><a href="fsf.html#cb34-319" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">NROW</span>(vec_dat)) {</span>
<span id="cb34-320"><a href="fsf.html#cb34-320" aria-hidden="true" tabindex="-1"></a>  vec_dat<span class="sc">$</span>nbPixels[i] <span class="ot">&lt;-</span> num_pix<span class="sc">$</span>n[num_pix<span class="sc">$</span>num <span class="sc">==</span> vec_dat<span class="sc">$</span>id[i]]</span>
<span id="cb34-321"><a href="fsf.html#cb34-321" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-322"><a href="fsf.html#cb34-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-323"><a href="fsf.html#cb34-323" aria-hidden="true" tabindex="-1"></a><span class="co"># remove current column of data and add id</span></span>
<span id="cb34-324"><a href="fsf.html#cb34-324" aria-hidden="true" tabindex="-1"></a><span class="co"># add nbPixels to vector</span></span>
<span id="cb34-325"><a href="fsf.html#cb34-325" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> vec[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb34-326"><a href="fsf.html#cb34-326" aria-hidden="true" tabindex="-1"></a>vec<span class="sc">$</span>id <span class="ot">&lt;-</span> vec_dat<span class="sc">$</span>id</span>
<span id="cb34-327"><a href="fsf.html#cb34-327" aria-hidden="true" tabindex="-1"></a>vec<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> vec_dat<span class="sc">$</span>nbPixels</span>
<span id="cb34-328"><a href="fsf.html#cb34-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-329"><a href="fsf.html#cb34-329" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb34-330"><a href="fsf.html#cb34-330" aria-hidden="true" tabindex="-1"></a><span class="do">### ADD PRE-ALLOCATED POLYGONS </span><span class="al">###</span></span>
<span id="cb34-331"><a href="fsf.html#cb34-331" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb34-332"><a href="fsf.html#cb34-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-333"><a href="fsf.html#cb34-333" aria-hidden="true" tabindex="-1"></a><span class="co"># load polygon dataset</span></span>
<span id="cb34-334"><a href="fsf.html#cb34-334" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> vec</span>
<span id="cb34-335"><a href="fsf.html#cb34-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-336"><a href="fsf.html#cb34-336" aria-hidden="true" tabindex="-1"></a><span class="co"># reproject segmented polygons to ensure same crs</span></span>
<span id="cb34-337"><a href="fsf.html#cb34-337" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">project</span>(p, spl_pt)</span>
<span id="cb34-338"><a href="fsf.html#cb34-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-339"><a href="fsf.html#cb34-339" aria-hidden="true" tabindex="-1"></a><span class="co"># add non-FOR POLYTYPE polygons back in</span></span>
<span id="cb34-340"><a href="fsf.html#cb34-340" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p, spl_pt)</span>
<span id="cb34-341"><a href="fsf.html#cb34-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-342"><a href="fsf.html#cb34-342" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb34-343"><a href="fsf.html#cb34-343" aria-hidden="true" tabindex="-1"></a><span class="do">### ADD LANDCOVER </span><span class="al">###</span></span>
<span id="cb34-344"><a href="fsf.html#cb34-344" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb34-345"><a href="fsf.html#cb34-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-346"><a href="fsf.html#cb34-346" aria-hidden="true" tabindex="-1"></a><span class="co"># load VLCE 2.0 landcover dataset</span></span>
<span id="cb34-347"><a href="fsf.html#cb34-347" aria-hidden="true" tabindex="-1"></a>lc <span class="ot">&lt;-</span> <span class="fu">rast</span>(lc_f)</span>
<span id="cb34-348"><a href="fsf.html#cb34-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-349"><a href="fsf.html#cb34-349" aria-hidden="true" tabindex="-1"></a><span class="co"># project polygons to CRS of raster</span></span>
<span id="cb34-350"><a href="fsf.html#cb34-350" aria-hidden="true" tabindex="-1"></a>p_lc <span class="ot">&lt;-</span> <span class="fu">project</span>(p2, lc)</span>
<span id="cb34-351"><a href="fsf.html#cb34-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-352"><a href="fsf.html#cb34-352" aria-hidden="true" tabindex="-1"></a><span class="co"># crop raster</span></span>
<span id="cb34-353"><a href="fsf.html#cb34-353" aria-hidden="true" tabindex="-1"></a>lc <span class="ot">&lt;-</span> <span class="fu">crop</span>(lc, p_lc)</span>
<span id="cb34-354"><a href="fsf.html#cb34-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-355"><a href="fsf.html#cb34-355" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf</span></span>
<span id="cb34-356"><a href="fsf.html#cb34-356" aria-hidden="true" tabindex="-1"></a>p_lcsf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(p_lc)</span>
<span id="cb34-357"><a href="fsf.html#cb34-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-358"><a href="fsf.html#cb34-358" aria-hidden="true" tabindex="-1"></a><span class="co"># extract landcover values</span></span>
<span id="cb34-359"><a href="fsf.html#cb34-359" aria-hidden="true" tabindex="-1"></a>lc_vals <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(lc, p_lcsf)</span>
<span id="cb34-360"><a href="fsf.html#cb34-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-361"><a href="fsf.html#cb34-361" aria-hidden="true" tabindex="-1"></a><span class="co"># set landcover class key</span></span>
<span id="cb34-362"><a href="fsf.html#cb34-362" aria-hidden="true" tabindex="-1"></a>lc_key <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;NA&#39;</span>,</span>
<span id="cb34-363"><a href="fsf.html#cb34-363" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">20</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Water&#39;</span>,</span>
<span id="cb34-364"><a href="fsf.html#cb34-364" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">31</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Snow/Ice&#39;</span>,</span>
<span id="cb34-365"><a href="fsf.html#cb34-365" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">32</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Rock/Rubble&#39;</span>,</span>
<span id="cb34-366"><a href="fsf.html#cb34-366" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">33</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Exposed/Barren Land&#39;</span>,</span>
<span id="cb34-367"><a href="fsf.html#cb34-367" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">40</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Bryoids&#39;</span>,</span>
<span id="cb34-368"><a href="fsf.html#cb34-368" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">50</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Shrubland&#39;</span>,</span>
<span id="cb34-369"><a href="fsf.html#cb34-369" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">80</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Wetland&#39;</span>,</span>
<span id="cb34-370"><a href="fsf.html#cb34-370" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">81</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Wetland-Treed&#39;</span>,</span>
<span id="cb34-371"><a href="fsf.html#cb34-371" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">100</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Herbs&#39;</span>,</span>
<span id="cb34-372"><a href="fsf.html#cb34-372" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">210</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Coniferous&#39;</span>,</span>
<span id="cb34-373"><a href="fsf.html#cb34-373" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">220</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Broadleaf&#39;</span>,</span>
<span id="cb34-374"><a href="fsf.html#cb34-374" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">230</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Mixed Wood&#39;</span>)</span>
<span id="cb34-375"><a href="fsf.html#cb34-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-376"><a href="fsf.html#cb34-376" aria-hidden="true" tabindex="-1"></a><span class="co"># find dominant lc type in each polygon</span></span>
<span id="cb34-377"><a href="fsf.html#cb34-377" aria-hidden="true" tabindex="-1"></a><span class="co"># if there are multiple modes keep them</span></span>
<span id="cb34-378"><a href="fsf.html#cb34-378" aria-hidden="true" tabindex="-1"></a><span class="co"># apply over list</span></span>
<span id="cb34-379"><a href="fsf.html#cb34-379" aria-hidden="true" tabindex="-1"></a>lc_mode <span class="ot">&lt;-</span> <span class="fu">sapply</span>(lc_vals, <span class="cf">function</span>(x){</span>
<span id="cb34-380"><a href="fsf.html#cb34-380" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">recode</span>(x<span class="sc">$</span>value, <span class="sc">!!!</span>lc_key)</span>
<span id="cb34-381"><a href="fsf.html#cb34-381" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(value) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">sum =</span> <span class="fu">sum</span>(coverage_fraction))</span>
<span id="cb34-382"><a href="fsf.html#cb34-382" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> x<span class="sc">$</span>value[<span class="fu">which</span>(x<span class="sc">$</span>sum <span class="sc">==</span> <span class="fu">max</span>(x<span class="sc">$</span>sum))]</span>
<span id="cb34-383"><a href="fsf.html#cb34-383" aria-hidden="true" tabindex="-1"></a>  <span class="co"># m &lt;- get_mode2(x$value[x$coverage_fraction &gt;= cov_frac])</span></span>
<span id="cb34-384"><a href="fsf.html#cb34-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">paste</span>(m, <span class="at">collapse =</span> <span class="st">&quot; &quot;</span>))</span>
<span id="cb34-385"><a href="fsf.html#cb34-385" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-386"><a href="fsf.html#cb34-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-387"><a href="fsf.html#cb34-387" aria-hidden="true" tabindex="-1"></a><span class="co"># add to polygon dataset</span></span>
<span id="cb34-388"><a href="fsf.html#cb34-388" aria-hidden="true" tabindex="-1"></a>p2<span class="sc">$</span>dom_lc <span class="ot">&lt;-</span> lc_mode</span>
<span id="cb34-389"><a href="fsf.html#cb34-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-390"><a href="fsf.html#cb34-390" aria-hidden="true" tabindex="-1"></a><span class="co"># set landcover class key with single forested class</span></span>
<span id="cb34-391"><a href="fsf.html#cb34-391" aria-hidden="true" tabindex="-1"></a>lc_key_for <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;NA&#39;</span>,</span>
<span id="cb34-392"><a href="fsf.html#cb34-392" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">20</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Water&#39;</span>,</span>
<span id="cb34-393"><a href="fsf.html#cb34-393" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">31</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Snow/Ice&#39;</span>,</span>
<span id="cb34-394"><a href="fsf.html#cb34-394" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">32</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Rock/Rubble&#39;</span>,</span>
<span id="cb34-395"><a href="fsf.html#cb34-395" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">33</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Exposed/Barren Land&#39;</span>,</span>
<span id="cb34-396"><a href="fsf.html#cb34-396" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">40</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Bryoids&#39;</span>,</span>
<span id="cb34-397"><a href="fsf.html#cb34-397" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">50</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Shrubland&#39;</span>,</span>
<span id="cb34-398"><a href="fsf.html#cb34-398" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">80</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Wetland&#39;</span>,</span>
<span id="cb34-399"><a href="fsf.html#cb34-399" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">81</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>,</span>
<span id="cb34-400"><a href="fsf.html#cb34-400" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">100</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Herbs&#39;</span>,</span>
<span id="cb34-401"><a href="fsf.html#cb34-401" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">210</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>,</span>
<span id="cb34-402"><a href="fsf.html#cb34-402" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">220</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>,</span>
<span id="cb34-403"><a href="fsf.html#cb34-403" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">230</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>)</span>
<span id="cb34-404"><a href="fsf.html#cb34-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-405"><a href="fsf.html#cb34-405" aria-hidden="true" tabindex="-1"></a><span class="co"># find pixels with forest at least 50% of pixel</span></span>
<span id="cb34-406"><a href="fsf.html#cb34-406" aria-hidden="true" tabindex="-1"></a><span class="co"># apply over list</span></span>
<span id="cb34-407"><a href="fsf.html#cb34-407" aria-hidden="true" tabindex="-1"></a>lc_dom_for <span class="ot">&lt;-</span> <span class="fu">sapply</span>(lc_vals, <span class="cf">function</span>(x){</span>
<span id="cb34-408"><a href="fsf.html#cb34-408" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">recode</span>(x<span class="sc">$</span>value, <span class="sc">!!!</span>lc_key_for)</span>
<span id="cb34-409"><a href="fsf.html#cb34-409" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(value) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">sum =</span> <span class="fu">sum</span>(coverage_fraction))</span>
<span id="cb34-410"><a href="fsf.html#cb34-410" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> x<span class="sc">$</span>value[<span class="fu">which</span>(x<span class="sc">$</span>sum <span class="sc">==</span> <span class="fu">max</span>(x<span class="sc">$</span>sum))]</span>
<span id="cb34-411"><a href="fsf.html#cb34-411" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>((<span class="fu">length</span>(m) <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">&amp;</span> (m <span class="sc">==</span> <span class="st">&#39;Forest&#39;</span>)[<span class="dv">1</span>]){</span>
<span id="cb34-412"><a href="fsf.html#cb34-412" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(x<span class="sc">$</span>sum[x<span class="sc">$</span>value <span class="sc">==</span> m]<span class="sc">/</span><span class="fu">sum</span>(x<span class="sc">$</span>sum) <span class="sc">&gt;=</span> <span class="fl">0.5</span>){</span>
<span id="cb34-413"><a href="fsf.html#cb34-413" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="st">&#39;Yes&#39;</span>)</span>
<span id="cb34-414"><a href="fsf.html#cb34-414" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{<span class="fu">return</span>(<span class="st">&#39;No&#39;</span>)}</span>
<span id="cb34-415"><a href="fsf.html#cb34-415" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{<span class="fu">return</span>(<span class="st">&#39;No&#39;</span>)}</span>
<span id="cb34-416"><a href="fsf.html#cb34-416" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb34-417"><a href="fsf.html#cb34-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-418"><a href="fsf.html#cb34-418" aria-hidden="true" tabindex="-1"></a><span class="co"># add to polygon dataset</span></span>
<span id="cb34-419"><a href="fsf.html#cb34-419" aria-hidden="true" tabindex="-1"></a>p2<span class="sc">$</span>dom_for <span class="ot">&lt;-</span> lc_dom_for</span>
<span id="cb34-420"><a href="fsf.html#cb34-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-421"><a href="fsf.html#cb34-421" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb34-422"><a href="fsf.html#cb34-422" aria-hidden="true" tabindex="-1"></a><span class="do">### ADD AREA AND PERIMETER </span><span class="al">###</span></span>
<span id="cb34-423"><a href="fsf.html#cb34-423" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb34-424"><a href="fsf.html#cb34-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-425"><a href="fsf.html#cb34-425" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf</span></span>
<span id="cb34-426"><a href="fsf.html#cb34-426" aria-hidden="true" tabindex="-1"></a>p2_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(p2)</span>
<span id="cb34-427"><a href="fsf.html#cb34-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-428"><a href="fsf.html#cb34-428" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate perimeter</span></span>
<span id="cb34-429"><a href="fsf.html#cb34-429" aria-hidden="true" tabindex="-1"></a>p2<span class="sc">$</span>perim <span class="ot">&lt;-</span> <span class="fu">st_perimeter</span>(p2_sf) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb34-430"><a href="fsf.html#cb34-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-431"><a href="fsf.html#cb34-431" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate area</span></span>
<span id="cb34-432"><a href="fsf.html#cb34-432" aria-hidden="true" tabindex="-1"></a>p2<span class="sc">$</span>area <span class="ot">&lt;-</span> <span class="fu">st_area</span>(p2_sf) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb34-433"><a href="fsf.html#cb34-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-434"><a href="fsf.html#cb34-434" aria-hidden="true" tabindex="-1"></a><span class="co"># write to file</span></span>
<span id="cb34-435"><a href="fsf.html#cb34-435" aria-hidden="true" tabindex="-1"></a><span class="fu">writeVector</span>(p2, <span class="fu">str_c</span>(out_dir, <span class="st">&quot;/&quot;</span>, name_out, <span class="st">&quot;.shp&quot;</span>),</span>
<span id="cb34-436"><a href="fsf.html#cb34-436" aria-hidden="true" tabindex="-1"></a>            <span class="at">overwrite =</span> T)</span>
<span id="cb34-437"><a href="fsf.html#cb34-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-438"><a href="fsf.html#cb34-438" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb34-439"><a href="fsf.html#cb34-439" aria-hidden="true" tabindex="-1"></a><span class="do">### EXTRACT FINAL POLYGON SUMMARY STATS </span><span class="al">###</span></span>
<span id="cb34-440"><a href="fsf.html#cb34-440" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb34-441"><a href="fsf.html#cb34-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-442"><a href="fsf.html#cb34-442" aria-hidden="true" tabindex="-1"></a><span class="co"># create list of polygon files, names and parameters</span></span>
<span id="cb34-443"><a href="fsf.html#cb34-443" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">str_c</span>(out_dir, <span class="st">&quot;/&quot;</span>, name_out, <span class="st">&quot;.shp&quot;</span>)</span>
<span id="cb34-444"><a href="fsf.html#cb34-444" aria-hidden="true" tabindex="-1"></a>out_loc <span class="ot">&lt;-</span> out_dir</span>
<span id="cb34-445"><a href="fsf.html#cb34-445" aria-hidden="true" tabindex="-1"></a>grm_input <span class="ot">&lt;-</span> <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/spl_stack.tif&#39;</span>)</span>
<span id="cb34-446"><a href="fsf.html#cb34-446" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> name_out</span>
<span id="cb34-447"><a href="fsf.html#cb34-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-448"><a href="fsf.html#cb34-448" aria-hidden="true" tabindex="-1"></a><span class="co"># create standard error function</span></span>
<span id="cb34-449"><a href="fsf.html#cb34-449" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb34-450"><a href="fsf.html#cb34-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sd</span>(x) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(x))</span>
<span id="cb34-451"><a href="fsf.html#cb34-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-452"><a href="fsf.html#cb34-452" aria-hidden="true" tabindex="-1"></a><span class="co"># load file</span></span>
<span id="cb34-453"><a href="fsf.html#cb34-453" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">vect</span>(file)</span>
<span id="cb34-454"><a href="fsf.html#cb34-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-455"><a href="fsf.html#cb34-455" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf</span></span>
<span id="cb34-456"><a href="fsf.html#cb34-456" aria-hidden="true" tabindex="-1"></a>p_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(p)</span>
<span id="cb34-457"><a href="fsf.html#cb34-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-458"><a href="fsf.html#cb34-458" aria-hidden="true" tabindex="-1"></a><span class="co"># subset non masked WAT and RD polygons</span></span>
<span id="cb34-459"><a href="fsf.html#cb34-459" aria-hidden="true" tabindex="-1"></a>p2_sf <span class="ot">&lt;-</span> p[<span class="fu">is.na</span>(p<span class="sc">$</span>POLYTYPE)] <span class="sc">%&gt;%</span> st_as_sf</span>
<span id="cb34-460"><a href="fsf.html#cb34-460" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p[<span class="fu">is.na</span>(p<span class="sc">$</span>POLYTYPE)] <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb34-461"><a href="fsf.html#cb34-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-462"><a href="fsf.html#cb34-462" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate perimeter to area ratio</span></span>
<span id="cb34-463"><a href="fsf.html#cb34-463" aria-hidden="true" tabindex="-1"></a>p2<span class="sc">$</span>p_to_a <span class="ot">&lt;-</span> p2<span class="sc">$</span>perim <span class="sc">/</span> p2<span class="sc">$</span>area</span>
<span id="cb34-464"><a href="fsf.html#cb34-464" aria-hidden="true" tabindex="-1"></a>p2<span class="sc">$</span>p_to_a <span class="ot">&lt;-</span> <span class="fu">round</span>(p2<span class="sc">$</span>p_to_a, <span class="dv">3</span>)</span>
<span id="cb34-465"><a href="fsf.html#cb34-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-466"><a href="fsf.html#cb34-466" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate msi</span></span>
<span id="cb34-467"><a href="fsf.html#cb34-467" aria-hidden="true" tabindex="-1"></a>p2<span class="sc">$</span>msi <span class="ot">&lt;-</span> p2<span class="sc">$</span>perim <span class="sc">/</span> <span class="fu">sqrt</span>(pi <span class="sc">*</span> p2<span class="sc">$</span>area)</span>
<span id="cb34-468"><a href="fsf.html#cb34-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-469"><a href="fsf.html#cb34-469" aria-hidden="true" tabindex="-1"></a><span class="co"># load original raster input file</span></span>
<span id="cb34-470"><a href="fsf.html#cb34-470" aria-hidden="true" tabindex="-1"></a>ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(grm_input)</span>
<span id="cb34-471"><a href="fsf.html#cb34-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-472"><a href="fsf.html#cb34-472" aria-hidden="true" tabindex="-1"></a><span class="co"># rename bands</span></span>
<span id="cb34-473"><a href="fsf.html#cb34-473" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ras) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;p95&#39;</span>, <span class="st">&#39;cc&#39;</span>, <span class="st">&#39;cv&#39;</span>)</span>
<span id="cb34-474"><a href="fsf.html#cb34-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-475"><a href="fsf.html#cb34-475" aria-hidden="true" tabindex="-1"></a><span class="co"># extract pixel values</span></span>
<span id="cb34-476"><a href="fsf.html#cb34-476" aria-hidden="true" tabindex="-1"></a>pvals <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(ras, p2_sf)</span>
<span id="cb34-477"><a href="fsf.html#cb34-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-478"><a href="fsf.html#cb34-478" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate SSE</span></span>
<span id="cb34-479"><a href="fsf.html#cb34-479" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb34-480"><a href="fsf.html#cb34-480" aria-hidden="true" tabindex="-1"></a>  pvals,</span>
<span id="cb34-481"><a href="fsf.html#cb34-481" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-482"><a href="fsf.html#cb34-482" aria-hidden="true" tabindex="-1"></a>    p95_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>p95, <span class="at">na.rm =</span> T)</span>
<span id="cb34-483"><a href="fsf.html#cb34-483" aria-hidden="true" tabindex="-1"></a>    cc_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>cc, <span class="at">na.rm =</span> T)</span>
<span id="cb34-484"><a href="fsf.html#cb34-484" aria-hidden="true" tabindex="-1"></a>    cv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>cv, <span class="at">na.rm =</span> T)</span>
<span id="cb34-485"><a href="fsf.html#cb34-485" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-486"><a href="fsf.html#cb34-486" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">sum</span>((x<span class="sc">$</span>p95 <span class="sc">-</span> p95_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb34-487"><a href="fsf.html#cb34-487" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cc <span class="sc">-</span> cc_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb34-488"><a href="fsf.html#cb34-488" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cv <span class="sc">-</span> cv_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)))</span>
<span id="cb34-489"><a href="fsf.html#cb34-489" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-490"><a href="fsf.html#cb34-490" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-491"><a href="fsf.html#cb34-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-492"><a href="fsf.html#cb34-492" aria-hidden="true" tabindex="-1"></a><span class="co"># transpose</span></span>
<span id="cb34-493"><a href="fsf.html#cb34-493" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="fu">t</span>(sse)</span>
<span id="cb34-494"><a href="fsf.html#cb34-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-495"><a href="fsf.html#cb34-495" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate final sums</span></span>
<span id="cb34-496"><a href="fsf.html#cb34-496" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="fu">colSums</span>(sse)</span>
<span id="cb34-497"><a href="fsf.html#cb34-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-498"><a href="fsf.html#cb34-498" aria-hidden="true" tabindex="-1"></a><span class="co"># unlist values</span></span>
<span id="cb34-499"><a href="fsf.html#cb34-499" aria-hidden="true" tabindex="-1"></a>pvals2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, pvals)</span>
<span id="cb34-500"><a href="fsf.html#cb34-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-501"><a href="fsf.html#cb34-501" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate global mean values</span></span>
<span id="cb34-502"><a href="fsf.html#cb34-502" aria-hidden="true" tabindex="-1"></a>p95_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>p95, <span class="at">na.rm =</span> T)</span>
<span id="cb34-503"><a href="fsf.html#cb34-503" aria-hidden="true" tabindex="-1"></a>cc_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>cc, <span class="at">na.rm =</span> T)</span>
<span id="cb34-504"><a href="fsf.html#cb34-504" aria-hidden="true" tabindex="-1"></a>cv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>cv, <span class="at">na.rm =</span> T)</span>
<span id="cb34-505"><a href="fsf.html#cb34-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-506"><a href="fsf.html#cb34-506" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pvals2)</span>
<span id="cb34-507"><a href="fsf.html#cb34-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-508"><a href="fsf.html#cb34-508" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate SST</span></span>
<span id="cb34-509"><a href="fsf.html#cb34-509" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb34-510"><a href="fsf.html#cb34-510" aria-hidden="true" tabindex="-1"></a>  pvals,</span>
<span id="cb34-511"><a href="fsf.html#cb34-511" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-512"><a href="fsf.html#cb34-512" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">sum</span>((x<span class="sc">$</span>p95 <span class="sc">-</span> p95_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb34-513"><a href="fsf.html#cb34-513" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cc <span class="sc">-</span> cc_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb34-514"><a href="fsf.html#cb34-514" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cv <span class="sc">-</span> cv_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)))</span>
<span id="cb34-515"><a href="fsf.html#cb34-515" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-516"><a href="fsf.html#cb34-516" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-517"><a href="fsf.html#cb34-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-518"><a href="fsf.html#cb34-518" aria-hidden="true" tabindex="-1"></a><span class="co"># transpose</span></span>
<span id="cb34-519"><a href="fsf.html#cb34-519" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">t</span>(sst)</span>
<span id="cb34-520"><a href="fsf.html#cb34-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-521"><a href="fsf.html#cb34-521" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate final sums</span></span>
<span id="cb34-522"><a href="fsf.html#cb34-522" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">colSums</span>(sst)</span>
<span id="cb34-523"><a href="fsf.html#cb34-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-524"><a href="fsf.html#cb34-524" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate r2 values</span></span>
<span id="cb34-525"><a href="fsf.html#cb34-525" aria-hidden="true" tabindex="-1"></a>r2_p95 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">1</span>] <span class="sc">/</span> sst[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb34-526"><a href="fsf.html#cb34-526" aria-hidden="true" tabindex="-1"></a>r2_cc <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">2</span>] <span class="sc">/</span> sst[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb34-527"><a href="fsf.html#cb34-527" aria-hidden="true" tabindex="-1"></a>r2_cv <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">3</span>] <span class="sc">/</span> sst[<span class="dv">3</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb34-528"><a href="fsf.html#cb34-528" aria-hidden="true" tabindex="-1"></a>r2_all <span class="ot">&lt;-</span> (<span class="fu">sum</span>(r2_p95, r2_cc, r2_cv) <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb34-529"><a href="fsf.html#cb34-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-530"><a href="fsf.html#cb34-530" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe with values wanted</span></span>
<span id="cb34-531"><a href="fsf.html#cb34-531" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-532"><a href="fsf.html#cb34-532" aria-hidden="true" tabindex="-1"></a>  <span class="at">alg =</span> name,</span>
<span id="cb34-533"><a href="fsf.html#cb34-533" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_pix =</span> (<span class="fu">min</span>(p2<span class="sc">$</span>nbPixels)),</span>
<span id="cb34-534"><a href="fsf.html#cb34-534" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_pix =</span> (<span class="fu">max</span>(p2<span class="sc">$</span>nbPixels)),</span>
<span id="cb34-535"><a href="fsf.html#cb34-535" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_pix =</span> (<span class="fu">mean</span>(p2<span class="sc">$</span>nbPixels)),</span>
<span id="cb34-536"><a href="fsf.html#cb34-536" aria-hidden="true" tabindex="-1"></a>  <span class="at">med_pix =</span> (<span class="fu">median</span>(p2<span class="sc">$</span>nbPixels)),</span>
<span id="cb34-537"><a href="fsf.html#cb34-537" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_poly =</span> <span class="fu">NROW</span>(p2),</span>
<span id="cb34-538"><a href="fsf.html#cb34-538" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_area =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>area),</span>
<span id="cb34-539"><a href="fsf.html#cb34-539" aria-hidden="true" tabindex="-1"></a>  <span class="at">se_area =</span> <span class="fu">se</span>(p2<span class="sc">$</span>area),</span>
<span id="cb34-540"><a href="fsf.html#cb34-540" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_area =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>area),</span>
<span id="cb34-541"><a href="fsf.html#cb34-541" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_perim =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>perim),</span>
<span id="cb34-542"><a href="fsf.html#cb34-542" aria-hidden="true" tabindex="-1"></a>  <span class="at">se_perim =</span> <span class="fu">se</span>(p2<span class="sc">$</span>perim),</span>
<span id="cb34-543"><a href="fsf.html#cb34-543" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_perim =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>perim),</span>
<span id="cb34-544"><a href="fsf.html#cb34-544" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_p_a =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>p_to_a),</span>
<span id="cb34-545"><a href="fsf.html#cb34-545" aria-hidden="true" tabindex="-1"></a>  <span class="at">se_p_a =</span> <span class="fu">se</span>(p2<span class="sc">$</span>p_to_a),</span>
<span id="cb34-546"><a href="fsf.html#cb34-546" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_p_a =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>p_to_a),</span>
<span id="cb34-547"><a href="fsf.html#cb34-547" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_msi =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>msi),</span>
<span id="cb34-548"><a href="fsf.html#cb34-548" aria-hidden="true" tabindex="-1"></a>  <span class="at">se_msi =</span> <span class="fu">se</span>(p2<span class="sc">$</span>msi),</span>
<span id="cb34-549"><a href="fsf.html#cb34-549" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_msi =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>msi),</span>
<span id="cb34-550"><a href="fsf.html#cb34-550" aria-hidden="true" tabindex="-1"></a>  <span class="at">r2_p95 =</span> r2_p95,</span>
<span id="cb34-551"><a href="fsf.html#cb34-551" aria-hidden="true" tabindex="-1"></a>  <span class="at">r2_cc =</span> r2_cc,</span>
<span id="cb34-552"><a href="fsf.html#cb34-552" aria-hidden="true" tabindex="-1"></a>  <span class="at">r2_cv =</span> r2_cv,</span>
<span id="cb34-553"><a href="fsf.html#cb34-553" aria-hidden="true" tabindex="-1"></a>  <span class="at">r2_all =</span> r2_all</span>
<span id="cb34-554"><a href="fsf.html#cb34-554" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-555"><a href="fsf.html#cb34-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-556"><a href="fsf.html#cb34-556" aria-hidden="true" tabindex="-1"></a><span class="co"># round numeric columns</span></span>
<span id="cb34-557"><a href="fsf.html#cb34-557" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb34-558"><a href="fsf.html#cb34-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(</span>
<span id="cb34-559"><a href="fsf.html#cb34-559" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;min_pix&#39;</span>,</span>
<span id="cb34-560"><a href="fsf.html#cb34-560" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;max_pix&#39;</span>,</span>
<span id="cb34-561"><a href="fsf.html#cb34-561" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;mean_pix&#39;</span>,</span>
<span id="cb34-562"><a href="fsf.html#cb34-562" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;med_pix&#39;</span>,</span>
<span id="cb34-563"><a href="fsf.html#cb34-563" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;mean_area&#39;</span>,</span>
<span id="cb34-564"><a href="fsf.html#cb34-564" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;se_area&#39;</span>,</span>
<span id="cb34-565"><a href="fsf.html#cb34-565" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;sd_area&#39;</span>,</span>
<span id="cb34-566"><a href="fsf.html#cb34-566" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;mean_perim&#39;</span>,</span>
<span id="cb34-567"><a href="fsf.html#cb34-567" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;se_perim&#39;</span>,</span>
<span id="cb34-568"><a href="fsf.html#cb34-568" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;sd_perim&#39;</span></span>
<span id="cb34-569"><a href="fsf.html#cb34-569" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb34-570"><a href="fsf.html#cb34-570" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x)</span>
<span id="cb34-571"><a href="fsf.html#cb34-571" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(x, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-572"><a href="fsf.html#cb34-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&#39;mean_p_a&#39;</span>,</span>
<span id="cb34-573"><a href="fsf.html#cb34-573" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;se_p_a&#39;</span>,</span>
<span id="cb34-574"><a href="fsf.html#cb34-574" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;sd_p_a&#39;</span>,</span>
<span id="cb34-575"><a href="fsf.html#cb34-575" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;mean_msi&#39;</span>,</span>
<span id="cb34-576"><a href="fsf.html#cb34-576" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;se_msi&#39;</span>,</span>
<span id="cb34-577"><a href="fsf.html#cb34-577" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;sd_msi&#39;</span>),</span>
<span id="cb34-578"><a href="fsf.html#cb34-578" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x)</span>
<span id="cb34-579"><a href="fsf.html#cb34-579" aria-hidden="true" tabindex="-1"></a>              <span class="fu">round</span>(x, <span class="dv">4</span>))</span>
<span id="cb34-580"><a href="fsf.html#cb34-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-581"><a href="fsf.html#cb34-581" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb34-582"><a href="fsf.html#cb34-582" aria-hidden="true" tabindex="-1"></a><span class="do">### ADD FRI STATS </span><span class="al">###</span></span>
<span id="cb34-583"><a href="fsf.html#cb34-583" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb34-584"><a href="fsf.html#cb34-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-585"><a href="fsf.html#cb34-585" aria-hidden="true" tabindex="-1"></a><span class="co"># load interpreter derived polygons to extract statistics</span></span>
<span id="cb34-586"><a href="fsf.html#cb34-586" aria-hidden="true" tabindex="-1"></a>pfri <span class="ot">&lt;-</span> <span class="fu">vect</span>(fri)</span>
<span id="cb34-587"><a href="fsf.html#cb34-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-588"><a href="fsf.html#cb34-588" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf</span></span>
<span id="cb34-589"><a href="fsf.html#cb34-589" aria-hidden="true" tabindex="-1"></a>pfri_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(pfri)</span>
<span id="cb34-590"><a href="fsf.html#cb34-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-591"><a href="fsf.html#cb34-591" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate perimeter</span></span>
<span id="cb34-592"><a href="fsf.html#cb34-592" aria-hidden="true" tabindex="-1"></a>pfri<span class="sc">$</span>perim <span class="ot">&lt;-</span> <span class="fu">st_perimeter</span>(pfri_sf) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb34-593"><a href="fsf.html#cb34-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-594"><a href="fsf.html#cb34-594" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate area</span></span>
<span id="cb34-595"><a href="fsf.html#cb34-595" aria-hidden="true" tabindex="-1"></a>pfri<span class="sc">$</span>area <span class="ot">&lt;-</span> <span class="fu">st_area</span>(pfri_sf) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb34-596"><a href="fsf.html#cb34-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-597"><a href="fsf.html#cb34-597" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate nbPixels</span></span>
<span id="cb34-598"><a href="fsf.html#cb34-598" aria-hidden="true" tabindex="-1"></a>pfri<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> pfri<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span></span>
<span id="cb34-599"><a href="fsf.html#cb34-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-600"><a href="fsf.html#cb34-600" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate perimeter to area ratio</span></span>
<span id="cb34-601"><a href="fsf.html#cb34-601" aria-hidden="true" tabindex="-1"></a>pfri<span class="sc">$</span>p_to_a <span class="ot">&lt;-</span> pfri<span class="sc">$</span>perim <span class="sc">/</span> pfri<span class="sc">$</span>area</span>
<span id="cb34-602"><a href="fsf.html#cb34-602" aria-hidden="true" tabindex="-1"></a>pfri<span class="sc">$</span>p_to_a <span class="ot">&lt;-</span> <span class="fu">round</span>(pfri<span class="sc">$</span>p_to_a, <span class="dv">3</span>)</span>
<span id="cb34-603"><a href="fsf.html#cb34-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-604"><a href="fsf.html#cb34-604" aria-hidden="true" tabindex="-1"></a><span class="co"># subset all non water/ucl polygons</span></span>
<span id="cb34-605"><a href="fsf.html#cb34-605" aria-hidden="true" tabindex="-1"></a>p2fri_sf <span class="ot">&lt;-</span> pfri[<span class="sc">!</span>(pfri<span class="sc">$</span>POLYTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;WAT&#39;</span>, <span class="st">&#39;UCL&#39;</span>))] <span class="sc">%&gt;%</span> st_as_sf</span>
<span id="cb34-606"><a href="fsf.html#cb34-606" aria-hidden="true" tabindex="-1"></a>p2fri <span class="ot">&lt;-</span> pfri[<span class="sc">!</span>(pfri<span class="sc">$</span>POLYTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;WAT&#39;</span>, <span class="st">&#39;UCL&#39;</span>))] <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb34-607"><a href="fsf.html#cb34-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-608"><a href="fsf.html#cb34-608" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate msi</span></span>
<span id="cb34-609"><a href="fsf.html#cb34-609" aria-hidden="true" tabindex="-1"></a>p2fri<span class="sc">$</span>msi <span class="ot">&lt;-</span> p2fri<span class="sc">$</span>perim <span class="sc">/</span> <span class="fu">sqrt</span>(pi <span class="sc">*</span> p2fri<span class="sc">$</span>area)</span>
<span id="cb34-610"><a href="fsf.html#cb34-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-611"><a href="fsf.html#cb34-611" aria-hidden="true" tabindex="-1"></a><span class="co"># load original raster input file</span></span>
<span id="cb34-612"><a href="fsf.html#cb34-612" aria-hidden="true" tabindex="-1"></a>ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(grm_input)</span>
<span id="cb34-613"><a href="fsf.html#cb34-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-614"><a href="fsf.html#cb34-614" aria-hidden="true" tabindex="-1"></a><span class="co"># rename bands</span></span>
<span id="cb34-615"><a href="fsf.html#cb34-615" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ras) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;p95&#39;</span>, <span class="st">&#39;cc&#39;</span>, <span class="st">&#39;cv&#39;</span>)</span>
<span id="cb34-616"><a href="fsf.html#cb34-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-617"><a href="fsf.html#cb34-617" aria-hidden="true" tabindex="-1"></a><span class="co"># extract pixel values</span></span>
<span id="cb34-618"><a href="fsf.html#cb34-618" aria-hidden="true" tabindex="-1"></a>pvals <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(ras, p2fri_sf)</span>
<span id="cb34-619"><a href="fsf.html#cb34-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-620"><a href="fsf.html#cb34-620" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate SSE</span></span>
<span id="cb34-621"><a href="fsf.html#cb34-621" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb34-622"><a href="fsf.html#cb34-622" aria-hidden="true" tabindex="-1"></a>  pvals,</span>
<span id="cb34-623"><a href="fsf.html#cb34-623" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-624"><a href="fsf.html#cb34-624" aria-hidden="true" tabindex="-1"></a>    <span class="co"># subset values based on coverage fraction</span></span>
<span id="cb34-625"><a href="fsf.html#cb34-625" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(coverage_fraction <span class="sc">&gt;=</span> <span class="fl">0.5</span>)</span>
<span id="cb34-626"><a href="fsf.html#cb34-626" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-627"><a href="fsf.html#cb34-627" aria-hidden="true" tabindex="-1"></a>    p95_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>p95, <span class="at">na.rm =</span> T)</span>
<span id="cb34-628"><a href="fsf.html#cb34-628" aria-hidden="true" tabindex="-1"></a>    cc_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>cc, <span class="at">na.rm =</span> T)</span>
<span id="cb34-629"><a href="fsf.html#cb34-629" aria-hidden="true" tabindex="-1"></a>    cv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>cv, <span class="at">na.rm =</span> T)</span>
<span id="cb34-630"><a href="fsf.html#cb34-630" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-631"><a href="fsf.html#cb34-631" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">sum</span>((x<span class="sc">$</span>p95 <span class="sc">-</span> p95_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb34-632"><a href="fsf.html#cb34-632" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cc <span class="sc">-</span> cc_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb34-633"><a href="fsf.html#cb34-633" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cv <span class="sc">-</span> cv_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)))</span>
<span id="cb34-634"><a href="fsf.html#cb34-634" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-635"><a href="fsf.html#cb34-635" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-636"><a href="fsf.html#cb34-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-637"><a href="fsf.html#cb34-637" aria-hidden="true" tabindex="-1"></a><span class="co"># transpose</span></span>
<span id="cb34-638"><a href="fsf.html#cb34-638" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="fu">t</span>(sse)</span>
<span id="cb34-639"><a href="fsf.html#cb34-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-640"><a href="fsf.html#cb34-640" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate final sums</span></span>
<span id="cb34-641"><a href="fsf.html#cb34-641" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="fu">colSums</span>(sse)</span>
<span id="cb34-642"><a href="fsf.html#cb34-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-643"><a href="fsf.html#cb34-643" aria-hidden="true" tabindex="-1"></a><span class="co"># unlist values</span></span>
<span id="cb34-644"><a href="fsf.html#cb34-644" aria-hidden="true" tabindex="-1"></a>pvals2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, pvals)</span>
<span id="cb34-645"><a href="fsf.html#cb34-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-646"><a href="fsf.html#cb34-646" aria-hidden="true" tabindex="-1"></a><span class="co"># subset values based on coverage fraction</span></span>
<span id="cb34-647"><a href="fsf.html#cb34-647" aria-hidden="true" tabindex="-1"></a>pvals2 <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(coverage_fraction <span class="sc">&gt;=</span> <span class="fl">0.5</span>)</span>
<span id="cb34-648"><a href="fsf.html#cb34-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-649"><a href="fsf.html#cb34-649" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate global mean values</span></span>
<span id="cb34-650"><a href="fsf.html#cb34-650" aria-hidden="true" tabindex="-1"></a>p95_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>p95, <span class="at">na.rm =</span> T)</span>
<span id="cb34-651"><a href="fsf.html#cb34-651" aria-hidden="true" tabindex="-1"></a>cc_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>cc, <span class="at">na.rm =</span> T)</span>
<span id="cb34-652"><a href="fsf.html#cb34-652" aria-hidden="true" tabindex="-1"></a>cv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>cv, <span class="at">na.rm =</span> T)</span>
<span id="cb34-653"><a href="fsf.html#cb34-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-654"><a href="fsf.html#cb34-654" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pvals2)</span>
<span id="cb34-655"><a href="fsf.html#cb34-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-656"><a href="fsf.html#cb34-656" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate SST</span></span>
<span id="cb34-657"><a href="fsf.html#cb34-657" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb34-658"><a href="fsf.html#cb34-658" aria-hidden="true" tabindex="-1"></a>  pvals,</span>
<span id="cb34-659"><a href="fsf.html#cb34-659" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-660"><a href="fsf.html#cb34-660" aria-hidden="true" tabindex="-1"></a>    <span class="co"># subset values based on coverage fraction</span></span>
<span id="cb34-661"><a href="fsf.html#cb34-661" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(coverage_fraction <span class="sc">&gt;=</span> <span class="fl">0.5</span>)</span>
<span id="cb34-662"><a href="fsf.html#cb34-662" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-663"><a href="fsf.html#cb34-663" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">sum</span>((x<span class="sc">$</span>p95 <span class="sc">-</span> p95_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb34-664"><a href="fsf.html#cb34-664" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cc <span class="sc">-</span> cc_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb34-665"><a href="fsf.html#cb34-665" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cv <span class="sc">-</span> cv_mean) <span class="sc">^</span> <span class="dv">2</span>, <span class="at">na.rm =</span> T)))</span>
<span id="cb34-666"><a href="fsf.html#cb34-666" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-667"><a href="fsf.html#cb34-667" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-668"><a href="fsf.html#cb34-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-669"><a href="fsf.html#cb34-669" aria-hidden="true" tabindex="-1"></a><span class="co"># transpose</span></span>
<span id="cb34-670"><a href="fsf.html#cb34-670" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">t</span>(sst)</span>
<span id="cb34-671"><a href="fsf.html#cb34-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-672"><a href="fsf.html#cb34-672" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate final sums</span></span>
<span id="cb34-673"><a href="fsf.html#cb34-673" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">colSums</span>(sst)</span>
<span id="cb34-674"><a href="fsf.html#cb34-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-675"><a href="fsf.html#cb34-675" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate r2 values</span></span>
<span id="cb34-676"><a href="fsf.html#cb34-676" aria-hidden="true" tabindex="-1"></a>r2_p95 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">1</span>] <span class="sc">/</span> sst[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb34-677"><a href="fsf.html#cb34-677" aria-hidden="true" tabindex="-1"></a>r2_cc <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">2</span>] <span class="sc">/</span> sst[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb34-678"><a href="fsf.html#cb34-678" aria-hidden="true" tabindex="-1"></a>r2_cv <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">3</span>] <span class="sc">/</span> sst[<span class="dv">3</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb34-679"><a href="fsf.html#cb34-679" aria-hidden="true" tabindex="-1"></a>r2_all <span class="ot">&lt;-</span> (<span class="fu">sum</span>(r2_p95, r2_cc, r2_cv) <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb34-680"><a href="fsf.html#cb34-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-681"><a href="fsf.html#cb34-681" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe with values wanted</span></span>
<span id="cb34-682"><a href="fsf.html#cb34-682" aria-hidden="true" tabindex="-1"></a>ms_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-683"><a href="fsf.html#cb34-683" aria-hidden="true" tabindex="-1"></a>  <span class="at">alg =</span> <span class="st">&#39;FRI&#39;</span>,</span>
<span id="cb34-684"><a href="fsf.html#cb34-684" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_pix =</span> (<span class="fu">min</span>(p2fri<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span>)),</span>
<span id="cb34-685"><a href="fsf.html#cb34-685" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_pix =</span> (<span class="fu">max</span>(p2fri<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span>)),</span>
<span id="cb34-686"><a href="fsf.html#cb34-686" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_pix =</span> (<span class="fu">mean</span>(p2fri<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span>)),</span>
<span id="cb34-687"><a href="fsf.html#cb34-687" aria-hidden="true" tabindex="-1"></a>  <span class="at">med_pix =</span> (<span class="fu">median</span>(p2fri<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span>)),</span>
<span id="cb34-688"><a href="fsf.html#cb34-688" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_poly =</span> <span class="fu">NROW</span>(p2fri),</span>
<span id="cb34-689"><a href="fsf.html#cb34-689" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_area =</span> <span class="fu">mean</span>(p2fri<span class="sc">$</span>area),</span>
<span id="cb34-690"><a href="fsf.html#cb34-690" aria-hidden="true" tabindex="-1"></a>  <span class="at">se_area =</span> <span class="fu">se</span>(p2fri<span class="sc">$</span>area),</span>
<span id="cb34-691"><a href="fsf.html#cb34-691" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_area =</span> <span class="fu">sd</span>(p2fri<span class="sc">$</span>area),</span>
<span id="cb34-692"><a href="fsf.html#cb34-692" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_perim =</span> <span class="fu">mean</span>(p2fri<span class="sc">$</span>perim),</span>
<span id="cb34-693"><a href="fsf.html#cb34-693" aria-hidden="true" tabindex="-1"></a>  <span class="at">se_perim =</span> <span class="fu">se</span>(p2fri<span class="sc">$</span>perim),</span>
<span id="cb34-694"><a href="fsf.html#cb34-694" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_perim =</span> <span class="fu">sd</span>(p2fri<span class="sc">$</span>perim),</span>
<span id="cb34-695"><a href="fsf.html#cb34-695" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_p_a =</span> <span class="fu">mean</span>(p2fri<span class="sc">$</span>p_to_a),</span>
<span id="cb34-696"><a href="fsf.html#cb34-696" aria-hidden="true" tabindex="-1"></a>  <span class="at">se_p_a =</span> <span class="fu">se</span>(p2fri<span class="sc">$</span>p_to_a),</span>
<span id="cb34-697"><a href="fsf.html#cb34-697" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_p_a =</span> <span class="fu">sd</span>(p2fri<span class="sc">$</span>p_to_a),</span>
<span id="cb34-698"><a href="fsf.html#cb34-698" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_msi =</span> <span class="fu">mean</span>(p2fri<span class="sc">$</span>msi),</span>
<span id="cb34-699"><a href="fsf.html#cb34-699" aria-hidden="true" tabindex="-1"></a>  <span class="at">se_msi =</span> <span class="fu">se</span>(p2fri<span class="sc">$</span>msi),</span>
<span id="cb34-700"><a href="fsf.html#cb34-700" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd_msi =</span> <span class="fu">sd</span>(p2fri<span class="sc">$</span>msi),</span>
<span id="cb34-701"><a href="fsf.html#cb34-701" aria-hidden="true" tabindex="-1"></a>  <span class="at">r2_p95 =</span> r2_p95,</span>
<span id="cb34-702"><a href="fsf.html#cb34-702" aria-hidden="true" tabindex="-1"></a>  <span class="at">r2_cc =</span> r2_cc,</span>
<span id="cb34-703"><a href="fsf.html#cb34-703" aria-hidden="true" tabindex="-1"></a>  <span class="at">r2_cv =</span> r2_cv,</span>
<span id="cb34-704"><a href="fsf.html#cb34-704" aria-hidden="true" tabindex="-1"></a>  <span class="at">r2_all =</span> r2_all</span>
<span id="cb34-705"><a href="fsf.html#cb34-705" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-706"><a href="fsf.html#cb34-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-707"><a href="fsf.html#cb34-707" aria-hidden="true" tabindex="-1"></a><span class="co"># round numeric columns</span></span>
<span id="cb34-708"><a href="fsf.html#cb34-708" aria-hidden="true" tabindex="-1"></a>ms_df <span class="sc">%&lt;&gt;%</span></span>
<span id="cb34-709"><a href="fsf.html#cb34-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&#39;min_pix&#39;</span>,</span>
<span id="cb34-710"><a href="fsf.html#cb34-710" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;max_pix&#39;</span>,</span>
<span id="cb34-711"><a href="fsf.html#cb34-711" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;mean_pix&#39;</span>,</span>
<span id="cb34-712"><a href="fsf.html#cb34-712" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;med_pix&#39;</span>),</span>
<span id="cb34-713"><a href="fsf.html#cb34-713" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x)</span>
<span id="cb34-714"><a href="fsf.html#cb34-714" aria-hidden="true" tabindex="-1"></a>              <span class="fu">round</span>(x)) <span class="sc">%&gt;%</span></span>
<span id="cb34-715"><a href="fsf.html#cb34-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(</span>
<span id="cb34-716"><a href="fsf.html#cb34-716" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;mean_area&#39;</span>,</span>
<span id="cb34-717"><a href="fsf.html#cb34-717" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;se_area&#39;</span>,</span>
<span id="cb34-718"><a href="fsf.html#cb34-718" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;sd_area&#39;</span>,</span>
<span id="cb34-719"><a href="fsf.html#cb34-719" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;mean_perim&#39;</span>,</span>
<span id="cb34-720"><a href="fsf.html#cb34-720" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;se_perim&#39;</span>,</span>
<span id="cb34-721"><a href="fsf.html#cb34-721" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;sd_perim&#39;</span></span>
<span id="cb34-722"><a href="fsf.html#cb34-722" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb34-723"><a href="fsf.html#cb34-723" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x)</span>
<span id="cb34-724"><a href="fsf.html#cb34-724" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(x, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-725"><a href="fsf.html#cb34-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&#39;mean_p_a&#39;</span>,</span>
<span id="cb34-726"><a href="fsf.html#cb34-726" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;se_p_a&#39;</span>,</span>
<span id="cb34-727"><a href="fsf.html#cb34-727" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;sd_p_a&#39;</span>,</span>
<span id="cb34-728"><a href="fsf.html#cb34-728" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;mean_msi&#39;</span>,</span>
<span id="cb34-729"><a href="fsf.html#cb34-729" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;se_msi&#39;</span>,</span>
<span id="cb34-730"><a href="fsf.html#cb34-730" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;sd_msi&#39;</span>),</span>
<span id="cb34-731"><a href="fsf.html#cb34-731" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x)</span>
<span id="cb34-732"><a href="fsf.html#cb34-732" aria-hidden="true" tabindex="-1"></a>              <span class="fu">round</span>(x, <span class="dv">4</span>))</span>
<span id="cb34-733"><a href="fsf.html#cb34-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-734"><a href="fsf.html#cb34-734" aria-hidden="true" tabindex="-1"></a><span class="co"># bind df</span></span>
<span id="cb34-735"><a href="fsf.html#cb34-735" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df, ms_df)</span>
<span id="cb34-736"><a href="fsf.html#cb34-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-737"><a href="fsf.html#cb34-737" aria-hidden="true" tabindex="-1"></a><span class="co"># write df as csv</span></span>
<span id="cb34-738"><a href="fsf.html#cb34-738" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df,</span>
<span id="cb34-739"><a href="fsf.html#cb34-739" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="fu">str_c</span>(out_loc, <span class="st">&#39;/summary_stats.csv&#39;</span>),</span>
<span id="cb34-740"><a href="fsf.html#cb34-740" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span></code></pre></div>
</div>
<div id="fsf612" class="section level3 unnumbered hasAnchor">
<h3><strong>6.1.2</strong> Results: Summary Statistics<a href="fsf.html#fsf612" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Polygon size statistics:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="fsf.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb35-2"><a href="fsf.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Summary Stats and Additional Tables </span><span class="al">###</span></span>
<span id="cb35-3"><a href="fsf.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb35-4"><a href="fsf.html#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="fsf.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Size</span></span>
<span id="cb35-6"><a href="fsf.html#cb35-6" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(df[, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb35-7"><a href="fsf.html#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="fsf.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># change to ha</span></span>
<span id="cb35-9"><a href="fsf.html#cb35-9" aria-hidden="true" tabindex="-1"></a>t1[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(t1[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>] <span class="sc">/</span> <span class="dv">25</span>, <span class="dv">2</span>)</span>
<span id="cb35-10"><a href="fsf.html#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="fsf.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Dataset&#39;</span>, <span class="st">&quot;Min Ha&quot;</span>, <span class="st">&#39;Max Ha&#39;</span>, <span class="st">&quot;Mean Ha&quot;</span>,</span>
<span id="cb35-12"><a href="fsf.html#cb35-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Median Ha&quot;</span>, <span class="st">&quot;Number of Polygons&quot;</span>)</span>
<span id="cb35-13"><a href="fsf.html#cb35-13" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(t1, <span class="at">caption =</span> <span class="st">&quot;Table 1: Polygon Size Stats&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Table 1: Polygon Size Stats</caption>
<thead>
<tr class="header">
<th align="left">Dataset</th>
<th align="right">Min Ha</th>
<th align="right">Max Ha</th>
<th align="right">Mean Ha</th>
<th align="right">Median Ha</th>
<th align="right">Number of Polygons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">grm_10_01_05</td>
<td align="right">0.04</td>
<td align="right">60.00</td>
<td align="right">4.71</td>
<td align="right">3.40</td>
<td align="right">223321</td>
</tr>
<tr class="even">
<td align="left">FRI</td>
<td align="right">0.00</td>
<td align="right">821.08</td>
<td align="right">5.24</td>
<td align="right">1.16</td>
<td align="right">207121</td>
</tr>
</tbody>
</table>
<p>The FSF is much larger than the RMF, with over twice as many polygons. The mean polygon size is around ~5 Ha for both the GRM polygons and the FRI, but the median polygon size is much smaller in the FRI. This tells us that in the FSF FRI there are more small polygons, but also a number of polygons with a large size, compared to GRM segmentation.</p>
<p>Area and perimeter:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="fsf.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Area and Perim</span></span>
<span id="cb36-2"><a href="fsf.html#cb36-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(df[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>)])</span>
<span id="cb36-3"><a href="fsf.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="fsf.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># change area to Ha</span></span>
<span id="cb36-5"><a href="fsf.html#cb36-5" aria-hidden="true" tabindex="-1"></a>t2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(t2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>] <span class="sc">/</span> <span class="dv">10000</span>, <span class="dv">2</span>)</span>
<span id="cb36-6"><a href="fsf.html#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="fsf.html#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Dataset&quot;</span>, <span class="st">&quot;Mean Area (Ha)&quot;</span>, <span class="st">&quot;SE Area&quot;</span>, <span class="st">&quot;SD Area&quot;</span>,</span>
<span id="cb36-8"><a href="fsf.html#cb36-8" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Mean Perimeter (m)&quot;</span>, <span class="st">&quot;SE Perimeter&quot;</span>, <span class="st">&quot;SD Perimeter&quot;</span>)</span>
<span id="cb36-9"><a href="fsf.html#cb36-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(t2, <span class="at">caption =</span> <span class="st">&quot;Table 2: Polygon Area and Perimeter Stats&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Table 2: Polygon Area and Perimeter Stats</caption>
<colgroup>
<col width="14%" />
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="21%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Dataset</th>
<th align="right">Mean Area (Ha)</th>
<th align="right">SE Area</th>
<th align="right">SD Area</th>
<th align="right">Mean Perimeter (m)</th>
<th align="right">SE Perimeter</th>
<th align="right">SD Perimeter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">grm_10_01_05</td>
<td align="right">4.71</td>
<td align="right">0.01</td>
<td align="right">4.27</td>
<td align="right">1155.00</td>
<td align="right">1.09</td>
<td align="right">517.22</td>
</tr>
<tr class="even">
<td align="left">FRI</td>
<td align="right">5.25</td>
<td align="right">0.02</td>
<td align="right">10.49</td>
<td align="right">1257.18</td>
<td align="right">3.78</td>
<td align="right">1719.51</td>
</tr>
</tbody>
</table>
<p>GRM mean area and perimeter are smaller than the FRI, with less variability.</p>
<p>Shape index:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="fsf.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean Shape Index</span></span>
<span id="cb37-2"><a href="fsf.html#cb37-2" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(df[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span><span class="sc">:</span><span class="dv">18</span>)])</span>
<span id="cb37-3"><a href="fsf.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t3) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Dataset&quot;</span>, <span class="st">&quot;Mean Shape Index&quot;</span>, <span class="st">&quot;SE Shape Index&quot;</span>, <span class="st">&quot;SD Shape Index&quot;</span>)</span>
<span id="cb37-4"><a href="fsf.html#cb37-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(t3, <span class="at">caption =</span> <span class="st">&quot;Table 3: Polygon Shape Index Stats&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Table 3: Polygon Shape Index Stats</caption>
<thead>
<tr class="header">
<th align="left">Dataset</th>
<th align="right">Mean Shape Index</th>
<th align="right">SE Shape Index</th>
<th align="right">SD Shape Index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">grm_10_01_05</td>
<td align="right">3.3014</td>
<td align="right">0.0015</td>
<td align="right">0.6915</td>
</tr>
<tr class="even">
<td align="left">FRI</td>
<td align="right">4.1344</td>
<td align="right">0.0035</td>
<td align="right">1.6105</td>
</tr>
</tbody>
</table>
<p>GRM polygons are more compact.</p>
<p>R2:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="fsf.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R2</span></span>
<span id="cb38-2"><a href="fsf.html#cb38-2" aria-hidden="true" tabindex="-1"></a>t4 <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(df[,<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span><span class="sc">:</span><span class="dv">22</span>)])</span>
<span id="cb38-3"><a href="fsf.html#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="fsf.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># round</span></span>
<span id="cb38-5"><a href="fsf.html#cb38-5" aria-hidden="true" tabindex="-1"></a>t4[,<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(t4[,<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">2</span>)</span>
<span id="cb38-6"><a href="fsf.html#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="fsf.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t4) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Dataset&#39;</span>, <span class="st">&#39;R2 P95&#39;</span>, <span class="st">&#39;R2 Can Cov&#39;</span>, <span class="st">&#39;R2 Coeff Var&#39;</span>, <span class="st">&#39;R2 Overall&#39;</span>)</span>
<span id="cb38-8"><a href="fsf.html#cb38-8" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(t4, <span class="at">caption =</span> <span class="st">&quot;Table 4: Polygon R2 Stats&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Table 4: Polygon R2 Stats</caption>
<thead>
<tr class="header">
<th align="left">Dataset</th>
<th align="right">R2 P95</th>
<th align="right">R2 Can Cov</th>
<th align="right">R2 Coeff Var</th>
<th align="right">R2 Overall</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">grm_10_01_05</td>
<td align="right">0.88</td>
<td align="right">0.90</td>
<td align="right">0.88</td>
<td align="right">0.88</td>
</tr>
<tr class="even">
<td align="left">FRI</td>
<td align="right">0.82</td>
<td align="right">0.82</td>
<td align="right">0.77</td>
<td align="right">0.80</td>
</tr>
</tbody>
</table>
<p>GRM polygons have an overall R2 value of 0.88 compared to 0.80 from the FRI.</p>
</div>
<div id="fsf613" class="section level3 unnumbered hasAnchor">
<h3><strong>6.1.3</strong> Results: Distribution Plots<a href="fsf.html#fsf613" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Polygon size:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="fsf.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot density GRM in ha</span></span>
<span id="cb39-2"><a href="fsf.html#cb39-2" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">nbPixels =</span> p2<span class="sc">$</span>nbPixels <span class="sc">/</span> <span class="dv">25</span>), <span class="fu">aes</span>(<span class="at">x =</span> nbPixels)) <span class="sc">+</span></span>
<span id="cb39-3"><a href="fsf.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb39-4"><a href="fsf.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span><span class="sc">/</span><span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb39-5"><a href="fsf.html#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.60</span>)) <span class="sc">+</span></span>
<span id="cb39-6"><a href="fsf.html#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(nbPixels)),</span>
<span id="cb39-7"><a href="fsf.html#cb39-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb39-8"><a href="fsf.html#cb39-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="fsf.html#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb39-10"><a href="fsf.html#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Number of Hectares&#39;</span>) <span class="sc">+</span></span>
<span id="cb39-11"><a href="fsf.html#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb39-12"><a href="fsf.html#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;GRM Distribution of Polygon Size&#39;</span>) <span class="sc">+</span></span>
<span id="cb39-13"><a href="fsf.html#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb39-14"><a href="fsf.html#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="fsf.html#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot density FRI in ha</span></span>
<span id="cb39-16"><a href="fsf.html#cb39-16" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">nbPixels =</span> p2fri<span class="sc">$</span>nbPixels <span class="sc">/</span> <span class="dv">25</span>), <span class="fu">aes</span>(<span class="at">x =</span> nbPixels)) <span class="sc">+</span></span>
<span id="cb39-17"><a href="fsf.html#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb39-18"><a href="fsf.html#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span><span class="sc">/</span><span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb39-19"><a href="fsf.html#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.60</span>)) <span class="sc">+</span></span>
<span id="cb39-20"><a href="fsf.html#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(nbPixels)),</span>
<span id="cb39-21"><a href="fsf.html#cb39-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb39-22"><a href="fsf.html#cb39-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb39-23"><a href="fsf.html#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb39-24"><a href="fsf.html#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Number of Hectares&#39;</span>) <span class="sc">+</span></span>
<span id="cb39-25"><a href="fsf.html#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb39-26"><a href="fsf.html#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;FRI Distribution of Polygon Size&#39;</span>) <span class="sc">+</span></span>
<span id="cb39-27"><a href="fsf.html#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb39-28"><a href="fsf.html#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="fsf.html#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co"># plot together</span></span>
<span id="cb39-30"><a href="fsf.html#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(g1, g2)</span></code></pre></div>
<p><img src="06-case-study_files/figure-html/fsf6131-1.png" width="1728" /></p>
<p>The density plots of polygon size give us a good indication of how the datasets differ. GRM polygons have a much larger density of polygons in the ~2-6 Ha range, whereas the FRI has a large number of small polygons, and also a fatter tail of ~10-20 Ha polygons.</p>
<p>Shape index:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="fsf.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot shape index GRM</span></span>
<span id="cb40-2"><a href="fsf.html#cb40-2" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">msi =</span> <span class="fu">as.numeric</span>(p2<span class="sc">$</span>msi)), <span class="fu">aes</span>(<span class="at">x =</span> msi)) <span class="sc">+</span></span>
<span id="cb40-3"><a href="fsf.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb40-4"><a href="fsf.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb40-5"><a href="fsf.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb40-6"><a href="fsf.html#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(msi)),</span>
<span id="cb40-7"><a href="fsf.html#cb40-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb40-8"><a href="fsf.html#cb40-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb40-9"><a href="fsf.html#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb40-10"><a href="fsf.html#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Shape Index&#39;</span>) <span class="sc">+</span></span>
<span id="cb40-11"><a href="fsf.html#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb40-12"><a href="fsf.html#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;GRM Distribution of Shape Index&#39;</span>) <span class="sc">+</span></span>
<span id="cb40-13"><a href="fsf.html#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb40-14"><a href="fsf.html#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="fsf.html#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot shape index FRI</span></span>
<span id="cb40-16"><a href="fsf.html#cb40-16" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">msi =</span> <span class="fu">as.numeric</span>(p2fri<span class="sc">$</span>msi)), <span class="fu">aes</span>(<span class="at">x =</span> msi)) <span class="sc">+</span></span>
<span id="cb40-17"><a href="fsf.html#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb40-18"><a href="fsf.html#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb40-19"><a href="fsf.html#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb40-20"><a href="fsf.html#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(msi)),</span>
<span id="cb40-21"><a href="fsf.html#cb40-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb40-22"><a href="fsf.html#cb40-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb40-23"><a href="fsf.html#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb40-24"><a href="fsf.html#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Shape Index&#39;</span>) <span class="sc">+</span></span>
<span id="cb40-25"><a href="fsf.html#cb40-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb40-26"><a href="fsf.html#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;FRI Distribution of Shape Index&#39;</span>) <span class="sc">+</span></span>
<span id="cb40-27"><a href="fsf.html#cb40-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb40-28"><a href="fsf.html#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="fsf.html#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="co"># plot together</span></span>
<span id="cb40-30"><a href="fsf.html#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(g1, g2)</span></code></pre></div>
<p><img src="06-case-study_files/figure-html/fsf6132-1.png" width="1728" /></p>
<p>We can see the distribution of polygon shape is more compact among GRM polygons. Remember that we are using the same GRM algorithm parameters as were used in segmenting the RMF. These parameters can be manipulated to meet the needs of various forested areas with different forest characteristics.</p>
</div>
</div>
<div id="fsf62" class="section level2 unnumbered hasAnchor">
<h2><strong>6.2</strong> Imputation Over FRI<a href="fsf.html#fsf62" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="fsf621" class="section level3 unnumbered hasAnchor">
<h3><strong>6.2.1</strong> Run Algorithm<a href="fsf.html#fsf621" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="fsf.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb41-2"><a href="fsf.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="do">### INSTALL PACKAGES IF NEEDED </span><span class="al">###</span></span>
<span id="cb41-3"><a href="fsf.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb41-4"><a href="fsf.html#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="fsf.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c(&#39;terra&#39;,</span></span>
<span id="cb41-6"><a href="fsf.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;tidyverse&#39;,</span></span>
<span id="cb41-7"><a href="fsf.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;exactextractr&#39;,</span></span>
<span id="cb41-8"><a href="fsf.html#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;sf&#39;,</span></span>
<span id="cb41-9"><a href="fsf.html#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;magrittr&#39;,</span></span>
<span id="cb41-10"><a href="fsf.html#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;gridExtra&#39;,</span></span>
<span id="cb41-11"><a href="fsf.html#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;RANN&#39;,</span></span>
<span id="cb41-12"><a href="fsf.html#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;reshape2&#39;,</span></span>
<span id="cb41-13"><a href="fsf.html#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;viridis&#39;,</span></span>
<span id="cb41-14"><a href="fsf.html#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;scales&#39;,</span></span>
<span id="cb41-15"><a href="fsf.html#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;janitor&#39;,</span></span>
<span id="cb41-16"><a href="fsf.html#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;kableExtra&#39;,</span></span>
<span id="cb41-17"><a href="fsf.html#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                    &#39;knitr&#39;))</span></span>
<span id="cb41-18"><a href="fsf.html#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="fsf.html#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure to have OTB installed from here:</span></span>
<span id="cb41-20"><a href="fsf.html#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.orfeo-toolbox.org/</span></span>
<span id="cb41-21"><a href="fsf.html#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="fsf.html#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb41-23"><a href="fsf.html#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="do">### LOAD PACKAGES </span><span class="al">###</span></span>
<span id="cb41-24"><a href="fsf.html#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb41-25"><a href="fsf.html#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="fsf.html#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb41-27"><a href="fsf.html#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb41-28"><a href="fsf.html#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-29"><a href="fsf.html#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span>
<span id="cb41-30"><a href="fsf.html#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb41-31"><a href="fsf.html#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb41-32"><a href="fsf.html#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb41-33"><a href="fsf.html#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RANN)</span>
<span id="cb41-34"><a href="fsf.html#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb41-35"><a href="fsf.html#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb41-36"><a href="fsf.html#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb41-37"><a href="fsf.html#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb41-38"><a href="fsf.html#cb41-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb41-39"><a href="fsf.html#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb41-40"><a href="fsf.html#cb41-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-41"><a href="fsf.html#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb41-42"><a href="fsf.html#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="do">### SET CODE AND FILE PARAMETERS </span><span class="al">###</span></span>
<span id="cb41-43"><a href="fsf.html#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb41-44"><a href="fsf.html#cb41-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="fsf.html#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="co"># set file names for ALS input variables</span></span>
<span id="cb41-46"><a href="fsf.html#cb41-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-47"><a href="fsf.html#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="co"># first set the imputation X-variables</span></span>
<span id="cb41-48"><a href="fsf.html#cb41-48" aria-hidden="true" tabindex="-1"></a>lidar_imp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;agb&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/FSF/EFI/Biomass.img&#39;</span>,</span>
<span id="cb41-49"><a href="fsf.html#cb41-49" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;gmvwl&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/FSF/EFI/GMV_WL.img&#39;</span>,</span>
<span id="cb41-50"><a href="fsf.html#cb41-50" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;pcum8&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/FSF/ALS/zpcum8.img&#39;</span>,</span>
<span id="cb41-51"><a href="fsf.html#cb41-51" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;ba&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/FSF/EFI/BasalArea.img&#39;</span>,</span>
<span id="cb41-52"><a href="fsf.html#cb41-52" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;b6&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/FSF/sentinel/boa/b6_fsf_2018.tif&#39;</span>)</span>
<span id="cb41-53"><a href="fsf.html#cb41-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-54"><a href="fsf.html#cb41-54" aria-hidden="true" tabindex="-1"></a><span class="co"># next set the data screening variables</span></span>
<span id="cb41-55"><a href="fsf.html#cb41-55" aria-hidden="true" tabindex="-1"></a>lidar_scr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;p95&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/FSF/ALS/zq95.img&#39;</span>,</span>
<span id="cb41-56"><a href="fsf.html#cb41-56" aria-hidden="true" tabindex="-1"></a>               <span class="st">&#39;cc&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/FSF/ALS/cov_2m.img&#39;</span>)</span>
<span id="cb41-57"><a href="fsf.html#cb41-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-58"><a href="fsf.html#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="co"># set file location of FRI polygons shape file</span></span>
<span id="cb41-59"><a href="fsf.html#cb41-59" aria-hidden="true" tabindex="-1"></a>fri <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/FSF/FRI/FSF_opi_polygon_CSRS_NAD83_17.shp&#39;</span></span>
<span id="cb41-60"><a href="fsf.html#cb41-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-61"><a href="fsf.html#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="co"># set file location of GRM polygons shape file</span></span>
<span id="cb41-62"><a href="fsf.html#cb41-62" aria-hidden="true" tabindex="-1"></a>grm <span class="ot">&lt;-</span> <span class="st">&#39;C:/Users/bermane/Desktop/FSF/grm_10_01_05.shp&#39;</span></span>
<span id="cb41-63"><a href="fsf.html#cb41-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-64"><a href="fsf.html#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="co"># set output folder for files generated</span></span>
<span id="cb41-65"><a href="fsf.html#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure no &quot;/&quot; at end of folder location!</span></span>
<span id="cb41-66"><a href="fsf.html#cb41-66" aria-hidden="true" tabindex="-1"></a>out_dir <span class="ot">&lt;-</span> <span class="st">&#39;C:/Users/bermane/Desktop/FSF&#39;</span></span>
<span id="cb41-67"><a href="fsf.html#cb41-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-68"><a href="fsf.html#cb41-68" aria-hidden="true" tabindex="-1"></a><span class="co"># set file location of 2018 VLCE 2.0 landcover data</span></span>
<span id="cb41-69"><a href="fsf.html#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="co"># using 2018 because it is the year of Romeo ALS acquisition</span></span>
<span id="cb41-70"><a href="fsf.html#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="co"># can change based on ALS acquisition year</span></span>
<span id="cb41-71"><a href="fsf.html#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="co"># download here:</span></span>
<span id="cb41-72"><a href="fsf.html#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="co"># https://opendata.nfis.org/mapserver/nfis-change_eng.html</span></span>
<span id="cb41-73"><a href="fsf.html#cb41-73" aria-hidden="true" tabindex="-1"></a>lc_f <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/VLCE/CA_forest_VLCE2_2018.tif&#39;</span></span>
<span id="cb41-74"><a href="fsf.html#cb41-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-75"><a href="fsf.html#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb41-76"><a href="fsf.html#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="do">### EXTRACT VARIABLES INTO FRI POLYGONS </span><span class="al">###</span></span>
<span id="cb41-77"><a href="fsf.html#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb41-78"><a href="fsf.html#cb41-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-79"><a href="fsf.html#cb41-79" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI polygons</span></span>
<span id="cb41-80"><a href="fsf.html#cb41-80" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(fri)</span>
<span id="cb41-81"><a href="fsf.html#cb41-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-82"><a href="fsf.html#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to df</span></span>
<span id="cb41-83"><a href="fsf.html#cb41-83" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(poly)</span>
<span id="cb41-84"><a href="fsf.html#cb41-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-85"><a href="fsf.html#cb41-85" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind centroids to dat</span></span>
<span id="cb41-86"><a href="fsf.html#cb41-86" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat_fri, <span class="fu">centroids</span>(poly) <span class="sc">%&gt;%</span> crds)</span>
<span id="cb41-87"><a href="fsf.html#cb41-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-88"><a href="fsf.html#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all LiDAR and aux variables to extract</span></span>
<span id="cb41-89"><a href="fsf.html#cb41-89" aria-hidden="true" tabindex="-1"></a>lidar_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(lidar_imp, lidar_scr)</span>
<span id="cb41-90"><a href="fsf.html#cb41-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-91"><a href="fsf.html#cb41-91" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through LiDAR attributes to extract values</span></span>
<span id="cb41-92"><a href="fsf.html#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(lidar_vars)) {</span>
<span id="cb41-93"><a href="fsf.html#cb41-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load LiDAR raster</span></span>
<span id="cb41-94"><a href="fsf.html#cb41-94" aria-hidden="true" tabindex="-1"></a>  lidar_ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(lidar_vars[i])</span>
<span id="cb41-95"><a href="fsf.html#cb41-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-96"><a href="fsf.html#cb41-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># project poly to crs of raster</span></span>
<span id="cb41-97"><a href="fsf.html#cb41-97" aria-hidden="true" tabindex="-1"></a>  poly_ras <span class="ot">&lt;-</span> <span class="fu">project</span>(poly, lidar_ras)</span>
<span id="cb41-98"><a href="fsf.html#cb41-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-99"><a href="fsf.html#cb41-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf</span></span>
<span id="cb41-100"><a href="fsf.html#cb41-100" aria-hidden="true" tabindex="-1"></a>  poly_ras <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_ras)</span>
<span id="cb41-101"><a href="fsf.html#cb41-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-102"><a href="fsf.html#cb41-102" aria-hidden="true" tabindex="-1"></a>  <span class="co">#extract median values</span></span>
<span id="cb41-103"><a href="fsf.html#cb41-103" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span></span>
<span id="cb41-104"><a href="fsf.html#cb41-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exact_extract</span>(lidar_ras, poly_ras, <span class="st">&#39;median&#39;</span>)</span>
<span id="cb41-105"><a href="fsf.html#cb41-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-106"><a href="fsf.html#cb41-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aggregate into data frame</span></span>
<span id="cb41-107"><a href="fsf.html#cb41-107" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb41-108"><a href="fsf.html#cb41-108" aria-hidden="true" tabindex="-1"></a>    vec_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(vec)</span>
<span id="cb41-109"><a href="fsf.html#cb41-109" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb41-110"><a href="fsf.html#cb41-110" aria-hidden="true" tabindex="-1"></a>    vec_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(vec_df, <span class="fu">as.data.frame</span>(vec))</span>
<span id="cb41-111"><a href="fsf.html#cb41-111" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-112"><a href="fsf.html#cb41-112" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-113"><a href="fsf.html#cb41-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-114"><a href="fsf.html#cb41-114" aria-hidden="true" tabindex="-1"></a><span class="co"># change column names of extracted attribute data frame</span></span>
<span id="cb41-115"><a href="fsf.html#cb41-115" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(vec_df) <span class="ot">&lt;-</span> <span class="fu">names</span>(lidar_vars)</span>
<span id="cb41-116"><a href="fsf.html#cb41-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-117"><a href="fsf.html#cb41-117" aria-hidden="true" tabindex="-1"></a><span class="co"># add LiDAR attributes to FRI polygon data frame</span></span>
<span id="cb41-118"><a href="fsf.html#cb41-118" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat_fri, vec_df)</span>
<span id="cb41-119"><a href="fsf.html#cb41-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-120"><a href="fsf.html#cb41-120" aria-hidden="true" tabindex="-1"></a><span class="co"># add 2018 age values</span></span>
<span id="cb41-121"><a href="fsf.html#cb41-121" aria-hidden="true" tabindex="-1"></a>dat_fri<span class="sc">$</span>AGE2018 <span class="ot">&lt;-</span> <span class="dv">2018</span> <span class="sc">-</span> dat_fri<span class="sc">$</span>YRORG</span>
<span id="cb41-122"><a href="fsf.html#cb41-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-123"><a href="fsf.html#cb41-123" aria-hidden="true" tabindex="-1"></a><span class="co"># check if main dir exists and create</span></span>
<span id="cb41-124"><a href="fsf.html#cb41-124" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">dir.exists</span>(out_dir) <span class="sc">==</span> F) {</span>
<span id="cb41-125"><a href="fsf.html#cb41-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(out_dir)</span>
<span id="cb41-126"><a href="fsf.html#cb41-126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-127"><a href="fsf.html#cb41-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-128"><a href="fsf.html#cb41-128" aria-hidden="true" tabindex="-1"></a><span class="co"># check if temp dir exists and create</span></span>
<span id="cb41-129"><a href="fsf.html#cb41-129" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">dir.exists</span>(<span class="fu">file.path</span>(out_dir, <span class="st">&#39;temp&#39;</span>)) <span class="sc">==</span> F) {</span>
<span id="cb41-130"><a href="fsf.html#cb41-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">file.path</span>(out_dir, <span class="st">&#39;temp&#39;</span>))</span>
<span id="cb41-131"><a href="fsf.html#cb41-131" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-132"><a href="fsf.html#cb41-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-133"><a href="fsf.html#cb41-133" aria-hidden="true" tabindex="-1"></a><span class="co"># save extracted dataframe for fast rebooting</span></span>
<span id="cb41-134"><a href="fsf.html#cb41-134" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat_fri, <span class="at">file =</span> <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/dat_fri_extr.RData&#39;</span>))</span>
<span id="cb41-135"><a href="fsf.html#cb41-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-136"><a href="fsf.html#cb41-136" aria-hidden="true" tabindex="-1"></a><span class="co"># load GRM segmented polygons</span></span>
<span id="cb41-137"><a href="fsf.html#cb41-137" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(grm)</span>
<span id="cb41-138"><a href="fsf.html#cb41-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-139"><a href="fsf.html#cb41-139" aria-hidden="true" tabindex="-1"></a><span class="co"># reproject to match FRI polygons</span></span>
<span id="cb41-140"><a href="fsf.html#cb41-140" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">project</span>(poly, <span class="fu">vect</span>(fri))</span>
<span id="cb41-141"><a href="fsf.html#cb41-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-142"><a href="fsf.html#cb41-142" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to df</span></span>
<span id="cb41-143"><a href="fsf.html#cb41-143" aria-hidden="true" tabindex="-1"></a>dat_grm <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(poly)</span>
<span id="cb41-144"><a href="fsf.html#cb41-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-145"><a href="fsf.html#cb41-145" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind centroids to dat</span></span>
<span id="cb41-146"><a href="fsf.html#cb41-146" aria-hidden="true" tabindex="-1"></a>dat_grm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat_grm, <span class="fu">centroids</span>(poly) <span class="sc">%&gt;%</span> crds)</span>
<span id="cb41-147"><a href="fsf.html#cb41-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-148"><a href="fsf.html#cb41-148" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through LiDAR attributes to extract values</span></span>
<span id="cb41-149"><a href="fsf.html#cb41-149" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(lidar_vars)) {</span>
<span id="cb41-150"><a href="fsf.html#cb41-150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load LiDAR raster</span></span>
<span id="cb41-151"><a href="fsf.html#cb41-151" aria-hidden="true" tabindex="-1"></a>  lidar_ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(lidar_vars[i])</span>
<span id="cb41-152"><a href="fsf.html#cb41-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-153"><a href="fsf.html#cb41-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># project poly to crs of raster</span></span>
<span id="cb41-154"><a href="fsf.html#cb41-154" aria-hidden="true" tabindex="-1"></a>  poly_ras <span class="ot">&lt;-</span> <span class="fu">project</span>(poly, lidar_ras)</span>
<span id="cb41-155"><a href="fsf.html#cb41-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-156"><a href="fsf.html#cb41-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf</span></span>
<span id="cb41-157"><a href="fsf.html#cb41-157" aria-hidden="true" tabindex="-1"></a>  poly_ras <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_ras)</span>
<span id="cb41-158"><a href="fsf.html#cb41-158" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-159"><a href="fsf.html#cb41-159" aria-hidden="true" tabindex="-1"></a>  <span class="co">#extract median values</span></span>
<span id="cb41-160"><a href="fsf.html#cb41-160" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span></span>
<span id="cb41-161"><a href="fsf.html#cb41-161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exact_extract</span>(lidar_ras, poly_ras, <span class="st">&#39;median&#39;</span>)</span>
<span id="cb41-162"><a href="fsf.html#cb41-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-163"><a href="fsf.html#cb41-163" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aggregate into data frame</span></span>
<span id="cb41-164"><a href="fsf.html#cb41-164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb41-165"><a href="fsf.html#cb41-165" aria-hidden="true" tabindex="-1"></a>    vec_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(vec)</span>
<span id="cb41-166"><a href="fsf.html#cb41-166" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb41-167"><a href="fsf.html#cb41-167" aria-hidden="true" tabindex="-1"></a>    vec_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(vec_df, <span class="fu">as.data.frame</span>(vec))</span>
<span id="cb41-168"><a href="fsf.html#cb41-168" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-169"><a href="fsf.html#cb41-169" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-170"><a href="fsf.html#cb41-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-171"><a href="fsf.html#cb41-171" aria-hidden="true" tabindex="-1"></a><span class="co"># change column names of extracted attribute data frame</span></span>
<span id="cb41-172"><a href="fsf.html#cb41-172" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(vec_df) <span class="ot">&lt;-</span> <span class="fu">names</span>(lidar_vars)</span>
<span id="cb41-173"><a href="fsf.html#cb41-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-174"><a href="fsf.html#cb41-174" aria-hidden="true" tabindex="-1"></a><span class="co"># add LiDAR attributes to FRI polygon data frame</span></span>
<span id="cb41-175"><a href="fsf.html#cb41-175" aria-hidden="true" tabindex="-1"></a>dat_grm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat_grm, vec_df)</span>
<span id="cb41-176"><a href="fsf.html#cb41-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-177"><a href="fsf.html#cb41-177" aria-hidden="true" tabindex="-1"></a><span class="co"># save extracted dataframe for fast rebooting</span></span>
<span id="cb41-178"><a href="fsf.html#cb41-178" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat_grm, <span class="at">file =</span> <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/dat_grm_extr.RData&#39;</span>))</span>
<span id="cb41-179"><a href="fsf.html#cb41-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-180"><a href="fsf.html#cb41-180" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb41-181"><a href="fsf.html#cb41-181" aria-hidden="true" tabindex="-1"></a><span class="do">### FUNCTIONS FOR SPECIES CLASSIFICATION </span><span class="al">###</span></span>
<span id="cb41-182"><a href="fsf.html#cb41-182" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb41-183"><a href="fsf.html#cb41-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-184"><a href="fsf.html#cb41-184" aria-hidden="true" tabindex="-1"></a><span class="co"># assign species name -- note this list was updated with all species in FSF FRI.</span></span>
<span id="cb41-185"><a href="fsf.html#cb41-185" aria-hidden="true" tabindex="-1"></a><span class="co"># It may need to be adjusted for other areas</span></span>
<span id="cb41-186"><a href="fsf.html#cb41-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-187"><a href="fsf.html#cb41-187" aria-hidden="true" tabindex="-1"></a>assign_common_name <span class="ot">&lt;-</span> <span class="cf">function</span>(sp_abbrev) {</span>
<span id="cb41-188"><a href="fsf.html#cb41-188" aria-hidden="true" tabindex="-1"></a>  sp_abbrev  <span class="ot">&lt;-</span> <span class="fu">toupper</span>(sp_abbrev)</span>
<span id="cb41-189"><a href="fsf.html#cb41-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-190"><a href="fsf.html#cb41-190" aria-hidden="true" tabindex="-1"></a>  dict <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SB =</span> <span class="st">&quot;black spruce&quot;</span>, </span>
<span id="cb41-191"><a href="fsf.html#cb41-191" aria-hidden="true" tabindex="-1"></a>                     <span class="at">LA =</span> <span class="st">&quot;eastern larch&quot;</span>, </span>
<span id="cb41-192"><a href="fsf.html#cb41-192" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BW =</span> <span class="st">&quot;white birch&quot;</span>, </span>
<span id="cb41-193"><a href="fsf.html#cb41-193" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BF =</span> <span class="st">&quot;balsam fir&quot;</span>, </span>
<span id="cb41-194"><a href="fsf.html#cb41-194" aria-hidden="true" tabindex="-1"></a>                     <span class="at">CE =</span> <span class="st">&quot;cedar&quot;</span>, </span>
<span id="cb41-195"><a href="fsf.html#cb41-195" aria-hidden="true" tabindex="-1"></a>                     <span class="at">SW =</span> <span class="st">&quot;white spruce&quot;</span>, </span>
<span id="cb41-196"><a href="fsf.html#cb41-196" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PT =</span> <span class="st">&quot;trembling aspen&quot;</span>, </span>
<span id="cb41-197"><a href="fsf.html#cb41-197" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PJ =</span> <span class="st">&quot;jack pine&quot;</span>, </span>
<span id="cb41-198"><a href="fsf.html#cb41-198" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PO =</span> <span class="st">&quot;poplar&quot;</span>, </span>
<span id="cb41-199"><a href="fsf.html#cb41-199" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PB =</span> <span class="st">&quot;balsam poplar&quot;</span>, </span>
<span id="cb41-200"><a href="fsf.html#cb41-200" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PR =</span> <span class="st">&quot;red pine&quot;</span>, </span>
<span id="cb41-201"><a href="fsf.html#cb41-201" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PW =</span> <span class="st">&quot;white pine&quot;</span>, </span>
<span id="cb41-202"><a href="fsf.html#cb41-202" aria-hidden="true" tabindex="-1"></a>                     <span class="at">SX =</span> <span class="st">&quot;spruce&quot;</span>, </span>
<span id="cb41-203"><a href="fsf.html#cb41-203" aria-hidden="true" tabindex="-1"></a>                     <span class="at">MR =</span> <span class="st">&quot;red maple&quot;</span>, </span>
<span id="cb41-204"><a href="fsf.html#cb41-204" aria-hidden="true" tabindex="-1"></a>                     <span class="at">AB =</span> <span class="st">&quot;black ash&quot;</span>, </span>
<span id="cb41-205"><a href="fsf.html#cb41-205" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BY =</span> <span class="st">&quot;yellow birch&quot;</span>,</span>
<span id="cb41-206"><a href="fsf.html#cb41-206" aria-hidden="true" tabindex="-1"></a>                     <span class="at">OR =</span> <span class="st">&#39;red oak&#39;</span>,</span>
<span id="cb41-207"><a href="fsf.html#cb41-207" aria-hidden="true" tabindex="-1"></a>                     <span class="at">CW =</span> <span class="st">&#39;eastern white cedar&#39;</span>,</span>
<span id="cb41-208"><a href="fsf.html#cb41-208" aria-hidden="true" tabindex="-1"></a>                     <span class="at">MH =</span> <span class="st">&#39;hard maple&#39;</span>,</span>
<span id="cb41-209"><a href="fsf.html#cb41-209" aria-hidden="true" tabindex="-1"></a>                     <span class="at">HE =</span> <span class="st">&#39;eastern hemlock&#39;</span>,</span>
<span id="cb41-210"><a href="fsf.html#cb41-210" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BD =</span> <span class="st">&#39;basswood&#39;</span>,</span>
<span id="cb41-211"><a href="fsf.html#cb41-211" aria-hidden="true" tabindex="-1"></a>                     <span class="at">CB =</span> <span class="st">&#39;black cherry&#39;</span>,</span>
<span id="cb41-212"><a href="fsf.html#cb41-212" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BE =</span> <span class="st">&#39;american beech&#39;</span>,</span>
<span id="cb41-213"><a href="fsf.html#cb41-213" aria-hidden="true" tabindex="-1"></a>                     <span class="at">AW =</span> <span class="st">&#39;white ash&#39;</span>,</span>
<span id="cb41-214"><a href="fsf.html#cb41-214" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PL =</span> <span class="st">&#39;largetooth aspen&#39;</span>,</span>
<span id="cb41-215"><a href="fsf.html#cb41-215" aria-hidden="true" tabindex="-1"></a>                     <span class="at">AG =</span> <span class="st">&#39;red ash&#39;</span>,</span>
<span id="cb41-216"><a href="fsf.html#cb41-216" aria-hidden="true" tabindex="-1"></a>                     <span class="at">OW =</span> <span class="st">&#39;white oak&#39;</span>,</span>
<span id="cb41-217"><a href="fsf.html#cb41-217" aria-hidden="true" tabindex="-1"></a>                     <span class="at">IW =</span> <span class="st">&#39;ironwood&#39;</span>,</span>
<span id="cb41-218"><a href="fsf.html#cb41-218" aria-hidden="true" tabindex="-1"></a>                     <span class="at">OB =</span> <span class="st">&#39;bur oak&#39;</span>,</span>
<span id="cb41-219"><a href="fsf.html#cb41-219" aria-hidden="true" tabindex="-1"></a>                     <span class="at">EW =</span> <span class="st">&#39;white elm&#39;</span>,</span>
<span id="cb41-220"><a href="fsf.html#cb41-220" aria-hidden="true" tabindex="-1"></a>                     <span class="at">MS =</span> <span class="st">&#39;silver maple&#39;</span>,</span>
<span id="cb41-221"><a href="fsf.html#cb41-221" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PS =</span> <span class="st">&#39;scots pine&#39;</span>,</span>
<span id="cb41-222"><a href="fsf.html#cb41-222" aria-hidden="true" tabindex="-1"></a>                     <span class="at">OH =</span> <span class="st">&#39;other hardwoods&#39;</span>,</span>
<span id="cb41-223"><a href="fsf.html#cb41-223" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BG =</span> <span class="st">&#39;grey birch&#39;</span>,</span>
<span id="cb41-224"><a href="fsf.html#cb41-224" aria-hidden="true" tabindex="-1"></a>                     <span class="at">AL =</span> <span class="st">&#39;alder&#39;</span>,</span>
<span id="cb41-225"><a href="fsf.html#cb41-225" aria-hidden="true" tabindex="-1"></a>                     <span class="at">SR =</span> <span class="st">&#39;red spruce&#39;</span>,</span>
<span id="cb41-226"><a href="fsf.html#cb41-226" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BB =</span> <span class="st">&#39;blue beech&#39;</span>,</span>
<span id="cb41-227"><a href="fsf.html#cb41-227" aria-hidden="true" tabindex="-1"></a>                     <span class="at">MT =</span> <span class="st">&#39;mountain maple&#39;</span>,</span>
<span id="cb41-228"><a href="fsf.html#cb41-228" aria-hidden="true" tabindex="-1"></a>                     <span class="at">MB =</span> <span class="st">&#39;black maple&#39;</span>,</span>
<span id="cb41-229"><a href="fsf.html#cb41-229" aria-hidden="true" tabindex="-1"></a>                     <span class="at">OC =</span> <span class="st">&#39;other conifers&#39;</span>,</span>
<span id="cb41-230"><a href="fsf.html#cb41-230" aria-hidden="true" tabindex="-1"></a>                     <span class="at">SN =</span> <span class="st">&#39;norway spruce&#39;</span>,</span>
<span id="cb41-231"><a href="fsf.html#cb41-231" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PE =</span> <span class="st">&#39;silver poplar&#39;</span>,</span>
<span id="cb41-232"><a href="fsf.html#cb41-232" aria-hidden="true" tabindex="-1"></a>                     <span class="at">HI =</span> <span class="st">&#39;hickory&#39;</span>,</span>
<span id="cb41-233"><a href="fsf.html#cb41-233" aria-hidden="true" tabindex="-1"></a>                     <span class="at">AX =</span> <span class="st">&#39;ash&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-234"><a href="fsf.html#cb41-234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;abb&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;common&quot;</span>)</span>
<span id="cb41-235"><a href="fsf.html#cb41-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-236"><a href="fsf.html#cb41-236" aria-hidden="true" tabindex="-1"></a>  dict<span class="sc">$</span>common[<span class="fu">match</span>(sp_abbrev, dict<span class="sc">$</span>abb)]</span>
<span id="cb41-237"><a href="fsf.html#cb41-237" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-238"><a href="fsf.html#cb41-238" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-239"><a href="fsf.html#cb41-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-240"><a href="fsf.html#cb41-240" aria-hidden="true" tabindex="-1"></a><span class="co"># assign either coniferous or deciduous</span></span>
<span id="cb41-241"><a href="fsf.html#cb41-241" aria-hidden="true" tabindex="-1"></a>assign_type <span class="ot">&lt;-</span> <span class="cf">function</span>(sp_common) {</span>
<span id="cb41-242"><a href="fsf.html#cb41-242" aria-hidden="true" tabindex="-1"></a>  sp_common  <span class="ot">&lt;-</span> <span class="fu">tolower</span>(sp_common)</span>
<span id="cb41-243"><a href="fsf.html#cb41-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(sp_common, <span class="at">pattern =</span> <span class="st">&quot;pine|spruce|fir|cedar|larch|conifers|hemlock&quot;</span>), <span class="st">&quot;Coniferous&quot;</span>, <span class="st">&quot;Deciduous&quot;</span>)</span>
<span id="cb41-244"><a href="fsf.html#cb41-244" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-245"><a href="fsf.html#cb41-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-246"><a href="fsf.html#cb41-246" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb41-247"><a href="fsf.html#cb41-247" aria-hidden="true" tabindex="-1"></a><span class="do">### CALCULATE SPECIES ATTRIBUTES </span><span class="al">###</span></span>
<span id="cb41-248"><a href="fsf.html#cb41-248" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb41-249"><a href="fsf.html#cb41-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-250"><a href="fsf.html#cb41-250" aria-hidden="true" tabindex="-1"></a><span class="co"># load fri</span></span>
<span id="cb41-251"><a href="fsf.html#cb41-251" aria-hidden="true" tabindex="-1"></a>poly_fri <span class="ot">&lt;-</span> <span class="fu">st_read</span>(fri)</span>
<span id="cb41-252"><a href="fsf.html#cb41-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-253"><a href="fsf.html#cb41-253" aria-hidden="true" tabindex="-1"></a><span class="co"># separate SPCOMP string into individual columns</span></span>
<span id="cb41-254"><a href="fsf.html#cb41-254" aria-hidden="true" tabindex="-1"></a>poly_fri_for <span class="ot">&lt;-</span> poly_fri <span class="sc">%&gt;%</span></span>
<span id="cb41-255"><a href="fsf.html#cb41-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-256"><a href="fsf.html#cb41-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(POLYTYPE <span class="sc">==</span> <span class="st">&quot;FOR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-257"><a href="fsf.html#cb41-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(OPI_ID, POLYTYPE, OSPCOMP) <span class="sc">%&gt;%</span> <span class="co"># these need to match FRI attr fields</span></span>
<span id="cb41-258"><a href="fsf.html#cb41-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_SP =</span> <span class="fu">str_match_all</span>(OSPCOMP, <span class="st">&quot;[A-Z]{2}[ ]+[0-9]+&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-259"><a href="fsf.html#cb41-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(new_SP) <span class="sc">%&gt;%</span></span>
<span id="cb41-260"><a href="fsf.html#cb41-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_SP =</span> <span class="fu">as.character</span>(new_SP)) <span class="sc">%&gt;%</span></span>
<span id="cb41-261"><a href="fsf.html#cb41-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(new_SP, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;SP&quot;</span>, <span class="st">&quot;PROP&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-262"><a href="fsf.html#cb41-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PROP =</span> <span class="fu">as.numeric</span>(PROP),</span>
<span id="cb41-263"><a href="fsf.html#cb41-263" aria-hidden="true" tabindex="-1"></a>         <span class="at">Common =</span> <span class="fu">assign_common_name</span>(SP),</span>
<span id="cb41-264"><a href="fsf.html#cb41-264" aria-hidden="true" tabindex="-1"></a>         <span class="at">sp_type =</span> <span class="fu">assign_type</span>(Common))</span>
<span id="cb41-265"><a href="fsf.html#cb41-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-266"><a href="fsf.html#cb41-266" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate polygon level species groups</span></span>
<span id="cb41-267"><a href="fsf.html#cb41-267" aria-hidden="true" tabindex="-1"></a><span class="co"># percent species type</span></span>
<span id="cb41-268"><a href="fsf.html#cb41-268" aria-hidden="true" tabindex="-1"></a>poly_dom_type <span class="ot">&lt;-</span> poly_fri_for <span class="sc">%&gt;%</span></span>
<span id="cb41-269"><a href="fsf.html#cb41-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(OPI_ID) <span class="sc">%&gt;%</span></span>
<span id="cb41-270"><a href="fsf.html#cb41-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">per_conif =</span> <span class="fu">sum</span>(PROP[sp_type <span class="sc">==</span> <span class="st">&quot;Coniferous&quot;</span>]), </span>
<span id="cb41-271"><a href="fsf.html#cb41-271" aria-hidden="true" tabindex="-1"></a>            <span class="at">per_decid =</span> <span class="fu">sum</span>(PROP[sp_type <span class="sc">==</span> <span class="st">&quot;Deciduous&quot;</span>]))</span>
<span id="cb41-272"><a href="fsf.html#cb41-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-273"><a href="fsf.html#cb41-273" aria-hidden="true" tabindex="-1"></a><span class="co"># leading species</span></span>
<span id="cb41-274"><a href="fsf.html#cb41-274" aria-hidden="true" tabindex="-1"></a>poly_dom_sp <span class="ot">&lt;-</span> poly_fri_for <span class="sc">%&gt;%</span></span>
<span id="cb41-275"><a href="fsf.html#cb41-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(OPI_ID) <span class="sc">%&gt;%</span></span>
<span id="cb41-276"><a href="fsf.html#cb41-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(PROP, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span>
<span id="cb41-277"><a href="fsf.html#cb41-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-278"><a href="fsf.html#cb41-278" aria-hidden="true" tabindex="-1"></a><span class="co"># combine type with leading species</span></span>
<span id="cb41-279"><a href="fsf.html#cb41-279" aria-hidden="true" tabindex="-1"></a>poly_dom_sp_group <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(poly_dom_type, poly_dom_sp, <span class="at">by =</span> <span class="st">&quot;OPI_ID&quot;</span>)</span>
<span id="cb41-280"><a href="fsf.html#cb41-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-281"><a href="fsf.html#cb41-281" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate functional groups</span></span>
<span id="cb41-282"><a href="fsf.html#cb41-282" aria-hidden="true" tabindex="-1"></a>poly_dom_sp_group <span class="ot">&lt;-</span> poly_dom_sp_group <span class="sc">%&gt;%</span></span>
<span id="cb41-283"><a href="fsf.html#cb41-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SpeciesGroup1 =</span> <span class="fu">ifelse</span>(PROP <span class="sc">&gt;=</span> <span class="dv">70</span>, Common, </span>
<span id="cb41-284"><a href="fsf.html#cb41-284" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(PROP <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">&amp;</span> per_conif <span class="sc">&gt;=</span> <span class="dv">70</span>, <span class="st">&quot;Mixed Coniferous&quot;</span>,</span>
<span id="cb41-285"><a href="fsf.html#cb41-285" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">ifelse</span>(PROP <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">&amp;</span> per_decid <span class="sc">&gt;=</span> <span class="dv">70</span>, <span class="st">&quot;Mixed Deciduous&quot;</span>, <span class="st">&quot;Mixedwoods&quot;</span>))), </span>
<span id="cb41-286"><a href="fsf.html#cb41-286" aria-hidden="true" tabindex="-1"></a>         <span class="at">SpeciesGroup2 =</span> <span class="fu">ifelse</span>(Common <span class="sc">==</span> <span class="st">&quot;jack pine&quot;</span> <span class="sc">&amp;</span> PROP <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> per_conif <span class="sc">&gt;=</span> <span class="dv">70</span>, <span class="st">&quot;Jack Pine Dominated&quot;</span>, <span class="fu">ifelse</span>(</span>
<span id="cb41-287"><a href="fsf.html#cb41-287" aria-hidden="true" tabindex="-1"></a>           Common <span class="sc">==</span> <span class="st">&quot;black spruce&quot;</span> <span class="sc">&amp;</span> PROP <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> per_conif <span class="sc">&gt;=</span> <span class="dv">70</span>, <span class="st">&quot;Black Spruce Dominated&quot;</span>, <span class="fu">ifelse</span>(</span>
<span id="cb41-288"><a href="fsf.html#cb41-288" aria-hidden="true" tabindex="-1"></a>             per_decid <span class="sc">&gt;=</span> <span class="dv">70</span>, <span class="st">&quot;Hardwood&quot;</span>, <span class="fu">ifelse</span>(</span>
<span id="cb41-289"><a href="fsf.html#cb41-289" aria-hidden="true" tabindex="-1"></a>               per_decid <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> per_decid <span class="sc">&lt;=</span> <span class="dv">70</span> <span class="sc">&amp;</span> per_conif <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> per_conif <span class="sc">&lt;=</span> <span class="dv">70</span>, <span class="st">&quot;Mixedwood&quot;</span>, <span class="st">&quot;Mixed Conifers&quot;</span></span>
<span id="cb41-290"><a href="fsf.html#cb41-290" aria-hidden="true" tabindex="-1"></a>             )))), </span>
<span id="cb41-291"><a href="fsf.html#cb41-291" aria-hidden="true" tabindex="-1"></a>         <span class="at">SpeciesGroup3 =</span> <span class="fu">ifelse</span>(per_conif <span class="sc">&gt;=</span> <span class="dv">70</span>, <span class="st">&quot;Softwood&quot;</span>, </span>
<span id="cb41-292"><a href="fsf.html#cb41-292" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(per_decid <span class="sc">&gt;=</span> <span class="dv">70</span>, <span class="st">&quot;Hardwood&quot;</span>, <span class="st">&quot;Mixedwood&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb41-293"><a href="fsf.html#cb41-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;SpeciesGroup&quot;</span>), <span class="at">.fns =</span> as.factor)) <span class="sc">%&gt;%</span></span>
<span id="cb41-294"><a href="fsf.html#cb41-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(OPI_ID, SpeciesGroup2, SpeciesGroup3) <span class="sc">%&gt;%</span></span>
<span id="cb41-295"><a href="fsf.html#cb41-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">class5 =</span> SpeciesGroup2, <span class="at">class3 =</span> SpeciesGroup3)</span>
<span id="cb41-296"><a href="fsf.html#cb41-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-297"><a href="fsf.html#cb41-297" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate leading and second species only</span></span>
<span id="cb41-298"><a href="fsf.html#cb41-298" aria-hidden="true" tabindex="-1"></a>poly_fri_sp <span class="ot">&lt;-</span> poly_fri <span class="sc">%&gt;%</span></span>
<span id="cb41-299"><a href="fsf.html#cb41-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-300"><a href="fsf.html#cb41-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(POLYTYPE <span class="sc">==</span> <span class="st">&quot;FOR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-301"><a href="fsf.html#cb41-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(OPI_ID, POLYTYPE, OSPCOMP) <span class="sc">%&gt;%</span> <span class="co"># these need to match FRI attr fields</span></span>
<span id="cb41-302"><a href="fsf.html#cb41-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_SP =</span> <span class="fu">str_match_all</span>(OSPCOMP, <span class="st">&quot;[A-Z]{2}[ ]+[0-9]+&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-303"><a href="fsf.html#cb41-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(new_SP, <span class="at">names_sep =</span> <span class="st">&#39;&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-304"><a href="fsf.html#cb41-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">new_SP =</span> new_SP1) <span class="sc">%&gt;%</span></span>
<span id="cb41-305"><a href="fsf.html#cb41-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_SP =</span> <span class="fu">as.character</span>(new_SP),</span>
<span id="cb41-306"><a href="fsf.html#cb41-306" aria-hidden="true" tabindex="-1"></a>         <span class="at">new_SP2 =</span> <span class="fu">as.character</span>(new_SP2)) <span class="sc">%&gt;%</span></span>
<span id="cb41-307"><a href="fsf.html#cb41-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(new_SP, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;SP&quot;</span>, <span class="st">&quot;PROP&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-308"><a href="fsf.html#cb41-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(new_SP2, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;SP2&quot;</span>, <span class="st">&quot;PROP2&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-309"><a href="fsf.html#cb41-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(OPI_ID, SP, SP2)</span>
<span id="cb41-310"><a href="fsf.html#cb41-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-311"><a href="fsf.html#cb41-311" aria-hidden="true" tabindex="-1"></a><span class="co"># join functional groups with leading and second species</span></span>
<span id="cb41-312"><a href="fsf.html#cb41-312" aria-hidden="true" tabindex="-1"></a>poly_dom_sp_group <span class="ot">&lt;-</span> <span class="fu">left_join</span>(poly_dom_sp_group,</span>
<span id="cb41-313"><a href="fsf.html#cb41-313" aria-hidden="true" tabindex="-1"></a>                               poly_fri_sp,</span>
<span id="cb41-314"><a href="fsf.html#cb41-314" aria-hidden="true" tabindex="-1"></a>                               <span class="at">by =</span> <span class="st">&#39;OPI_ID&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-315"><a href="fsf.html#cb41-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SP1 =</span> SP)</span>
<span id="cb41-316"><a href="fsf.html#cb41-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-317"><a href="fsf.html#cb41-317" aria-hidden="true" tabindex="-1"></a><span class="co"># join to FRI extracted dataframe</span></span>
<span id="cb41-318"><a href="fsf.html#cb41-318" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dat_fri,</span>
<span id="cb41-319"><a href="fsf.html#cb41-319" aria-hidden="true" tabindex="-1"></a>                     poly_dom_sp_group,</span>
<span id="cb41-320"><a href="fsf.html#cb41-320" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="st">&#39;OPI_ID&#39;</span>)</span>
<span id="cb41-321"><a href="fsf.html#cb41-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-322"><a href="fsf.html#cb41-322" aria-hidden="true" tabindex="-1"></a><span class="co"># re-save extracted dataframe for fast rebooting</span></span>
<span id="cb41-323"><a href="fsf.html#cb41-323" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat_fri, <span class="at">file =</span> <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/dat_fri_extr.RData&#39;</span>))</span>
<span id="cb41-324"><a href="fsf.html#cb41-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-325"><a href="fsf.html#cb41-325" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb41-326"><a href="fsf.html#cb41-326" aria-hidden="true" tabindex="-1"></a><span class="do">### LOAD FRI DATA </span><span class="al">###</span></span>
<span id="cb41-327"><a href="fsf.html#cb41-327" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb41-328"><a href="fsf.html#cb41-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-329"><a href="fsf.html#cb41-329" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI polygons</span></span>
<span id="cb41-330"><a href="fsf.html#cb41-330" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(fri)</span>
<span id="cb41-331"><a href="fsf.html#cb41-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-332"><a href="fsf.html#cb41-332" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI polygon data frame</span></span>
<span id="cb41-333"><a href="fsf.html#cb41-333" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/dat_fri_extr.RData&#39;</span>))</span>
<span id="cb41-334"><a href="fsf.html#cb41-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-335"><a href="fsf.html#cb41-335" aria-hidden="true" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb41-336"><a href="fsf.html#cb41-336" aria-hidden="true" tabindex="-1"></a><span class="do">### DATA SCREENING PART 1 </span><span class="al">###</span></span>
<span id="cb41-337"><a href="fsf.html#cb41-337" aria-hidden="true" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb41-338"><a href="fsf.html#cb41-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-339"><a href="fsf.html#cb41-339" aria-hidden="true" tabindex="-1"></a><span class="co"># remove all non-forested polygons</span></span>
<span id="cb41-340"><a href="fsf.html#cb41-340" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">filter</span>(dat_fri, POLYTYPE <span class="sc">==</span> <span class="st">&#39;FOR&#39;</span>)</span>
<span id="cb41-341"><a href="fsf.html#cb41-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-342"><a href="fsf.html#cb41-342" aria-hidden="true" tabindex="-1"></a><span class="co"># create smaller polygon set only FOR polytypes</span></span>
<span id="cb41-343"><a href="fsf.html#cb41-343" aria-hidden="true" tabindex="-1"></a>poly_fri <span class="ot">&lt;-</span> poly[poly<span class="sc">$</span>POLYTYPE <span class="sc">==</span> <span class="st">&#39;FOR&#39;</span>]</span>
<span id="cb41-344"><a href="fsf.html#cb41-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-345"><a href="fsf.html#cb41-345" aria-hidden="true" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb41-346"><a href="fsf.html#cb41-346" aria-hidden="true" tabindex="-1"></a><span class="do">### DATA SCREENING PART 2 </span><span class="al">###</span></span>
<span id="cb41-347"><a href="fsf.html#cb41-347" aria-hidden="true" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb41-348"><a href="fsf.html#cb41-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-349"><a href="fsf.html#cb41-349" aria-hidden="true" tabindex="-1"></a><span class="co"># polygon landcover &gt; 50% forested</span></span>
<span id="cb41-350"><a href="fsf.html#cb41-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-351"><a href="fsf.html#cb41-351" aria-hidden="true" tabindex="-1"></a><span class="co"># load VLCE 2.0 landcover dataset from 2018</span></span>
<span id="cb41-352"><a href="fsf.html#cb41-352" aria-hidden="true" tabindex="-1"></a>lc <span class="ot">&lt;-</span> <span class="fu">rast</span>(lc_f)</span>
<span id="cb41-353"><a href="fsf.html#cb41-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-354"><a href="fsf.html#cb41-354" aria-hidden="true" tabindex="-1"></a><span class="co"># project poly to crs of raster</span></span>
<span id="cb41-355"><a href="fsf.html#cb41-355" aria-hidden="true" tabindex="-1"></a>poly_lc <span class="ot">&lt;-</span> <span class="fu">project</span>(poly_fri, lc)</span>
<span id="cb41-356"><a href="fsf.html#cb41-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-357"><a href="fsf.html#cb41-357" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf</span></span>
<span id="cb41-358"><a href="fsf.html#cb41-358" aria-hidden="true" tabindex="-1"></a>poly_lcsf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_lc)</span>
<span id="cb41-359"><a href="fsf.html#cb41-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-360"><a href="fsf.html#cb41-360" aria-hidden="true" tabindex="-1"></a><span class="co"># extract landcover values</span></span>
<span id="cb41-361"><a href="fsf.html#cb41-361" aria-hidden="true" tabindex="-1"></a>lc_poly <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(lc, poly_lcsf)</span>
<span id="cb41-362"><a href="fsf.html#cb41-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-363"><a href="fsf.html#cb41-363" aria-hidden="true" tabindex="-1"></a><span class="co"># set landcover class key with single forested class</span></span>
<span id="cb41-364"><a href="fsf.html#cb41-364" aria-hidden="true" tabindex="-1"></a>lc_key_for <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;NA&#39;</span>,</span>
<span id="cb41-365"><a href="fsf.html#cb41-365" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">20</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Water&#39;</span>,</span>
<span id="cb41-366"><a href="fsf.html#cb41-366" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">31</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Snow/Ice&#39;</span>,</span>
<span id="cb41-367"><a href="fsf.html#cb41-367" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">32</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Rock/Rubble&#39;</span>,</span>
<span id="cb41-368"><a href="fsf.html#cb41-368" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">33</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Exposed/Barren Land&#39;</span>,</span>
<span id="cb41-369"><a href="fsf.html#cb41-369" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">40</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Bryoids&#39;</span>,</span>
<span id="cb41-370"><a href="fsf.html#cb41-370" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">50</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Shrubland&#39;</span>,</span>
<span id="cb41-371"><a href="fsf.html#cb41-371" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">80</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Wetland&#39;</span>,</span>
<span id="cb41-372"><a href="fsf.html#cb41-372" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">81</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>,</span>
<span id="cb41-373"><a href="fsf.html#cb41-373" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">100</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Herbs&#39;</span>,</span>
<span id="cb41-374"><a href="fsf.html#cb41-374" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">210</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>,</span>
<span id="cb41-375"><a href="fsf.html#cb41-375" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">220</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>,</span>
<span id="cb41-376"><a href="fsf.html#cb41-376" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">230</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>)</span>
<span id="cb41-377"><a href="fsf.html#cb41-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-378"><a href="fsf.html#cb41-378" aria-hidden="true" tabindex="-1"></a><span class="co"># find pixels with forest at least 50% of pixel</span></span>
<span id="cb41-379"><a href="fsf.html#cb41-379" aria-hidden="true" tabindex="-1"></a><span class="co"># apply over list</span></span>
<span id="cb41-380"><a href="fsf.html#cb41-380" aria-hidden="true" tabindex="-1"></a>lc_dom_for <span class="ot">&lt;-</span> <span class="fu">sapply</span>(lc_poly, <span class="cf">function</span>(x){</span>
<span id="cb41-381"><a href="fsf.html#cb41-381" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">recode</span>(x<span class="sc">$</span>value, <span class="sc">!!!</span>lc_key_for)</span>
<span id="cb41-382"><a href="fsf.html#cb41-382" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(value) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">sum =</span> <span class="fu">sum</span>(coverage_fraction))</span>
<span id="cb41-383"><a href="fsf.html#cb41-383" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> x<span class="sc">$</span>value[<span class="fu">which</span>(x<span class="sc">$</span>sum <span class="sc">==</span> <span class="fu">max</span>(x<span class="sc">$</span>sum))]</span>
<span id="cb41-384"><a href="fsf.html#cb41-384" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>((<span class="fu">length</span>(m) <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">&amp;</span> (m <span class="sc">==</span> <span class="st">&#39;Forest&#39;</span>)[<span class="dv">1</span>]){</span>
<span id="cb41-385"><a href="fsf.html#cb41-385" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(x<span class="sc">$</span>sum[x<span class="sc">$</span>value <span class="sc">==</span> m]<span class="sc">/</span><span class="fu">sum</span>(x<span class="sc">$</span>sum) <span class="sc">&gt;=</span> <span class="fl">0.5</span>){</span>
<span id="cb41-386"><a href="fsf.html#cb41-386" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="st">&#39;Yes&#39;</span>)</span>
<span id="cb41-387"><a href="fsf.html#cb41-387" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{<span class="fu">return</span>(<span class="st">&#39;No&#39;</span>)}</span>
<span id="cb41-388"><a href="fsf.html#cb41-388" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{<span class="fu">return</span>(<span class="st">&#39;No&#39;</span>)}</span>
<span id="cb41-389"><a href="fsf.html#cb41-389" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb41-390"><a href="fsf.html#cb41-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-391"><a href="fsf.html#cb41-391" aria-hidden="true" tabindex="-1"></a><span class="co"># add new columns into dat</span></span>
<span id="cb41-392"><a href="fsf.html#cb41-392" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> dat_fri <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">dom_for =</span> lc_dom_for)</span>
<span id="cb41-393"><a href="fsf.html#cb41-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-394"><a href="fsf.html#cb41-394" aria-hidden="true" tabindex="-1"></a><span class="co"># subset FRI data frame based on whether polygon dominated by forest</span></span>
<span id="cb41-395"><a href="fsf.html#cb41-395" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="ot">&lt;-</span> dat_fri <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dom_for <span class="sc">==</span> <span class="st">&#39;Yes&#39;</span>)</span>
<span id="cb41-396"><a href="fsf.html#cb41-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-397"><a href="fsf.html#cb41-397" aria-hidden="true" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb41-398"><a href="fsf.html#cb41-398" aria-hidden="true" tabindex="-1"></a><span class="do">### DATA SCREENING PART 3 </span><span class="al">###</span></span>
<span id="cb41-399"><a href="fsf.html#cb41-399" aria-hidden="true" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb41-400"><a href="fsf.html#cb41-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-401"><a href="fsf.html#cb41-401" aria-hidden="true" tabindex="-1"></a><span class="co"># require p95 &gt;= 5</span></span>
<span id="cb41-402"><a href="fsf.html#cb41-402" aria-hidden="true" tabindex="-1"></a><span class="co"># require cc &gt;= 50</span></span>
<span id="cb41-403"><a href="fsf.html#cb41-403" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(p95 <span class="sc">&gt;=</span> <span class="dv">5</span>, cc <span class="sc">&gt;=</span> <span class="dv">50</span>)</span>
<span id="cb41-404"><a href="fsf.html#cb41-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-405"><a href="fsf.html#cb41-405" aria-hidden="true" tabindex="-1"></a><span class="co"># save extracted data frame for fast rebooting</span></span>
<span id="cb41-406"><a href="fsf.html#cb41-406" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat_fri_scr, <span class="at">file =</span> <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/dat_fri_scr.RData&#39;</span>))</span>
<span id="cb41-407"><a href="fsf.html#cb41-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-408"><a href="fsf.html#cb41-408" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb41-409"><a href="fsf.html#cb41-409" aria-hidden="true" tabindex="-1"></a><span class="do">### LOAD GRM DATA </span><span class="al">###</span></span>
<span id="cb41-410"><a href="fsf.html#cb41-410" aria-hidden="true" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb41-411"><a href="fsf.html#cb41-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-412"><a href="fsf.html#cb41-412" aria-hidden="true" tabindex="-1"></a><span class="co"># load GRM polygon data frame</span></span>
<span id="cb41-413"><a href="fsf.html#cb41-413" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/dat_grm_extr.RData&#39;</span>))</span>
<span id="cb41-414"><a href="fsf.html#cb41-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-415"><a href="fsf.html#cb41-415" aria-hidden="true" tabindex="-1"></a><span class="do">######################</span></span>
<span id="cb41-416"><a href="fsf.html#cb41-416" aria-hidden="true" tabindex="-1"></a><span class="do">### DATA SCREENING </span><span class="al">###</span></span>
<span id="cb41-417"><a href="fsf.html#cb41-417" aria-hidden="true" tabindex="-1"></a><span class="do">######################</span></span>
<span id="cb41-418"><a href="fsf.html#cb41-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-419"><a href="fsf.html#cb41-419" aria-hidden="true" tabindex="-1"></a><span class="co"># Don&#39;t screen GRM polygons for POLYTYPE == FOR</span></span>
<span id="cb41-420"><a href="fsf.html#cb41-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-421"><a href="fsf.html#cb41-421" aria-hidden="true" tabindex="-1"></a><span class="co"># polygon landcover &gt; 50% forested</span></span>
<span id="cb41-422"><a href="fsf.html#cb41-422" aria-hidden="true" tabindex="-1"></a><span class="co"># dom_for attribute already exists in GRM data from segmentation</span></span>
<span id="cb41-423"><a href="fsf.html#cb41-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-424"><a href="fsf.html#cb41-424" aria-hidden="true" tabindex="-1"></a><span class="co"># require p95 &gt;= 5</span></span>
<span id="cb41-425"><a href="fsf.html#cb41-425" aria-hidden="true" tabindex="-1"></a><span class="co"># require cc &gt;= 50</span></span>
<span id="cb41-426"><a href="fsf.html#cb41-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-427"><a href="fsf.html#cb41-427" aria-hidden="true" tabindex="-1"></a>dat_grm_scr <span class="ot">&lt;-</span> dat_grm <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dom_for <span class="sc">==</span> <span class="st">&#39;Yes&#39;</span>,</span>
<span id="cb41-428"><a href="fsf.html#cb41-428" aria-hidden="true" tabindex="-1"></a>                                  p95 <span class="sc">&gt;=</span> <span class="dv">5</span>,</span>
<span id="cb41-429"><a href="fsf.html#cb41-429" aria-hidden="true" tabindex="-1"></a>                                  cc <span class="sc">&gt;=</span> <span class="dv">50</span>)</span>
<span id="cb41-430"><a href="fsf.html#cb41-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-431"><a href="fsf.html#cb41-431" aria-hidden="true" tabindex="-1"></a><span class="co"># save extracted data frame for fast rebooting</span></span>
<span id="cb41-432"><a href="fsf.html#cb41-432" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat_grm_scr, <span class="at">file =</span> <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/dat_grm_scr.RData&#39;</span>))</span>
<span id="cb41-433"><a href="fsf.html#cb41-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-434"><a href="fsf.html#cb41-434" aria-hidden="true" tabindex="-1"></a><span class="do">######################################################</span></span>
<span id="cb41-435"><a href="fsf.html#cb41-435" aria-hidden="true" tabindex="-1"></a><span class="do">### FUNCTIONS TO RUN K NEAREST NEIGHBOR IMPUTATION </span><span class="al">###</span></span>
<span id="cb41-436"><a href="fsf.html#cb41-436" aria-hidden="true" tabindex="-1"></a><span class="do">######################################################</span></span>
<span id="cb41-437"><a href="fsf.html#cb41-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-438"><a href="fsf.html#cb41-438" aria-hidden="true" tabindex="-1"></a><span class="co"># create mode function</span></span>
<span id="cb41-439"><a href="fsf.html#cb41-439" aria-hidden="true" tabindex="-1"></a>getmode <span class="ot">&lt;-</span> <span class="cf">function</span>(v) {</span>
<span id="cb41-440"><a href="fsf.html#cb41-440" aria-hidden="true" tabindex="-1"></a>  uniqv <span class="ot">&lt;-</span> <span class="fu">unique</span>(v)</span>
<span id="cb41-441"><a href="fsf.html#cb41-441" aria-hidden="true" tabindex="-1"></a>  uniqv[<span class="fu">which.max</span>(<span class="fu">tabulate</span>(<span class="fu">match</span>(v, uniqv)))]</span>
<span id="cb41-442"><a href="fsf.html#cb41-442" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-443"><a href="fsf.html#cb41-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-444"><a href="fsf.html#cb41-444" aria-hidden="true" tabindex="-1"></a><span class="co"># create rmsd function</span></span>
<span id="cb41-445"><a href="fsf.html#cb41-445" aria-hidden="true" tabindex="-1"></a>rmsd <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb41-446"><a href="fsf.html#cb41-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">mean</span>((est <span class="sc">-</span> obs) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb41-447"><a href="fsf.html#cb41-447" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-448"><a href="fsf.html#cb41-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-449"><a href="fsf.html#cb41-449" aria-hidden="true" tabindex="-1"></a><span class="co"># create rrmsd function</span></span>
<span id="cb41-450"><a href="fsf.html#cb41-450" aria-hidden="true" tabindex="-1"></a>rrmsd <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb41-451"><a href="fsf.html#cb41-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">mean</span>((est <span class="sc">-</span> obs) <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> <span class="fu">mean</span>(obs) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb41-452"><a href="fsf.html#cb41-452" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-453"><a href="fsf.html#cb41-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-454"><a href="fsf.html#cb41-454" aria-hidden="true" tabindex="-1"></a><span class="co"># create mae function</span></span>
<span id="cb41-455"><a href="fsf.html#cb41-455" aria-hidden="true" tabindex="-1"></a>mae <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb41-456"><a href="fsf.html#cb41-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(est <span class="sc">-</span> obs))</span>
<span id="cb41-457"><a href="fsf.html#cb41-457" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-458"><a href="fsf.html#cb41-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-459"><a href="fsf.html#cb41-459" aria-hidden="true" tabindex="-1"></a><span class="co"># create mbe function</span></span>
<span id="cb41-460"><a href="fsf.html#cb41-460" aria-hidden="true" tabindex="-1"></a>mbe <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb41-461"><a href="fsf.html#cb41-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(est <span class="sc">-</span> obs)</span>
<span id="cb41-462"><a href="fsf.html#cb41-462" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-463"><a href="fsf.html#cb41-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-464"><a href="fsf.html#cb41-464" aria-hidden="true" tabindex="-1"></a><span class="co"># create rmbe function</span></span>
<span id="cb41-465"><a href="fsf.html#cb41-465" aria-hidden="true" tabindex="-1"></a>rmbe <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb41-466"><a href="fsf.html#cb41-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(est <span class="sc">-</span> obs) <span class="sc">/</span> <span class="fu">mean</span>(obs) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb41-467"><a href="fsf.html#cb41-467" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-468"><a href="fsf.html#cb41-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-469"><a href="fsf.html#cb41-469" aria-hidden="true" tabindex="-1"></a><span class="co"># create knn function to output performance results</span></span>
<span id="cb41-470"><a href="fsf.html#cb41-470" aria-hidden="true" tabindex="-1"></a>run_knn_fri <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, vars, k) {</span>
<span id="cb41-471"><a href="fsf.html#cb41-471" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-472"><a href="fsf.html#cb41-472" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset data</span></span>
<span id="cb41-473"><a href="fsf.html#cb41-473" aria-hidden="true" tabindex="-1"></a>  dat_nn <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(vars))</span>
<span id="cb41-474"><a href="fsf.html#cb41-474" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-475"><a href="fsf.html#cb41-475" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale for nn computation</span></span>
<span id="cb41-476"><a href="fsf.html#cb41-476" aria-hidden="true" tabindex="-1"></a>  dat_nn_scaled <span class="ot">&lt;-</span> dat_nn <span class="sc">%&gt;%</span> scale</span>
<span id="cb41-477"><a href="fsf.html#cb41-477" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-478"><a href="fsf.html#cb41-478" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run nearest neighbor</span></span>
<span id="cb41-479"><a href="fsf.html#cb41-479" aria-hidden="true" tabindex="-1"></a>  nn <span class="ot">&lt;-</span> <span class="fu">nn2</span>(dat_nn_scaled, dat_nn_scaled, <span class="at">k =</span> k <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb41-480"><a href="fsf.html#cb41-480" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-481"><a href="fsf.html#cb41-481" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get nn indices</span></span>
<span id="cb41-482"><a href="fsf.html#cb41-482" aria-hidden="true" tabindex="-1"></a>  nni <span class="ot">&lt;-</span> nn[[<span class="dv">1</span>]][, <span class="dv">2</span><span class="sc">:</span>(k <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="cb41-483"><a href="fsf.html#cb41-483" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-484"><a href="fsf.html#cb41-484" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add vars to tibble</span></span>
<span id="cb41-485"><a href="fsf.html#cb41-485" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take mean/mode if k &gt; 1</span></span>
<span id="cb41-486"><a href="fsf.html#cb41-486" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb41-487"><a href="fsf.html#cb41-487" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb41-488"><a href="fsf.html#cb41-488" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb41-489"><a href="fsf.html#cb41-489" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb41-490"><a href="fsf.html#cb41-490" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-491"><a href="fsf.html#cb41-491" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">mean</span>(dat_nn[x, i])</span>
<span id="cb41-492"><a href="fsf.html#cb41-492" aria-hidden="true" tabindex="-1"></a>                         }))</span>
<span id="cb41-493"><a href="fsf.html#cb41-493" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb41-494"><a href="fsf.html#cb41-494" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb41-495"><a href="fsf.html#cb41-495" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-496"><a href="fsf.html#cb41-496" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">mean</span>(dat_nn[x, i])</span>
<span id="cb41-497"><a href="fsf.html#cb41-497" aria-hidden="true" tabindex="-1"></a>                           }))</span>
<span id="cb41-498"><a href="fsf.html#cb41-498" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb41-499"><a href="fsf.html#cb41-499" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-500"><a href="fsf.html#cb41-500" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-501"><a href="fsf.html#cb41-501" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add target vars to tibble</span></span>
<span id="cb41-502"><a href="fsf.html#cb41-502" aria-hidden="true" tabindex="-1"></a>    nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age =</span> dat<span class="sc">$</span>AGE2018,</span>
<span id="cb41-503"><a href="fsf.html#cb41-503" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1 =</span> dat<span class="sc">$</span>SP1,</span>
<span id="cb41-504"><a href="fsf.html#cb41-504" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2 =</span> dat<span class="sc">$</span>SP2,</span>
<span id="cb41-505"><a href="fsf.html#cb41-505" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class5 =</span> dat<span class="sc">$</span>class5,</span>
<span id="cb41-506"><a href="fsf.html#cb41-506" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class3 =</span> dat<span class="sc">$</span>class3,</span>
<span id="cb41-507"><a href="fsf.html#cb41-507" aria-hidden="true" tabindex="-1"></a>                       <span class="at">age_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-508"><a href="fsf.html#cb41-508" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">mean</span>(dat<span class="sc">$</span>AGE2018[x])</span>
<span id="cb41-509"><a href="fsf.html#cb41-509" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb41-510"><a href="fsf.html#cb41-510" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-511"><a href="fsf.html#cb41-511" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>SP1[x])</span>
<span id="cb41-512"><a href="fsf.html#cb41-512" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb41-513"><a href="fsf.html#cb41-513" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-514"><a href="fsf.html#cb41-514" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>SP2[x])</span>
<span id="cb41-515"><a href="fsf.html#cb41-515" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb41-516"><a href="fsf.html#cb41-516" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class5_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-517"><a href="fsf.html#cb41-517" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>class5[x])</span>
<span id="cb41-518"><a href="fsf.html#cb41-518" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb41-519"><a href="fsf.html#cb41-519" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class3_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-520"><a href="fsf.html#cb41-520" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>class3[x])</span>
<span id="cb41-521"><a href="fsf.html#cb41-521" aria-hidden="true" tabindex="-1"></a>                       }))</span>
<span id="cb41-522"><a href="fsf.html#cb41-522" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-523"><a href="fsf.html#cb41-523" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-524"><a href="fsf.html#cb41-524" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take direct nn if k == 1</span></span>
<span id="cb41-525"><a href="fsf.html#cb41-525" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb41-526"><a href="fsf.html#cb41-526" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb41-527"><a href="fsf.html#cb41-527" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb41-528"><a href="fsf.html#cb41-528" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb41-529"><a href="fsf.html#cb41-529" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> dat_nn[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>],i])</span>
<span id="cb41-530"><a href="fsf.html#cb41-530" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb41-531"><a href="fsf.html#cb41-531" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb41-532"><a href="fsf.html#cb41-532" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> dat_nn[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>],i])</span>
<span id="cb41-533"><a href="fsf.html#cb41-533" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb41-534"><a href="fsf.html#cb41-534" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-535"><a href="fsf.html#cb41-535" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-536"><a href="fsf.html#cb41-536" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add target vars to tibble</span></span>
<span id="cb41-537"><a href="fsf.html#cb41-537" aria-hidden="true" tabindex="-1"></a>    nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age =</span> dat<span class="sc">$</span>AGE2018,</span>
<span id="cb41-538"><a href="fsf.html#cb41-538" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1 =</span> dat<span class="sc">$</span>SP1,</span>
<span id="cb41-539"><a href="fsf.html#cb41-539" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2 =</span> dat<span class="sc">$</span>SP2,</span>
<span id="cb41-540"><a href="fsf.html#cb41-540" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class5 =</span> dat<span class="sc">$</span>class5,</span>
<span id="cb41-541"><a href="fsf.html#cb41-541" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class3 =</span> dat<span class="sc">$</span>class3,</span>
<span id="cb41-542"><a href="fsf.html#cb41-542" aria-hidden="true" tabindex="-1"></a>                       <span class="at">age_nn =</span> dat<span class="sc">$</span>AGE2018[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb41-543"><a href="fsf.html#cb41-543" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1_nn =</span> dat<span class="sc">$</span>SP1[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb41-544"><a href="fsf.html#cb41-544" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2_nn =</span> dat<span class="sc">$</span>SP2[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb41-545"><a href="fsf.html#cb41-545" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class5_nn =</span> dat<span class="sc">$</span>class5[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb41-546"><a href="fsf.html#cb41-546" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class3_nn =</span> dat<span class="sc">$</span>class3[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]])</span>
<span id="cb41-547"><a href="fsf.html#cb41-547" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-548"><a href="fsf.html#cb41-548" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-549"><a href="fsf.html#cb41-549" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-550"><a href="fsf.html#cb41-550" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate fit metrics for vars</span></span>
<span id="cb41-551"><a href="fsf.html#cb41-551" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb41-552"><a href="fsf.html#cb41-552" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb41-553"><a href="fsf.html#cb41-553" aria-hidden="true" tabindex="-1"></a>      perform_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">variable =</span> vars[i],</span>
<span id="cb41-554"><a href="fsf.html#cb41-554" aria-hidden="true" tabindex="-1"></a>                           <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>),</span>
<span id="cb41-555"><a href="fsf.html#cb41-555" aria-hidden="true" tabindex="-1"></a>                           <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rrmsd</span>(<span class="fu">pull</span>(nn_tab, vars[i]),</span>
<span id="cb41-556"><a href="fsf.html#cb41-556" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">pull</span>(nn_tab, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>))),</span>
<span id="cb41-557"><a href="fsf.html#cb41-557" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rmbe</span>(<span class="fu">pull</span>(nn_tab, vars[i]),</span>
<span id="cb41-558"><a href="fsf.html#cb41-558" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">pull</span>(nn_tab, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>)))))</span>
<span id="cb41-559"><a href="fsf.html#cb41-559" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb41-560"><a href="fsf.html#cb41-560" aria-hidden="true" tabindex="-1"></a>      perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> vars[i],</span>
<span id="cb41-561"><a href="fsf.html#cb41-561" aria-hidden="true" tabindex="-1"></a>                           <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>),</span>
<span id="cb41-562"><a href="fsf.html#cb41-562" aria-hidden="true" tabindex="-1"></a>                           <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rrmsd</span>(<span class="fu">pull</span>(nn_tab, vars[i]),</span>
<span id="cb41-563"><a href="fsf.html#cb41-563" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">pull</span>(nn_tab, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>))),</span>
<span id="cb41-564"><a href="fsf.html#cb41-564" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rmbe</span>(<span class="fu">pull</span>(nn_tab, vars[i]),</span>
<span id="cb41-565"><a href="fsf.html#cb41-565" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">pull</span>(nn_tab, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>)))))</span>
<span id="cb41-566"><a href="fsf.html#cb41-566" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-567"><a href="fsf.html#cb41-567" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-568"><a href="fsf.html#cb41-568" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-569"><a href="fsf.html#cb41-569" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate metrics for age</span></span>
<span id="cb41-570"><a href="fsf.html#cb41-570" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;age&#39;</span>,</span>
<span id="cb41-571"><a href="fsf.html#cb41-571" aria-hidden="true" tabindex="-1"></a>                          <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rmsd (yrs)&#39;</span>, <span class="st">&#39;mbe (yrs)&#39;</span>, <span class="st">&#39;mae (yrs)&#39;</span>),</span>
<span id="cb41-572"><a href="fsf.html#cb41-572" aria-hidden="true" tabindex="-1"></a>                          <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rmsd</span>(nn_tab<span class="sc">$</span>age, nn_tab<span class="sc">$</span>age_nn),</span>
<span id="cb41-573"><a href="fsf.html#cb41-573" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">mbe</span>(nn_tab<span class="sc">$</span>age, nn_tab<span class="sc">$</span>age_nn),</span>
<span id="cb41-574"><a href="fsf.html#cb41-574" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">mae</span>(nn_tab<span class="sc">$</span>age, nn_tab<span class="sc">$</span>age_nn)))</span>
<span id="cb41-575"><a href="fsf.html#cb41-575" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-576"><a href="fsf.html#cb41-576" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate SP1 accuracy</span></span>
<span id="cb41-577"><a href="fsf.html#cb41-577" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create df of SP1</span></span>
<span id="cb41-578"><a href="fsf.html#cb41-578" aria-hidden="true" tabindex="-1"></a>  sp1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>sp1,</span>
<span id="cb41-579"><a href="fsf.html#cb41-579" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> nn_tab<span class="sc">$</span>sp1_nn)</span>
<span id="cb41-580"><a href="fsf.html#cb41-580" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-581"><a href="fsf.html#cb41-581" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column of match or not</span></span>
<span id="cb41-582"><a href="fsf.html#cb41-582" aria-hidden="true" tabindex="-1"></a>  sp1<span class="sc">$</span>match <span class="ot">&lt;-</span> sp1<span class="sc">$</span>obs <span class="sc">==</span> sp1<span class="sc">$</span>est</span>
<span id="cb41-583"><a href="fsf.html#cb41-583" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-584"><a href="fsf.html#cb41-584" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total percent of matching SP1 to perform_df</span></span>
<span id="cb41-585"><a href="fsf.html#cb41-585" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;leading species&#39;</span>,</span>
<span id="cb41-586"><a href="fsf.html#cb41-586" aria-hidden="true" tabindex="-1"></a>                          <span class="at">metric =</span> <span class="st">&#39;accuracy (%)&#39;</span>,</span>
<span id="cb41-587"><a href="fsf.html#cb41-587" aria-hidden="true" tabindex="-1"></a>                          <span class="at">value =</span> <span class="fu">NROW</span>(sp1[sp1<span class="sc">$</span>match <span class="sc">==</span> T,]) <span class="sc">/</span></span>
<span id="cb41-588"><a href="fsf.html#cb41-588" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">NROW</span>(sp1) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb41-589"><a href="fsf.html#cb41-589" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-590"><a href="fsf.html#cb41-590" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate SP2 accuracy</span></span>
<span id="cb41-591"><a href="fsf.html#cb41-591" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create df of SP2</span></span>
<span id="cb41-592"><a href="fsf.html#cb41-592" aria-hidden="true" tabindex="-1"></a>  sp2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>sp2,</span>
<span id="cb41-593"><a href="fsf.html#cb41-593" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> nn_tab<span class="sc">$</span>sp2_nn)</span>
<span id="cb41-594"><a href="fsf.html#cb41-594" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-595"><a href="fsf.html#cb41-595" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column of match or not</span></span>
<span id="cb41-596"><a href="fsf.html#cb41-596" aria-hidden="true" tabindex="-1"></a>  sp2<span class="sc">$</span>match <span class="ot">&lt;-</span> sp2<span class="sc">$</span>obs <span class="sc">==</span> sp2<span class="sc">$</span>est</span>
<span id="cb41-597"><a href="fsf.html#cb41-597" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-598"><a href="fsf.html#cb41-598" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total percent of matching SP2 to perform_df</span></span>
<span id="cb41-599"><a href="fsf.html#cb41-599" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;second species&#39;</span>, </span>
<span id="cb41-600"><a href="fsf.html#cb41-600" aria-hidden="true" tabindex="-1"></a>                        <span class="at">metric =</span> <span class="st">&#39;accuracy (%)&#39;</span>,</span>
<span id="cb41-601"><a href="fsf.html#cb41-601" aria-hidden="true" tabindex="-1"></a>                        <span class="at">value =</span> <span class="fu">NROW</span>(sp2[sp2<span class="sc">$</span>match <span class="sc">==</span> T,]) <span class="sc">/</span></span>
<span id="cb41-602"><a href="fsf.html#cb41-602" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">NROW</span>(sp2) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb41-603"><a href="fsf.html#cb41-603" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-604"><a href="fsf.html#cb41-604" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate  class3 accuracy</span></span>
<span id="cb41-605"><a href="fsf.html#cb41-605" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create df of class3</span></span>
<span id="cb41-606"><a href="fsf.html#cb41-606" aria-hidden="true" tabindex="-1"></a>  class3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>class3,</span>
<span id="cb41-607"><a href="fsf.html#cb41-607" aria-hidden="true" tabindex="-1"></a>                       <span class="at">est =</span> nn_tab<span class="sc">$</span>class3_nn)</span>
<span id="cb41-608"><a href="fsf.html#cb41-608" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-609"><a href="fsf.html#cb41-609" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column of match or not</span></span>
<span id="cb41-610"><a href="fsf.html#cb41-610" aria-hidden="true" tabindex="-1"></a>  class3<span class="sc">$</span>match <span class="ot">&lt;-</span> class3<span class="sc">$</span>obs <span class="sc">==</span> class3<span class="sc">$</span>est</span>
<span id="cb41-611"><a href="fsf.html#cb41-611" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-612"><a href="fsf.html#cb41-612" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total percent of matching class3 to perform_df</span></span>
<span id="cb41-613"><a href="fsf.html#cb41-613" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;three func group class&#39;</span>,</span>
<span id="cb41-614"><a href="fsf.html#cb41-614" aria-hidden="true" tabindex="-1"></a>                          <span class="at">metric =</span> <span class="st">&#39;accuracy (%)&#39;</span>,</span>
<span id="cb41-615"><a href="fsf.html#cb41-615" aria-hidden="true" tabindex="-1"></a>                          <span class="at">value =</span> <span class="fu">NROW</span>(class3[class3<span class="sc">$</span>match <span class="sc">==</span> T,]) <span class="sc">/</span></span>
<span id="cb41-616"><a href="fsf.html#cb41-616" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">NROW</span>(class3) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb41-617"><a href="fsf.html#cb41-617" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-618"><a href="fsf.html#cb41-618" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate class5 accuracy</span></span>
<span id="cb41-619"><a href="fsf.html#cb41-619" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create df of class5</span></span>
<span id="cb41-620"><a href="fsf.html#cb41-620" aria-hidden="true" tabindex="-1"></a>  class5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>class5,</span>
<span id="cb41-621"><a href="fsf.html#cb41-621" aria-hidden="true" tabindex="-1"></a>                       <span class="at">est =</span> nn_tab<span class="sc">$</span>class5_nn)</span>
<span id="cb41-622"><a href="fsf.html#cb41-622" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-623"><a href="fsf.html#cb41-623" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column of match or not</span></span>
<span id="cb41-624"><a href="fsf.html#cb41-624" aria-hidden="true" tabindex="-1"></a>  class5<span class="sc">$</span>match <span class="ot">&lt;-</span> class5<span class="sc">$</span>obs <span class="sc">==</span> class5<span class="sc">$</span>est</span>
<span id="cb41-625"><a href="fsf.html#cb41-625" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-626"><a href="fsf.html#cb41-626" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total percent of matching class5 to perform_df</span></span>
<span id="cb41-627"><a href="fsf.html#cb41-627" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;five func group class&#39;</span>,</span>
<span id="cb41-628"><a href="fsf.html#cb41-628" aria-hidden="true" tabindex="-1"></a>                        <span class="at">metric =</span> <span class="st">&#39;accuracy (%)&#39;</span>,</span>
<span id="cb41-629"><a href="fsf.html#cb41-629" aria-hidden="true" tabindex="-1"></a>                        <span class="at">value =</span> <span class="fu">NROW</span>(class5[class5<span class="sc">$</span>match <span class="sc">==</span> T,]) <span class="sc">/</span></span>
<span id="cb41-630"><a href="fsf.html#cb41-630" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">NROW</span>(class5) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb41-631"><a href="fsf.html#cb41-631" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-632"><a href="fsf.html#cb41-632" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return df</span></span>
<span id="cb41-633"><a href="fsf.html#cb41-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(perform_df)</span>
<span id="cb41-634"><a href="fsf.html#cb41-634" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-635"><a href="fsf.html#cb41-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-636"><a href="fsf.html#cb41-636" aria-hidden="true" tabindex="-1"></a><span class="co"># create knn function to output imputed vs. observed table</span></span>
<span id="cb41-637"><a href="fsf.html#cb41-637" aria-hidden="true" tabindex="-1"></a>run_knn_fri_table <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, vars, k) {</span>
<span id="cb41-638"><a href="fsf.html#cb41-638" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-639"><a href="fsf.html#cb41-639" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset data</span></span>
<span id="cb41-640"><a href="fsf.html#cb41-640" aria-hidden="true" tabindex="-1"></a>  dat_nn <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(vars))</span>
<span id="cb41-641"><a href="fsf.html#cb41-641" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-642"><a href="fsf.html#cb41-642" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale for nn computation</span></span>
<span id="cb41-643"><a href="fsf.html#cb41-643" aria-hidden="true" tabindex="-1"></a>  dat_nn_scaled <span class="ot">&lt;-</span> dat_nn <span class="sc">%&gt;%</span> scale</span>
<span id="cb41-644"><a href="fsf.html#cb41-644" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-645"><a href="fsf.html#cb41-645" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run nearest neighbor</span></span>
<span id="cb41-646"><a href="fsf.html#cb41-646" aria-hidden="true" tabindex="-1"></a>  nn <span class="ot">&lt;-</span> <span class="fu">nn2</span>(dat_nn_scaled, dat_nn_scaled, <span class="at">k =</span> k <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb41-647"><a href="fsf.html#cb41-647" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-648"><a href="fsf.html#cb41-648" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get nn indices</span></span>
<span id="cb41-649"><a href="fsf.html#cb41-649" aria-hidden="true" tabindex="-1"></a>  nni <span class="ot">&lt;-</span> nn[[<span class="dv">1</span>]][, <span class="dv">2</span><span class="sc">:</span>(k <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="cb41-650"><a href="fsf.html#cb41-650" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-651"><a href="fsf.html#cb41-651" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add vars to tibble</span></span>
<span id="cb41-652"><a href="fsf.html#cb41-652" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take mean/mode if k &gt; 1</span></span>
<span id="cb41-653"><a href="fsf.html#cb41-653" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb41-654"><a href="fsf.html#cb41-654" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb41-655"><a href="fsf.html#cb41-655" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb41-656"><a href="fsf.html#cb41-656" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb41-657"><a href="fsf.html#cb41-657" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-658"><a href="fsf.html#cb41-658" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">mean</span>(dat_nn[x, i])</span>
<span id="cb41-659"><a href="fsf.html#cb41-659" aria-hidden="true" tabindex="-1"></a>                         }))</span>
<span id="cb41-660"><a href="fsf.html#cb41-660" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb41-661"><a href="fsf.html#cb41-661" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb41-662"><a href="fsf.html#cb41-662" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-663"><a href="fsf.html#cb41-663" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">mean</span>(dat_nn[x, i])</span>
<span id="cb41-664"><a href="fsf.html#cb41-664" aria-hidden="true" tabindex="-1"></a>                           }))</span>
<span id="cb41-665"><a href="fsf.html#cb41-665" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb41-666"><a href="fsf.html#cb41-666" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-667"><a href="fsf.html#cb41-667" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-668"><a href="fsf.html#cb41-668" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add target vars to tibble</span></span>
<span id="cb41-669"><a href="fsf.html#cb41-669" aria-hidden="true" tabindex="-1"></a>    nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age =</span> dat<span class="sc">$</span>AGE2018,</span>
<span id="cb41-670"><a href="fsf.html#cb41-670" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1 =</span> dat<span class="sc">$</span>SP1,</span>
<span id="cb41-671"><a href="fsf.html#cb41-671" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2 =</span> dat<span class="sc">$</span>SP2,</span>
<span id="cb41-672"><a href="fsf.html#cb41-672" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class5 =</span> dat<span class="sc">$</span>class5,</span>
<span id="cb41-673"><a href="fsf.html#cb41-673" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class3 =</span> dat<span class="sc">$</span>class3,</span>
<span id="cb41-674"><a href="fsf.html#cb41-674" aria-hidden="true" tabindex="-1"></a>                       <span class="at">age_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-675"><a href="fsf.html#cb41-675" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">mean</span>(dat<span class="sc">$</span>AGE2018[x])</span>
<span id="cb41-676"><a href="fsf.html#cb41-676" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb41-677"><a href="fsf.html#cb41-677" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-678"><a href="fsf.html#cb41-678" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>SP1[x])</span>
<span id="cb41-679"><a href="fsf.html#cb41-679" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb41-680"><a href="fsf.html#cb41-680" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-681"><a href="fsf.html#cb41-681" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>SP2[x])</span>
<span id="cb41-682"><a href="fsf.html#cb41-682" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb41-683"><a href="fsf.html#cb41-683" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class5_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-684"><a href="fsf.html#cb41-684" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>class5[x])</span>
<span id="cb41-685"><a href="fsf.html#cb41-685" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb41-686"><a href="fsf.html#cb41-686" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class3_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb41-687"><a href="fsf.html#cb41-687" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>class3[x])</span>
<span id="cb41-688"><a href="fsf.html#cb41-688" aria-hidden="true" tabindex="-1"></a>                       }))</span>
<span id="cb41-689"><a href="fsf.html#cb41-689" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-690"><a href="fsf.html#cb41-690" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-691"><a href="fsf.html#cb41-691" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take direct nn if k == 1</span></span>
<span id="cb41-692"><a href="fsf.html#cb41-692" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb41-693"><a href="fsf.html#cb41-693" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb41-694"><a href="fsf.html#cb41-694" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb41-695"><a href="fsf.html#cb41-695" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb41-696"><a href="fsf.html#cb41-696" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> dat_nn[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>],i])</span>
<span id="cb41-697"><a href="fsf.html#cb41-697" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb41-698"><a href="fsf.html#cb41-698" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb41-699"><a href="fsf.html#cb41-699" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> dat_nn[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>],i])</span>
<span id="cb41-700"><a href="fsf.html#cb41-700" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb41-701"><a href="fsf.html#cb41-701" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-702"><a href="fsf.html#cb41-702" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-703"><a href="fsf.html#cb41-703" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add target vars to tibble</span></span>
<span id="cb41-704"><a href="fsf.html#cb41-704" aria-hidden="true" tabindex="-1"></a>    nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age =</span> dat<span class="sc">$</span>AGE2018,</span>
<span id="cb41-705"><a href="fsf.html#cb41-705" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1 =</span> dat<span class="sc">$</span>SP1,</span>
<span id="cb41-706"><a href="fsf.html#cb41-706" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2 =</span> dat<span class="sc">$</span>SP2,</span>
<span id="cb41-707"><a href="fsf.html#cb41-707" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class5 =</span> dat<span class="sc">$</span>class5,</span>
<span id="cb41-708"><a href="fsf.html#cb41-708" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class3 =</span> dat<span class="sc">$</span>class3,</span>
<span id="cb41-709"><a href="fsf.html#cb41-709" aria-hidden="true" tabindex="-1"></a>                       <span class="at">age_nn =</span> dat<span class="sc">$</span>AGE2018[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb41-710"><a href="fsf.html#cb41-710" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1_nn =</span> dat<span class="sc">$</span>SP1[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb41-711"><a href="fsf.html#cb41-711" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2_nn =</span> dat<span class="sc">$</span>SP2[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb41-712"><a href="fsf.html#cb41-712" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class5_nn =</span> dat<span class="sc">$</span>class5[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb41-713"><a href="fsf.html#cb41-713" aria-hidden="true" tabindex="-1"></a>                       <span class="at">class3_nn =</span> dat<span class="sc">$</span>class3[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]])</span>
<span id="cb41-714"><a href="fsf.html#cb41-714" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-715"><a href="fsf.html#cb41-715" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-716"><a href="fsf.html#cb41-716" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return nn table</span></span>
<span id="cb41-717"><a href="fsf.html#cb41-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(nn_tab)</span>
<span id="cb41-718"><a href="fsf.html#cb41-718" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-719"><a href="fsf.html#cb41-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-720"><a href="fsf.html#cb41-720" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################</span></span>
<span id="cb41-721"><a href="fsf.html#cb41-721" aria-hidden="true" tabindex="-1"></a><span class="do">### RUN KNN IMPUTATION USING OPTIMAL MODEL VARIABLES </span><span class="al">###</span></span>
<span id="cb41-722"><a href="fsf.html#cb41-722" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################</span></span>
<span id="cb41-723"><a href="fsf.html#cb41-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-724"><a href="fsf.html#cb41-724" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI screened polygons</span></span>
<span id="cb41-725"><a href="fsf.html#cb41-725" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/dat_fri_scr.RData&#39;</span>))</span>
<span id="cb41-726"><a href="fsf.html#cb41-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-727"><a href="fsf.html#cb41-727" aria-hidden="true" tabindex="-1"></a><span class="co"># subset only the attributes we need from the screened FRI polygons</span></span>
<span id="cb41-728"><a href="fsf.html#cb41-728" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="sc">%&lt;&gt;%</span> <span class="fu">select</span>(OPI_ID, AGE2018, agb,</span>
<span id="cb41-729"><a href="fsf.html#cb41-729" aria-hidden="true" tabindex="-1"></a>                        gmvwl, pcum8, ba,</span>
<span id="cb41-730"><a href="fsf.html#cb41-730" aria-hidden="true" tabindex="-1"></a>                        b6, x, y, SP1, SP2, class3, class5)</span>
<span id="cb41-731"><a href="fsf.html#cb41-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-732"><a href="fsf.html#cb41-732" aria-hidden="true" tabindex="-1"></a><span class="co"># remove any polygons with missing values</span></span>
<span id="cb41-733"><a href="fsf.html#cb41-733" aria-hidden="true" tabindex="-1"></a><span class="co"># in imputation X-variables</span></span>
<span id="cb41-734"><a href="fsf.html#cb41-734" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dat_fri_scr <span class="sc">%&gt;%</span> <span class="fu">select</span>(OPI_ID, AGE2018, agb,</span>
<span id="cb41-735"><a href="fsf.html#cb41-735" aria-hidden="true" tabindex="-1"></a>                        gmvwl, pcum8, ba,</span>
<span id="cb41-736"><a href="fsf.html#cb41-736" aria-hidden="true" tabindex="-1"></a>                        b6, x, y) <span class="sc">%&gt;%</span> na.omit,</span>
<span id="cb41-737"><a href="fsf.html#cb41-737" aria-hidden="true" tabindex="-1"></a>                        dat_fri_scr)</span>
<span id="cb41-738"><a href="fsf.html#cb41-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-739"><a href="fsf.html#cb41-739" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector of X-variables for imputation</span></span>
<span id="cb41-740"><a href="fsf.html#cb41-740" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;agb&#39;</span>, <span class="st">&#39;gmvwl&#39;</span>,</span>
<span id="cb41-741"><a href="fsf.html#cb41-741" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;pcum8&#39;</span>, <span class="st">&#39;ba&#39;</span>,</span>
<span id="cb41-742"><a href="fsf.html#cb41-742" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;b6&#39;</span>, <span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)</span>
<span id="cb41-743"><a href="fsf.html#cb41-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-744"><a href="fsf.html#cb41-744" aria-hidden="true" tabindex="-1"></a><span class="co"># run_knn_fri function to get performance results</span></span>
<span id="cb41-745"><a href="fsf.html#cb41-745" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">run_knn_fri</span>(dat_fri_scr, vars, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb41-746"><a href="fsf.html#cb41-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-747"><a href="fsf.html#cb41-747" aria-hidden="true" tabindex="-1"></a><span class="co"># run_knn_fri function to get imputed vs. observed values</span></span>
<span id="cb41-748"><a href="fsf.html#cb41-748" aria-hidden="true" tabindex="-1"></a>nn_tab <span class="ot">&lt;-</span> <span class="fu">run_knn_fri_table</span>(dat_fri_scr, vars, <span class="at">k =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
<div id="fsf622" class="section level3 unnumbered hasAnchor">
<h3><strong>6.2.2</strong> Results: Imputation Over FRI<a href="fsf.html#fsf622" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Summary Stats:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="fsf.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># round values</span></span>
<span id="cb42-2"><a href="fsf.html#cb42-2" aria-hidden="true" tabindex="-1"></a>perf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">round</span>(value, <span class="dv">2</span>))</span>
<span id="cb42-3"><a href="fsf.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="fsf.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># factor variable and metric categories to order</span></span>
<span id="cb42-5"><a href="fsf.html#cb42-5" aria-hidden="true" tabindex="-1"></a>perf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">factor</span>(variable, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;age&#39;</span>, <span class="st">&#39;leading species&#39;</span>, </span>
<span id="cb42-6"><a href="fsf.html#cb42-6" aria-hidden="true" tabindex="-1"></a>                                                        <span class="st">&#39;second species&#39;</span>, <span class="st">&#39;three func group class&#39;</span>,</span>
<span id="cb42-7"><a href="fsf.html#cb42-7" aria-hidden="true" tabindex="-1"></a>                                                        <span class="st">&#39;five func group class&#39;</span>, vars))) <span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="fsf.html#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="fu">factor</span>(metric, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;rmsd (yrs)&#39;</span>, <span class="st">&#39;mbe (yrs)&#39;</span>, <span class="st">&#39;mae (yrs)&#39;</span>, <span class="st">&#39;accuracy (%)&#39;</span>, <span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>)))</span>
<span id="cb42-9"><a href="fsf.html#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="fsf.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cast df</span></span>
<span id="cb42-11"><a href="fsf.html#cb42-11" aria-hidden="true" tabindex="-1"></a>perf_cast <span class="ot">&lt;-</span> <span class="fu">dcast</span>(perf, variable <span class="sc">~</span> metric)</span>
<span id="cb42-12"><a href="fsf.html#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="fsf.html#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># remove x and y</span></span>
<span id="cb42-14"><a href="fsf.html#cb42-14" aria-hidden="true" tabindex="-1"></a>perf_cast <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)))</span>
<span id="cb42-15"><a href="fsf.html#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="fsf.html#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co"># set NA to blank</span></span>
<span id="cb42-17"><a href="fsf.html#cb42-17" aria-hidden="true" tabindex="-1"></a>perf_cast[<span class="fu">is.na</span>(perf_cast)] <span class="ot">&lt;-</span> <span class="st">&#39;&#39;</span></span>
<span id="cb42-18"><a href="fsf.html#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="fsf.html#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># display results</span></span>
<span id="cb42-20"><a href="fsf.html#cb42-20" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(perf_cast, <span class="at">caption =</span> <span class="st">&quot;Imputation Performance of FRI Forest Stand Polygons&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>
Imputation Performance of FRI Forest Stand Polygons
</caption>
<thead>
<tr>
<th style="text-align:left;">
variable
</th>
<th style="text-align:left;">
rmsd (yrs)
</th>
<th style="text-align:left;">
mbe (yrs)
</th>
<th style="text-align:left;">
mae (yrs)
</th>
<th style="text-align:left;">
accuracy (%)
</th>
<th style="text-align:left;">
rrmsd (%)
</th>
<th style="text-align:left;">
rmbe (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:left;">
20.08
</td>
<td style="text-align:left;">
0.17
</td>
<td style="text-align:left;">
14.75
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
leading species
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
64.47
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
second species
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
31.75
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
three func group class
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
78.61
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
five func group class
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
80.78
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
agb
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
2.5
</td>
<td style="text-align:left;">
-0.02
</td>
</tr>
<tr>
<td style="text-align:left;">
gmvwl
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
3.84
</td>
<td style="text-align:left;">
-0.28
</td>
</tr>
<tr>
<td style="text-align:left;">
pcum8
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1.24
</td>
<td style="text-align:left;">
0.07
</td>
</tr>
<tr>
<td style="text-align:left;">
ba
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
2.24
</td>
<td style="text-align:left;">
0.05
</td>
</tr>
<tr>
<td style="text-align:left;">
b6
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
2.27
</td>
<td style="text-align:left;">
0.09
</td>
</tr>
</tbody>
</table>
<p>The mean bias error (MBE) of age is 0.17 years, indicating the imputed estimates of age are not skewed toward younger or older values. The mean absolute error (MAE) of age is 14.75 years, which is the average difference between the observed and imputed value.</p>
<p>Accuracy of leading species classification is 64.47%, and a much lower 31.75% for second leading species. Three and five functional group classification have respective accuracies of 78.61% and 80.78%. Functional group classification accuracies are higher than in the RMF.</p>
<p>Relative root mean squared difference (RRMSD) of the imputation attributes (avg, sd, rumple, zpcum8, and red_edge_2) is below 4% for all attributes. These are low values, which demonstrate that the imputation algorithm is finding optimal matches within the database of available FRI polygons.</p>
<p>Relative mean bias error (RMBE) of the imputation attributes is less than 1%, meaning that the nearest neighbor selections are not skewed toward positive or negative values of these attributes.</p>
<p>RRMSD/RMBE are not calculated for x and y because the coordinates do not represent a value scale.</p>
<p>We can also generate detailed confusion matrices of the imputed vs.Â observed species composition.</p>
<p>Confusion matrices:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="fsf.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate 3 func group confusion matrix</span></span>
<span id="cb43-2"><a href="fsf.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># build accuracy table</span></span>
<span id="cb43-3"><a href="fsf.html#cb43-3" aria-hidden="true" tabindex="-1"></a>accmat <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="st">&quot;pred&quot;</span> <span class="ot">=</span> nn_tab<span class="sc">$</span>class3_nn, <span class="st">&quot;ref&quot;</span> <span class="ot">=</span> nn_tab<span class="sc">$</span>class3)</span>
<span id="cb43-4"><a href="fsf.html#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="fsf.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># UA</span></span>
<span id="cb43-6"><a href="fsf.html#cb43-6" aria-hidden="true" tabindex="-1"></a>ua <span class="ot">&lt;-</span> <span class="fu">diag</span>(accmat) <span class="sc">/</span> <span class="fu">rowSums</span>(accmat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb43-7"><a href="fsf.html#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="fsf.html#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># PA</span></span>
<span id="cb43-9"><a href="fsf.html#cb43-9" aria-hidden="true" tabindex="-1"></a>pa <span class="ot">&lt;-</span> <span class="fu">diag</span>(accmat) <span class="sc">/</span> <span class="fu">colSums</span>(accmat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb43-10"><a href="fsf.html#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="fsf.html#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># OA</span></span>
<span id="cb43-12"><a href="fsf.html#cb43-12" aria-hidden="true" tabindex="-1"></a>oa <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(accmat)) <span class="sc">/</span> <span class="fu">sum</span>(accmat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb43-13"><a href="fsf.html#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="fsf.html#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co"># build confusion matrix</span></span>
<span id="cb43-15"><a href="fsf.html#cb43-15" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">addmargins</span>(accmat)</span>
<span id="cb43-16"><a href="fsf.html#cb43-16" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">rbind</span>(accmat_ext, <span class="st">&quot;Users&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(pa, <span class="cn">NA</span>))</span>
<span id="cb43-17"><a href="fsf.html#cb43-17" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">cbind</span>(accmat_ext, <span class="st">&quot;Producers&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(ua, <span class="cn">NA</span>, oa))</span>
<span id="cb43-18"><a href="fsf.html#cb43-18" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">round</span>(accmat_ext, <span class="dv">2</span>)</span>
<span id="cb43-19"><a href="fsf.html#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(accmat_ext) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;Imputed&quot;</span> <span class="ot">=</span> <span class="fu">colnames</span>(accmat_ext),</span>
<span id="cb43-20"><a href="fsf.html#cb43-20" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Observed&quot;</span> <span class="ot">=</span> <span class="fu">rownames</span>(accmat_ext))</span>
<span id="cb43-21"><a href="fsf.html#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(accmat_ext) <span class="ot">&lt;-</span> <span class="st">&quot;table&quot;</span></span>
<span id="cb43-22"><a href="fsf.html#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="fsf.html#cb43-23" aria-hidden="true" tabindex="-1"></a><span class="co"># display results</span></span>
<span id="cb43-24"><a href="fsf.html#cb43-24" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(accmat_ext <span class="sc">%&gt;%</span> round, <span class="at">caption =</span> <span class="st">&quot;Confusion matrix of imputed vs. observed three functional group classification over FRI polygons. Rows are imputed values and columns are observed values.&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>
Confusion matrix of imputed vs.Â observed three functional group classification over FRI polygons. Rows are imputed values and columns are observed values.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Hardwood
</th>
<th style="text-align:right;">
Mixedwood
</th>
<th style="text-align:right;">
Softwood
</th>
<th style="text-align:right;">
Sum
</th>
<th style="text-align:right;">
Users
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Hardwood
</td>
<td style="text-align:right;">
53011
</td>
<td style="text-align:right;">
5542
</td>
<td style="text-align:right;">
745
</td>
<td style="text-align:right;">
59298
</td>
<td style="text-align:right;">
89
</td>
</tr>
<tr>
<td style="text-align:left;">
Mixedwood
</td>
<td style="text-align:right;">
4227
</td>
<td style="text-align:right;">
14830
</td>
<td style="text-align:right;">
5210
</td>
<td style="text-align:right;">
24267
</td>
<td style="text-align:right;">
61
</td>
</tr>
<tr>
<td style="text-align:left;">
Softwood
</td>
<td style="text-align:right;">
1098
</td>
<td style="text-align:right;">
4781
</td>
<td style="text-align:right;">
11560
</td>
<td style="text-align:right;">
17439
</td>
<td style="text-align:right;">
66
</td>
</tr>
<tr>
<td style="text-align:left;">
Sum
</td>
<td style="text-align:right;">
58336
</td>
<td style="text-align:right;">
25153
</td>
<td style="text-align:right;">
17515
</td>
<td style="text-align:right;">
101004
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Producers
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
79
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="fsf.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate 5 func group confusion matrix</span></span>
<span id="cb44-2"><a href="fsf.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># build accuracy table</span></span>
<span id="cb44-3"><a href="fsf.html#cb44-3" aria-hidden="true" tabindex="-1"></a>accmat <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="st">&quot;pred&quot;</span> <span class="ot">=</span> nn_tab<span class="sc">$</span>class5_nn, <span class="st">&quot;ref&quot;</span> <span class="ot">=</span> nn_tab<span class="sc">$</span>class5)</span>
<span id="cb44-4"><a href="fsf.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="fsf.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># UA</span></span>
<span id="cb44-6"><a href="fsf.html#cb44-6" aria-hidden="true" tabindex="-1"></a>ua <span class="ot">&lt;-</span> <span class="fu">diag</span>(accmat) <span class="sc">/</span> <span class="fu">rowSums</span>(accmat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb44-7"><a href="fsf.html#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="fsf.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># PA</span></span>
<span id="cb44-9"><a href="fsf.html#cb44-9" aria-hidden="true" tabindex="-1"></a>pa <span class="ot">&lt;-</span> <span class="fu">diag</span>(accmat) <span class="sc">/</span> <span class="fu">colSums</span>(accmat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb44-10"><a href="fsf.html#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="fsf.html#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># OA</span></span>
<span id="cb44-12"><a href="fsf.html#cb44-12" aria-hidden="true" tabindex="-1"></a>oa <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(accmat)) <span class="sc">/</span> <span class="fu">sum</span>(accmat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb44-13"><a href="fsf.html#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="fsf.html#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co"># build confusion matrix</span></span>
<span id="cb44-15"><a href="fsf.html#cb44-15" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">addmargins</span>(accmat)</span>
<span id="cb44-16"><a href="fsf.html#cb44-16" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">rbind</span>(accmat_ext, <span class="st">&quot;Users&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(pa, <span class="cn">NA</span>))</span>
<span id="cb44-17"><a href="fsf.html#cb44-17" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">cbind</span>(accmat_ext, <span class="st">&quot;Producers&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(ua, <span class="cn">NA</span>, oa))</span>
<span id="cb44-18"><a href="fsf.html#cb44-18" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">round</span>(accmat_ext, <span class="dv">2</span>)</span>
<span id="cb44-19"><a href="fsf.html#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(accmat_ext) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;Imputed&quot;</span> <span class="ot">=</span> <span class="fu">colnames</span>(accmat_ext),</span>
<span id="cb44-20"><a href="fsf.html#cb44-20" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Observed&quot;</span> <span class="ot">=</span> <span class="fu">rownames</span>(accmat_ext))</span>
<span id="cb44-21"><a href="fsf.html#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(accmat_ext) <span class="ot">&lt;-</span> <span class="st">&quot;table&quot;</span></span>
<span id="cb44-22"><a href="fsf.html#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="fsf.html#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co"># display results</span></span>
<span id="cb44-24"><a href="fsf.html#cb44-24" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(accmat_ext <span class="sc">%&gt;%</span> round, <span class="at">caption =</span> <span class="st">&quot;Confusion matrix of imputed vs. observed five functional group classification over FRI polygons. Rows are imputed values and columns are observed values.&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>
Confusion matrix of imputed vs.Â observed five functional group classification over FRI polygons. Rows are imputed values and columns are observed values.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Black Spruce Dominated
</th>
<th style="text-align:right;">
Hardwood
</th>
<th style="text-align:right;">
Jack Pine Dominated
</th>
<th style="text-align:right;">
Mixed Conifers
</th>
<th style="text-align:right;">
Mixedwood
</th>
<th style="text-align:right;">
Sum
</th>
<th style="text-align:right;">
Users
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Black Spruce Dominated
</td>
<td style="text-align:right;">
549
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
348
</td>
<td style="text-align:right;">
217
</td>
<td style="text-align:right;">
1178
</td>
<td style="text-align:right;">
47
</td>
</tr>
<tr>
<td style="text-align:left;">
Hardwood
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
52851
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
319
</td>
<td style="text-align:right;">
5613
</td>
<td style="text-align:right;">
58844
</td>
<td style="text-align:right;">
90
</td>
</tr>
<tr>
<td style="text-align:left;">
Jack Pine Dominated
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
357
</td>
<td style="text-align:right;">
128
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
683
</td>
<td style="text-align:right;">
52
</td>
</tr>
<tr>
<td style="text-align:left;">
Mixed Conifers
</td>
<td style="text-align:right;">
483
</td>
<td style="text-align:right;">
316
</td>
<td style="text-align:right;">
104
</td>
<td style="text-align:right;">
3607
</td>
<td style="text-align:right;">
2248
</td>
<td style="text-align:right;">
6758
</td>
<td style="text-align:right;">
53
</td>
</tr>
<tr>
<td style="text-align:left;">
Mixedwood
</td>
<td style="text-align:right;">
336
</td>
<td style="text-align:right;">
5078
</td>
<td style="text-align:right;">
159
</td>
<td style="text-align:right;">
3739
</td>
<td style="text-align:right;">
24229
</td>
<td style="text-align:right;">
33541
</td>
<td style="text-align:right;">
72
</td>
</tr>
<tr>
<td style="text-align:left;">
Sum
</td>
<td style="text-align:right;">
1432
</td>
<td style="text-align:right;">
58336
</td>
<td style="text-align:right;">
640
</td>
<td style="text-align:right;">
8141
</td>
<td style="text-align:right;">
32455
</td>
<td style="text-align:right;">
101004
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Producers
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
81
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="fsf.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate leading species confusion matrix</span></span>
<span id="cb45-2"><a href="fsf.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create df of sp1</span></span>
<span id="cb45-3"><a href="fsf.html#cb45-3" aria-hidden="true" tabindex="-1"></a>sp1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>sp1 <span class="sc">%&gt;%</span> as.factor,</span>
<span id="cb45-4"><a href="fsf.html#cb45-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">est =</span> nn_tab<span class="sc">$</span>sp1_nn <span class="sc">%&gt;%</span> as.factor)</span>
<span id="cb45-5"><a href="fsf.html#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="fsf.html#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># make estimate levels match obs levels</span></span>
<span id="cb45-7"><a href="fsf.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(sp1<span class="sc">$</span>est) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">levels</span>(sp1<span class="sc">$</span>est), <span class="fu">levels</span>(sp1<span class="sc">$</span>obs)[<span class="sc">!</span>(<span class="fu">levels</span>(sp1<span class="sc">$</span>obs) <span class="sc">%in%</span> <span class="fu">levels</span>(sp1<span class="sc">$</span>est))])</span>
<span id="cb45-8"><a href="fsf.html#cb45-8" aria-hidden="true" tabindex="-1"></a>sp1<span class="sc">$</span>est <span class="ot">&lt;-</span> <span class="fu">factor</span>(sp1<span class="sc">$</span>est, <span class="at">levels =</span> <span class="fu">levels</span>(sp1<span class="sc">$</span>obs))</span>
<span id="cb45-9"><a href="fsf.html#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="fsf.html#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create column of match or not</span></span>
<span id="cb45-11"><a href="fsf.html#cb45-11" aria-hidden="true" tabindex="-1"></a>sp1<span class="sc">$</span>match <span class="ot">&lt;-</span> sp1<span class="sc">$</span>obs <span class="sc">==</span> sp1<span class="sc">$</span>est</span>
<span id="cb45-12"><a href="fsf.html#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="fsf.html#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co"># build accuracy table</span></span>
<span id="cb45-14"><a href="fsf.html#cb45-14" aria-hidden="true" tabindex="-1"></a>accmat <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="st">&quot;pred&quot;</span> <span class="ot">=</span> sp1<span class="sc">$</span>est, <span class="st">&quot;ref&quot;</span> <span class="ot">=</span> sp1<span class="sc">$</span>obs)</span>
<span id="cb45-15"><a href="fsf.html#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="fsf.html#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># UA</span></span>
<span id="cb45-17"><a href="fsf.html#cb45-17" aria-hidden="true" tabindex="-1"></a>ua <span class="ot">&lt;-</span> <span class="fu">diag</span>(accmat) <span class="sc">/</span> <span class="fu">rowSums</span>(accmat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb45-18"><a href="fsf.html#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="fsf.html#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># PA</span></span>
<span id="cb45-20"><a href="fsf.html#cb45-20" aria-hidden="true" tabindex="-1"></a>pa <span class="ot">&lt;-</span> <span class="fu">diag</span>(accmat) <span class="sc">/</span> <span class="fu">colSums</span>(accmat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb45-21"><a href="fsf.html#cb45-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-22"><a href="fsf.html#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co"># OA</span></span>
<span id="cb45-23"><a href="fsf.html#cb45-23" aria-hidden="true" tabindex="-1"></a>oa <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(accmat)) <span class="sc">/</span> <span class="fu">sum</span>(accmat) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb45-24"><a href="fsf.html#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="fsf.html#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="co"># build confusion matrix</span></span>
<span id="cb45-26"><a href="fsf.html#cb45-26" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">addmargins</span>(accmat)</span>
<span id="cb45-27"><a href="fsf.html#cb45-27" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">rbind</span>(accmat_ext, <span class="st">&quot;Users&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(pa, <span class="cn">NA</span>))</span>
<span id="cb45-28"><a href="fsf.html#cb45-28" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">cbind</span>(accmat_ext, <span class="st">&quot;Producers&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(ua, <span class="cn">NA</span>, oa))</span>
<span id="cb45-29"><a href="fsf.html#cb45-29" aria-hidden="true" tabindex="-1"></a>accmat_ext <span class="ot">&lt;-</span> <span class="fu">round</span>(accmat_ext, <span class="dv">2</span>)</span>
<span id="cb45-30"><a href="fsf.html#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(accmat_ext) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;Imputed&quot;</span> <span class="ot">=</span> <span class="fu">colnames</span>(accmat_ext),</span>
<span id="cb45-31"><a href="fsf.html#cb45-31" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Observed&quot;</span> <span class="ot">=</span> <span class="fu">rownames</span>(accmat_ext))</span>
<span id="cb45-32"><a href="fsf.html#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(accmat_ext) <span class="ot">&lt;-</span> <span class="st">&quot;table&quot;</span></span>
<span id="cb45-33"><a href="fsf.html#cb45-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-34"><a href="fsf.html#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="co"># display results</span></span>
<span id="cb45-35"><a href="fsf.html#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(accmat_ext <span class="sc">%&gt;%</span> round, <span class="at">caption =</span> <span class="st">&quot;Confusion matrix of imputed vs. observed leading species over FRI polygons. Rows are imputed values and columns are observed values.&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-36"><a href="fsf.html#cb45-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_paper</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-37"><a href="fsf.html#cb45-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;500px&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:500px; ">
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<caption>
Confusion matrix of imputed vs.Â observed leading species over FRI polygons. Rows are imputed values and columns are observed values.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
AB
</th>
<th style="text-align:right;">
AG
</th>
<th style="text-align:right;">
AW
</th>
<th style="text-align:right;">
BD
</th>
<th style="text-align:right;">
BE
</th>
<th style="text-align:right;">
BF
</th>
<th style="text-align:right;">
BW
</th>
<th style="text-align:right;">
BY
</th>
<th style="text-align:right;">
CB
</th>
<th style="text-align:right;">
CE
</th>
<th style="text-align:right;">
CW
</th>
<th style="text-align:right;">
EW
</th>
<th style="text-align:right;">
HE
</th>
<th style="text-align:right;">
LA
</th>
<th style="text-align:right;">
MH
</th>
<th style="text-align:right;">
MR
</th>
<th style="text-align:right;">
MS
</th>
<th style="text-align:right;">
OR
</th>
<th style="text-align:right;">
OW
</th>
<th style="text-align:right;">
PB
</th>
<th style="text-align:right;">
PJ
</th>
<th style="text-align:right;">
PL
</th>
<th style="text-align:right;">
PO
</th>
<th style="text-align:right;">
PR
</th>
<th style="text-align:right;">
PS
</th>
<th style="text-align:right;">
PT
</th>
<th style="text-align:right;">
PW
</th>
<th style="text-align:right;">
SB
</th>
<th style="text-align:right;">
SW
</th>
<th style="text-align:right;">
Sum
</th>
<th style="text-align:right;">
Users
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AB
</td>
<td style="text-align:right;">
133
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
383
</td>
<td style="text-align:right;">
35
</td>
</tr>
<tr>
<td style="text-align:left;">
AG
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NaN
</td>
</tr>
<tr>
<td style="text-align:left;">
AW
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
BD
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
BE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
BF
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1886
</td>
<td style="text-align:right;">
258
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
125
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
238
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
206
</td>
<td style="text-align:right;">
202
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
494
</td>
<td style="text-align:right;">
310
</td>
<td style="text-align:right;">
578
</td>
<td style="text-align:right;">
443
</td>
<td style="text-align:right;">
5130
</td>
<td style="text-align:right;">
37
</td>
</tr>
<tr>
<td style="text-align:left;">
BW
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
197
</td>
<td style="text-align:right;">
578
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
111
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
160
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
424
</td>
<td style="text-align:right;">
252
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
2095
</td>
<td style="text-align:right;">
28
</td>
</tr>
<tr>
<td style="text-align:left;">
BY
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
337
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
52
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
454
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
1194
</td>
<td style="text-align:right;">
28
</td>
</tr>
<tr>
<td style="text-align:left;">
CB
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
CE
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NaN
</td>
</tr>
<tr>
<td style="text-align:left;">
CW
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
74
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
341
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
EW
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NaN
</td>
</tr>
<tr>
<td style="text-align:left;">
HE
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
230
</td>
<td style="text-align:right;">
223
</td>
<td style="text-align:right;">
128
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4177
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
446
</td>
<td style="text-align:right;">
122
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
107
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
281
</td>
<td style="text-align:right;">
609
</td>
<td style="text-align:right;">
114
</td>
<td style="text-align:right;">
121
</td>
<td style="text-align:right;">
6683
</td>
<td style="text-align:right;">
62
</td>
</tr>
<tr>
<td style="text-align:left;">
LA
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
177
</td>
<td style="text-align:right;">
19
</td>
</tr>
<tr>
<td style="text-align:left;">
MH
</td>
<td style="text-align:right;">
378
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
156
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
1566
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
613
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
34365
</td>
<td style="text-align:right;">
2281
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
2617
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
337
</td>
<td style="text-align:right;">
240
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
54
</td>
<td style="text-align:right;">
43134
</td>
<td style="text-align:right;">
80
</td>
</tr>
<tr>
<td style="text-align:left;">
MR
</td>
<td style="text-align:right;">
108
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
125
</td>
<td style="text-align:right;">
72
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
134
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
920
</td>
<td style="text-align:right;">
2086
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
739
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
187
</td>
<td style="text-align:right;">
362
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
4945
</td>
<td style="text-align:right;">
42
</td>
</tr>
<tr>
<td style="text-align:left;">
MS
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
OR
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1283
</td>
<td style="text-align:right;">
828
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
2698
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
307
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5491
</td>
<td style="text-align:right;">
49
</td>
</tr>
<tr>
<td style="text-align:left;">
OW
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
PB
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
PJ
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
567
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
61
</td>
<td style="text-align:right;">
263
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1042
</td>
<td style="text-align:right;">
54
</td>
</tr>
<tr>
<td style="text-align:left;">
PL
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
59
</td>
<td style="text-align:right;">
19
</td>
</tr>
<tr>
<td style="text-align:left;">
PO
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
24
</td>
</tr>
<tr>
<td style="text-align:left;">
PR
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
351
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
587
</td>
<td style="text-align:right;">
60
</td>
</tr>
<tr>
<td style="text-align:left;">
PS
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
102
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:left;">
PT
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
500
</td>
<td style="text-align:right;">
585
</td>
<td style="text-align:right;">
112
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
263
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
389
</td>
<td style="text-align:right;">
272
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
96
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
2918
</td>
<td style="text-align:right;">
699
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
190
</td>
<td style="text-align:right;">
6450
</td>
<td style="text-align:right;">
45
</td>
</tr>
<tr>
<td style="text-align:left;">
PW
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
492
</td>
<td style="text-align:right;">
549
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
802
</td>
<td style="text-align:right;">
49
</td>
<td style="text-align:right;">
277
</td>
<td style="text-align:right;">
654
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
601
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
307
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
276
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1107
</td>
<td style="text-align:right;">
13245
</td>
<td style="text-align:right;">
132
</td>
<td style="text-align:right;">
172
</td>
<td style="text-align:right;">
18883
</td>
<td style="text-align:right;">
70
</td>
</tr>
<tr>
<td style="text-align:left;">
SB
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
531
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
192
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
122
</td>
<td style="text-align:right;">
130
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
79
</td>
<td style="text-align:right;">
1357
</td>
<td style="text-align:right;">
183
</td>
<td style="text-align:right;">
2995
</td>
<td style="text-align:right;">
45
</td>
</tr>
<tr>
<td style="text-align:left;">
SW
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
284
</td>
<td style="text-align:right;">
83
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
98
</td>
<td style="text-align:right;">
63
</td>
<td style="text-align:right;">
101
</td>
<td style="text-align:right;">
271
</td>
<td style="text-align:right;">
1189
</td>
<td style="text-align:right;">
23
</td>
</tr>
<tr>
<td style="text-align:left;">
Sum
</td>
<td style="text-align:right;">
918
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
4639
</td>
<td style="text-align:right;">
2731
</td>
<td style="text-align:right;">
2550
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
629
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6745
</td>
<td style="text-align:right;">
401
</td>
<td style="text-align:right;">
38799
</td>
<td style="text-align:right;">
6775
</td>
<td style="text-align:right;">
131
</td>
<td style="text-align:right;">
6966
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
996
</td>
<td style="text-align:right;">
125
</td>
<td style="text-align:right;">
66
</td>
<td style="text-align:right;">
913
</td>
<td style="text-align:right;">
211
</td>
<td style="text-align:right;">
6242
</td>
<td style="text-align:right;">
16569
</td>
<td style="text-align:right;">
2648
</td>
<td style="text-align:right;">
1653
</td>
<td style="text-align:right;">
101004
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Producers
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
39
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
64
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="fsf63" class="section level2 unnumbered hasAnchor">
<h2><strong>6.3</strong> Imputation from FRI to GRM<a href="fsf.html#fsf63" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="fsf631" class="section level3 unnumbered hasAnchor">
<h3><strong>6.3.1</strong> Run Algorithm<a href="fsf.html#fsf631" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="fsf.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load GRM screened polygons</span></span>
<span id="cb46-2"><a href="fsf.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">str_c</span>(out_dir, <span class="st">&#39;/temp/dat_grm_scr.RData&#39;</span>))</span>
<span id="cb46-3"><a href="fsf.html#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="fsf.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for grm and fri metrics used in imputation</span></span>
<span id="cb46-5"><a href="fsf.html#cb46-5" aria-hidden="true" tabindex="-1"></a>dat_grm_imp <span class="ot">&lt;-</span> dat_grm_scr <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, agb,</span>
<span id="cb46-6"><a href="fsf.html#cb46-6" aria-hidden="true" tabindex="-1"></a>                                      gmvwl, pcum8, ba,</span>
<span id="cb46-7"><a href="fsf.html#cb46-7" aria-hidden="true" tabindex="-1"></a>                                      b6, x, y) <span class="sc">%&gt;%</span> na.omit</span>
<span id="cb46-8"><a href="fsf.html#cb46-8" aria-hidden="true" tabindex="-1"></a>dat_fri_imp <span class="ot">&lt;-</span> dat_fri_scr <span class="sc">%&gt;%</span> <span class="fu">select</span>(agb,</span>
<span id="cb46-9"><a href="fsf.html#cb46-9" aria-hidden="true" tabindex="-1"></a>                                      gmvwl, pcum8, ba,</span>
<span id="cb46-10"><a href="fsf.html#cb46-10" aria-hidden="true" tabindex="-1"></a>                                      b6, x, y) <span class="sc">%&gt;%</span> na.omit</span>
<span id="cb46-11"><a href="fsf.html#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="fsf.html#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># need to combine and scale all values together then separate again</span></span>
<span id="cb46-13"><a href="fsf.html#cb46-13" aria-hidden="true" tabindex="-1"></a>dat_comb_scaled <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dat_grm_imp <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>id), </span>
<span id="cb46-14"><a href="fsf.html#cb46-14" aria-hidden="true" tabindex="-1"></a>                         dat_fri_imp) <span class="sc">%&gt;%</span> scale</span>
<span id="cb46-15"><a href="fsf.html#cb46-15" aria-hidden="true" tabindex="-1"></a>dat_grm_scaled <span class="ot">&lt;-</span> dat_comb_scaled[<span class="dv">1</span><span class="sc">:</span><span class="fu">NROW</span>(dat_grm_imp),]</span>
<span id="cb46-16"><a href="fsf.html#cb46-16" aria-hidden="true" tabindex="-1"></a>dat_fri_scaled <span class="ot">&lt;-</span> dat_comb_scaled[(<span class="fu">NROW</span>(dat_grm_imp)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">NROW</span>(dat_grm_imp)<span class="sc">+</span><span class="fu">NROW</span>(dat_fri_imp)),]</span>
<span id="cb46-17"><a href="fsf.html#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="fsf.html#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="co"># run nearest neighbor imputation k = 5</span></span>
<span id="cb46-19"><a href="fsf.html#cb46-19" aria-hidden="true" tabindex="-1"></a>nn <span class="ot">&lt;-</span> <span class="fu">nn2</span>(dat_fri_scaled, dat_grm_scaled, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb46-20"><a href="fsf.html#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="fsf.html#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="co"># get nn indices</span></span>
<span id="cb46-22"><a href="fsf.html#cb46-22" aria-hidden="true" tabindex="-1"></a>nni <span class="ot">&lt;-</span> nn[[<span class="dv">1</span>]]</span>
<span id="cb46-23"><a href="fsf.html#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="fsf.html#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="co"># add imputed attributes into GRM imputation data frame</span></span>
<span id="cb46-25"><a href="fsf.html#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb46-26"><a href="fsf.html#cb46-26" aria-hidden="true" tabindex="-1"></a>  dat_grm_imp <span class="sc">%&lt;&gt;%</span> <span class="fu">add_column</span>(</span>
<span id="cb46-27"><a href="fsf.html#cb46-27" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(</span>
<span id="cb46-28"><a href="fsf.html#cb46-28" aria-hidden="true" tabindex="-1"></a>      nni, </span>
<span id="cb46-29"><a href="fsf.html#cb46-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">1</span>, </span>
<span id="cb46-30"><a href="fsf.html#cb46-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb46-31"><a href="fsf.html#cb46-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>(dat_fri_imp[x, vars[i]])</span>
<span id="cb46-32"><a href="fsf.html#cb46-32" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb46-33"><a href="fsf.html#cb46-33" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb46-34"><a href="fsf.html#cb46-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-35"><a href="fsf.html#cb46-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-36"><a href="fsf.html#cb46-36" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector of target variables</span></span>
<span id="cb46-37"><a href="fsf.html#cb46-37" aria-hidden="true" tabindex="-1"></a>tar_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;AGE2018&#39;</span>, <span class="st">&#39;SP1&#39;</span>, <span class="st">&#39;SP2&#39;</span>,</span>
<span id="cb46-38"><a href="fsf.html#cb46-38" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;class3&#39;</span>, <span class="st">&#39;class5&#39;</span>)</span>
<span id="cb46-39"><a href="fsf.html#cb46-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-40"><a href="fsf.html#cb46-40" aria-hidden="true" tabindex="-1"></a><span class="co"># add age and species variables to GRM data frame</span></span>
<span id="cb46-41"><a href="fsf.html#cb46-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(tar_vars)){</span>
<span id="cb46-42"><a href="fsf.html#cb46-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="st">&#39;AGE2018&#39;</span>){</span>
<span id="cb46-43"><a href="fsf.html#cb46-43" aria-hidden="true" tabindex="-1"></a>    dat_grm_imp <span class="sc">%&lt;&gt;%</span> <span class="fu">add_column</span>(</span>
<span id="cb46-44"><a href="fsf.html#cb46-44" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span>tar_vars[i] <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(</span>
<span id="cb46-45"><a href="fsf.html#cb46-45" aria-hidden="true" tabindex="-1"></a>        nni, </span>
<span id="cb46-46"><a href="fsf.html#cb46-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">1</span>, </span>
<span id="cb46-47"><a href="fsf.html#cb46-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb46-48"><a href="fsf.html#cb46-48" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mean</span>(dat_fri_scr[x, tar_vars[i]])</span>
<span id="cb46-49"><a href="fsf.html#cb46-49" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-50"><a href="fsf.html#cb46-50" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb46-51"><a href="fsf.html#cb46-51" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb46-52"><a href="fsf.html#cb46-52" aria-hidden="true" tabindex="-1"></a>    dat_grm_imp <span class="sc">%&lt;&gt;%</span> <span class="fu">add_column</span>(</span>
<span id="cb46-53"><a href="fsf.html#cb46-53" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span>tar_vars[i] <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(</span>
<span id="cb46-54"><a href="fsf.html#cb46-54" aria-hidden="true" tabindex="-1"></a>        nni, </span>
<span id="cb46-55"><a href="fsf.html#cb46-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">1</span>, </span>
<span id="cb46-56"><a href="fsf.html#cb46-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb46-57"><a href="fsf.html#cb46-57" aria-hidden="true" tabindex="-1"></a>          <span class="fu">getmode</span>(dat_fri_scr[x, tar_vars[i]])</span>
<span id="cb46-58"><a href="fsf.html#cb46-58" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-59"><a href="fsf.html#cb46-59" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb46-60"><a href="fsf.html#cb46-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-61"><a href="fsf.html#cb46-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-62"><a href="fsf.html#cb46-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-63"><a href="fsf.html#cb46-63" aria-hidden="true" tabindex="-1"></a><span class="co"># update colnames</span></span>
<span id="cb46-64"><a href="fsf.html#cb46-64" aria-hidden="true" tabindex="-1"></a>dat_grm_imp <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">age =</span> AGE2018)</span>
<span id="cb46-65"><a href="fsf.html#cb46-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-66"><a href="fsf.html#cb46-66" aria-hidden="true" tabindex="-1"></a><span class="co"># add values back into main GRM data frame</span></span>
<span id="cb46-67"><a href="fsf.html#cb46-67" aria-hidden="true" tabindex="-1"></a>dat_grm <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dat_grm, dat_grm_imp)</span></code></pre></div>
</div>
<div id="fsf632" class="section level3 unnumbered hasAnchor">
<h3><strong>6.3.2</strong> Results: Imputation X-Variable Performance<a href="fsf.html#fsf632" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="fsf.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate performance across imputation x-variables</span></span>
<span id="cb47-2"><a href="fsf.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb47-3"><a href="fsf.html#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb47-4"><a href="fsf.html#cb47-4" aria-hidden="true" tabindex="-1"></a>      perf <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">variable =</span> vars[i],</span>
<span id="cb47-5"><a href="fsf.html#cb47-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>),</span>
<span id="cb47-6"><a href="fsf.html#cb47-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rrmsd</span>(dat_grm_imp[, vars[i]],</span>
<span id="cb47-7"><a href="fsf.html#cb47-7" aria-hidden="true" tabindex="-1"></a>                         dat_grm_imp[, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>)]),</span>
<span id="cb47-8"><a href="fsf.html#cb47-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rmbe</span>(dat_grm_imp[, vars[i]],</span>
<span id="cb47-9"><a href="fsf.html#cb47-9" aria-hidden="true" tabindex="-1"></a>                         dat_grm_imp[, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>)])))</span>
<span id="cb47-10"><a href="fsf.html#cb47-10" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb47-11"><a href="fsf.html#cb47-11" aria-hidden="true" tabindex="-1"></a>      perf <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> vars[i],</span>
<span id="cb47-12"><a href="fsf.html#cb47-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>),</span>
<span id="cb47-13"><a href="fsf.html#cb47-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rrmsd</span>(dat_grm_imp[, vars[i]],</span>
<span id="cb47-14"><a href="fsf.html#cb47-14" aria-hidden="true" tabindex="-1"></a>                         dat_grm_imp[, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>)]),</span>
<span id="cb47-15"><a href="fsf.html#cb47-15" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rmbe</span>(dat_grm_imp[, vars[i]],</span>
<span id="cb47-16"><a href="fsf.html#cb47-16" aria-hidden="true" tabindex="-1"></a>                          dat_grm_imp[, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>)])))</span>
<span id="cb47-17"><a href="fsf.html#cb47-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-18"><a href="fsf.html#cb47-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-19"><a href="fsf.html#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="fsf.html#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co"># round to two decimal places</span></span>
<span id="cb47-21"><a href="fsf.html#cb47-21" aria-hidden="true" tabindex="-1"></a>perf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">round</span>(value, <span class="dv">2</span>))</span>
<span id="cb47-22"><a href="fsf.html#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="fsf.html#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co"># factor so table displays nicely</span></span>
<span id="cb47-24"><a href="fsf.html#cb47-24" aria-hidden="true" tabindex="-1"></a>perf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">factor</span>(variable, <span class="at">levels =</span> vars)) <span class="sc">%&gt;%</span></span>
<span id="cb47-25"><a href="fsf.html#cb47-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="fu">factor</span>(metric, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>)))</span>
<span id="cb47-26"><a href="fsf.html#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="fsf.html#cb47-27" aria-hidden="true" tabindex="-1"></a><span class="co"># cast df</span></span>
<span id="cb47-28"><a href="fsf.html#cb47-28" aria-hidden="true" tabindex="-1"></a>perf_cast <span class="ot">&lt;-</span> <span class="fu">dcast</span>(perf, variable <span class="sc">~</span> metric)</span>
<span id="cb47-29"><a href="fsf.html#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="fsf.html#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="co"># remove x and y</span></span>
<span id="cb47-31"><a href="fsf.html#cb47-31" aria-hidden="true" tabindex="-1"></a>perf_cast <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)))</span>
<span id="cb47-32"><a href="fsf.html#cb47-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-33"><a href="fsf.html#cb47-33" aria-hidden="true" tabindex="-1"></a><span class="co"># display results of imputation rmsd</span></span>
<span id="cb47-34"><a href="fsf.html#cb47-34" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(perf_cast, <span class="at">caption =</span> <span class="st">&quot;Imputation X-Variable Performance between FRI and GRM Forest Stand Polygons&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>
Imputation X-Variable Performance between FRI and GRM Forest Stand Polygons
</caption>
<thead>
<tr>
<th style="text-align:left;">
variable
</th>
<th style="text-align:right;">
rrmsd (%)
</th>
<th style="text-align:right;">
rmbe (%)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
agb
</td>
<td style="text-align:right;">
3.31
</td>
<td style="text-align:right;">
-0.06
</td>
</tr>
<tr>
<td style="text-align:left;">
gmvwl
</td>
<td style="text-align:right;">
4.10
</td>
<td style="text-align:right;">
-0.72
</td>
</tr>
<tr>
<td style="text-align:left;">
pcum8
</td>
<td style="text-align:right;">
1.47
</td>
<td style="text-align:right;">
-0.30
</td>
</tr>
<tr>
<td style="text-align:left;">
ba
</td>
<td style="text-align:right;">
2.68
</td>
<td style="text-align:right;">
-0.08
</td>
</tr>
<tr>
<td style="text-align:left;">
b6
</td>
<td style="text-align:right;">
1.82
</td>
<td style="text-align:right;">
-0.21
</td>
</tr>
</tbody>
</table>
<p>The RRMSD results are all below 5% and RMBE does not show bias toward negative of positive difference. These results are comparable to those found when conducting imputation over FRI polygons only.</p>
</div>
<div id="fsf633" class="section level3 unnumbered hasAnchor">
<h3><strong>6.3.3</strong> Results: Distribution of Age<a href="fsf.html#fsf633" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Spatial comparison:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="fsf.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load GRM polygons</span></span>
<span id="cb48-2"><a href="fsf.html#cb48-2" aria-hidden="true" tabindex="-1"></a>poly_grm <span class="ot">&lt;-</span> <span class="fu">vect</span>(grm)</span>
<span id="cb48-3"><a href="fsf.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="fsf.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add new data frame to polygons</span></span>
<span id="cb48-5"><a href="fsf.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(poly_grm) <span class="ot">&lt;-</span> dat_grm</span>
<span id="cb48-6"><a href="fsf.html#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="fsf.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># save grm polygon output</span></span>
<span id="cb48-8"><a href="fsf.html#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">writeVector</span>(poly_grm, <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/grm_imp.shp&#39;</span>), <span class="at">overwrite =</span> T)</span>
<span id="cb48-9"><a href="fsf.html#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="fsf.html#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI polygons</span></span>
<span id="cb48-11"><a href="fsf.html#cb48-11" aria-hidden="true" tabindex="-1"></a>poly_fri <span class="ot">&lt;-</span> <span class="fu">vect</span>(fri)</span>
<span id="cb48-12"><a href="fsf.html#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="fsf.html#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># combine dat_fri with polygon attributes</span></span>
<span id="cb48-14"><a href="fsf.html#cb48-14" aria-hidden="true" tabindex="-1"></a>dat_fri_poly <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">as.data.frame</span>(poly_fri), dat_fri)</span>
<span id="cb48-15"><a href="fsf.html#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="fsf.html#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co"># we should only compare the screened FRI polygons so set </span></span>
<span id="cb48-17"><a href="fsf.html#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="co"># other values to NA</span></span>
<span id="cb48-18"><a href="fsf.html#cb48-18" aria-hidden="true" tabindex="-1"></a>dat_fri_poly<span class="sc">$</span>AGE2018[<span class="sc">!</span>(dat_fri_poly<span class="sc">$</span>OPI_ID <span class="sc">%in%</span> dat_fri_scr<span class="sc">$</span>OPI_ID)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb48-19"><a href="fsf.html#cb48-19" aria-hidden="true" tabindex="-1"></a>dat_fri_poly<span class="sc">$</span>class3[<span class="sc">!</span>(dat_fri_poly<span class="sc">$</span>OPI_ID <span class="sc">%in%</span> dat_fri_scr<span class="sc">$</span>OPI_ID)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb48-20"><a href="fsf.html#cb48-20" aria-hidden="true" tabindex="-1"></a>dat_fri_poly<span class="sc">$</span>class5[<span class="sc">!</span>(dat_fri_poly<span class="sc">$</span>OPI_ID <span class="sc">%in%</span> dat_fri_scr<span class="sc">$</span>OPI_ID)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb48-21"><a href="fsf.html#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="fsf.html#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="co"># re-input attributes into FRI polygons</span></span>
<span id="cb48-23"><a href="fsf.html#cb48-23" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(poly_fri) <span class="ot">&lt;-</span> dat_fri_poly</span>
<span id="cb48-24"><a href="fsf.html#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dat_fri_poly)</span>
<span id="cb48-25"><a href="fsf.html#cb48-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-26"><a href="fsf.html#cb48-26" aria-hidden="true" tabindex="-1"></a><span class="co"># save fri polygon output with key values only in screened polygons</span></span>
<span id="cb48-27"><a href="fsf.html#cb48-27" aria-hidden="true" tabindex="-1"></a><span class="fu">writeVector</span>(poly_fri, <span class="fu">str_c</span>(out_dir, <span class="st">&#39;/fri_scr.shp&#39;</span>), <span class="at">overwrite =</span> T)</span>
<span id="cb48-28"><a href="fsf.html#cb48-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-29"><a href="fsf.html#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="co"># create df to plot age</span></span>
<span id="cb48-30"><a href="fsf.html#cb48-30" aria-hidden="true" tabindex="-1"></a>grm_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_grm)</span>
<span id="cb48-31"><a href="fsf.html#cb48-31" aria-hidden="true" tabindex="-1"></a>fri_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_fri)</span>
<span id="cb48-32"><a href="fsf.html#cb48-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-33"><a href="fsf.html#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="co"># cut dfs</span></span>
<span id="cb48-34"><a href="fsf.html#cb48-34" aria-hidden="true" tabindex="-1"></a>grm_sf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age_cut =</span> <span class="fu">cut</span>(age, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">130</span>, <span class="dv">10</span>), <span class="dv">250</span>)))</span>
<span id="cb48-35"><a href="fsf.html#cb48-35" aria-hidden="true" tabindex="-1"></a>fri_sf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age_cut =</span> <span class="fu">cut</span>(AGE2018, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">130</span>, <span class="dv">10</span>), <span class="dv">250</span>)))</span>
<span id="cb48-36"><a href="fsf.html#cb48-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-37"><a href="fsf.html#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="co"># plot age</span></span>
<span id="cb48-38"><a href="fsf.html#cb48-38" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grm_sf) <span class="sc">+</span></span>
<span id="cb48-39"><a href="fsf.html#cb48-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> age_cut), <span class="at">linewidth =</span> <span class="fl">0.001</span>) <span class="sc">+</span></span>
<span id="cb48-40"><a href="fsf.html#cb48-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb48-41"><a href="fsf.html#cb48-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">viridis</span>(<span class="dv">14</span>), <span class="at">name =</span> <span class="st">&#39;Age&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb48-42"><a href="fsf.html#cb48-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb48-43"><a href="fsf.html#cb48-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Imputed Age of GRM </span><span class="sc">\n</span><span class="st">Segmented Forest Stands&#39;</span>) <span class="sc">+</span></span>
<span id="cb48-44"><a href="fsf.html#cb48-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb48-45"><a href="fsf.html#cb48-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-46"><a href="fsf.html#cb48-46" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fri_sf) <span class="sc">+</span></span>
<span id="cb48-47"><a href="fsf.html#cb48-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> age_cut), <span class="at">linewidth =</span> <span class="fl">0.001</span>) <span class="sc">+</span></span>
<span id="cb48-48"><a href="fsf.html#cb48-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb48-49"><a href="fsf.html#cb48-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">viridis</span>(<span class="dv">14</span>), <span class="at">name =</span> <span class="st">&#39;Age&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb48-50"><a href="fsf.html#cb48-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb48-51"><a href="fsf.html#cb48-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Age of FRI </span><span class="sc">\n</span><span class="st">Forest Stands&#39;</span>) <span class="sc">+</span></span>
<span id="cb48-52"><a href="fsf.html#cb48-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb48-53"><a href="fsf.html#cb48-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-54"><a href="fsf.html#cb48-54" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="06-case-study_files/figure-html/fsf6331-1.png" width="1152" />
Imputed age values show a similar spatial distribution to observed age values at a broad scale.</p>
<p>Density plots:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="fsf.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># density plots of age</span></span>
<span id="cb49-2"><a href="fsf.html#cb49-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_grm, <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb49-3"><a href="fsf.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb49-4"><a href="fsf.html#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(age, <span class="at">na.rm =</span> T)),</span>
<span id="cb49-5"><a href="fsf.html#cb49-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb49-6"><a href="fsf.html#cb49-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb49-7"><a href="fsf.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb49-8"><a href="fsf.html#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.025</span>)) <span class="sc">+</span></span>
<span id="cb49-9"><a href="fsf.html#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb49-10"><a href="fsf.html#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Age&#39;</span>) <span class="sc">+</span></span>
<span id="cb49-11"><a href="fsf.html#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb49-12"><a href="fsf.html#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Imputed Age of GRM Segmented Forest Stands&#39;</span>) <span class="sc">+</span></span>
<span id="cb49-13"><a href="fsf.html#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb49-14"><a href="fsf.html#cb49-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>))</span>
<span id="cb49-15"><a href="fsf.html#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="fsf.html#cb49-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">as.data.frame</span>(poly_fri), <span class="fu">aes</span>(<span class="at">x =</span> AGE2018)) <span class="sc">+</span></span>
<span id="cb49-17"><a href="fsf.html#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb49-18"><a href="fsf.html#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(AGE2018, <span class="at">na.rm =</span> T)),</span>
<span id="cb49-19"><a href="fsf.html#cb49-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb49-20"><a href="fsf.html#cb49-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb49-21"><a href="fsf.html#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb49-22"><a href="fsf.html#cb49-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.025</span>)) <span class="sc">+</span></span>
<span id="cb49-23"><a href="fsf.html#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb49-24"><a href="fsf.html#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Age&#39;</span>) <span class="sc">+</span></span>
<span id="cb49-25"><a href="fsf.html#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb49-26"><a href="fsf.html#cb49-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Age of FRI Forest Stands&#39;</span>) <span class="sc">+</span></span>
<span id="cb49-27"><a href="fsf.html#cb49-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb49-28"><a href="fsf.html#cb49-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>))</span>
<span id="cb49-29"><a href="fsf.html#cb49-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-30"><a href="fsf.html#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="06-case-study_files/figure-html/fsf6332-1.png" width="1728" />
The distribution of imputed age in GRM polygons closely matches that of observed age in FRI polygons. The median age values (dotted lines) are similar.</p>
</div>
<div id="fsf634" class="section level3 unnumbered hasAnchor">
<h3><strong>6.3.4</strong> Results: Distribution of Species<a href="fsf.html#fsf634" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Spatial patterns of three functional group classification:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="fsf.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot three func group classification</span></span>
<span id="cb50-2"><a href="fsf.html#cb50-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grm_sf) <span class="sc">+</span></span>
<span id="cb50-3"><a href="fsf.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> class3), <span class="at">linewidth =</span> <span class="fl">0.001</span>) <span class="sc">+</span></span>
<span id="cb50-4"><a href="fsf.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb50-5"><a href="fsf.html#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>, <span class="st">&#39;#ccbb44&#39;</span>), </span>
<span id="cb50-6"><a href="fsf.html#cb50-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&#39;Species Class&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb50-7"><a href="fsf.html#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb50-8"><a href="fsf.html#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Imputed Three Functional </span><span class="sc">\n</span><span class="st">Group Classification (GRM)&#39;</span>) <span class="sc">+</span></span>
<span id="cb50-9"><a href="fsf.html#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb50-10"><a href="fsf.html#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="fsf.html#cb50-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fri_sf) <span class="sc">+</span></span>
<span id="cb50-12"><a href="fsf.html#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> class3), <span class="at">linewidth =</span> <span class="fl">0.001</span>) <span class="sc">+</span></span>
<span id="cb50-13"><a href="fsf.html#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb50-14"><a href="fsf.html#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>, <span class="st">&#39;#ccbb44&#39;</span>), </span>
<span id="cb50-15"><a href="fsf.html#cb50-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&#39;Species Class&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb50-16"><a href="fsf.html#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb50-17"><a href="fsf.html#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Three Functional </span><span class="sc">\n</span><span class="st">Group Classification (FRI)&#39;</span>) <span class="sc">+</span></span>
<span id="cb50-18"><a href="fsf.html#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb50-19"><a href="fsf.html#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="fsf.html#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="06-case-study_files/figure-html/fsf6341-1.png" width="1152" /></p>
<p>We can observe a similar distribution of species classes.</p>
<p>Spatial patterns of five functional group classification:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="fsf.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot five func group classification</span></span>
<span id="cb51-2"><a href="fsf.html#cb51-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grm_sf) <span class="sc">+</span></span>
<span id="cb51-3"><a href="fsf.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> class5), <span class="at">linewidth =</span> <span class="fl">0.001</span>) <span class="sc">+</span></span>
<span id="cb51-4"><a href="fsf.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb51-5"><a href="fsf.html#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#ccbb44&#39;</span>, <span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#4477aa&#39;</span>,</span>
<span id="cb51-6"><a href="fsf.html#cb51-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;#ee6677&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>), </span>
<span id="cb51-7"><a href="fsf.html#cb51-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&#39;Species Class&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb51-8"><a href="fsf.html#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb51-9"><a href="fsf.html#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Imputed Five Functional </span><span class="sc">\n</span><span class="st">Group Classification (GRM)&#39;</span>) <span class="sc">+</span></span>
<span id="cb51-10"><a href="fsf.html#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb51-11"><a href="fsf.html#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="fsf.html#cb51-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fri_sf) <span class="sc">+</span></span>
<span id="cb51-13"><a href="fsf.html#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> class5), <span class="at">linewidth =</span> <span class="fl">0.001</span>) <span class="sc">+</span></span>
<span id="cb51-14"><a href="fsf.html#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb51-15"><a href="fsf.html#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#ccbb44&#39;</span>, <span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#4477aa&#39;</span>,</span>
<span id="cb51-16"><a href="fsf.html#cb51-16" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;#ee6677&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>), </span>
<span id="cb51-17"><a href="fsf.html#cb51-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&#39;Species Class&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb51-18"><a href="fsf.html#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb51-19"><a href="fsf.html#cb51-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Five Functional </span><span class="sc">\n</span><span class="st">Group Classification (FRI)&#39;</span>) <span class="sc">+</span></span>
<span id="cb51-20"><a href="fsf.html#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb51-21"><a href="fsf.html#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="fsf.html#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="06-case-study_files/figure-html/fsf6342-1.png" width="1152" /></p>
<p>Overall distribution of three functional group classification:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="fsf.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for GRM 3 classes</span></span>
<span id="cb52-2"><a href="fsf.html#cb52-2" aria-hidden="true" tabindex="-1"></a>dat_grm_c3 <span class="ot">&lt;-</span> dat_grm <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="fsf.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(class3) <span class="sc">%&gt;%</span>  </span>
<span id="cb52-4"><a href="fsf.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(class3) <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="fsf.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(class3)) <span class="sc">%&gt;%</span></span>
<span id="cb52-6"><a href="fsf.html#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(.<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="fsf.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ypos =</span> <span class="fu">cumsum</span>(prop) <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>prop) <span class="sc">%&gt;%</span></span>
<span id="cb52-8"><a href="fsf.html#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lbl =</span> <span class="fu">round</span>(prop))</span>
<span id="cb52-9"><a href="fsf.html#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="fsf.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for FRI 3 classes</span></span>
<span id="cb52-11"><a href="fsf.html#cb52-11" aria-hidden="true" tabindex="-1"></a>dat_fri_c3 <span class="ot">&lt;-</span> poly_fri <span class="sc">%&gt;%</span> as.data.frame <span class="sc">%&gt;%</span></span>
<span id="cb52-12"><a href="fsf.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(class3) <span class="sc">%&gt;%</span>  </span>
<span id="cb52-13"><a href="fsf.html#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(class3) <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb52-14"><a href="fsf.html#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(class3)) <span class="sc">%&gt;%</span></span>
<span id="cb52-15"><a href="fsf.html#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(.<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-16"><a href="fsf.html#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ypos =</span> <span class="fu">cumsum</span>(prop) <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>prop) <span class="sc">%&gt;%</span></span>
<span id="cb52-17"><a href="fsf.html#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lbl =</span> <span class="fu">round</span>(prop))</span>
<span id="cb52-18"><a href="fsf.html#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="fsf.html#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb52-20"><a href="fsf.html#cb52-20" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_grm_c3, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> prop, <span class="at">fill =</span> class3)) <span class="sc">+</span></span>
<span id="cb52-21"><a href="fsf.html#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-22"><a href="fsf.html#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb52-23"><a href="fsf.html#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb52-24"><a href="fsf.html#cb52-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> ypos, <span class="at">label =</span> <span class="fu">str_c</span>(lbl, <span class="st">&quot;%&quot;</span>)), <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb52-25"><a href="fsf.html#cb52-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb52-26"><a href="fsf.html#cb52-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb52-27"><a href="fsf.html#cb52-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb52-28"><a href="fsf.html#cb52-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb52-29"><a href="fsf.html#cb52-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>, <span class="st">&#39;#ccbb44&#39;</span>)) <span class="sc">+</span></span>
<span id="cb52-30"><a href="fsf.html#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-31"><a href="fsf.html#cb52-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Imputed Three Functional </span><span class="sc">\n</span><span class="st">Group Classification (GRM)&quot;</span>)</span>
<span id="cb52-32"><a href="fsf.html#cb52-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-33"><a href="fsf.html#cb52-33" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_fri_c3, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> prop, <span class="at">fill =</span> class3)) <span class="sc">+</span></span>
<span id="cb52-34"><a href="fsf.html#cb52-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-35"><a href="fsf.html#cb52-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb52-36"><a href="fsf.html#cb52-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb52-37"><a href="fsf.html#cb52-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> ypos, <span class="at">label =</span> <span class="fu">str_c</span>(lbl, <span class="st">&quot;%&quot;</span>)), <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb52-38"><a href="fsf.html#cb52-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb52-39"><a href="fsf.html#cb52-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb52-40"><a href="fsf.html#cb52-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb52-41"><a href="fsf.html#cb52-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb52-42"><a href="fsf.html#cb52-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>, <span class="st">&#39;#ccbb44&#39;</span>)) <span class="sc">+</span></span>
<span id="cb52-43"><a href="fsf.html#cb52-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-44"><a href="fsf.html#cb52-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Three Functional Group </span><span class="sc">\n</span><span class="st">Classification (FRI)&quot;</span>)</span>
<span id="cb52-45"><a href="fsf.html#cb52-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-46"><a href="fsf.html#cb52-46" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="06-case-study_files/figure-html/fsf6343-1.png" width="1728" /></p>
<p>The distribution of hardwood is the same. The GRM data have slightly more softwood and slightly less mixedwood.</p>
<p>Overall distribution of five functional group classification:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="fsf.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of 5 species classes</span></span>
<span id="cb53-2"><a href="fsf.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for GRM 5 classes</span></span>
<span id="cb53-3"><a href="fsf.html#cb53-3" aria-hidden="true" tabindex="-1"></a>dat_grm_c5 <span class="ot">&lt;-</span> dat_grm <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="fsf.html#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(class5) <span class="sc">%&gt;%</span>  </span>
<span id="cb53-5"><a href="fsf.html#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(class5) <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb53-6"><a href="fsf.html#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(class5)) <span class="sc">%&gt;%</span></span>
<span id="cb53-7"><a href="fsf.html#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(.<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-8"><a href="fsf.html#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ypos =</span> <span class="fu">cumsum</span>(prop) <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>prop) <span class="sc">%&gt;%</span></span>
<span id="cb53-9"><a href="fsf.html#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lbl =</span> <span class="fu">round</span>(prop))</span>
<span id="cb53-10"><a href="fsf.html#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="fsf.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for FRI 5 classes</span></span>
<span id="cb53-12"><a href="fsf.html#cb53-12" aria-hidden="true" tabindex="-1"></a>dat_fri_c5 <span class="ot">&lt;-</span> poly_fri <span class="sc">%&gt;%</span> as.data.frame <span class="sc">%&gt;%</span></span>
<span id="cb53-13"><a href="fsf.html#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(class5) <span class="sc">%&gt;%</span>  </span>
<span id="cb53-14"><a href="fsf.html#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(class5) <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb53-15"><a href="fsf.html#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(class5)) <span class="sc">%&gt;%</span></span>
<span id="cb53-16"><a href="fsf.html#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(.<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-17"><a href="fsf.html#cb53-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ypos =</span> <span class="fu">cumsum</span>(prop) <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>prop) <span class="sc">%&gt;%</span></span>
<span id="cb53-18"><a href="fsf.html#cb53-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lbl =</span> <span class="fu">round</span>(prop))</span>
<span id="cb53-19"><a href="fsf.html#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="fsf.html#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb53-21"><a href="fsf.html#cb53-21" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_grm_c5, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> prop, <span class="at">fill =</span> class5)) <span class="sc">+</span></span>
<span id="cb53-22"><a href="fsf.html#cb53-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-23"><a href="fsf.html#cb53-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb53-24"><a href="fsf.html#cb53-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb53-25"><a href="fsf.html#cb53-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> ypos, <span class="at">label =</span> <span class="fu">str_c</span>(lbl, <span class="st">&quot;%&quot;</span>)), <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb53-26"><a href="fsf.html#cb53-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb53-27"><a href="fsf.html#cb53-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb53-28"><a href="fsf.html#cb53-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb53-29"><a href="fsf.html#cb53-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb53-30"><a href="fsf.html#cb53-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#ccbb44&#39;</span>, <span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#4477aa&#39;</span>,</span>
<span id="cb53-31"><a href="fsf.html#cb53-31" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;#ee6677&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>)) <span class="sc">+</span></span>
<span id="cb53-32"><a href="fsf.html#cb53-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-33"><a href="fsf.html#cb53-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Imputed Five Functional </span><span class="sc">\n</span><span class="st">Group Classification (GRM)&quot;</span>)</span>
<span id="cb53-34"><a href="fsf.html#cb53-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-35"><a href="fsf.html#cb53-35" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_fri_c5, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> prop, <span class="at">fill =</span> class5)) <span class="sc">+</span></span>
<span id="cb53-36"><a href="fsf.html#cb53-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-37"><a href="fsf.html#cb53-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb53-38"><a href="fsf.html#cb53-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb53-39"><a href="fsf.html#cb53-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> ypos, <span class="at">label =</span> <span class="fu">str_c</span>(lbl, <span class="st">&quot;%&quot;</span>)), <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb53-40"><a href="fsf.html#cb53-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb53-41"><a href="fsf.html#cb53-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb53-42"><a href="fsf.html#cb53-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb53-43"><a href="fsf.html#cb53-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb53-44"><a href="fsf.html#cb53-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#ccbb44&#39;</span>, <span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#4477aa&#39;</span>,</span>
<span id="cb53-45"><a href="fsf.html#cb53-45" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;#ee6677&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>)) <span class="sc">+</span></span>
<span id="cb53-46"><a href="fsf.html#cb53-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-47"><a href="fsf.html#cb53-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Five Functional Group </span><span class="sc">\n</span><span class="st">Classification (FRI)&quot;</span>)</span>
<span id="cb53-48"><a href="fsf.html#cb53-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-49"><a href="fsf.html#cb53-49" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="06-case-study_files/figure-html/fsf6344-1.png" width="1728" /></p>
<p>The distributions are again very similar. The RMF five species classification does not apply to the FSF in general, due to the negligible amounts of black spruce and jack pine.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="imputation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="perf.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
