<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Imputation | Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework</title>
  <meta name="description" content="A place to find background information and follow updates related to the project." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Imputation | Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A place to find background information and follow updates related to the project." />
  <meta name="github-repo" content="bermane/ontario-inventory" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Imputation | Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework" />
  
  <meta name="twitter:description" content="A place to find background information and follow updates related to the project." />
  

<meta name="author" content="Ethan Berman" />


<meta name="date" content="2023-03-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="segmentation-update.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Integration of Photo Interpreted and LiDAR Attributes Into a Polygonal Forest Inventory Framework</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#summary"><i class="fa fa-check"></i>Project Summary</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#partners"><i class="fa fa-check"></i>Project Partners</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html"><i class="fa fa-check"></i>People</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ubc"><i class="fa fa-check"></i>University of British Columbia</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ncc"><i class="fa fa-check"></i>Prof.Â Nicholas Coops, <em>project lead</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#eb"><i class="fa fa-check"></i>Ethan Berman, <em>research scientist</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#greenfirst"><i class="fa fa-check"></i>GreenFirst Forest Products</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#cm"><i class="fa fa-check"></i>Chris McDonell, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#gm"><i class="fa fa-check"></i>Grant McCartney, <em>partner</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ministry"><i class="fa fa-check"></i>Ontario Ministry of Northern Development, Mines, Natural Resources and Forestry</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#is"><i class="fa fa-check"></i>Ian Sinclair, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#dl"><i class="fa fa-check"></i>Derek Landry, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#grm"><i class="fa fa-check"></i>Geordie Robere-McGugan, <em>partner</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html"><i class="fa fa-check"></i>Project Details</a>
<ul>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#objective"><i class="fa fa-check"></i>Objective</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#themes"><i class="fa fa-check"></i>Themes</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#description"><i class="fa fa-check"></i>Description</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#design"><i class="fa fa-check"></i>Design</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#methodology"><i class="fa fa-check"></i>Methodology</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#schedule"><i class="fa fa-check"></i>Schedule</a>
<ul>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#project-dates"><i class="fa fa-check"></i>Project Dates</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#knowledge-transfer"><i class="fa fa-check"></i>Knowledge &amp; Technology Transfer</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html"><i class="fa fa-check"></i>Segmentation Example</a>
<ul>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#intro"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#create-raster"><i class="fa fa-check"></i>Create Multi-band Raster</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#run-segmentation"><i class="fa fa-check"></i>Run Mean Shift Segmentation</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#compare-datasets"><i class="fa fa-check"></i>Compare Datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html"><i class="fa fa-check"></i>Segmentation Update</a>
<ul>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#intro"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#updatep1"><i class="fa fa-check"></i>1. Create Multi-band Raster</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#updatep2"><i class="fa fa-check"></i>2. Run GRM Segmentation</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#updatep3a"><i class="fa fa-check"></i>3a. Calculate Summary Statistics</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#updatep3b"><i class="fa fa-check"></i>3b. Compare GRM Segmentation Output to FRI</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html"><i class="fa fa-check"></i>Imputation</a>
<ul>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#intro"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp1"><i class="fa fa-check"></i>1. Extract LiDAR attributes in FRI polygons and GRM polygons</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp1a"><i class="fa fa-check"></i>1a. Extract attributes in FRI polygons</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp1b"><i class="fa fa-check"></i>1b. Extract attributes in GRM segmented polygons</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp2"><i class="fa fa-check"></i>2. Screen FRI polygons to curate an optimal dataset to use for imputation</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp3"><i class="fa fa-check"></i>3. Run imputation on FRI polygons ONLY to assess imputation performance</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp3a"><i class="fa fa-check"></i>3a. Create functions needed</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp3b"><i class="fa fa-check"></i>3b. Run the imputation and assess performance</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4"><i class="fa fa-check"></i>4. Run imputation between FRI and GRM polygons to derive estimates of age and species composition</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4a"><i class="fa fa-check"></i>4a. Figures of Forest Stand Age</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4b"><i class="fa fa-check"></i>4b. Figures of Three Functional Group Classification</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4c"><i class="fa fa-check"></i>4c. Figures of Five Functional Group Classification</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4d"><i class="fa fa-check"></i>4d. Density Plots of Forest Stand Age</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4e"><i class="fa fa-check"></i>4e. Distribution of Three Functional Group Classification</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4f"><i class="fa fa-check"></i>4f. Distribution of Five Functional Group Classification</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="imputation" class="section level1 unnumbered hasAnchor">
<h1>Imputation<a href="imputation.html#imputation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="intro" class="section level2 unnumbered hasAnchor">
<h2>Intro<a href="segmentation-example.html#intro" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This page provides an example of the imputation approach used to estimate age and species composition in newly-generated forest stands. The imputation is based on a k-nearest neighbor (kNN) algorithm. X-variables (variables that are contiguous across reference and target polygons) are identified and for each Generic Region Merging (GRM) generated forest polygon (the target polygon), the k-nearest neighbor FRI polygons (the reference polygons) that minimize the Euclidean distance of the X-variables are identified and used to impute age and species composition into the target polygon. If k = 1, the age and species variables are imputed directly from the best matching reference polygon. If k &gt; 1, age is imputed as the mean age of kNN polygons and species variables are imputed as the mode across kNN polygons. The basic workflow is as follows:</p>
<ol start="0" style="list-style-type: decimal">
<li>Run GRM Segmentation to derive new polygon dataset (see previous posts)</li>
<li>Extract LiDAR attributes in FRI polygons and GRM segmented polygons</li>
<li>Screen FRI polygons to curate an optimal dataset to use for imputation</li>
<li>Run imputation on FRI polygons ONLY to assess imputation performance</li>
<li>Run imputation between FRI and GRM polygons to impute estimates of age and species composition</li>
</ol>
</div>
<div id="imputationp1" class="section level2 unnumbered hasAnchor">
<h2>1. Extract LiDAR attributes in FRI polygons and GRM polygons<a href="imputation.html#imputationp1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before running imputation we need to extract LiDAR and Sentinel 2 attributes in all FRI and GRM polygons. For this example, we only extract attributes used in the optimal imputation model (listed below) as well as the attributes needed for polygon data screening in step 2 of this walk-through. The value extracted for each polygon is the median cell value, weighted by the fraction of each cell that is covered by the polygon.</p>
<p>The variables used in the imputation algorithm are as follows, and were selected with guidance from previous works as well as a performance analysis (the details of which will be disclosed in a forthcoming journal article):</p>
<ul>
<li>avg: mean returns height &gt; 1.3 m classified as vegetation</li>
<li>sd: standard deviation of returns height &gt; 1.3 m classified as vegetation</li>
<li>rumple: ratio of canopy outer surface area to ground surface area</li>
<li>zpcum8: cumulative percentage of LiDAR returns found in 80% percentile of LiDAR height</li>
<li>x and y: coordinates of polygon centroid (in UTM coordinates)</li>
<li>red_edge_2: Sentinel 2 surface reflectance band 6 (740 nm)</li>
</ul>
<p>The following two variables are needed for polygon data screening:</p>
<ul>
<li>p95: 95th percentile of LiDAR height returns &gt; 1.3 m classified as vegetation</li>
<li>cc: percent of first returns &gt; 2 meters (canopy cover)</li>
</ul>
</div>
<div id="imputationp1a" class="section level2 unnumbered hasAnchor">
<h2>1a. Extract attributes in FRI polygons<a href="imputation.html#imputationp1a" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="imputation.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb24-2"><a href="imputation.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb24-3"><a href="imputation.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb24-4"><a href="imputation.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span>
<span id="cb24-5"><a href="imputation.html#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb24-6"><a href="imputation.html#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb24-7"><a href="imputation.html#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb24-8"><a href="imputation.html#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="imputation.html#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI polygons</span></span>
<span id="cb24-10"><a href="imputation.html#cb24-10" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Polygons Inventory/RMF_PolygonForest.shp&#39;</span>)</span>
<span id="cb24-11"><a href="imputation.html#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="imputation.html#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to df</span></span>
<span id="cb24-13"><a href="imputation.html#cb24-13" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(poly)</span>
<span id="cb24-14"><a href="imputation.html#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="imputation.html#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind centroids to dat</span></span>
<span id="cb24-16"><a href="imputation.html#cb24-16" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat_fri, <span class="fu">centroids</span>(poly) <span class="sc">%&gt;%</span> crds)</span>
<span id="cb24-17"><a href="imputation.html#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="imputation.html#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># load LiDAR datasets we need to extract over polygons</span></span>
<span id="cb24-19"><a href="imputation.html#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># create named vector with variable names and data links</span></span>
<span id="cb24-20"><a href="imputation.html#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="imputation.html#cb24-21" aria-hidden="true" tabindex="-1"></a>lidar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;p95&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_p95.tif&#39;</span>,</span>
<span id="cb24-22"><a href="imputation.html#cb24-22" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;sd&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/SPL metrics/Z_METRICS_MOSAIC/individual/RMF_Z_METRICS_MOSAIC_zsd.tif&#39;</span>,</span>
<span id="cb24-23"><a href="imputation.html#cb24-23" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;rumple&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/SPL metrics/Z_METRICS_MOSAIC/individual/RMF_RUMPLE_MOSAIC_r_rumple.tif&#39;</span>,</span>
<span id="cb24-24"><a href="imputation.html#cb24-24" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;zpcum8&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/SPL metrics/Z_METRICS_MOSAIC/individual/RMF_Z_METRICS_MOSAIC_zpcum8.tif&#39;</span>,</span>
<span id="cb24-25"><a href="imputation.html#cb24-25" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;avg&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_avg.tif&#39;</span>,</span>
<span id="cb24-26"><a href="imputation.html#cb24-26" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;red_edge_2&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/Sentinel/red_edge_2.tif&#39;</span>,</span>
<span id="cb24-27"><a href="imputation.html#cb24-27" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;cc&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_2m_cov.tif&#39;</span>)</span>
<span id="cb24-28"><a href="imputation.html#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="imputation.html#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through LiDAR attributes to extract values</span></span>
<span id="cb24-30"><a href="imputation.html#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(lidar)) {</span>
<span id="cb24-31"><a href="imputation.html#cb24-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load LiDAR rasters as raster stack</span></span>
<span id="cb24-32"><a href="imputation.html#cb24-32" aria-hidden="true" tabindex="-1"></a>  lidar_ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(lidar[i])</span>
<span id="cb24-33"><a href="imputation.html#cb24-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-34"><a href="imputation.html#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># project poly to crs of raster</span></span>
<span id="cb24-35"><a href="imputation.html#cb24-35" aria-hidden="true" tabindex="-1"></a>  poly_ras <span class="ot">&lt;-</span> <span class="fu">project</span>(poly, lidar_ras)</span>
<span id="cb24-36"><a href="imputation.html#cb24-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-37"><a href="imputation.html#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf</span></span>
<span id="cb24-38"><a href="imputation.html#cb24-38" aria-hidden="true" tabindex="-1"></a>  poly_ras <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_ras)</span>
<span id="cb24-39"><a href="imputation.html#cb24-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-40"><a href="imputation.html#cb24-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">#extract median values</span></span>
<span id="cb24-41"><a href="imputation.html#cb24-41" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span></span>
<span id="cb24-42"><a href="imputation.html#cb24-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exact_extract</span>(lidar_ras, poly_ras, <span class="st">&#39;median&#39;</span>)</span>
<span id="cb24-43"><a href="imputation.html#cb24-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-44"><a href="imputation.html#cb24-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aggregate into data frame</span></span>
<span id="cb24-45"><a href="imputation.html#cb24-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb24-46"><a href="imputation.html#cb24-46" aria-hidden="true" tabindex="-1"></a>    vec_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(vec)</span>
<span id="cb24-47"><a href="imputation.html#cb24-47" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb24-48"><a href="imputation.html#cb24-48" aria-hidden="true" tabindex="-1"></a>    vec_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(vec_df, <span class="fu">as.data.frame</span>(vec))</span>
<span id="cb24-49"><a href="imputation.html#cb24-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-50"><a href="imputation.html#cb24-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-51"><a href="imputation.html#cb24-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-52"><a href="imputation.html#cb24-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-53"><a href="imputation.html#cb24-53" aria-hidden="true" tabindex="-1"></a><span class="co"># change column names of extracted attribute data frame</span></span>
<span id="cb24-54"><a href="imputation.html#cb24-54" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(vec_df) <span class="ot">&lt;-</span> <span class="fu">names</span>(lidar)</span>
<span id="cb24-55"><a href="imputation.html#cb24-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-56"><a href="imputation.html#cb24-56" aria-hidden="true" tabindex="-1"></a><span class="co"># add LiDAR attributes to FRI polygon data frame</span></span>
<span id="cb24-57"><a href="imputation.html#cb24-57" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat_fri, vec_df)</span>
<span id="cb24-58"><a href="imputation.html#cb24-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-59"><a href="imputation.html#cb24-59" aria-hidden="true" tabindex="-1"></a><span class="co"># add 2018 age values</span></span>
<span id="cb24-60"><a href="imputation.html#cb24-60" aria-hidden="true" tabindex="-1"></a>dat_fri<span class="sc">$</span>AGE2018 <span class="ot">&lt;-</span> <span class="dv">2018</span> <span class="sc">-</span> dat_fri<span class="sc">$</span>YRORG</span>
<span id="cb24-61"><a href="imputation.html#cb24-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-62"><a href="imputation.html#cb24-62" aria-hidden="true" tabindex="-1"></a><span class="co"># save extracted dataframe for fast rebooting</span></span>
<span id="cb24-63"><a href="imputation.html#cb24-63" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat_fri, <span class="at">file =</span> <span class="st">&#39;D:/ontario_inventory/imputation/example/dat_fri_extr.RData&#39;</span>)</span></code></pre></div>
</div>
<div id="imputationp1b" class="section level2 unnumbered hasAnchor">
<h2>1b. Extract attributes in GRM segmented polygons<a href="imputation.html#imputationp1b" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="imputation.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load GRM segmented polygons</span></span>
<span id="cb25-2"><a href="imputation.html#cb25-2" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/segmentation/grm/shp/grm_10_01_05.shp&#39;</span>)</span>
<span id="cb25-3"><a href="imputation.html#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="imputation.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to df</span></span>
<span id="cb25-5"><a href="imputation.html#cb25-5" aria-hidden="true" tabindex="-1"></a>dat_grm <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(poly)</span>
<span id="cb25-6"><a href="imputation.html#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="imputation.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind centroids to dat</span></span>
<span id="cb25-8"><a href="imputation.html#cb25-8" aria-hidden="true" tabindex="-1"></a>dat_grm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat_grm, <span class="fu">centroids</span>(poly) <span class="sc">%&gt;%</span> crds)</span>
<span id="cb25-9"><a href="imputation.html#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="imputation.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># remove p95 and cc as we&#39;ll re-calculate here for consistency</span></span>
<span id="cb25-11"><a href="imputation.html#cb25-11" aria-hidden="true" tabindex="-1"></a>dat_grm <span class="sc">%&lt;&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(p95, cc))</span>
<span id="cb25-12"><a href="imputation.html#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="imputation.html#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># load LiDAR datasets we need to extract over polygons</span></span>
<span id="cb25-14"><a href="imputation.html#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create named vector with variable names and data links</span></span>
<span id="cb25-15"><a href="imputation.html#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="imputation.html#cb25-16" aria-hidden="true" tabindex="-1"></a>lidar <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;p95&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_p95.tif&#39;</span>,</span>
<span id="cb25-17"><a href="imputation.html#cb25-17" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;sd&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/SPL metrics/Z_METRICS_MOSAIC/individual/RMF_Z_METRICS_MOSAIC_zsd.tif&#39;</span>,</span>
<span id="cb25-18"><a href="imputation.html#cb25-18" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;rumple&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/SPL metrics/Z_METRICS_MOSAIC/individual/RMF_RUMPLE_MOSAIC_r_rumple.tif&#39;</span>,</span>
<span id="cb25-19"><a href="imputation.html#cb25-19" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;zpcum8&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/SPL metrics/Z_METRICS_MOSAIC/individual/RMF_Z_METRICS_MOSAIC_zpcum8.tif&#39;</span>,</span>
<span id="cb25-20"><a href="imputation.html#cb25-20" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;avg&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_avg.tif&#39;</span>,</span>
<span id="cb25-21"><a href="imputation.html#cb25-21" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;red_edge_2&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/Sentinel/red_edge_2.tif&#39;</span>,</span>
<span id="cb25-22"><a href="imputation.html#cb25-22" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;cc&#39;</span> <span class="ot">=</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_2m_cov.tif&#39;</span>)</span>
<span id="cb25-23"><a href="imputation.html#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="imputation.html#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through LiDAR attributes to extract values</span></span>
<span id="cb25-25"><a href="imputation.html#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(lidar)) {</span>
<span id="cb25-26"><a href="imputation.html#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load LiDAR rasters as raster stack</span></span>
<span id="cb25-27"><a href="imputation.html#cb25-27" aria-hidden="true" tabindex="-1"></a>  lidar_ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(lidar[i])</span>
<span id="cb25-28"><a href="imputation.html#cb25-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-29"><a href="imputation.html#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># project poly to crs of raster</span></span>
<span id="cb25-30"><a href="imputation.html#cb25-30" aria-hidden="true" tabindex="-1"></a>  poly_ras <span class="ot">&lt;-</span> <span class="fu">project</span>(poly, lidar_ras)</span>
<span id="cb25-31"><a href="imputation.html#cb25-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-32"><a href="imputation.html#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf</span></span>
<span id="cb25-33"><a href="imputation.html#cb25-33" aria-hidden="true" tabindex="-1"></a>  poly_ras <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_ras)</span>
<span id="cb25-34"><a href="imputation.html#cb25-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-35"><a href="imputation.html#cb25-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#extract median values</span></span>
<span id="cb25-36"><a href="imputation.html#cb25-36" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span></span>
<span id="cb25-37"><a href="imputation.html#cb25-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exact_extract</span>(lidar_ras, poly_ras, <span class="st">&#39;median&#39;</span>)</span>
<span id="cb25-38"><a href="imputation.html#cb25-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-39"><a href="imputation.html#cb25-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aggregate into data frame</span></span>
<span id="cb25-40"><a href="imputation.html#cb25-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb25-41"><a href="imputation.html#cb25-41" aria-hidden="true" tabindex="-1"></a>    vec_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(vec)</span>
<span id="cb25-42"><a href="imputation.html#cb25-42" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb25-43"><a href="imputation.html#cb25-43" aria-hidden="true" tabindex="-1"></a>    vec_df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(vec_df, <span class="fu">as.data.frame</span>(vec))</span>
<span id="cb25-44"><a href="imputation.html#cb25-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-45"><a href="imputation.html#cb25-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-46"><a href="imputation.html#cb25-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-47"><a href="imputation.html#cb25-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-48"><a href="imputation.html#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="co"># change column names of extracted attribute data frame</span></span>
<span id="cb25-49"><a href="imputation.html#cb25-49" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(vec_df) <span class="ot">&lt;-</span> <span class="fu">names</span>(lidar)</span>
<span id="cb25-50"><a href="imputation.html#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="imputation.html#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="co"># add LiDAR attributes to FRI polygon data frame</span></span>
<span id="cb25-52"><a href="imputation.html#cb25-52" aria-hidden="true" tabindex="-1"></a>dat_grm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat_grm, vec_df)</span>
<span id="cb25-53"><a href="imputation.html#cb25-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-54"><a href="imputation.html#cb25-54" aria-hidden="true" tabindex="-1"></a><span class="co"># save extracted data frame for fast rebooting</span></span>
<span id="cb25-55"><a href="imputation.html#cb25-55" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat_grm, <span class="at">file =</span> <span class="st">&#39;D:/ontario_inventory/imputation/example/grm_10_01_05_extr.RData&#39;</span>)</span>
<span id="cb25-56"><a href="imputation.html#cb25-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-57"><a href="imputation.html#cb25-57" aria-hidden="true" tabindex="-1"></a><span class="co"># clear workspace</span></span>
<span id="cb25-58"><a href="imputation.html#cb25-58" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span></code></pre></div>
</div>
<div id="imputationp2" class="section level2 unnumbered hasAnchor">
<h2>2. Screen FRI polygons to curate an optimal dataset to use for imputation<a href="imputation.html#imputationp2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to ensure the best possible imputation results, it is important to screen the FRI dataset and remove polygons that do not fit certain data quality criteria, or are not representative of forest stands.</p>
<p>The current criteria being used are:</p>
<ul>
<li>POLYTYPE == âFORâ</li>
<li>polygon &gt;= 50% forested landcover</li>
<li>p95 &gt;= 5 meters (broad definition of âforestâ)</li>
<li>Canopy cover &gt;= 50%</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="imputation.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI polygons</span></span>
<span id="cb26-2"><a href="imputation.html#cb26-2" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Polygons Inventory/RMF_PolygonForest.shp&#39;</span>)</span>
<span id="cb26-3"><a href="imputation.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="imputation.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI polygon data frame</span></span>
<span id="cb26-5"><a href="imputation.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;D:/ontario_inventory/imputation/example/dat_fri_extr.RData&#39;</span>)</span>
<span id="cb26-6"><a href="imputation.html#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="imputation.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb26-8"><a href="imputation.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="do">### SCREEN FOR POLYTYPE == FOR </span><span class="al">###</span></span>
<span id="cb26-9"><a href="imputation.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb26-10"><a href="imputation.html#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="imputation.html#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># filter POLYTYPE == &#39;FOR&#39;</span></span>
<span id="cb26-12"><a href="imputation.html#cb26-12" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">filter</span>(dat_fri, POLYTYPE <span class="sc">==</span> <span class="st">&#39;FOR&#39;</span>)</span>
<span id="cb26-13"><a href="imputation.html#cb26-13" aria-hidden="true" tabindex="-1"></a>poly_fri <span class="ot">&lt;-</span> poly[poly<span class="sc">$</span>POLYTYPE <span class="sc">==</span> <span class="st">&#39;FOR&#39;</span>]</span>
<span id="cb26-14"><a href="imputation.html#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="imputation.html#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################</span></span>
<span id="cb26-16"><a href="imputation.html#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="do">### SCREEN FOR POLYGON &gt;= 50% FORESTED LANDCOVER </span><span class="al">###</span></span>
<span id="cb26-17"><a href="imputation.html#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################</span></span>
<span id="cb26-18"><a href="imputation.html#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="imputation.html#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># load VLCE 2.0 landcover dataset from 2018</span></span>
<span id="cb26-20"><a href="imputation.html#cb26-20" aria-hidden="true" tabindex="-1"></a>lc <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&#39;D:/ontario_inventory/VLCE/CA_forest_VLCE2_2018_CLIPPED.tif&#39;</span>)</span>
<span id="cb26-21"><a href="imputation.html#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="imputation.html#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co"># project poly to crs of raster</span></span>
<span id="cb26-23"><a href="imputation.html#cb26-23" aria-hidden="true" tabindex="-1"></a>poly_lc <span class="ot">&lt;-</span> <span class="fu">project</span>(poly_fri, lc)</span>
<span id="cb26-24"><a href="imputation.html#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="imputation.html#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf</span></span>
<span id="cb26-26"><a href="imputation.html#cb26-26" aria-hidden="true" tabindex="-1"></a>poly_lcsf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_lc)</span>
<span id="cb26-27"><a href="imputation.html#cb26-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-28"><a href="imputation.html#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co"># extract landcover values</span></span>
<span id="cb26-29"><a href="imputation.html#cb26-29" aria-hidden="true" tabindex="-1"></a>lc_poly <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(lc, poly_lcsf)</span>
<span id="cb26-30"><a href="imputation.html#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="imputation.html#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="co"># set landcover class key with single forested class</span></span>
<span id="cb26-32"><a href="imputation.html#cb26-32" aria-hidden="true" tabindex="-1"></a>lc_key_for <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">20</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Water&#39;</span>,</span>
<span id="cb26-33"><a href="imputation.html#cb26-33" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">31</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Snow/Ice&#39;</span>,</span>
<span id="cb26-34"><a href="imputation.html#cb26-34" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">32</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Rock/Rubble&#39;</span>,</span>
<span id="cb26-35"><a href="imputation.html#cb26-35" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">33</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Exposed/Barren Land&#39;</span>,</span>
<span id="cb26-36"><a href="imputation.html#cb26-36" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">40</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Bryoids&#39;</span>,</span>
<span id="cb26-37"><a href="imputation.html#cb26-37" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">50</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Shrubland&#39;</span>,</span>
<span id="cb26-38"><a href="imputation.html#cb26-38" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">80</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Wetland&#39;</span>,</span>
<span id="cb26-39"><a href="imputation.html#cb26-39" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">81</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>,</span>
<span id="cb26-40"><a href="imputation.html#cb26-40" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">100</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Herbs&#39;</span>,</span>
<span id="cb26-41"><a href="imputation.html#cb26-41" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">210</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>,</span>
<span id="cb26-42"><a href="imputation.html#cb26-42" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">220</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>,</span>
<span id="cb26-43"><a href="imputation.html#cb26-43" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">230</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;Forest&#39;</span>)</span>
<span id="cb26-44"><a href="imputation.html#cb26-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-45"><a href="imputation.html#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="co"># find polygons with forest at least 50% of pixels</span></span>
<span id="cb26-46"><a href="imputation.html#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="co"># apply over list</span></span>
<span id="cb26-47"><a href="imputation.html#cb26-47" aria-hidden="true" tabindex="-1"></a>lc_dom_for <span class="ot">&lt;-</span> <span class="fu">sapply</span>(lc_poly, <span class="cf">function</span>(x){</span>
<span id="cb26-48"><a href="imputation.html#cb26-48" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">recode</span>(x<span class="sc">$</span>value, <span class="sc">!!!</span>lc_key_for)</span>
<span id="cb26-49"><a href="imputation.html#cb26-49" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(value) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">sum =</span> <span class="fu">sum</span>(coverage_fraction))</span>
<span id="cb26-50"><a href="imputation.html#cb26-50" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> x<span class="sc">$</span>value[<span class="fu">which</span>(x<span class="sc">$</span>sum <span class="sc">==</span> <span class="fu">max</span>(x<span class="sc">$</span>sum))]</span>
<span id="cb26-51"><a href="imputation.html#cb26-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>((<span class="fu">length</span>(m) <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">&amp;</span> (m <span class="sc">==</span> <span class="st">&#39;Forest&#39;</span>)[<span class="dv">1</span>]){</span>
<span id="cb26-52"><a href="imputation.html#cb26-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(x<span class="sc">$</span>sum[x<span class="sc">$</span>value <span class="sc">==</span> m]<span class="sc">/</span><span class="fu">sum</span>(x<span class="sc">$</span>sum) <span class="sc">&gt;=</span> <span class="fl">0.5</span>){</span>
<span id="cb26-53"><a href="imputation.html#cb26-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="st">&#39;Yes&#39;</span>)</span>
<span id="cb26-54"><a href="imputation.html#cb26-54" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{<span class="fu">return</span>(<span class="st">&#39;No&#39;</span>)}</span>
<span id="cb26-55"><a href="imputation.html#cb26-55" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{<span class="fu">return</span>(<span class="st">&#39;No&#39;</span>)}</span>
<span id="cb26-56"><a href="imputation.html#cb26-56" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb26-57"><a href="imputation.html#cb26-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-58"><a href="imputation.html#cb26-58" aria-hidden="true" tabindex="-1"></a><span class="co"># add into FRI data frame</span></span>
<span id="cb26-59"><a href="imputation.html#cb26-59" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> dat_fri <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">dom_for =</span> lc_dom_for)</span>
<span id="cb26-60"><a href="imputation.html#cb26-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-61"><a href="imputation.html#cb26-61" aria-hidden="true" tabindex="-1"></a><span class="co"># subset FRI data frame based on whether polygon dominated by forest</span></span>
<span id="cb26-62"><a href="imputation.html#cb26-62" aria-hidden="true" tabindex="-1"></a>dat_dom_for <span class="ot">&lt;-</span> dat_fri[dat_fri<span class="sc">$</span>dom_for <span class="sc">==</span> <span class="st">&#39;Yes&#39;</span>,]</span>
<span id="cb26-63"><a href="imputation.html#cb26-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-64"><a href="imputation.html#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb26-65"><a href="imputation.html#cb26-65" aria-hidden="true" tabindex="-1"></a><span class="do">### SCREEN FOR P95 &gt;= 5 METERS </span><span class="al">###</span></span>
<span id="cb26-66"><a href="imputation.html#cb26-66" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb26-67"><a href="imputation.html#cb26-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-68"><a href="imputation.html#cb26-68" aria-hidden="true" tabindex="-1"></a><span class="co"># subset FRI data frame</span></span>
<span id="cb26-69"><a href="imputation.html#cb26-69" aria-hidden="true" tabindex="-1"></a>dat_p95 <span class="ot">&lt;-</span> dat_fri[dat_fri<span class="sc">$</span>p95 <span class="sc">&gt;=</span> <span class="dv">5</span>,]</span>
<span id="cb26-70"><a href="imputation.html#cb26-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-71"><a href="imputation.html#cb26-71" aria-hidden="true" tabindex="-1"></a><span class="do">############################</span></span>
<span id="cb26-72"><a href="imputation.html#cb26-72" aria-hidden="true" tabindex="-1"></a><span class="do">### SCREEN FOR CC &gt;= 50% </span><span class="al">###</span></span>
<span id="cb26-73"><a href="imputation.html#cb26-73" aria-hidden="true" tabindex="-1"></a><span class="do">############################</span></span>
<span id="cb26-74"><a href="imputation.html#cb26-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-75"><a href="imputation.html#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="co"># subset FRI data frame</span></span>
<span id="cb26-76"><a href="imputation.html#cb26-76" aria-hidden="true" tabindex="-1"></a>dat_cc <span class="ot">&lt;-</span> dat_fri[dat_fri<span class="sc">$</span>cc <span class="sc">&gt;=</span> <span class="dv">50</span>,]</span>
<span id="cb26-77"><a href="imputation.html#cb26-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-78"><a href="imputation.html#cb26-78" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb26-79"><a href="imputation.html#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="do">### COMBINE INTERSECTION OF DATA SCREENS </span><span class="al">###</span></span>
<span id="cb26-80"><a href="imputation.html#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb26-81"><a href="imputation.html#cb26-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-82"><a href="imputation.html#cb26-82" aria-hidden="true" tabindex="-1"></a><span class="co"># first combine only by POLYID</span></span>
<span id="cb26-83"><a href="imputation.html#cb26-83" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="ot">&lt;-</span> <span class="fu">intersect</span>(dat_dom_for <span class="sc">%&gt;%</span> <span class="fu">subset</span>(<span class="at">select =</span> POLYID),</span>
<span id="cb26-84"><a href="imputation.html#cb26-84" aria-hidden="true" tabindex="-1"></a>                        dat_p95 <span class="sc">%&gt;%</span> <span class="fu">subset</span>(<span class="at">select =</span> POLYID)) <span class="sc">%&gt;%</span></span>
<span id="cb26-85"><a href="imputation.html#cb26-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">intersect</span>(., dat_cc <span class="sc">%&gt;%</span> <span class="fu">subset</span>(<span class="at">select =</span> POLYID))</span>
<span id="cb26-86"><a href="imputation.html#cb26-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-87"><a href="imputation.html#cb26-87" aria-hidden="true" tabindex="-1"></a><span class="co"># load full data frame attributes</span></span>
<span id="cb26-88"><a href="imputation.html#cb26-88" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="ot">&lt;-</span> dat_fri[dat_fri<span class="sc">$</span>POLYID <span class="sc">%in%</span> dat_fri_scr<span class="sc">$</span>POLYID,]</span>
<span id="cb26-89"><a href="imputation.html#cb26-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-90"><a href="imputation.html#cb26-90" aria-hidden="true" tabindex="-1"></a><span class="co"># save extracted data frame for fast rebooting</span></span>
<span id="cb26-91"><a href="imputation.html#cb26-91" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dat_fri_scr, <span class="at">file =</span> <span class="st">&#39;D:/ontario_inventory/imputation/example/dat_fri_scr.RData&#39;</span>)</span>
<span id="cb26-92"><a href="imputation.html#cb26-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-93"><a href="imputation.html#cb26-93" aria-hidden="true" tabindex="-1"></a><span class="co"># clear workspace</span></span>
<span id="cb26-94"><a href="imputation.html#cb26-94" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span></code></pre></div>
</div>
<div id="imputationp3" class="section level2 unnumbered hasAnchor">
<h2>3. Run imputation on FRI polygons ONLY to assess imputation performance<a href="imputation.html#imputationp3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The goal of this imputation procedure is to estimate age and species composition in GRM segmented forest polygons. But it is also important to assess the performance of the algorithm. To do this, we can conduct the imputation over the FRI dataset ONLY. For each FRI polygon, we find the k-nearest neighbors, and calculate the age and species composition attributes to impute. We can then compare the observed age and species composition of the polygon to the imputed values. Note we have to do this calculation on the FRI dataset alone because we do not have observed age and species composition values for the GRM segmented polygons. Also note that ALL attributes are imputed from the same k-nearest neighbors. The algorithm is not run for individual attributes.</p>
<p>For age, we report root mean squared difference (RMSD), mean absolute error (MAE) and mean bias error (MBE). RMSD is used for assess results for model comparison. MAE gives an average error of imputed age in years. MBE gives an indication of whether we are imputing younger or older ages on average.</p>
<p>For species composition, we report the percent of observed and imputed values that match (accuracy). Species composition is broken down into several distinct attributes:</p>
<ol style="list-style-type: lower-alpha">
<li>Working group</li>
<li>First leading species (from FRI SPCOMP attribute)</li>
<li>Second leading species (from FRI SPCOMP attribute)</li>
<li>Three functional group classification (softwood, mixedwood, hardwood) derived from SPCOMP</li>
<li>Five functional group classification (jack pine dominated, black spruce dominated, mixed conifer, mixedwood, hardwood) derived from SPCOMP</li>
</ol>
<p>We also calculate performance metrics on the X-variables used in imputation: relative RMSD (RRMSD) and relative MBE (RMBE), calculated by dividing RMSD and RMBE by the mean value of each variable and multiplying by 100. RRMSD and RMBE give a percent error that can be compared across variables and when variables have difficult to interpret units, such as several of the ALS metrics used in imputation.</p>
</div>
<div id="imputationp3a" class="section level2 unnumbered hasAnchor">
<h2>3a. Create functions needed<a href="imputation.html#imputationp3a" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="imputation.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">######################################################</span></span>
<span id="cb27-2"><a href="imputation.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="do">### FUNCTIONS TO RUN K NEAREST NEIGHBOR IMPUTATION </span><span class="al">###</span></span>
<span id="cb27-3"><a href="imputation.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="do">######################################################</span></span>
<span id="cb27-4"><a href="imputation.html#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="imputation.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb27-6"><a href="imputation.html#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RANN)</span>
<span id="cb27-7"><a href="imputation.html#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb27-8"><a href="imputation.html#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="imputation.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create mode function</span></span>
<span id="cb27-10"><a href="imputation.html#cb27-10" aria-hidden="true" tabindex="-1"></a>getmode <span class="ot">&lt;-</span> <span class="cf">function</span>(v) {</span>
<span id="cb27-11"><a href="imputation.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  uniqv <span class="ot">&lt;-</span> <span class="fu">unique</span>(v)</span>
<span id="cb27-12"><a href="imputation.html#cb27-12" aria-hidden="true" tabindex="-1"></a>  uniqv[<span class="fu">which.max</span>(<span class="fu">tabulate</span>(<span class="fu">match</span>(v, uniqv)))]</span>
<span id="cb27-13"><a href="imputation.html#cb27-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-14"><a href="imputation.html#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="imputation.html#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create rmsd function</span></span>
<span id="cb27-16"><a href="imputation.html#cb27-16" aria-hidden="true" tabindex="-1"></a>rmsd <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb27-17"><a href="imputation.html#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">mean</span>((est <span class="sc">-</span> obs) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb27-18"><a href="imputation.html#cb27-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-19"><a href="imputation.html#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="imputation.html#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co"># create rrmsd function</span></span>
<span id="cb27-21"><a href="imputation.html#cb27-21" aria-hidden="true" tabindex="-1"></a>rrmsd <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb27-22"><a href="imputation.html#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">mean</span>((est <span class="sc">-</span> obs) <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> <span class="fu">mean</span>(obs) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb27-23"><a href="imputation.html#cb27-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-24"><a href="imputation.html#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="imputation.html#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co"># create mae function</span></span>
<span id="cb27-26"><a href="imputation.html#cb27-26" aria-hidden="true" tabindex="-1"></a>mae <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb27-27"><a href="imputation.html#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">abs</span>(est <span class="sc">-</span> obs))</span>
<span id="cb27-28"><a href="imputation.html#cb27-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-29"><a href="imputation.html#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="imputation.html#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="co"># create mbe function</span></span>
<span id="cb27-31"><a href="imputation.html#cb27-31" aria-hidden="true" tabindex="-1"></a>mbe <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb27-32"><a href="imputation.html#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(est <span class="sc">-</span> obs)</span>
<span id="cb27-33"><a href="imputation.html#cb27-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-34"><a href="imputation.html#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="imputation.html#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="co"># create rmbe function</span></span>
<span id="cb27-36"><a href="imputation.html#cb27-36" aria-hidden="true" tabindex="-1"></a>rmbe <span class="ot">&lt;-</span> <span class="cf">function</span>(obs, est){</span>
<span id="cb27-37"><a href="imputation.html#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(est <span class="sc">-</span> obs) <span class="sc">/</span> <span class="fu">mean</span>(obs) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb27-38"><a href="imputation.html#cb27-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-39"><a href="imputation.html#cb27-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-40"><a href="imputation.html#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="co"># create knn function</span></span>
<span id="cb27-41"><a href="imputation.html#cb27-41" aria-hidden="true" tabindex="-1"></a>run_knn_fri <span class="ot">&lt;-</span> <span class="cf">function</span>(dat, vars, k) {</span>
<span id="cb27-42"><a href="imputation.html#cb27-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-43"><a href="imputation.html#cb27-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset data</span></span>
<span id="cb27-44"><a href="imputation.html#cb27-44" aria-hidden="true" tabindex="-1"></a>  dat_nn <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(vars))</span>
<span id="cb27-45"><a href="imputation.html#cb27-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-46"><a href="imputation.html#cb27-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale for nn computation</span></span>
<span id="cb27-47"><a href="imputation.html#cb27-47" aria-hidden="true" tabindex="-1"></a>  dat_nn_scaled <span class="ot">&lt;-</span> dat_nn <span class="sc">%&gt;%</span> scale</span>
<span id="cb27-48"><a href="imputation.html#cb27-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-49"><a href="imputation.html#cb27-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run nearest neighbor</span></span>
<span id="cb27-50"><a href="imputation.html#cb27-50" aria-hidden="true" tabindex="-1"></a>  nn <span class="ot">&lt;-</span> <span class="fu">nn2</span>(dat_nn_scaled, dat_nn_scaled, <span class="at">k =</span> k <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb27-51"><a href="imputation.html#cb27-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-52"><a href="imputation.html#cb27-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get nn indices</span></span>
<span id="cb27-53"><a href="imputation.html#cb27-53" aria-hidden="true" tabindex="-1"></a>  nni <span class="ot">&lt;-</span> nn[[<span class="dv">1</span>]][, <span class="dv">2</span><span class="sc">:</span>(k <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="cb27-54"><a href="imputation.html#cb27-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-55"><a href="imputation.html#cb27-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add vars to tibble</span></span>
<span id="cb27-56"><a href="imputation.html#cb27-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take mean/mode if k &gt; 1</span></span>
<span id="cb27-57"><a href="imputation.html#cb27-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb27-58"><a href="imputation.html#cb27-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb27-59"><a href="imputation.html#cb27-59" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb27-60"><a href="imputation.html#cb27-60" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb27-61"><a href="imputation.html#cb27-61" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb27-62"><a href="imputation.html#cb27-62" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">mean</span>(dat_nn[x, i])</span>
<span id="cb27-63"><a href="imputation.html#cb27-63" aria-hidden="true" tabindex="-1"></a>                         }))</span>
<span id="cb27-64"><a href="imputation.html#cb27-64" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb27-65"><a href="imputation.html#cb27-65" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb27-66"><a href="imputation.html#cb27-66" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb27-67"><a href="imputation.html#cb27-67" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">mean</span>(dat_nn[x, i])</span>
<span id="cb27-68"><a href="imputation.html#cb27-68" aria-hidden="true" tabindex="-1"></a>                           }))</span>
<span id="cb27-69"><a href="imputation.html#cb27-69" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb27-70"><a href="imputation.html#cb27-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-71"><a href="imputation.html#cb27-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-72"><a href="imputation.html#cb27-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add target vars to tibble</span></span>
<span id="cb27-73"><a href="imputation.html#cb27-73" aria-hidden="true" tabindex="-1"></a>    nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age =</span> dat<span class="sc">$</span>AGE2018,</span>
<span id="cb27-74"><a href="imputation.html#cb27-74" aria-hidden="true" tabindex="-1"></a>                       <span class="at">wg =</span> dat<span class="sc">$</span>WG,</span>
<span id="cb27-75"><a href="imputation.html#cb27-75" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1 =</span> dat<span class="sc">$</span>SP1,</span>
<span id="cb27-76"><a href="imputation.html#cb27-76" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2 =</span> dat<span class="sc">$</span>SP2,</span>
<span id="cb27-77"><a href="imputation.html#cb27-77" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group5 =</span> dat<span class="sc">$</span>SpeciesGroup2,</span>
<span id="cb27-78"><a href="imputation.html#cb27-78" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group3 =</span> dat<span class="sc">$</span>SpeciesGroup3,</span>
<span id="cb27-79"><a href="imputation.html#cb27-79" aria-hidden="true" tabindex="-1"></a>                       <span class="at">age_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb27-80"><a href="imputation.html#cb27-80" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">mean</span>(dat<span class="sc">$</span>AGE2018[x])</span>
<span id="cb27-81"><a href="imputation.html#cb27-81" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb27-82"><a href="imputation.html#cb27-82" aria-hidden="true" tabindex="-1"></a>                       <span class="at">wg_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb27-83"><a href="imputation.html#cb27-83" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>WG[x])</span>
<span id="cb27-84"><a href="imputation.html#cb27-84" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb27-85"><a href="imputation.html#cb27-85" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb27-86"><a href="imputation.html#cb27-86" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>SP1[x])</span>
<span id="cb27-87"><a href="imputation.html#cb27-87" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb27-88"><a href="imputation.html#cb27-88" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb27-89"><a href="imputation.html#cb27-89" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>SP2[x])</span>
<span id="cb27-90"><a href="imputation.html#cb27-90" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb27-91"><a href="imputation.html#cb27-91" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group5_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb27-92"><a href="imputation.html#cb27-92" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>SpeciesGroup2[x])</span>
<span id="cb27-93"><a href="imputation.html#cb27-93" aria-hidden="true" tabindex="-1"></a>                       }),</span>
<span id="cb27-94"><a href="imputation.html#cb27-94" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group3_nn =</span> <span class="fu">apply</span>(nni, <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb27-95"><a href="imputation.html#cb27-95" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">getmode</span>(dat<span class="sc">$</span>SpeciesGroup3[x])</span>
<span id="cb27-96"><a href="imputation.html#cb27-96" aria-hidden="true" tabindex="-1"></a>                       }))</span>
<span id="cb27-97"><a href="imputation.html#cb27-97" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-98"><a href="imputation.html#cb27-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-99"><a href="imputation.html#cb27-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take direct nn if k == 1</span></span>
<span id="cb27-100"><a href="imputation.html#cb27-100" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb27-101"><a href="imputation.html#cb27-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb27-102"><a href="imputation.html#cb27-102" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb27-103"><a href="imputation.html#cb27-103" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb27-104"><a href="imputation.html#cb27-104" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> dat_nn[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>],i])</span>
<span id="cb27-105"><a href="imputation.html#cb27-105" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb27-106"><a href="imputation.html#cb27-106" aria-hidden="true" tabindex="-1"></a>        nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="sc">!!</span>vars[i] <span class="sc">:</span><span class="er">=</span> dat_nn[,i],</span>
<span id="cb27-107"><a href="imputation.html#cb27-107" aria-hidden="true" tabindex="-1"></a>                           <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>) <span class="sc">:</span><span class="er">=</span> dat_nn[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>],i])</span>
<span id="cb27-108"><a href="imputation.html#cb27-108" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb27-109"><a href="imputation.html#cb27-109" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-110"><a href="imputation.html#cb27-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-111"><a href="imputation.html#cb27-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add target vars to tibble</span></span>
<span id="cb27-112"><a href="imputation.html#cb27-112" aria-hidden="true" tabindex="-1"></a>    nn_tab <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age =</span> dat<span class="sc">$</span>AGE2018,</span>
<span id="cb27-113"><a href="imputation.html#cb27-113" aria-hidden="true" tabindex="-1"></a>                       <span class="at">wg =</span> dat<span class="sc">$</span>WG,</span>
<span id="cb27-114"><a href="imputation.html#cb27-114" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1 =</span> dat<span class="sc">$</span>SP1,</span>
<span id="cb27-115"><a href="imputation.html#cb27-115" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2 =</span> dat<span class="sc">$</span>SP2,</span>
<span id="cb27-116"><a href="imputation.html#cb27-116" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group5 =</span> dat<span class="sc">$</span>SpeciesGroup2,</span>
<span id="cb27-117"><a href="imputation.html#cb27-117" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group3 =</span> dat<span class="sc">$</span>SpeciesGroup3,</span>
<span id="cb27-118"><a href="imputation.html#cb27-118" aria-hidden="true" tabindex="-1"></a>                       <span class="at">age_nn =</span> dat<span class="sc">$</span>AGE2018[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb27-119"><a href="imputation.html#cb27-119" aria-hidden="true" tabindex="-1"></a>                       <span class="at">wg_nn =</span> dat<span class="sc">$</span>WG[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb27-120"><a href="imputation.html#cb27-120" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp1_nn =</span> dat<span class="sc">$</span>SP1[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb27-121"><a href="imputation.html#cb27-121" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sp2_nn =</span> dat<span class="sc">$</span>SP2[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb27-122"><a href="imputation.html#cb27-122" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group5_nn =</span> dat<span class="sc">$</span>SpeciesGroup2[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]],</span>
<span id="cb27-123"><a href="imputation.html#cb27-123" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group3_nn =</span> dat<span class="sc">$</span>SpeciesGroup3[nn[[<span class="dv">1</span>]][,<span class="dv">2</span>]])</span>
<span id="cb27-124"><a href="imputation.html#cb27-124" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-125"><a href="imputation.html#cb27-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-126"><a href="imputation.html#cb27-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-127"><a href="imputation.html#cb27-127" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate fit metrics for vars</span></span>
<span id="cb27-128"><a href="imputation.html#cb27-128" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb27-129"><a href="imputation.html#cb27-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb27-130"><a href="imputation.html#cb27-130" aria-hidden="true" tabindex="-1"></a>      perform_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">variable =</span> vars[i],</span>
<span id="cb27-131"><a href="imputation.html#cb27-131" aria-hidden="true" tabindex="-1"></a>                           <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>),</span>
<span id="cb27-132"><a href="imputation.html#cb27-132" aria-hidden="true" tabindex="-1"></a>                           <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rrmsd</span>(<span class="fu">pull</span>(nn_tab, vars[i]),</span>
<span id="cb27-133"><a href="imputation.html#cb27-133" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">pull</span>(nn_tab, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>))),</span>
<span id="cb27-134"><a href="imputation.html#cb27-134" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rmbe</span>(<span class="fu">pull</span>(nn_tab, vars[i]),</span>
<span id="cb27-135"><a href="imputation.html#cb27-135" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">pull</span>(nn_tab, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>)))))</span>
<span id="cb27-136"><a href="imputation.html#cb27-136" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb27-137"><a href="imputation.html#cb27-137" aria-hidden="true" tabindex="-1"></a>      perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> vars[i],</span>
<span id="cb27-138"><a href="imputation.html#cb27-138" aria-hidden="true" tabindex="-1"></a>                           <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>),</span>
<span id="cb27-139"><a href="imputation.html#cb27-139" aria-hidden="true" tabindex="-1"></a>                           <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rrmsd</span>(<span class="fu">pull</span>(nn_tab, vars[i]),</span>
<span id="cb27-140"><a href="imputation.html#cb27-140" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">pull</span>(nn_tab, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>))),</span>
<span id="cb27-141"><a href="imputation.html#cb27-141" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rmbe</span>(<span class="fu">pull</span>(nn_tab, vars[i]),</span>
<span id="cb27-142"><a href="imputation.html#cb27-142" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">pull</span>(nn_tab, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_nn&#39;</span>)))))</span>
<span id="cb27-143"><a href="imputation.html#cb27-143" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-144"><a href="imputation.html#cb27-144" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-145"><a href="imputation.html#cb27-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-146"><a href="imputation.html#cb27-146" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate metrics for age</span></span>
<span id="cb27-147"><a href="imputation.html#cb27-147" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;age&#39;</span>,</span>
<span id="cb27-148"><a href="imputation.html#cb27-148" aria-hidden="true" tabindex="-1"></a>                          <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rmsd (yrs)&#39;</span>, <span class="st">&#39;mbe (yrs)&#39;</span>, <span class="st">&#39;mae (yrs)&#39;</span>),</span>
<span id="cb27-149"><a href="imputation.html#cb27-149" aria-hidden="true" tabindex="-1"></a>                          <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rmsd</span>(nn_tab<span class="sc">$</span>age, nn_tab<span class="sc">$</span>age_nn),</span>
<span id="cb27-150"><a href="imputation.html#cb27-150" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">mbe</span>(nn_tab<span class="sc">$</span>age, nn_tab<span class="sc">$</span>age_nn),</span>
<span id="cb27-151"><a href="imputation.html#cb27-151" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">mae</span>(nn_tab<span class="sc">$</span>age, nn_tab<span class="sc">$</span>age_nn)))</span>
<span id="cb27-152"><a href="imputation.html#cb27-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-153"><a href="imputation.html#cb27-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate wg accuracy</span></span>
<span id="cb27-154"><a href="imputation.html#cb27-154" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create df of WG</span></span>
<span id="cb27-155"><a href="imputation.html#cb27-155" aria-hidden="true" tabindex="-1"></a>  wg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>wg,</span>
<span id="cb27-156"><a href="imputation.html#cb27-156" aria-hidden="true" tabindex="-1"></a>                   <span class="at">est =</span> nn_tab<span class="sc">$</span>wg_nn)</span>
<span id="cb27-157"><a href="imputation.html#cb27-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-158"><a href="imputation.html#cb27-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column of match or not</span></span>
<span id="cb27-159"><a href="imputation.html#cb27-159" aria-hidden="true" tabindex="-1"></a>  wg<span class="sc">$</span>match <span class="ot">&lt;-</span> wg<span class="sc">$</span>obs <span class="sc">==</span> wg<span class="sc">$</span>est</span>
<span id="cb27-160"><a href="imputation.html#cb27-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-161"><a href="imputation.html#cb27-161" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total percent of matching WG to perform_df</span></span>
<span id="cb27-162"><a href="imputation.html#cb27-162" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;working group&#39;</span>,</span>
<span id="cb27-163"><a href="imputation.html#cb27-163" aria-hidden="true" tabindex="-1"></a>                          <span class="at">metric =</span> <span class="st">&#39;accuracy (%)&#39;</span>,</span>
<span id="cb27-164"><a href="imputation.html#cb27-164" aria-hidden="true" tabindex="-1"></a>                          <span class="at">value =</span> <span class="fu">NROW</span>(wg[wg<span class="sc">$</span>match <span class="sc">==</span> T,]) <span class="sc">/</span></span>
<span id="cb27-165"><a href="imputation.html#cb27-165" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">NROW</span>(wg) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb27-166"><a href="imputation.html#cb27-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-167"><a href="imputation.html#cb27-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate SP1 accuracy</span></span>
<span id="cb27-168"><a href="imputation.html#cb27-168" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create df of SP1</span></span>
<span id="cb27-169"><a href="imputation.html#cb27-169" aria-hidden="true" tabindex="-1"></a>  sp1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>sp1,</span>
<span id="cb27-170"><a href="imputation.html#cb27-170" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> nn_tab<span class="sc">$</span>sp1_nn)</span>
<span id="cb27-171"><a href="imputation.html#cb27-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-172"><a href="imputation.html#cb27-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column of match or not</span></span>
<span id="cb27-173"><a href="imputation.html#cb27-173" aria-hidden="true" tabindex="-1"></a>  sp1<span class="sc">$</span>match <span class="ot">&lt;-</span> sp1<span class="sc">$</span>obs <span class="sc">==</span> sp1<span class="sc">$</span>est</span>
<span id="cb27-174"><a href="imputation.html#cb27-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-175"><a href="imputation.html#cb27-175" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total percent of matching SP1 to perform_df</span></span>
<span id="cb27-176"><a href="imputation.html#cb27-176" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;leading species&#39;</span>,</span>
<span id="cb27-177"><a href="imputation.html#cb27-177" aria-hidden="true" tabindex="-1"></a>                          <span class="at">metric =</span> <span class="st">&#39;accuracy (%)&#39;</span>,</span>
<span id="cb27-178"><a href="imputation.html#cb27-178" aria-hidden="true" tabindex="-1"></a>                          <span class="at">value =</span> <span class="fu">NROW</span>(sp1[sp1<span class="sc">$</span>match <span class="sc">==</span> T,]) <span class="sc">/</span></span>
<span id="cb27-179"><a href="imputation.html#cb27-179" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">NROW</span>(sp1) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb27-180"><a href="imputation.html#cb27-180" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-181"><a href="imputation.html#cb27-181" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate SP2 accuracy</span></span>
<span id="cb27-182"><a href="imputation.html#cb27-182" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create df of SP2</span></span>
<span id="cb27-183"><a href="imputation.html#cb27-183" aria-hidden="true" tabindex="-1"></a>  sp2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>sp2,</span>
<span id="cb27-184"><a href="imputation.html#cb27-184" aria-hidden="true" tabindex="-1"></a>                    <span class="at">est =</span> nn_tab<span class="sc">$</span>sp2_nn)</span>
<span id="cb27-185"><a href="imputation.html#cb27-185" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-186"><a href="imputation.html#cb27-186" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column of match or not</span></span>
<span id="cb27-187"><a href="imputation.html#cb27-187" aria-hidden="true" tabindex="-1"></a>  sp2<span class="sc">$</span>match <span class="ot">&lt;-</span> sp2<span class="sc">$</span>obs <span class="sc">==</span> sp2<span class="sc">$</span>est</span>
<span id="cb27-188"><a href="imputation.html#cb27-188" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-189"><a href="imputation.html#cb27-189" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total percent of matching SP2 to perform_df</span></span>
<span id="cb27-190"><a href="imputation.html#cb27-190" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;second species&#39;</span>, </span>
<span id="cb27-191"><a href="imputation.html#cb27-191" aria-hidden="true" tabindex="-1"></a>                        <span class="at">metric =</span> <span class="st">&#39;accuracy (%)&#39;</span>,</span>
<span id="cb27-192"><a href="imputation.html#cb27-192" aria-hidden="true" tabindex="-1"></a>                        <span class="at">value =</span> <span class="fu">NROW</span>(sp2[sp2<span class="sc">$</span>match <span class="sc">==</span> T,]) <span class="sc">/</span></span>
<span id="cb27-193"><a href="imputation.html#cb27-193" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">NROW</span>(sp2) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb27-194"><a href="imputation.html#cb27-194" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-195"><a href="imputation.html#cb27-195" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate GROUP3 accuracy</span></span>
<span id="cb27-196"><a href="imputation.html#cb27-196" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create df of GROUP3</span></span>
<span id="cb27-197"><a href="imputation.html#cb27-197" aria-hidden="true" tabindex="-1"></a>  group3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>group3,</span>
<span id="cb27-198"><a href="imputation.html#cb27-198" aria-hidden="true" tabindex="-1"></a>                       <span class="at">est =</span> nn_tab<span class="sc">$</span>group3_nn)</span>
<span id="cb27-199"><a href="imputation.html#cb27-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-200"><a href="imputation.html#cb27-200" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column of match or not</span></span>
<span id="cb27-201"><a href="imputation.html#cb27-201" aria-hidden="true" tabindex="-1"></a>  group3<span class="sc">$</span>match <span class="ot">&lt;-</span> group3<span class="sc">$</span>obs <span class="sc">==</span> group3<span class="sc">$</span>est</span>
<span id="cb27-202"><a href="imputation.html#cb27-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-203"><a href="imputation.html#cb27-203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total percent of matching group3 to perform_df</span></span>
<span id="cb27-204"><a href="imputation.html#cb27-204" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;three func group class&#39;</span>,</span>
<span id="cb27-205"><a href="imputation.html#cb27-205" aria-hidden="true" tabindex="-1"></a>                          <span class="at">metric =</span> <span class="st">&#39;accuracy (%)&#39;</span>,</span>
<span id="cb27-206"><a href="imputation.html#cb27-206" aria-hidden="true" tabindex="-1"></a>                          <span class="at">value =</span> <span class="fu">NROW</span>(group3[group3<span class="sc">$</span>match <span class="sc">==</span> T,]) <span class="sc">/</span></span>
<span id="cb27-207"><a href="imputation.html#cb27-207" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">NROW</span>(group3) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb27-208"><a href="imputation.html#cb27-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-209"><a href="imputation.html#cb27-209" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate GROUP5 accuracy</span></span>
<span id="cb27-210"><a href="imputation.html#cb27-210" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create df of GROUP5</span></span>
<span id="cb27-211"><a href="imputation.html#cb27-211" aria-hidden="true" tabindex="-1"></a>  group5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> nn_tab<span class="sc">$</span>group5,</span>
<span id="cb27-212"><a href="imputation.html#cb27-212" aria-hidden="true" tabindex="-1"></a>                       <span class="at">est =</span> nn_tab<span class="sc">$</span>group5_nn)</span>
<span id="cb27-213"><a href="imputation.html#cb27-213" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-214"><a href="imputation.html#cb27-214" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create column of match or not</span></span>
<span id="cb27-215"><a href="imputation.html#cb27-215" aria-hidden="true" tabindex="-1"></a>  group5<span class="sc">$</span>match <span class="ot">&lt;-</span> group5<span class="sc">$</span>obs <span class="sc">==</span> group5<span class="sc">$</span>est</span>
<span id="cb27-216"><a href="imputation.html#cb27-216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-217"><a href="imputation.html#cb27-217" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add total percent of matching group5 to perform_df</span></span>
<span id="cb27-218"><a href="imputation.html#cb27-218" aria-hidden="true" tabindex="-1"></a>  perform_df <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> <span class="st">&#39;five func group class&#39;</span>,</span>
<span id="cb27-219"><a href="imputation.html#cb27-219" aria-hidden="true" tabindex="-1"></a>                        <span class="at">metric =</span> <span class="st">&#39;accuracy (%)&#39;</span>,</span>
<span id="cb27-220"><a href="imputation.html#cb27-220" aria-hidden="true" tabindex="-1"></a>                        <span class="at">value =</span> <span class="fu">NROW</span>(group5[group5<span class="sc">$</span>match <span class="sc">==</span> T,]) <span class="sc">/</span></span>
<span id="cb27-221"><a href="imputation.html#cb27-221" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">NROW</span>(group5) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb27-222"><a href="imputation.html#cb27-222" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-223"><a href="imputation.html#cb27-223" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return df</span></span>
<span id="cb27-224"><a href="imputation.html#cb27-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(perform_df)</span>
<span id="cb27-225"><a href="imputation.html#cb27-225" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="imputationp3b" class="section level2 unnumbered hasAnchor">
<h2>3b. Run the imputation and assess performance<a href="imputation.html#imputationp3b" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="imputation.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb28-2"><a href="imputation.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="do">### LOAD FRI DATA FRAME </span><span class="al">###</span></span>
<span id="cb28-3"><a href="imputation.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb28-4"><a href="imputation.html#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="imputation.html#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load from part 2 above</span></span>
<span id="cb28-6"><a href="imputation.html#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;D:/ontario_inventory/imputation/example/dat_fri_scr.RData&#39;</span>)</span>
<span id="cb28-7"><a href="imputation.html#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="imputation.html#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># subset only the attributes we need</span></span>
<span id="cb28-9"><a href="imputation.html#cb28-9" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="sc">%&lt;&gt;%</span> <span class="fu">select</span>(POLYID, AGE2018, SPCOMP, WG, </span>
<span id="cb28-10"><a href="imputation.html#cb28-10" aria-hidden="true" tabindex="-1"></a>                        avg, sd,</span>
<span id="cb28-11"><a href="imputation.html#cb28-11" aria-hidden="true" tabindex="-1"></a>                        rumple, zpcum8,</span>
<span id="cb28-12"><a href="imputation.html#cb28-12" aria-hidden="true" tabindex="-1"></a>                        x, y, red_edge_2)</span>
<span id="cb28-13"><a href="imputation.html#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="imputation.html#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co"># remove any polygons with missing values</span></span>
<span id="cb28-15"><a href="imputation.html#cb28-15" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(dat_fri_scr)</span>
<span id="cb28-16"><a href="imputation.html#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="imputation.html#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb28-18"><a href="imputation.html#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="do">### CALCULATE AND ADD SPCOMP ATTRIBUTES </span><span class="al">###</span></span>
<span id="cb28-19"><a href="imputation.html#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb28-20"><a href="imputation.html#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="imputation.html#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co"># parse SPCOMP strings</span></span>
<span id="cb28-22"><a href="imputation.html#cb28-22" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">str_split</span>(dat_fri_scr<span class="sc">$</span>SPCOMP, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s{2}&quot;</span>)</span>
<span id="cb28-23"><a href="imputation.html#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="imputation.html#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># add first species to dat</span></span>
<span id="cb28-25"><a href="imputation.html#cb28-25" aria-hidden="true" tabindex="-1"></a>dat_fri_scr<span class="sc">$</span>SP1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sp, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb28-26"><a href="imputation.html#cb28-26" aria-hidden="true" tabindex="-1"></a>  str <span class="ot">&lt;-</span> x[<span class="dv">1</span>]</span>
<span id="cb28-27"><a href="imputation.html#cb28-27" aria-hidden="true" tabindex="-1"></a>  str <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(str, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>)</span>
<span id="cb28-28"><a href="imputation.html#cb28-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(str)</span>
<span id="cb28-29"><a href="imputation.html#cb28-29" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-30"><a href="imputation.html#cb28-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-31"><a href="imputation.html#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="co"># add first species percent to dat</span></span>
<span id="cb28-32"><a href="imputation.html#cb28-32" aria-hidden="true" tabindex="-1"></a>dat_fri_scr<span class="sc">$</span>SP1P <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sp, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb28-33"><a href="imputation.html#cb28-33" aria-hidden="true" tabindex="-1"></a>  str <span class="ot">&lt;-</span> x[<span class="dv">2</span>]</span>
<span id="cb28-34"><a href="imputation.html#cb28-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(str)){</span>
<span id="cb28-35"><a href="imputation.html#cb28-35" aria-hidden="true" tabindex="-1"></a>    str <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb28-36"><a href="imputation.html#cb28-36" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb28-37"><a href="imputation.html#cb28-37" aria-hidden="true" tabindex="-1"></a>    str <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(str, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>)</span>
<span id="cb28-38"><a href="imputation.html#cb28-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-39"><a href="imputation.html#cb28-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(str)</span>
<span id="cb28-40"><a href="imputation.html#cb28-40" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-41"><a href="imputation.html#cb28-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-42"><a href="imputation.html#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="co"># add second species to dat</span></span>
<span id="cb28-43"><a href="imputation.html#cb28-43" aria-hidden="true" tabindex="-1"></a>dat_fri_scr<span class="sc">$</span>SP2 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sp, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb28-44"><a href="imputation.html#cb28-44" aria-hidden="true" tabindex="-1"></a>  str <span class="ot">&lt;-</span> x[<span class="dv">2</span>]</span>
<span id="cb28-45"><a href="imputation.html#cb28-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(str) <span class="sc">==</span> F){</span>
<span id="cb28-46"><a href="imputation.html#cb28-46" aria-hidden="true" tabindex="-1"></a>    str <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(str, <span class="at">start =</span> <span class="dv">3</span>, <span class="at">end =</span> <span class="dv">4</span>)</span>
<span id="cb28-47"><a href="imputation.html#cb28-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-48"><a href="imputation.html#cb28-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(str)</span>
<span id="cb28-49"><a href="imputation.html#cb28-49" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-50"><a href="imputation.html#cb28-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-51"><a href="imputation.html#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="co"># add second species percent to dat</span></span>
<span id="cb28-52"><a href="imputation.html#cb28-52" aria-hidden="true" tabindex="-1"></a>dat_fri_scr<span class="sc">$</span>SP2P <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sp, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb28-53"><a href="imputation.html#cb28-53" aria-hidden="true" tabindex="-1"></a>  str <span class="ot">&lt;-</span> x[<span class="dv">3</span>]</span>
<span id="cb28-54"><a href="imputation.html#cb28-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(str) <span class="sc">==</span> F){</span>
<span id="cb28-55"><a href="imputation.html#cb28-55" aria-hidden="true" tabindex="-1"></a>    str <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(str, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>)</span>
<span id="cb28-56"><a href="imputation.html#cb28-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-57"><a href="imputation.html#cb28-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(str)</span>
<span id="cb28-58"><a href="imputation.html#cb28-58" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-59"><a href="imputation.html#cb28-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-60"><a href="imputation.html#cb28-60" aria-hidden="true" tabindex="-1"></a><span class="co"># change second species missing values</span></span>
<span id="cb28-61"><a href="imputation.html#cb28-61" aria-hidden="true" tabindex="-1"></a>dat_fri_scr<span class="sc">$</span>SP2[<span class="fu">is.na</span>(dat_fri_scr<span class="sc">$</span>SP2)] <span class="ot">&lt;-</span> <span class="st">&#39;MIS&#39;</span></span>
<span id="cb28-62"><a href="imputation.html#cb28-62" aria-hidden="true" tabindex="-1"></a>dat_fri_scr<span class="sc">$</span>SP2P[<span class="fu">is.na</span>(dat_fri_scr<span class="sc">$</span>SP2P)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-63"><a href="imputation.html#cb28-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-64"><a href="imputation.html#cb28-64" aria-hidden="true" tabindex="-1"></a><span class="co"># load species group data -- calculated in separate code (can provide details)</span></span>
<span id="cb28-65"><a href="imputation.html#cb28-65" aria-hidden="true" tabindex="-1"></a>sp_group <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb28-66"><a href="imputation.html#cb28-66" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Polygons Inventory/RMF_PolygonForest_SPGROUP.shp&#39;</span></span>
<span id="cb28-67"><a href="imputation.html#cb28-67" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-68"><a href="imputation.html#cb28-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-69"><a href="imputation.html#cb28-69" aria-hidden="true" tabindex="-1"></a><span class="co"># change POLYID to numeric</span></span>
<span id="cb28-70"><a href="imputation.html#cb28-70" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">POLYID =</span> <span class="fu">as.numeric</span>(POLYID))</span>
<span id="cb28-71"><a href="imputation.html#cb28-71" aria-hidden="true" tabindex="-1"></a>sp_group <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">POLYID =</span> <span class="fu">as.numeric</span>(POLYID))</span>
<span id="cb28-72"><a href="imputation.html#cb28-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-73"><a href="imputation.html#cb28-73" aria-hidden="true" tabindex="-1"></a><span class="co"># join to dat</span></span>
<span id="cb28-74"><a href="imputation.html#cb28-74" aria-hidden="true" tabindex="-1"></a>dat_fri_scr <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dat_fri_scr, </span>
<span id="cb28-75"><a href="imputation.html#cb28-75" aria-hidden="true" tabindex="-1"></a>                 sp_group <span class="sc">%&gt;%</span> <span class="fu">select</span>(POLYID, SpeciesGroup2, SpeciesGroup3), </span>
<span id="cb28-76"><a href="imputation.html#cb28-76" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="st">&#39;POLYID&#39;</span>)</span>
<span id="cb28-77"><a href="imputation.html#cb28-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-78"><a href="imputation.html#cb28-78" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################</span></span>
<span id="cb28-79"><a href="imputation.html#cb28-79" aria-hidden="true" tabindex="-1"></a><span class="do">### RUN NEAREST NEIGHBOR IMPUTATION K = 5 </span><span class="al">###</span></span>
<span id="cb28-80"><a href="imputation.html#cb28-80" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################</span></span>
<span id="cb28-81"><a href="imputation.html#cb28-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-82"><a href="imputation.html#cb28-82" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector of X-variables for imputation</span></span>
<span id="cb28-83"><a href="imputation.html#cb28-83" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;avg&#39;</span>, <span class="st">&#39;sd&#39;</span>, <span class="st">&#39;rumple&#39;</span>,</span>
<span id="cb28-84"><a href="imputation.html#cb28-84" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;zpcum8&#39;</span>, <span class="st">&#39;x&#39;</span>,</span>
<span id="cb28-85"><a href="imputation.html#cb28-85" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;y&#39;</span>, <span class="st">&#39;red_edge_2&#39;</span>)</span>
<span id="cb28-86"><a href="imputation.html#cb28-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-87"><a href="imputation.html#cb28-87" aria-hidden="true" tabindex="-1"></a><span class="co"># run_knn function already created</span></span>
<span id="cb28-88"><a href="imputation.html#cb28-88" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">run_knn_fri</span>(dat_fri_scr, vars, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb28-89"><a href="imputation.html#cb28-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-90"><a href="imputation.html#cb28-90" aria-hidden="true" tabindex="-1"></a><span class="co"># round values</span></span>
<span id="cb28-91"><a href="imputation.html#cb28-91" aria-hidden="true" tabindex="-1"></a>perf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">round</span>(value, <span class="dv">2</span>))</span>
<span id="cb28-92"><a href="imputation.html#cb28-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-93"><a href="imputation.html#cb28-93" aria-hidden="true" tabindex="-1"></a><span class="co"># factor variable and metric categories to order</span></span>
<span id="cb28-94"><a href="imputation.html#cb28-94" aria-hidden="true" tabindex="-1"></a>perf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">factor</span>(variable, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;age&#39;</span>, <span class="st">&#39;working group&#39;</span>,<span class="st">&#39;leading species&#39;</span>, </span>
<span id="cb28-95"><a href="imputation.html#cb28-95" aria-hidden="true" tabindex="-1"></a>                                                        <span class="st">&#39;second species&#39;</span>, <span class="st">&#39;three func group class&#39;</span>,</span>
<span id="cb28-96"><a href="imputation.html#cb28-96" aria-hidden="true" tabindex="-1"></a>                                                        <span class="st">&#39;five func group class&#39;</span>, vars))) <span class="sc">%&gt;%</span></span>
<span id="cb28-97"><a href="imputation.html#cb28-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="fu">factor</span>(metric, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;rmsd (yrs)&#39;</span>, <span class="st">&#39;mbe (yrs)&#39;</span>, <span class="st">&#39;mae (yrs)&#39;</span>, <span class="st">&#39;accuracy (%)&#39;</span>, <span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>)))</span>
<span id="cb28-98"><a href="imputation.html#cb28-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-99"><a href="imputation.html#cb28-99" aria-hidden="true" tabindex="-1"></a><span class="co"># cast df</span></span>
<span id="cb28-100"><a href="imputation.html#cb28-100" aria-hidden="true" tabindex="-1"></a>perf_cast <span class="ot">&lt;-</span> <span class="fu">dcast</span>(perf, variable <span class="sc">~</span> metric)</span>
<span id="cb28-101"><a href="imputation.html#cb28-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-102"><a href="imputation.html#cb28-102" aria-hidden="true" tabindex="-1"></a><span class="co"># remove x and y</span></span>
<span id="cb28-103"><a href="imputation.html#cb28-103" aria-hidden="true" tabindex="-1"></a>perf_cast <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)))</span>
<span id="cb28-104"><a href="imputation.html#cb28-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-105"><a href="imputation.html#cb28-105" aria-hidden="true" tabindex="-1"></a><span class="co"># set NA to blank</span></span>
<span id="cb28-106"><a href="imputation.html#cb28-106" aria-hidden="true" tabindex="-1"></a>perf_cast[<span class="fu">is.na</span>(perf_cast)] <span class="ot">&lt;-</span> <span class="st">&#39;&#39;</span></span>
<span id="cb28-107"><a href="imputation.html#cb28-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-108"><a href="imputation.html#cb28-108" aria-hidden="true" tabindex="-1"></a><span class="co"># display results</span></span>
<span id="cb28-109"><a href="imputation.html#cb28-109" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(perf_cast, <span class="at">caption =</span> <span class="st">&quot;Imputation Performance of FRI Forest Stand Polygons&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Imputation Performance of FRI Forest Stand Polygons</caption>
<colgroup>
<col width="26%" />
<col width="12%" />
<col width="11%" />
<col width="11%" />
<col width="15%" />
<col width="11%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="left">rmsd (yrs)</th>
<th align="left">mbe (yrs)</th>
<th align="left">mae (yrs)</th>
<th align="left">accuracy (%)</th>
<th align="left">rrmsd (%)</th>
<th align="left">rmbe (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">age</td>
<td align="left">23.31</td>
<td align="left">-0.14</td>
<td align="left">16.06</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">working group</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">66.77</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">leading species</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">65.46</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">second species</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">34.05</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">three func group class</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">72.34</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">five func group class</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">60.73</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">avg</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">3.6</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">sd</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">3.88</td>
<td align="left">-0.33</td>
</tr>
<tr class="odd">
<td align="left">rumple</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">2.54</td>
<td align="left">0.01</td>
</tr>
<tr class="even">
<td align="left">zpcum8</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">0.9</td>
<td align="left">0.13</td>
</tr>
<tr class="odd">
<td align="left">red_edge_2</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">2.15</td>
<td align="left">-0.1</td>
</tr>
</tbody>
</table>
<p><em>The mean bias error (MBE) of age is -0.14 years, indicating the imputed estimates of age are not skewed toward younger or older values. The mean absolute error (MAE) of age is 16.06 years, which is the average difference between the observed and imputed value.</em></p>
<p><em>Accuracy of leading species classification is 65.46%, and a much lower 34.05% for second leading species. Three and five functional group classification have respective accuracies of 72.34% and 60.73%.</em></p>
<p><em>Relative root mean squared difference (RRMSD) of the imputation attributes (avg, sd, rumple, zpcum8, and red_edge_2) is below 4% for all attributes. These are low values, which demonstrate that the imputation algorithm is finding optimal matches within the database of available FRI polygons.</em></p>
<p><em>Relative mean bias error (RMBE) of the imputation attributes is close to 0%, meaning that the nearest neighbor selections are not skewed toward positive or negative values of these attributes.</em></p>
<p><em>RRMSD/RMBE are not calculated for x and y because the coordinates do not represent a value scale.</em></p>
</div>
<div id="imputationp4" class="section level2 unnumbered hasAnchor">
<h2>4. Run imputation between FRI and GRM polygons to derive estimates of age and species composition<a href="imputation.html#imputationp4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The last step is to run the imputation between the screened FRI polygons and the GRM segmented polygons. For each GRM segmented polygon, the k-nearest neighbors in the FRI data are found and used to impute age and species composition. Note we do not conduct imputation on all the GRM segmented polygons, but only the polygons that have &gt;= 50% forested landcover, p95 &gt;= 5 meters, and canopy cover &gt;= 50% (same criteria as FRI data screening conducted above in step 2).</p>
<p>Although we cannot directly assess the error of age and species composition when imputing into the GRM segmented polygons, we can still assess the fit of the variables used in the imputation.</p>
<p>We can also review maps and distributions comparing FRI age/species composition against the same attributes imputed into GRM segmented polygons.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="imputation.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load additional packages</span></span>
<span id="cb29-2"><a href="imputation.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb29-3"><a href="imputation.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb29-4"><a href="imputation.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb29-5"><a href="imputation.html#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="imputation.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># load GRM polygon data frame</span></span>
<span id="cb29-7"><a href="imputation.html#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;D:/ontario_inventory/imputation/example/grm_10_01_05_extr.RData&#39;</span>)</span>
<span id="cb29-8"><a href="imputation.html#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="imputation.html#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># screen for forested polygons</span></span>
<span id="cb29-10"><a href="imputation.html#cb29-10" aria-hidden="true" tabindex="-1"></a>dat_grm_scr <span class="ot">&lt;-</span> dat_grm <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dom_for <span class="sc">==</span> <span class="st">&#39;Yes&#39;</span>,</span>
<span id="cb29-11"><a href="imputation.html#cb29-11" aria-hidden="true" tabindex="-1"></a>                                  p95 <span class="sc">&gt;=</span> <span class="dv">5</span>,</span>
<span id="cb29-12"><a href="imputation.html#cb29-12" aria-hidden="true" tabindex="-1"></a>                                  cc <span class="sc">&gt;=</span> <span class="dv">50</span>)</span>
<span id="cb29-13"><a href="imputation.html#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="imputation.html#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for grm and fri metrics used in imputation</span></span>
<span id="cb29-15"><a href="imputation.html#cb29-15" aria-hidden="true" tabindex="-1"></a>dat_grm_imp <span class="ot">&lt;-</span> dat_grm_scr <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, avg, sd, </span>
<span id="cb29-16"><a href="imputation.html#cb29-16" aria-hidden="true" tabindex="-1"></a>                                      rumple, zpcum8,</span>
<span id="cb29-17"><a href="imputation.html#cb29-17" aria-hidden="true" tabindex="-1"></a>                                      x, y, red_edge_2) <span class="sc">%&gt;%</span> na.omit</span>
<span id="cb29-18"><a href="imputation.html#cb29-18" aria-hidden="true" tabindex="-1"></a>dat_fri_imp <span class="ot">&lt;-</span> dat_fri_scr <span class="sc">%&gt;%</span> <span class="fu">select</span>(avg, sd, </span>
<span id="cb29-19"><a href="imputation.html#cb29-19" aria-hidden="true" tabindex="-1"></a>                                      rumple, zpcum8,</span>
<span id="cb29-20"><a href="imputation.html#cb29-20" aria-hidden="true" tabindex="-1"></a>                                      x, y, red_edge_2) <span class="sc">%&gt;%</span> na.omit</span>
<span id="cb29-21"><a href="imputation.html#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="imputation.html#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co"># need to combine and scale all values together then separate again</span></span>
<span id="cb29-23"><a href="imputation.html#cb29-23" aria-hidden="true" tabindex="-1"></a>dat_comb_scaled <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dat_grm_imp <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>id), </span>
<span id="cb29-24"><a href="imputation.html#cb29-24" aria-hidden="true" tabindex="-1"></a>                         dat_fri_imp) <span class="sc">%&gt;%</span> scale</span>
<span id="cb29-25"><a href="imputation.html#cb29-25" aria-hidden="true" tabindex="-1"></a>dat_grm_scaled <span class="ot">&lt;-</span> dat_comb_scaled[<span class="dv">1</span><span class="sc">:</span><span class="fu">NROW</span>(dat_grm_imp),]</span>
<span id="cb29-26"><a href="imputation.html#cb29-26" aria-hidden="true" tabindex="-1"></a>dat_fri_scaled <span class="ot">&lt;-</span> dat_comb_scaled[(<span class="fu">NROW</span>(dat_grm_imp)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">NROW</span>(dat_grm_imp)<span class="sc">+</span><span class="fu">NROW</span>(dat_fri_imp)),]</span>
<span id="cb29-27"><a href="imputation.html#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="imputation.html#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co"># run nearest neighbor imputation k = 5</span></span>
<span id="cb29-29"><a href="imputation.html#cb29-29" aria-hidden="true" tabindex="-1"></a>nn <span class="ot">&lt;-</span> <span class="fu">nn2</span>(dat_fri_scaled, dat_grm_scaled, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb29-30"><a href="imputation.html#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="imputation.html#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="co"># get nn indices</span></span>
<span id="cb29-32"><a href="imputation.html#cb29-32" aria-hidden="true" tabindex="-1"></a>nni <span class="ot">&lt;-</span> nn[[<span class="dv">1</span>]]</span>
<span id="cb29-33"><a href="imputation.html#cb29-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="imputation.html#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="co"># add imputed attributes into GRM imputation data frame</span></span>
<span id="cb29-35"><a href="imputation.html#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb29-36"><a href="imputation.html#cb29-36" aria-hidden="true" tabindex="-1"></a>  dat_grm_imp <span class="sc">%&lt;&gt;%</span> <span class="fu">add_column</span>(</span>
<span id="cb29-37"><a href="imputation.html#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!!</span><span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(</span>
<span id="cb29-38"><a href="imputation.html#cb29-38" aria-hidden="true" tabindex="-1"></a>      nni, </span>
<span id="cb29-39"><a href="imputation.html#cb29-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">1</span>, </span>
<span id="cb29-40"><a href="imputation.html#cb29-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb29-41"><a href="imputation.html#cb29-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>(dat_fri_imp[x, vars[i]])</span>
<span id="cb29-42"><a href="imputation.html#cb29-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb29-43"><a href="imputation.html#cb29-43" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb29-44"><a href="imputation.html#cb29-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-45"><a href="imputation.html#cb29-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-46"><a href="imputation.html#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector of target variables</span></span>
<span id="cb29-47"><a href="imputation.html#cb29-47" aria-hidden="true" tabindex="-1"></a>tar_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;AGE2018&#39;</span>, <span class="st">&#39;WG&#39;</span>, <span class="st">&#39;SP1&#39;</span>, <span class="st">&#39;SP2&#39;</span>,</span>
<span id="cb29-48"><a href="imputation.html#cb29-48" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;SpeciesGroup3&#39;</span>, <span class="st">&#39;SpeciesGroup2&#39;</span>)</span>
<span id="cb29-49"><a href="imputation.html#cb29-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-50"><a href="imputation.html#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="co"># add age and species variables to GRM data frame</span></span>
<span id="cb29-51"><a href="imputation.html#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(tar_vars)){</span>
<span id="cb29-52"><a href="imputation.html#cb29-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="st">&#39;AGE2018&#39;</span>){</span>
<span id="cb29-53"><a href="imputation.html#cb29-53" aria-hidden="true" tabindex="-1"></a>    dat_grm_imp <span class="sc">%&lt;&gt;%</span> <span class="fu">add_column</span>(</span>
<span id="cb29-54"><a href="imputation.html#cb29-54" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span>tar_vars[i] <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(</span>
<span id="cb29-55"><a href="imputation.html#cb29-55" aria-hidden="true" tabindex="-1"></a>        nni, </span>
<span id="cb29-56"><a href="imputation.html#cb29-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">1</span>, </span>
<span id="cb29-57"><a href="imputation.html#cb29-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb29-58"><a href="imputation.html#cb29-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mean</span>(dat_fri_scr[x, tar_vars[i]])</span>
<span id="cb29-59"><a href="imputation.html#cb29-59" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-60"><a href="imputation.html#cb29-60" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb29-61"><a href="imputation.html#cb29-61" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb29-62"><a href="imputation.html#cb29-62" aria-hidden="true" tabindex="-1"></a>    dat_grm_imp <span class="sc">%&lt;&gt;%</span> <span class="fu">add_column</span>(</span>
<span id="cb29-63"><a href="imputation.html#cb29-63" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span>tar_vars[i] <span class="sc">:</span><span class="er">=</span> <span class="fu">apply</span>(</span>
<span id="cb29-64"><a href="imputation.html#cb29-64" aria-hidden="true" tabindex="-1"></a>        nni, </span>
<span id="cb29-65"><a href="imputation.html#cb29-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">1</span>, </span>
<span id="cb29-66"><a href="imputation.html#cb29-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb29-67"><a href="imputation.html#cb29-67" aria-hidden="true" tabindex="-1"></a>          <span class="fu">getmode</span>(dat_fri_scr[x, tar_vars[i]])</span>
<span id="cb29-68"><a href="imputation.html#cb29-68" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-69"><a href="imputation.html#cb29-69" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb29-70"><a href="imputation.html#cb29-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-71"><a href="imputation.html#cb29-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-72"><a href="imputation.html#cb29-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-73"><a href="imputation.html#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="co"># update colnames</span></span>
<span id="cb29-74"><a href="imputation.html#cb29-74" aria-hidden="true" tabindex="-1"></a>dat_grm_imp <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">age =</span> AGE2018,</span>
<span id="cb29-75"><a href="imputation.html#cb29-75" aria-hidden="true" tabindex="-1"></a>                        <span class="at">class3 =</span> SpeciesGroup3,</span>
<span id="cb29-76"><a href="imputation.html#cb29-76" aria-hidden="true" tabindex="-1"></a>                        <span class="at">class5 =</span> SpeciesGroup2)</span>
<span id="cb29-77"><a href="imputation.html#cb29-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-78"><a href="imputation.html#cb29-78" aria-hidden="true" tabindex="-1"></a><span class="co"># add values back into main GRM data frame (missing values for polygons not</span></span>
<span id="cb29-79"><a href="imputation.html#cb29-79" aria-hidden="true" tabindex="-1"></a><span class="co"># included in the imputation)</span></span>
<span id="cb29-80"><a href="imputation.html#cb29-80" aria-hidden="true" tabindex="-1"></a>dat_grm <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dat_grm, dat_grm_imp)</span>
<span id="cb29-81"><a href="imputation.html#cb29-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-82"><a href="imputation.html#cb29-82" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate performance across imputation attributes</span></span>
<span id="cb29-83"><a href="imputation.html#cb29-83" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(vars)){</span>
<span id="cb29-84"><a href="imputation.html#cb29-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb29-85"><a href="imputation.html#cb29-85" aria-hidden="true" tabindex="-1"></a>      perf <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">variable =</span> vars[i],</span>
<span id="cb29-86"><a href="imputation.html#cb29-86" aria-hidden="true" tabindex="-1"></a>                           <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>),</span>
<span id="cb29-87"><a href="imputation.html#cb29-87" aria-hidden="true" tabindex="-1"></a>                           <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rrmsd</span>(dat_grm_imp[, vars[i]],</span>
<span id="cb29-88"><a href="imputation.html#cb29-88" aria-hidden="true" tabindex="-1"></a>                         dat_grm_imp[, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>)]),</span>
<span id="cb29-89"><a href="imputation.html#cb29-89" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">rmbe</span>(dat_grm_imp[, vars[i]],</span>
<span id="cb29-90"><a href="imputation.html#cb29-90" aria-hidden="true" tabindex="-1"></a>                         dat_grm_imp[, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>)])))</span>
<span id="cb29-91"><a href="imputation.html#cb29-91" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb29-92"><a href="imputation.html#cb29-92" aria-hidden="true" tabindex="-1"></a>      perf <span class="sc">%&lt;&gt;%</span> <span class="fu">add_row</span>(<span class="at">variable =</span> vars[i],</span>
<span id="cb29-93"><a href="imputation.html#cb29-93" aria-hidden="true" tabindex="-1"></a>                           <span class="at">metric =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>),</span>
<span id="cb29-94"><a href="imputation.html#cb29-94" aria-hidden="true" tabindex="-1"></a>                           <span class="at">value =</span> <span class="fu">c</span>(<span class="fu">rrmsd</span>(dat_grm_imp[, vars[i]],</span>
<span id="cb29-95"><a href="imputation.html#cb29-95" aria-hidden="true" tabindex="-1"></a>                         dat_grm_imp[, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>)]),</span>
<span id="cb29-96"><a href="imputation.html#cb29-96" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">rmbe</span>(dat_grm_imp[, vars[i]],</span>
<span id="cb29-97"><a href="imputation.html#cb29-97" aria-hidden="true" tabindex="-1"></a>                          dat_grm_imp[, <span class="fu">str_c</span>(vars[i], <span class="st">&#39;_imp&#39;</span>)])))</span>
<span id="cb29-98"><a href="imputation.html#cb29-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-99"><a href="imputation.html#cb29-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-100"><a href="imputation.html#cb29-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-101"><a href="imputation.html#cb29-101" aria-hidden="true" tabindex="-1"></a><span class="co"># round to two decimal places</span></span>
<span id="cb29-102"><a href="imputation.html#cb29-102" aria-hidden="true" tabindex="-1"></a>perf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">round</span>(value, <span class="dv">2</span>))</span>
<span id="cb29-103"><a href="imputation.html#cb29-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-104"><a href="imputation.html#cb29-104" aria-hidden="true" tabindex="-1"></a><span class="co"># factor so table displays nicely</span></span>
<span id="cb29-105"><a href="imputation.html#cb29-105" aria-hidden="true" tabindex="-1"></a>perf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">variable =</span> <span class="fu">factor</span>(variable, <span class="at">levels =</span> vars)) <span class="sc">%&gt;%</span></span>
<span id="cb29-106"><a href="imputation.html#cb29-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="fu">factor</span>(metric, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&#39;rrmsd (%)&#39;</span>, <span class="st">&#39;rmbe (%)&#39;</span>)))</span>
<span id="cb29-107"><a href="imputation.html#cb29-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-108"><a href="imputation.html#cb29-108" aria-hidden="true" tabindex="-1"></a><span class="co"># cast df</span></span>
<span id="cb29-109"><a href="imputation.html#cb29-109" aria-hidden="true" tabindex="-1"></a>perf_cast <span class="ot">&lt;-</span> <span class="fu">dcast</span>(perf, variable <span class="sc">~</span> metric)</span>
<span id="cb29-110"><a href="imputation.html#cb29-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-111"><a href="imputation.html#cb29-111" aria-hidden="true" tabindex="-1"></a><span class="co"># remove x and y</span></span>
<span id="cb29-112"><a href="imputation.html#cb29-112" aria-hidden="true" tabindex="-1"></a>perf_cast <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>)))</span>
<span id="cb29-113"><a href="imputation.html#cb29-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-114"><a href="imputation.html#cb29-114" aria-hidden="true" tabindex="-1"></a><span class="co"># display results of imputation rmsd</span></span>
<span id="cb29-115"><a href="imputation.html#cb29-115" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(perf_cast, <span class="at">caption =</span> <span class="st">&quot;Imputation Performance between FRI and GRM Forest Stand Polygons&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Imputation Performance between FRI and GRM Forest Stand Polygons</caption>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">rrmsd (%)</th>
<th align="right">rmbe (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">avg</td>
<td align="right">3.82</td>
<td align="right">0.05</td>
</tr>
<tr class="even">
<td align="left">sd</td>
<td align="right">4.05</td>
<td align="right">-0.46</td>
</tr>
<tr class="odd">
<td align="left">rumple</td>
<td align="right">2.65</td>
<td align="right">0.11</td>
</tr>
<tr class="even">
<td align="left">zpcum8</td>
<td align="right">0.86</td>
<td align="right">0.12</td>
</tr>
<tr class="odd">
<td align="left">red_edge_2</td>
<td align="right">2.09</td>
<td align="right">-0.12</td>
</tr>
</tbody>
</table>
<p><em>The RRMSD results are again all below ~4% and RMBE does not show bias toward negative of positive difference.</em></p>
</div>
<div id="imputationp4a" class="section level2 unnumbered hasAnchor">
<h2>4a. Figures of Forest Stand Age<a href="imputation.html#imputationp4a" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="imputation.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load GRM polygons</span></span>
<span id="cb30-2"><a href="imputation.html#cb30-2" aria-hidden="true" tabindex="-1"></a>poly_grm <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/segmentation/grm/shp/grm_10_01_05.shp&#39;</span>)</span>
<span id="cb30-3"><a href="imputation.html#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="imputation.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add new data frame to polygons</span></span>
<span id="cb30-5"><a href="imputation.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(poly_grm) <span class="ot">&lt;-</span> dat_grm</span>
<span id="cb30-6"><a href="imputation.html#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="imputation.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># save grm polygon output</span></span>
<span id="cb30-8"><a href="imputation.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">writeVector</span>(poly_grm, <span class="st">&#39;D:/ontario_inventory/imputation/example/grm_10_01_05_imp.shp&#39;</span>, <span class="at">overwrite =</span> T)</span>
<span id="cb30-9"><a href="imputation.html#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="imputation.html#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI polygons</span></span>
<span id="cb30-11"><a href="imputation.html#cb30-11" aria-hidden="true" tabindex="-1"></a>poly_fri <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Polygons Inventory/RMF_PolygonForest.shp&#39;</span>)</span>
<span id="cb30-12"><a href="imputation.html#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="imputation.html#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set age == 0 to NA</span></span>
<span id="cb30-14"><a href="imputation.html#cb30-14" aria-hidden="true" tabindex="-1"></a>poly_fri<span class="sc">$</span>AGE[poly_fri<span class="sc">$</span>AGE <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb30-15"><a href="imputation.html#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="imputation.html#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># load species group data -- calculated in separate code (can provide details)</span></span>
<span id="cb30-17"><a href="imputation.html#cb30-17" aria-hidden="true" tabindex="-1"></a>sp_group <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb30-18"><a href="imputation.html#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Polygons Inventory/RMF_PolygonForest_SPGROUP.shp&#39;</span></span>
<span id="cb30-19"><a href="imputation.html#cb30-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-20"><a href="imputation.html#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="imputation.html#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co"># load poly_fri dataframe</span></span>
<span id="cb30-22"><a href="imputation.html#cb30-22" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(poly_fri)</span>
<span id="cb30-23"><a href="imputation.html#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="imputation.html#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co"># change POLYID to numeric</span></span>
<span id="cb30-25"><a href="imputation.html#cb30-25" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">POLYID =</span> <span class="fu">as.numeric</span>(POLYID))</span>
<span id="cb30-26"><a href="imputation.html#cb30-26" aria-hidden="true" tabindex="-1"></a>sp_group <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">POLYID =</span> <span class="fu">as.numeric</span>(POLYID))</span>
<span id="cb30-27"><a href="imputation.html#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="imputation.html#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co"># rename species groups</span></span>
<span id="cb30-29"><a href="imputation.html#cb30-29" aria-hidden="true" tabindex="-1"></a>sp_group <span class="sc">%&lt;&gt;%</span> <span class="fu">rename</span>(<span class="at">class3 =</span> SpeciesGroup3, <span class="at">class5 =</span> SpeciesGroup2)</span>
<span id="cb30-30"><a href="imputation.html#cb30-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-31"><a href="imputation.html#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="co"># join to dat</span></span>
<span id="cb30-32"><a href="imputation.html#cb30-32" aria-hidden="true" tabindex="-1"></a>dat_fri <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dat_fri, </span>
<span id="cb30-33"><a href="imputation.html#cb30-33" aria-hidden="true" tabindex="-1"></a>                 sp_group <span class="sc">%&gt;%</span> <span class="fu">select</span>(POLYID, class3, class5), </span>
<span id="cb30-34"><a href="imputation.html#cb30-34" aria-hidden="true" tabindex="-1"></a>                 <span class="at">by =</span> <span class="st">&#39;POLYID&#39;</span>)</span>
<span id="cb30-35"><a href="imputation.html#cb30-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-36"><a href="imputation.html#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="co"># update age to 2018</span></span>
<span id="cb30-37"><a href="imputation.html#cb30-37" aria-hidden="true" tabindex="-1"></a>dat_fri<span class="sc">$</span>AGE2018 <span class="ot">&lt;-</span> <span class="dv">2018</span> <span class="sc">-</span> dat_fri<span class="sc">$</span>YRORG</span>
<span id="cb30-38"><a href="imputation.html#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="imputation.html#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="co"># re-input attributes into FRI polygons</span></span>
<span id="cb30-40"><a href="imputation.html#cb30-40" aria-hidden="true" tabindex="-1"></a><span class="fu">values</span>(poly_fri) <span class="ot">&lt;-</span> dat_fri</span>
<span id="cb30-41"><a href="imputation.html#cb30-41" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dat_fri)</span>
<span id="cb30-42"><a href="imputation.html#cb30-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-43"><a href="imputation.html#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="co"># since we only have values of age and species comp for dom_fom == yes</span></span>
<span id="cb30-44"><a href="imputation.html#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="co"># and p95 &gt;= 5 m we should only compare the screened FRI polygons that </span></span>
<span id="cb30-45"><a href="imputation.html#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="co"># contain those same attributes</span></span>
<span id="cb30-46"><a href="imputation.html#cb30-46" aria-hidden="true" tabindex="-1"></a>poly_fri<span class="sc">$</span>AGE2018[<span class="sc">!</span>(poly_fri<span class="sc">$</span>POLYID <span class="sc">%in%</span> dat_fri_scr<span class="sc">$</span>POLYID)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb30-47"><a href="imputation.html#cb30-47" aria-hidden="true" tabindex="-1"></a>poly_fri<span class="sc">$</span>class3[<span class="sc">!</span>(poly_fri<span class="sc">$</span>POLYID <span class="sc">%in%</span> dat_fri_scr<span class="sc">$</span>POLYID)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb30-48"><a href="imputation.html#cb30-48" aria-hidden="true" tabindex="-1"></a>poly_fri<span class="sc">$</span>class5[<span class="sc">!</span>(poly_fri<span class="sc">$</span>POLYID <span class="sc">%in%</span> dat_fri_scr<span class="sc">$</span>POLYID)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb30-49"><a href="imputation.html#cb30-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-50"><a href="imputation.html#cb30-50" aria-hidden="true" tabindex="-1"></a><span class="co"># create df to plot age</span></span>
<span id="cb30-51"><a href="imputation.html#cb30-51" aria-hidden="true" tabindex="-1"></a>grm_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_grm)</span>
<span id="cb30-52"><a href="imputation.html#cb30-52" aria-hidden="true" tabindex="-1"></a>fri_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(poly_fri)</span>
<span id="cb30-53"><a href="imputation.html#cb30-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-54"><a href="imputation.html#cb30-54" aria-hidden="true" tabindex="-1"></a><span class="co"># cut dfs</span></span>
<span id="cb30-55"><a href="imputation.html#cb30-55" aria-hidden="true" tabindex="-1"></a>grm_sf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age_cut =</span> <span class="fu">cut</span>(age, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">130</span>, <span class="dv">10</span>), <span class="dv">250</span>)))</span>
<span id="cb30-56"><a href="imputation.html#cb30-56" aria-hidden="true" tabindex="-1"></a>fri_sf <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">age_cut =</span> <span class="fu">cut</span>(AGE2018, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">130</span>, <span class="dv">10</span>), <span class="dv">250</span>)))</span>
<span id="cb30-57"><a href="imputation.html#cb30-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-58"><a href="imputation.html#cb30-58" aria-hidden="true" tabindex="-1"></a><span class="co"># plot age</span></span>
<span id="cb30-59"><a href="imputation.html#cb30-59" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grm_sf) <span class="sc">+</span></span>
<span id="cb30-60"><a href="imputation.html#cb30-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> age_cut), <span class="at">linewidth =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb30-61"><a href="imputation.html#cb30-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb30-62"><a href="imputation.html#cb30-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">viridis</span>(<span class="dv">14</span>), <span class="at">name =</span> <span class="st">&#39;Age&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb30-63"><a href="imputation.html#cb30-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb30-64"><a href="imputation.html#cb30-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Imputed Age of GRM </span><span class="sc">\n</span><span class="st">Segmented Forest Stands&#39;</span>) <span class="sc">+</span></span>
<span id="cb30-65"><a href="imputation.html#cb30-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb30-66"><a href="imputation.html#cb30-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-67"><a href="imputation.html#cb30-67" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fri_sf) <span class="sc">+</span></span>
<span id="cb30-68"><a href="imputation.html#cb30-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> age_cut), <span class="at">linewidth =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb30-69"><a href="imputation.html#cb30-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb30-70"><a href="imputation.html#cb30-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">viridis</span>(<span class="dv">14</span>), <span class="at">name =</span> <span class="st">&#39;Age&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb30-71"><a href="imputation.html#cb30-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb30-72"><a href="imputation.html#cb30-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Age of FRI </span><span class="sc">\n</span><span class="st">Forest Stands&#39;</span>) <span class="sc">+</span></span>
<span id="cb30-73"><a href="imputation.html#cb30-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb30-74"><a href="imputation.html#cb30-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-75"><a href="imputation.html#cb30-75" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="05-Imputation_files/figure-html/imputationp4a-1.png" width="1152" />
<em>Imputed age values show a similar spatial distribution to observed age values at a broad scale. Of course, the values should be scrutinized on a fine scale in specific areas. This task is much easier to do in a GIS software using the output shapefiles.</em></p>
</div>
<div id="imputationp4b" class="section level2 unnumbered hasAnchor">
<h2>4b. Figures of Three Functional Group Classification<a href="imputation.html#imputationp4b" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="imputation.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot three func group classification</span></span>
<span id="cb31-2"><a href="imputation.html#cb31-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grm_sf) <span class="sc">+</span></span>
<span id="cb31-3"><a href="imputation.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> class3), <span class="at">linewidth =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="imputation.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb31-5"><a href="imputation.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>, <span class="st">&#39;#ccbb44&#39;</span>), </span>
<span id="cb31-6"><a href="imputation.html#cb31-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&#39;Species Class&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb31-7"><a href="imputation.html#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb31-8"><a href="imputation.html#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Imputed Three Functional </span><span class="sc">\n</span><span class="st">Group Classification (GRM)&#39;</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="imputation.html#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb31-10"><a href="imputation.html#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="imputation.html#cb31-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fri_sf) <span class="sc">+</span></span>
<span id="cb31-12"><a href="imputation.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> class3), <span class="at">linewidth =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb31-13"><a href="imputation.html#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb31-14"><a href="imputation.html#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>, <span class="st">&#39;#ccbb44&#39;</span>), </span>
<span id="cb31-15"><a href="imputation.html#cb31-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&#39;Species Class&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb31-16"><a href="imputation.html#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb31-17"><a href="imputation.html#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Three Functional </span><span class="sc">\n</span><span class="st">Group Classification (FRI)&#39;</span>) <span class="sc">+</span></span>
<span id="cb31-18"><a href="imputation.html#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb31-19"><a href="imputation.html#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="imputation.html#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="05-Imputation_files/figure-html/imputationp4b-1.png" width="1152" />
<em>We can also observe a similar distribution of species classes.</em></p>
</div>
<div id="imputationp4c" class="section level2 unnumbered hasAnchor">
<h2>4c. Figures of Five Functional Group Classification<a href="imputation.html#imputationp4c" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="imputation.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot five func group classification</span></span>
<span id="cb32-2"><a href="imputation.html#cb32-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grm_sf) <span class="sc">+</span></span>
<span id="cb32-3"><a href="imputation.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> class5), <span class="at">linewidth =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb32-4"><a href="imputation.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb32-5"><a href="imputation.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#ccbb44&#39;</span>, <span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#4477aa&#39;</span>,</span>
<span id="cb32-6"><a href="imputation.html#cb32-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;#ee6677&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>), </span>
<span id="cb32-7"><a href="imputation.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&#39;Species Class&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb32-8"><a href="imputation.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="imputation.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Imputed Five Functional </span><span class="sc">\n</span><span class="st">Group Classification (GRM)&#39;</span>) <span class="sc">+</span></span>
<span id="cb32-10"><a href="imputation.html#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb32-11"><a href="imputation.html#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="imputation.html#cb32-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fri_sf) <span class="sc">+</span></span>
<span id="cb32-13"><a href="imputation.html#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> class5), <span class="at">linewidth =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb32-14"><a href="imputation.html#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>() <span class="sc">+</span></span>
<span id="cb32-15"><a href="imputation.html#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#ccbb44&#39;</span>, <span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#4477aa&#39;</span>,</span>
<span id="cb32-16"><a href="imputation.html#cb32-16" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;#ee6677&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>), </span>
<span id="cb32-17"><a href="imputation.html#cb32-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">name =</span> <span class="st">&#39;Species Class&#39;</span>, <span class="at">na.translate =</span> F) <span class="sc">+</span></span>
<span id="cb32-18"><a href="imputation.html#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb32-19"><a href="imputation.html#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Five Functional </span><span class="sc">\n</span><span class="st">Group Classification (FRI)&#39;</span>) <span class="sc">+</span></span>
<span id="cb32-20"><a href="imputation.html#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb32-21"><a href="imputation.html#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="imputation.html#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="05-Imputation_files/figure-html/imputationp4c-1.png" width="1152" /></p>
</div>
<div id="imputationp4d" class="section level2 unnumbered hasAnchor">
<h2>4d. Density Plots of Forest Stand Age<a href="imputation.html#imputationp4d" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="imputation.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># density plots of age</span></span>
<span id="cb33-2"><a href="imputation.html#cb33-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_grm, <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb33-3"><a href="imputation.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="imputation.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(age, <span class="at">na.rm =</span> T)),</span>
<span id="cb33-5"><a href="imputation.html#cb33-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb33-6"><a href="imputation.html#cb33-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="imputation.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb33-8"><a href="imputation.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.02</span>)) <span class="sc">+</span></span>
<span id="cb33-9"><a href="imputation.html#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-10"><a href="imputation.html#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Age&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-11"><a href="imputation.html#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="imputation.html#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Imputed Age of GRM Segmented Forest Stands&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-13"><a href="imputation.html#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb33-14"><a href="imputation.html#cb33-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>))</span>
<span id="cb33-15"><a href="imputation.html#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="imputation.html#cb33-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">as.data.frame</span>(poly_fri), <span class="fu">aes</span>(<span class="at">x =</span> AGE2018)) <span class="sc">+</span></span>
<span id="cb33-17"><a href="imputation.html#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-18"><a href="imputation.html#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(AGE2018, <span class="at">na.rm =</span> T)),</span>
<span id="cb33-19"><a href="imputation.html#cb33-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb33-20"><a href="imputation.html#cb33-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb33-21"><a href="imputation.html#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb33-22"><a href="imputation.html#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.02</span>)) <span class="sc">+</span></span>
<span id="cb33-23"><a href="imputation.html#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-24"><a href="imputation.html#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Age&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-25"><a href="imputation.html#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-26"><a href="imputation.html#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Age of FRI Forest Stands&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-27"><a href="imputation.html#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>),</span>
<span id="cb33-28"><a href="imputation.html#cb33-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>))</span>
<span id="cb33-29"><a href="imputation.html#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="imputation.html#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="05-Imputation_files/figure-html/imputationp4d-1.png" width="1728" />
<em>The distribution of imputed age in GRM polygons closely matches that of observed age in FRI polygons. The median age values (dotted lines) are 78 (GRM) and 83 (FRI).</em></p>
</div>
<div id="imputationp4e" class="section level2 unnumbered hasAnchor">
<h2>4e. Distribution of Three Functional Group Classification<a href="imputation.html#imputationp4e" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="imputation.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for GRM 3 classes</span></span>
<span id="cb34-2"><a href="imputation.html#cb34-2" aria-hidden="true" tabindex="-1"></a>dat_grm_c3 <span class="ot">&lt;-</span> dat_grm <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="imputation.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(class3) <span class="sc">%&gt;%</span>  </span>
<span id="cb34-4"><a href="imputation.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(class3) <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb34-5"><a href="imputation.html#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(class3)) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="imputation.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(.<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="imputation.html#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ypos =</span> <span class="fu">cumsum</span>(prop) <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>prop) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="imputation.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lbl =</span> <span class="fu">round</span>(prop))</span>
<span id="cb34-9"><a href="imputation.html#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="imputation.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for FRI 3 classes</span></span>
<span id="cb34-11"><a href="imputation.html#cb34-11" aria-hidden="true" tabindex="-1"></a>dat_fri_c3 <span class="ot">&lt;-</span> poly_fri <span class="sc">%&gt;%</span> as.data.frame <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="imputation.html#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(class3) <span class="sc">%&gt;%</span>  </span>
<span id="cb34-13"><a href="imputation.html#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(class3) <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb34-14"><a href="imputation.html#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(class3)) <span class="sc">%&gt;%</span></span>
<span id="cb34-15"><a href="imputation.html#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(.<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-16"><a href="imputation.html#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ypos =</span> <span class="fu">cumsum</span>(prop) <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>prop) <span class="sc">%&gt;%</span></span>
<span id="cb34-17"><a href="imputation.html#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lbl =</span> <span class="fu">round</span>(prop))</span>
<span id="cb34-18"><a href="imputation.html#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="imputation.html#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb34-20"><a href="imputation.html#cb34-20" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_grm_c3, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> prop, <span class="at">fill =</span> class3)) <span class="sc">+</span></span>
<span id="cb34-21"><a href="imputation.html#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-22"><a href="imputation.html#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb34-23"><a href="imputation.html#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb34-24"><a href="imputation.html#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> ypos, <span class="at">label =</span> <span class="fu">str_c</span>(lbl, <span class="st">&quot;%&quot;</span>)), <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb34-25"><a href="imputation.html#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb34-26"><a href="imputation.html#cb34-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb34-27"><a href="imputation.html#cb34-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb34-28"><a href="imputation.html#cb34-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb34-29"><a href="imputation.html#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>, <span class="st">&#39;#ccbb44&#39;</span>)) <span class="sc">+</span></span>
<span id="cb34-30"><a href="imputation.html#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-31"><a href="imputation.html#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Imputed Three Functional </span><span class="sc">\n</span><span class="st">Group Classification (GRM)&quot;</span>)</span>
<span id="cb34-32"><a href="imputation.html#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="imputation.html#cb34-33" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_fri_c3, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> prop, <span class="at">fill =</span> class3)) <span class="sc">+</span></span>
<span id="cb34-34"><a href="imputation.html#cb34-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-35"><a href="imputation.html#cb34-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb34-36"><a href="imputation.html#cb34-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb34-37"><a href="imputation.html#cb34-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> ypos, <span class="at">label =</span> <span class="fu">str_c</span>(lbl, <span class="st">&quot;%&quot;</span>)), <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb34-38"><a href="imputation.html#cb34-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb34-39"><a href="imputation.html#cb34-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb34-40"><a href="imputation.html#cb34-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb34-41"><a href="imputation.html#cb34-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb34-42"><a href="imputation.html#cb34-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>, <span class="st">&#39;#ccbb44&#39;</span>)) <span class="sc">+</span></span>
<span id="cb34-43"><a href="imputation.html#cb34-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-44"><a href="imputation.html#cb34-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Three Functional Group </span><span class="sc">\n</span><span class="st">Classification (FRI)&quot;</span>)</span>
<span id="cb34-45"><a href="imputation.html#cb34-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-46"><a href="imputation.html#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="05-Imputation_files/figure-html/imputationp4e-1.png" width="1728" />
<em>The distribution of three functional groups is equal in the hardwood class (20%). The distribution of mixedwood and softwood is slightly different in the imputed values, with 3% more softwood, and thus 3% less mixedwood.</em></p>
</div>
<div id="imputationp4f" class="section level2 unnumbered hasAnchor">
<h2>4f. Distribution of Five Functional Group Classification<a href="imputation.html#imputationp4f" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="imputation.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution of 5 species classes</span></span>
<span id="cb35-2"><a href="imputation.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for GRM 5 classes</span></span>
<span id="cb35-3"><a href="imputation.html#cb35-3" aria-hidden="true" tabindex="-1"></a>dat_grm_c5 <span class="ot">&lt;-</span> dat_grm <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="imputation.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(class5) <span class="sc">%&gt;%</span>  </span>
<span id="cb35-5"><a href="imputation.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(class5) <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb35-6"><a href="imputation.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(class5)) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="imputation.html#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(.<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="imputation.html#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ypos =</span> <span class="fu">cumsum</span>(prop) <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>prop) <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="imputation.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lbl =</span> <span class="fu">round</span>(prop))</span>
<span id="cb35-10"><a href="imputation.html#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="imputation.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create data frame for FRI 5 classes</span></span>
<span id="cb35-12"><a href="imputation.html#cb35-12" aria-hidden="true" tabindex="-1"></a>dat_fri_c5 <span class="ot">&lt;-</span> poly_fri <span class="sc">%&gt;%</span> as.data.frame <span class="sc">%&gt;%</span></span>
<span id="cb35-13"><a href="imputation.html#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(class5) <span class="sc">%&gt;%</span>  </span>
<span id="cb35-14"><a href="imputation.html#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(class5) <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb35-15"><a href="imputation.html#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(class5)) <span class="sc">%&gt;%</span></span>
<span id="cb35-16"><a href="imputation.html#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(.<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-17"><a href="imputation.html#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ypos =</span> <span class="fu">cumsum</span>(prop) <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>prop) <span class="sc">%&gt;%</span></span>
<span id="cb35-18"><a href="imputation.html#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lbl =</span> <span class="fu">round</span>(prop))</span>
<span id="cb35-19"><a href="imputation.html#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="imputation.html#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb35-21"><a href="imputation.html#cb35-21" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_grm_c5, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> prop, <span class="at">fill =</span> class5)) <span class="sc">+</span></span>
<span id="cb35-22"><a href="imputation.html#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-23"><a href="imputation.html#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb35-24"><a href="imputation.html#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb35-25"><a href="imputation.html#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> ypos, <span class="at">label =</span> <span class="fu">str_c</span>(lbl, <span class="st">&quot;%&quot;</span>)), <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb35-26"><a href="imputation.html#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb35-27"><a href="imputation.html#cb35-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb35-28"><a href="imputation.html#cb35-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb35-29"><a href="imputation.html#cb35-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb35-30"><a href="imputation.html#cb35-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#ccbb44&#39;</span>, <span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#4477aa&#39;</span>,</span>
<span id="cb35-31"><a href="imputation.html#cb35-31" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;#ee6677&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>)) <span class="sc">+</span></span>
<span id="cb35-32"><a href="imputation.html#cb35-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-33"><a href="imputation.html#cb35-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Imputed Five Functional </span><span class="sc">\n</span><span class="st">Group Classification (GRM)&quot;</span>)</span>
<span id="cb35-34"><a href="imputation.html#cb35-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-35"><a href="imputation.html#cb35-35" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_fri_c5, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> prop, <span class="at">fill =</span> class5)) <span class="sc">+</span></span>
<span id="cb35-36"><a href="imputation.html#cb35-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-37"><a href="imputation.html#cb35-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">&quot;y&quot;</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb35-38"><a href="imputation.html#cb35-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb35-39"><a href="imputation.html#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> ypos, <span class="at">label =</span> <span class="fu">str_c</span>(lbl, <span class="st">&quot;%&quot;</span>)), <span class="at">size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb35-40"><a href="imputation.html#cb35-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">30</span>),</span>
<span id="cb35-41"><a href="imputation.html#cb35-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb35-42"><a href="imputation.html#cb35-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb35-43"><a href="imputation.html#cb35-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb35-44"><a href="imputation.html#cb35-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&#39;#ccbb44&#39;</span>, <span class="st">&#39;#228833&#39;</span>, <span class="st">&#39;#4477aa&#39;</span>,</span>
<span id="cb35-45"><a href="imputation.html#cb35-45" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&#39;#ee6677&#39;</span>, <span class="st">&#39;#aa3377&#39;</span>)) <span class="sc">+</span></span>
<span id="cb35-46"><a href="imputation.html#cb35-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-47"><a href="imputation.html#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Five Functional Group </span><span class="sc">\n</span><span class="st">Classification (FRI)&quot;</span>)</span>
<span id="cb35-48"><a href="imputation.html#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="imputation.html#cb35-49" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="05-Imputation_files/figure-html/imputationp4f-1.png" width="1728" />
<em>The distribution of imputed five classes of species is also very similar to the FRI distribution. The imputed values contain slightly more black spruce dominated stands (3% more than the FRI) and mixedwood stands (1% more than the FRI), and slightly less mixed conifers and jack pine dominated.</em></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="segmentation-update.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
