<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Segmentation Example | Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework</title>
  <meta name="description" content="A place to find background information and follow updates related to the project." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Segmentation Example | Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A place to find background information and follow updates related to the project." />
  <meta name="github-repo" content="bermane/ontario-inventory" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Segmentation Example | Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework" />
  
  <meta name="twitter:description" content="A place to find background information and follow updates related to the project." />
  

<meta name="author" content="Ethan Berman" />


<meta name="date" content="2023-03-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="project-details.html"/>
<link rel="next" href="segmentation-update.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Integration of Photo Interpreted and LiDAR Attributes Into a Polygonal Forest Inventory Framework</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#summary"><i class="fa fa-check"></i>Project Summary</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#partners"><i class="fa fa-check"></i>Project Partners</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html"><i class="fa fa-check"></i>People</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ubc"><i class="fa fa-check"></i>University of British Columbia</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ncc"><i class="fa fa-check"></i>Prof.Â Nicholas Coops, <em>project lead</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#eb"><i class="fa fa-check"></i>Ethan Berman, <em>research scientist</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#greenfirst"><i class="fa fa-check"></i>GreenFirst Forest Products</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#cm"><i class="fa fa-check"></i>Chris McDonell, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#gm"><i class="fa fa-check"></i>Grant McCartney, <em>partner</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ministry"><i class="fa fa-check"></i>Ontario Ministry of Northern Development, Mines, Natural Resources and Forestry</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#is"><i class="fa fa-check"></i>Ian Sinclair, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#dl"><i class="fa fa-check"></i>Derek Landry, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#grm"><i class="fa fa-check"></i>Geordie Robere-McGugan, <em>partner</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html"><i class="fa fa-check"></i>Project Details</a>
<ul>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#objective"><i class="fa fa-check"></i>Objective</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#themes"><i class="fa fa-check"></i>Themes</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#description"><i class="fa fa-check"></i>Description</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#design"><i class="fa fa-check"></i>Design</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#methodology"><i class="fa fa-check"></i>Methodology</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#schedule"><i class="fa fa-check"></i>Schedule</a>
<ul>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#project-dates"><i class="fa fa-check"></i>Project Dates</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#knowledge-transfer"><i class="fa fa-check"></i>Knowledge &amp; Technology Transfer</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html"><i class="fa fa-check"></i>Segmentation Example</a>
<ul>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#intro"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#create-raster"><i class="fa fa-check"></i>Create Multi-band Raster</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#run-segmentation"><i class="fa fa-check"></i>Run Mean Shift Segmentation</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#compare-datasets"><i class="fa fa-check"></i>Compare Datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html"><i class="fa fa-check"></i>Segmentation Update</a>
<ul>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#intro"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#updatep1"><i class="fa fa-check"></i>1. Create Multi-band Raster</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#updatep2"><i class="fa fa-check"></i>2. Run GRM Segmentation</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#updatep3a"><i class="fa fa-check"></i>3a. Calculate Summary Statistics</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#updatep3b"><i class="fa fa-check"></i>3b. Compare GRM Segmentation Output to FRI</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html"><i class="fa fa-check"></i>Imputation</a>
<ul>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#intro"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp1"><i class="fa fa-check"></i>1. Extract LiDAR attributes in FRI polygons and GRM polygons</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp1a"><i class="fa fa-check"></i>1a. Extract attributes in FRI polygons</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp1b"><i class="fa fa-check"></i>1b. Extract attributes in GRM segmented polygons</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp2"><i class="fa fa-check"></i>2. Screen FRI polygons to curate an optimal dataset to use for imputation</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp3"><i class="fa fa-check"></i>3. Run imputation on FRI polygons ONLY to assess imputation performance</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp3a"><i class="fa fa-check"></i>3a. Create functions needed</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp3b"><i class="fa fa-check"></i>3b. Run the imputation and assess performance</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4"><i class="fa fa-check"></i>4. Run imputation between FRI and GRM polygons to derive estimates of age and species composition</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4a"><i class="fa fa-check"></i>4a. Figures of Forest Stand Age</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4b"><i class="fa fa-check"></i>4b. Figures of Three Functional Group Classification</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4c"><i class="fa fa-check"></i>4c. Figures of Five Functional Group Classification</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4d"><i class="fa fa-check"></i>4d. Density Plots of Forest Stand Age</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4e"><i class="fa fa-check"></i>4e. Distribution of Three Functional Group Classification</a></li>
<li class="chapter" data-level="" data-path="imputation.html"><a href="imputation.html#imputationp4f"><i class="fa fa-check"></i>4f. Distribution of Five Functional Group Classification</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="segmentation-example" class="section level1 unnumbered hasAnchor">
<h1>Segmentation Example<a href="segmentation-example.html#segmentation-example" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="intro" class="section level2 unnumbered hasAnchor">
<h2>Intro<a href="segmentation-example.html#intro" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This page provides an example of the image segmentation approach used to derive polygonal forest stands from LiDAR-based raster data. The example data provided is from the Romeo Malette Forest (RMF).</p>
<p>First, a three band raster at 20 m spatial resolution is generated from Enhanced Forest Inventory (EFI) metrics. The three bands comprise Loreyâs height, canopy cover (% cover above 2m) and coefficient of variation (standard deviation of LiDAR return heights divided by mean). These bands are re-scaled to comprise values from 0-100, setting the minimum and maximum values to be the 1st and 99th percentile of data observations. Large roads and waterbodies are also masked to prevent them from being included in forest stand polygons.</p>
<p>Second, the mean shift algorithm is used to derive forest stand polygons from the input raster. The algorithm used is the <a href="https://www.orfeo-toolbox.org/CookBook-6.4/Applications/app_LargeScaleMeanShift.html">LargeScaleMeanShift</a> function from Orfeo ToolBox. Mean Shift is a robust and efficient segmentation algorithm that allows users to provide several parameters to ensure the output polygons meet certain specifications (input parameters described in above link). Although this example only runs the segmentation over a small part of the RMF, segmentation of the entire RMF only takes around 1.5 hrs on a single desktop machine.</p>
<p>Third, the output segmentation is compared to polygons derived from manual interpretation.</p>
</div>
<div id="create-raster" class="section level2 unnumbered hasAnchor">
<h2>Create Multi-band Raster<a href="segmentation-example.html#create-raster" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="segmentation-example.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb1-2"><a href="segmentation-example.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-3"><a href="segmentation-example.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(meanShiftR)</span>
<span id="cb1-4"><a href="segmentation-example.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="segmentation-example.html#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="segmentation-example.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># load file names of SPL rasters to stack</span></span>
<span id="cb1-7"><a href="segmentation-example.html#cb1-7" aria-hidden="true" tabindex="-1"></a>lor <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/ABA layers SPL 2018/RMF_20m_T130cm_lor.tif&#39;</span></span>
<span id="cb1-8"><a href="segmentation-example.html#cb1-8" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_2m_cov.tif&#39;</span></span>
<span id="cb1-9"><a href="segmentation-example.html#cb1-9" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_cv.tif&#39;</span></span>
<span id="cb1-10"><a href="segmentation-example.html#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="segmentation-example.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># stack rasters</span></span>
<span id="cb1-12"><a href="segmentation-example.html#cb1-12" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">c</span>(lor, cc, cv))</span>
<span id="cb1-13"><a href="segmentation-example.html#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="segmentation-example.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># load RMF shapefile along with sample to be used for example</span></span>
<span id="cb1-15"><a href="segmentation-example.html#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># reproject to match raster</span></span>
<span id="cb1-16"><a href="segmentation-example.html#cb1-16" aria-hidden="true" tabindex="-1"></a>rmf <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Land ownership/RMF_Ownership.shp&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="segmentation-example.html#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., spl)</span>
<span id="cb1-18"><a href="segmentation-example.html#cb1-18" aria-hidden="true" tabindex="-1"></a>rmf_samp <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_Sample.shp&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-19"><a href="segmentation-example.html#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., spl)</span>
<span id="cb1-20"><a href="segmentation-example.html#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="segmentation-example.html#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plot RMF overlaid with example</span></span>
<span id="cb1-22"><a href="segmentation-example.html#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmf, <span class="at">col =</span> <span class="st">&#39;grey&#39;</span>,</span>
<span id="cb1-23"><a href="segmentation-example.html#cb1-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&#39;Romeo Malette Forest with Sample Area in Red&#39;</span>)</span>
<span id="cb1-24"><a href="segmentation-example.html#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmf_samp, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">add =</span> T)</span></code></pre></div>
<p><img src="03-Segmentation_files/figure-html/create-raster-1.png" width="1728" /></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="segmentation-example.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crop raster stack to sample area</span></span>
<span id="cb2-2"><a href="segmentation-example.html#cb2-2" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> <span class="fu">crop</span>(spl, rmf_samp)</span>
<span id="cb2-3"><a href="segmentation-example.html#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="segmentation-example.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># apply smoothing function on 5 cell square</span></span>
<span id="cb2-5"><a href="segmentation-example.html#cb2-5" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">focal</span>(spl[[<span class="dv">1</span>]], <span class="at">w=</span><span class="dv">5</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)</span>
<span id="cb2-6"><a href="segmentation-example.html#cb2-6" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">focal</span>(spl[[<span class="dv">2</span>]], <span class="at">w=</span><span class="dv">5</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)</span>
<span id="cb2-7"><a href="segmentation-example.html#cb2-7" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">focal</span>(spl[[<span class="dv">3</span>]], <span class="at">w=</span><span class="dv">5</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)</span>
<span id="cb2-8"><a href="segmentation-example.html#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="segmentation-example.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># load roads and waterbodies</span></span>
<span id="cb2-10"><a href="segmentation-example.html#cb2-10" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Roads/RMF_roads.shp&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="segmentation-example.html#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., spl)</span>
<span id="cb2-12"><a href="segmentation-example.html#cb2-12" aria-hidden="true" tabindex="-1"></a>waterb <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Lakes and rivers/RMF_waterbodies.shp&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="segmentation-example.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., spl)</span>
<span id="cb2-14"><a href="segmentation-example.html#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="segmentation-example.html#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># subset roads to only mask the main types used by interpreter</span></span>
<span id="cb2-16"><a href="segmentation-example.html#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># RDTYPE = H, P, B</span></span>
<span id="cb2-17"><a href="segmentation-example.html#cb2-17" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> roads[roads<span class="sc">$</span>RDTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;H&#39;</span>, <span class="st">&#39;P&#39;</span>, <span class="st">&#39;B&#39;</span>),]</span>
<span id="cb2-18"><a href="segmentation-example.html#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="segmentation-example.html#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># mask road and water body pixels to NA</span></span>
<span id="cb2-20"><a href="segmentation-example.html#cb2-20" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> spl <span class="sc">%&gt;%</span> </span>
<span id="cb2-21"><a href="segmentation-example.html#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(., roads, <span class="at">inverse =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb2-22"><a href="segmentation-example.html#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mask</span>(., waterb, <span class="at">inverse =</span> T)</span>
<span id="cb2-23"><a href="segmentation-example.html#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="segmentation-example.html#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># if any band is missing values set all to NA</span></span>
<span id="cb2-25"><a href="segmentation-example.html#cb2-25" aria-hidden="true" tabindex="-1"></a>spl[<span class="fu">is.na</span>(spl[[<span class="dv">1</span>]])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-26"><a href="segmentation-example.html#cb2-26" aria-hidden="true" tabindex="-1"></a>spl[<span class="fu">is.na</span>(spl[[<span class="dv">2</span>]])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-27"><a href="segmentation-example.html#cb2-27" aria-hidden="true" tabindex="-1"></a>spl[<span class="fu">is.na</span>(spl[[<span class="dv">3</span>]])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-28"><a href="segmentation-example.html#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="segmentation-example.html#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co"># create function to rescale values from 0 to 100 using 1 and 99 percentile</span></span>
<span id="cb2-30"><a href="segmentation-example.html#cb2-30" aria-hidden="true" tabindex="-1"></a>scale_100 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb2-31"><a href="segmentation-example.html#cb2-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-32"><a href="segmentation-example.html#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate 1st and 99th percentile of input raster</span></span>
<span id="cb2-33"><a href="segmentation-example.html#cb2-33" aria-hidden="true" tabindex="-1"></a>  perc <span class="ot">&lt;-</span> <span class="fu">values</span>(x, <span class="at">mat=</span>F) <span class="sc">%&gt;%</span> <span class="fu">quantile</span>(., <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb2-34"><a href="segmentation-example.html#cb2-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-35"><a href="segmentation-example.html#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rescale raster using 1st and 99th %</span></span>
<span id="cb2-36"><a href="segmentation-example.html#cb2-36" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> (x<span class="sc">-</span>perc[<span class="dv">1</span>])<span class="sc">/</span>(perc[<span class="dv">2</span>] <span class="sc">-</span> perc[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb2-37"><a href="segmentation-example.html#cb2-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-38"><a href="segmentation-example.html#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#reset values below 0 and above 100</span></span>
<span id="cb2-39"><a href="segmentation-example.html#cb2-39" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-40"><a href="segmentation-example.html#cb2-40" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">&gt;</span> <span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-41"><a href="segmentation-example.html#cb2-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-42"><a href="segmentation-example.html#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb2-43"><a href="segmentation-example.html#cb2-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-44"><a href="segmentation-example.html#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="segmentation-example.html#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co"># rescale rasters from 0 to 100</span></span>
<span id="cb2-46"><a href="segmentation-example.html#cb2-46" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">scale_100</span>(spl[[<span class="dv">1</span>]])</span>
<span id="cb2-47"><a href="segmentation-example.html#cb2-47" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">scale_100</span>(spl[[<span class="dv">2</span>]])</span>
<span id="cb2-48"><a href="segmentation-example.html#cb2-48" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">scale_100</span>(spl[[<span class="dv">3</span>]])</span>
<span id="cb2-49"><a href="segmentation-example.html#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="segmentation-example.html#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co"># plot raster layers</span></span>
<span id="cb2-51"><a href="segmentation-example.html#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spl[[<span class="dv">1</span>]], <span class="at">main =</span> <span class="st">&quot;Lorey&#39;s Height (scaled 0-100)&quot;</span>)</span></code></pre></div>
<p><img src="03-Segmentation_files/figure-html/create-raster-2.png" width="1728" /></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="segmentation-example.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spl[[<span class="dv">2</span>]], <span class="at">main =</span> <span class="st">&quot;Canopy Cover (scaled 0-100)&quot;</span>)</span></code></pre></div>
<p><img src="03-Segmentation_files/figure-html/create-raster-3.png" width="1728" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="segmentation-example.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spl[[<span class="dv">3</span>]], <span class="at">main =</span> <span class="st">&quot;Coefficient of Variation (scaled 0-100)&quot;</span>)</span></code></pre></div>
<p><img src="03-Segmentation_files/figure-html/create-raster-4.png" width="1728" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="segmentation-example.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write raster to tif</span></span>
<span id="cb5-2"><a href="segmentation-example.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(spl, <span class="at">filename=</span><span class="st">&#39;D:/ontario_inventory/segmentation_ex/spl_stack.tif&#39;</span>, <span class="at">overwrite=</span>T)</span></code></pre></div>
</div>
<div id="run-segmentation" class="section level2 unnumbered hasAnchor">
<h2>Run Mean Shift Segmentation<a href="segmentation-example.html#run-segmentation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="segmentation-example.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set working directory where temp files will be output</span></span>
<span id="cb6-2"><a href="segmentation-example.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&#39;D:/temp&#39;</span>)</span>
<span id="cb6-3"><a href="segmentation-example.html#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="segmentation-example.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create function to run mean shift</span></span>
<span id="cb6-5"><a href="segmentation-example.html#cb6-5" aria-hidden="true" tabindex="-1"></a>meanshift_otb <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">otb_path =</span> <span class="st">&quot;&quot;</span>, <span class="at">raster_in =</span> <span class="st">&quot;&quot;</span>, <span class="at">out_path =</span> <span class="st">&quot;&quot;</span>, <span class="at">name =</span><span class="st">&quot;&quot;</span>, <span class="at">spatialr =</span> <span class="st">&quot;10&quot;</span>,</span>
<span id="cb6-6"><a href="segmentation-example.html#cb6-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">ranger =</span> <span class="st">&quot;10&quot;</span>, <span class="at">minsize =</span> <span class="st">&quot;100&quot;</span>, <span class="at">tilesizex =</span> <span class="st">&quot;500&quot;</span>, <span class="at">tilesizey =</span> <span class="st">&quot;500&quot;</span>,</span>
<span id="cb6-7"><a href="segmentation-example.html#cb6-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">outmode =</span> <span class="st">&quot;vector&quot;</span>, <span class="at">cleanup =</span> <span class="st">&quot;true&quot;</span>, <span class="at">ram =</span> <span class="st">&quot;256&quot;</span>){</span>
<span id="cb6-8"><a href="segmentation-example.html#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set configuration</span></span>
<span id="cb6-9"><a href="segmentation-example.html#cb6-9" aria-hidden="true" tabindex="-1"></a>  conf <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;-in&quot;</span>, raster_in, <span class="st">&quot;-spatialr&quot;</span>, spatialr, <span class="st">&quot;-ranger&quot;</span>, ranger,</span>
<span id="cb6-10"><a href="segmentation-example.html#cb6-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;-minsize&quot;</span>, minsize, <span class="st">&quot;-tilesizex&quot;</span>, tilesizex, <span class="st">&quot;-tilesizey&quot;</span>, tilesizey,</span>
<span id="cb6-11"><a href="segmentation-example.html#cb6-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;-mode&quot;</span>, outmode, <span class="st">&quot;-mode.vector.out&quot;</span>, <span class="fu">paste</span>(out_path, <span class="st">&quot;/&quot;</span>, name, <span class="st">&quot;.shp&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb6-12"><a href="segmentation-example.html#cb6-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;-cleanup&quot;</span>, cleanup,<span class="st">&quot;-ram&quot;</span>, ram)</span>
<span id="cb6-13"><a href="segmentation-example.html#cb6-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-14"><a href="segmentation-example.html#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># apply function in command line</span></span>
<span id="cb6-15"><a href="segmentation-example.html#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="fu">paste</span>(otb_path, <span class="st">&quot;/otbcli_LargeScaleMeanShift&quot;</span>, <span class="st">&quot; &quot;</span>, conf, <span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">intern=</span>T)</span>
<span id="cb6-16"><a href="segmentation-example.html#cb6-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-17"><a href="segmentation-example.html#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save configuration for further use</span></span>
<span id="cb6-18"><a href="segmentation-example.html#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(<span class="at">x =</span> conf,<span class="at">file =</span> <span class="fu">paste</span>(out_path,<span class="st">&quot;/&quot;</span>,name,<span class="st">&quot;_conf.txt&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),<span class="at">row.names =</span> F, <span class="at">col.names =</span> F)</span>
<span id="cb6-19"><a href="segmentation-example.html#cb6-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-20"><a href="segmentation-example.html#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="segmentation-example.html#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># run mean shift</span></span>
<span id="cb6-22"><a href="segmentation-example.html#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="fu">meanshift_otb</span>(<span class="at">otb_path =</span> <span class="st">&quot;C:/OTB/bin&quot;</span>,</span>
<span id="cb6-23"><a href="segmentation-example.html#cb6-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">raster_in =</span> <span class="st">&#39;D:/ontario_inventory/segmentation_ex/spl_stack.tif&#39;</span>,</span>
<span id="cb6-24"><a href="segmentation-example.html#cb6-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">out_path =</span> <span class="st">&quot;D:/ontario_inventory/segmentation_ex&quot;</span>,</span>
<span id="cb6-25"><a href="segmentation-example.html#cb6-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">name =</span> <span class="st">&quot;ms_10_10_100&quot;</span>,</span>
<span id="cb6-26"><a href="segmentation-example.html#cb6-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">spatialr =</span> <span class="st">&quot;10&quot;</span>,</span>
<span id="cb6-27"><a href="segmentation-example.html#cb6-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">ranger =</span> <span class="st">&quot;10&quot;</span>,</span>
<span id="cb6-28"><a href="segmentation-example.html#cb6-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">minsize =</span> <span class="st">&quot;100&quot;</span>,</span>
<span id="cb6-29"><a href="segmentation-example.html#cb6-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">ram =</span> <span class="st">&quot;1024&quot;</span>)</span>
<span id="cb6-30"><a href="segmentation-example.html#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="segmentation-example.html#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># since mean shift segments missing values into polygons of 1 pixel, aggregate into single polygon</span></span>
<span id="cb6-32"><a href="segmentation-example.html#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># segmented dataset</span></span>
<span id="cb6-33"><a href="segmentation-example.html#cb6-33" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/segmentation_ex/ms_10_10_100.shp&#39;</span>)</span>
<span id="cb6-34"><a href="segmentation-example.html#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="segmentation-example.html#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co"># subset by polygons that only have one pixel (NA) and polygons that have more</span></span>
<span id="cb6-36"><a href="segmentation-example.html#cb6-36" aria-hidden="true" tabindex="-1"></a>p_na <span class="ot">&lt;-</span> p[p<span class="sc">$</span>nbPixels<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb6-37"><a href="segmentation-example.html#cb6-37" aria-hidden="true" tabindex="-1"></a>p_real <span class="ot">&lt;-</span> p[p<span class="sc">$</span>nbPixels<span class="sc">&gt;</span><span class="dv">1</span>,]</span>
<span id="cb6-38"><a href="segmentation-example.html#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="segmentation-example.html#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co"># dissolve polygons that only have 1 pixels</span></span>
<span id="cb6-40"><a href="segmentation-example.html#cb6-40" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(p_na, <span class="at">by=</span><span class="st">&#39;nbPixels&#39;</span>)</span>
<span id="cb6-41"><a href="segmentation-example.html#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="segmentation-example.html#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="co"># add back into single file</span></span>
<span id="cb6-43"><a href="segmentation-example.html#cb6-43" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p_real, p2)</span>
<span id="cb6-44"><a href="segmentation-example.html#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="segmentation-example.html#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co"># write to file</span></span>
<span id="cb6-46"><a href="segmentation-example.html#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="fu">writeVector</span>(p3, <span class="st">&#39;D:/ontario_inventory/segmentation_ex/ms_10_10_100_agg_na.shp&#39;</span>, <span class="at">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="compare-datasets" class="section level2 unnumbered hasAnchor">
<h2>Compare Datasets<a href="segmentation-example.html#compare-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="segmentation-example.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load base imagery</span></span>
<span id="cb7-2"><a href="segmentation-example.html#cb7-2" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_Sample_Base.tif&#39;</span>)</span>
<span id="cb7-3"><a href="segmentation-example.html#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="segmentation-example.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load manually interpreted polygons and change to raster proj</span></span>
<span id="cb7-5"><a href="segmentation-example.html#cb7-5" aria-hidden="true" tabindex="-1"></a>man_poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Polygons Inventory/RMF_PolygonForest.shp&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="segmentation-example.html#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., base) <span class="sc">%&gt;%</span> <span class="fu">crop</span>(., base)</span>
<span id="cb7-7"><a href="segmentation-example.html#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="segmentation-example.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># load mean shift derived polygons and change to raster proj</span></span>
<span id="cb7-9"><a href="segmentation-example.html#cb7-9" aria-hidden="true" tabindex="-1"></a>ms_poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/segmentation_ex/ms_10_10_100_agg_na.shp&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="segmentation-example.html#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., base) <span class="sc">%&gt;%</span> <span class="fu">crop</span>(., base)</span>
<span id="cb7-11"><a href="segmentation-example.html#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="segmentation-example.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot base imagery with interpreter polygons</span></span>
<span id="cb7-13"><a href="segmentation-example.html#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(man_poly, <span class="at">main =</span> <span class="st">&#39;Polygonal Forest Stands Derived Manually&#39;</span>)</span>
<span id="cb7-14"><a href="segmentation-example.html#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRGB</span>(base, <span class="at">stretch =</span> <span class="st">&#39;lin&#39;</span>, <span class="at">add =</span> T)</span>
<span id="cb7-15"><a href="segmentation-example.html#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(man_poly, <span class="at">border =</span> <span class="st">&#39;mediumvioletred&#39;</span>, <span class="at">add =</span> T)</span></code></pre></div>
<p><img src="03-Segmentation_files/figure-html/compare-datasets1-1.png" width="1728" /></p>
<p>The above plot shows the manually derived forest stand polygons in part of the sample area, overlaid on recent true color imagery. Note the clean edges around water bodies, rivers/streams, and road features.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="segmentation-example.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot base imagery with mean shift polygons</span></span>
<span id="cb8-2"><a href="segmentation-example.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ms_poly, <span class="at">main =</span> <span class="st">&#39;Polygonal Forest Stands Derived from EFI Layers using Mean Shift&#39;</span>)</span>
<span id="cb8-3"><a href="segmentation-example.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRGB</span>(base, <span class="at">stretch =</span> <span class="st">&#39;lin&#39;</span>, <span class="at">add =</span> T)</span>
<span id="cb8-4"><a href="segmentation-example.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ms_poly, <span class="at">border =</span> <span class="st">&#39;red2&#39;</span>, <span class="at">add =</span> T)</span></code></pre></div>
<p><img src="03-Segmentation_files/figure-html/compare-datasets2-1.png" width="1728" /></p>
<p>The above plot shows the mean shift derived forest stand polygons in part of the sample area. Note that the automated segmentation also has clean edges around water bodies and road features, since these features were masked in the first step. Rivers/streams were not masked due to no clear pattern dictating which features manual interpreters included/excluded. The workflow gives the user control over which features in the landscape should be excluded from the segmentation process. Also note that the polygons never reach the same maximum size as the polygons derived manually. The algorithm takes minimum polygon size as an input parameter, but in general does not cluster the landscape into as large polygons.</p>
<p>We will continue to tweak the segmentation algorithm until we are satisfied with the polygonal output. We have also begun working on the imputation step of the project and will provide further results as they become available.</p>
<p>We look forward to receiving feedback!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="project-details.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="segmentation-update.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
