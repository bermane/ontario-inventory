<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Segmentation Update | Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework</title>
  <meta name="description" content="A place to find background information and follow updates related to the project." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Segmentation Update | Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A place to find background information and follow updates related to the project." />
  <meta name="github-repo" content="bermane/ontario-inventory" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Segmentation Update | Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework" />
  
  <meta name="twitter:description" content="A place to find background information and follow updates related to the project." />
  

<meta name="author" content="Ethan Berman" />


<meta name="date" content="2022-06-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="segmentation-example.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Integration of Photo Interpreted and LiDAR Attributes Into a Polygonal Forest Inventory Framework</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#summary"><i class="fa fa-check"></i>Project Summary</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#partners"><i class="fa fa-check"></i>Project Partners</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html"><i class="fa fa-check"></i>People</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ubc"><i class="fa fa-check"></i>University of British Columbia</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ncc"><i class="fa fa-check"></i>Prof. Nicholas Coops, <em>project lead</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#eb"><i class="fa fa-check"></i>Ethan Berman, <em>research scientist</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#greenfirst"><i class="fa fa-check"></i>GreenFirst Forest Products</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#cm"><i class="fa fa-check"></i>Chris McDonell, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#gm"><i class="fa fa-check"></i>Grant McCartney, <em>partner</em></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#ministry"><i class="fa fa-check"></i>Ontario Ministry of Northern Development, Mines, Natural Resources and Forestry</a>
<ul>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#is"><i class="fa fa-check"></i>Ian Sinclair, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#dl"><i class="fa fa-check"></i>Derek Landry, <em>partner</em></a></li>
<li class="chapter" data-level="" data-path="people.html"><a href="people.html#grm"><i class="fa fa-check"></i>Geordie Robere-McGugan, <em>partner</em></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html"><i class="fa fa-check"></i>Project Details</a>
<ul>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#objective"><i class="fa fa-check"></i>Objective</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#themes"><i class="fa fa-check"></i>Themes</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#description"><i class="fa fa-check"></i>Description</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#design"><i class="fa fa-check"></i>Design</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#methodology"><i class="fa fa-check"></i>Methodology</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#schedule"><i class="fa fa-check"></i>Schedule</a>
<ul>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#project-dates"><i class="fa fa-check"></i>Project Dates</a></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="project-details.html"><a href="project-details.html#knowledge-transfer"><i class="fa fa-check"></i>Knowledge &amp; Technology Transfer</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html"><i class="fa fa-check"></i>Segmentation Example</a>
<ul>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#intro"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#create-raster"><i class="fa fa-check"></i>Create Multi-band Raster</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#run-segmentation"><i class="fa fa-check"></i>Run Mean Shift Segmentation</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#compare-datasets"><i class="fa fa-check"></i>Compare Datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html"><i class="fa fa-check"></i>Segmentation Update</a>
<ul>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#intro"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#create-raster"><i class="fa fa-check"></i>1. Create Multi-band Raster</a></li>
<li class="chapter" data-level="" data-path="segmentation-example.html"><a href="segmentation-example.html#run-segmentation"><i class="fa fa-check"></i>2. Run GRM Segmentation</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#calculate-stats"><i class="fa fa-check"></i>3a. Calculate Summary Statistics</a></li>
<li class="chapter" data-level="" data-path="segmentation-update.html"><a href="segmentation-update.html#compare-outputs"><i class="fa fa-check"></i>3b. Compare GRM Segmentation Output to FRI</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Integration of Photo Interpreted and LIDAR Attributes Into a Polygonal Forest Inventory Framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="segmentation-update" class="section level1 unnumbered hasAnchor">
<h1>Segmentation Update<a href="segmentation-update.html#segmentation-update" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="intro" class="section level2 unnumbered hasAnchor">
<h2>Intro<a href="segmentation-example.html#intro" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This page provides an update of the segmentation approach used to derive polygons from Airborne Laser Scanning (ALS) gridded summary metrics. Based on feedback from our meetings I have now tested three segmentation algorithms to find the best approach to balance a) the visual component of the segmentation (e.g. shape, overlapping parallel lines) with b) the spectral component (outputting polygons with homogeneous values different from nearby polygons).</p>
<p>The three segmentation algorithms I tested are:
1. <a href="https://www.orfeo-toolbox.org/CookBook-6.4/Applications/app_LargeScaleMeanShift.html">Large Scale Mean Shift</a> (showcased in the initial segmentation example)
2. <a href="https://www.orfeo-toolbox.org/CookBook/Applications/app_GenericRegionMerging.html">Generic Region Merging</a>
3. <a href="https://scikit-image.org/docs/dev/api/skimage.segmentation.html?highlight=slic#skimage.segmentation.slic">Simple Linear Iterative Clustering</a></p>
<p>This example will run a segmentation of a small area in the Romeo Malette Forest using the Generic Region Merging algorithm, which I found to be the best candidate algorithm for this application. GRM is an open-source region merging algorithm available from Orfeo Toolbox that uses the same segmentation criterion (called the Baatz &amp; Schape criterion) as the subscription based Multi-resolution Segmentation (MRS) from eCognition software, which is the most popular segmentation method for remote sensing applications. I found GRM to be the most appropriate algorithm to derive meaningful and consistent forest stands, due to its ability to easily balance segment shape with spectral homogeneity, an important trade-off to ensure homogeneous forest stands while also maintaining spatial standards needed for forest operations.</p>
<p>First, a three band raster at 20 m spatial resolution is generated from gridded ALS metrics. The three bands comprise P95 height (95th percentile of vegetation return heights above 1.3 m), canopy cover (% cover above 2m) and coefficient of variation (standard deviation of LiDAR return heights divided by mean). I initially used Lorey’s Height instead of P95 height, but am now using P95 height because the two variables are highly correlated (Pearson’s correlation = 0.91) and P95 height provides wall-to-wall coverage within ALS transects whereas Lorey’s Height is modelled for a specific area and only valid within forested landcover types. These bands are re-scaled to comprise values from 0-100, setting the minimum and maximum values to be the 1st and 99th percentile of data observations. Large roads and waterbodies are also masked to prevent them from being included in forest stand polygons. These polygons are re-added to the dataset after segmentation.</p>
<p>Second, the GRM algorithm is used to derive forest stand polygons from the input raster. I am using the algorithm parameters I found to work best after conducting an iterative sensitivity analysis, which is described in the corresponding paper.</p>
<p>Third, the segmentation output is compared to polygons derived from manual interpretation, both visually and with a full suite of summary and performance metrics including:</p>
<ol style="list-style-type: decimal">
<li>Minimum, maximum, mean, and median polygon size (expressed in number of hectares)</li>
<li>Total number of polygons</li>
<li>Mean, standard error, and standard deviation of polygon area, perimeter, and shape index</li>
<li>R2 to assess the performance of segmentation outputs in explaining variation in the input variables: P95 height, canopy cover, and coefficient of variation</li>
</ol>
</div>
<div id="create-raster" class="section level2 unnumbered hasAnchor">
<h2>1. Create Multi-band Raster<a href="segmentation-example.html#create-raster" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="segmentation-update.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb9-2"><a href="segmentation-update.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb9-3"><a href="segmentation-update.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb9-4"><a href="segmentation-update.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb9-5"><a href="segmentation-update.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb9-6"><a href="segmentation-update.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr)</span>
<span id="cb9-7"><a href="segmentation-update.html#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lwgeom)</span>
<span id="cb9-8"><a href="segmentation-update.html#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb9-9"><a href="segmentation-update.html#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb9-10"><a href="segmentation-update.html#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="segmentation-update.html#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="do">###################################################</span></span>
<span id="cb9-12"><a href="segmentation-update.html#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="do">### LOAD MULTI BAND ALS RASTER FOR SEGMENTATION </span><span class="al">###</span></span>
<span id="cb9-13"><a href="segmentation-update.html#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="do">###################################################</span></span>
<span id="cb9-14"><a href="segmentation-update.html#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="segmentation-update.html#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># load file names of SPL rasters to stack</span></span>
<span id="cb9-16"><a href="segmentation-update.html#cb9-16" aria-hidden="true" tabindex="-1"></a>p95 <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_p95.tif&#39;</span></span>
<span id="cb9-17"><a href="segmentation-update.html#cb9-17" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_2m_cov.tif&#39;</span></span>
<span id="cb9-18"><a href="segmentation-update.html#cb9-18" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/SPL100 metrics/RMF_20m_T130cm_cv.tif&#39;</span></span>
<span id="cb9-19"><a href="segmentation-update.html#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="segmentation-update.html#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co"># stack rasters</span></span>
<span id="cb9-21"><a href="segmentation-update.html#cb9-21" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="fu">c</span>(p95, cc, cv))</span>
<span id="cb9-22"><a href="segmentation-update.html#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="segmentation-update.html#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># load RMF shapefile along with sample to be used for example</span></span>
<span id="cb9-24"><a href="segmentation-update.html#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># reproject to match raster</span></span>
<span id="cb9-25"><a href="segmentation-update.html#cb9-25" aria-hidden="true" tabindex="-1"></a>rmf <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Land ownership/RMF_Ownership.shp&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-26"><a href="segmentation-update.html#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., spl)</span>
<span id="cb9-27"><a href="segmentation-update.html#cb9-27" aria-hidden="true" tabindex="-1"></a>rmf_samp <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_Sample.shp&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-28"><a href="segmentation-update.html#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., spl)</span>
<span id="cb9-29"><a href="segmentation-update.html#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="segmentation-update.html#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co"># plot RMF overlaid with example</span></span>
<span id="cb9-31"><a href="segmentation-update.html#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmf, <span class="at">col =</span> <span class="st">&#39;grey&#39;</span>)</span>
<span id="cb9-32"><a href="segmentation-update.html#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmf_samp, <span class="at">col =</span> <span class="st">&#39;red&#39;</span>, <span class="at">add =</span> T,</span>
<span id="cb9-33"><a href="segmentation-update.html#cb9-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&#39;Romeo Malette Forest with Sample Area in Red&#39;</span>, <span class="at">cex.main =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="04-Segmentation-Update_files/figure-html/create-raster-1.png" width="1728" /></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="segmentation-update.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crop raster stack to sample area</span></span>
<span id="cb10-2"><a href="segmentation-update.html#cb10-2" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> <span class="fu">crop</span>(spl, rmf_samp)</span>
<span id="cb10-3"><a href="segmentation-update.html#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="segmentation-update.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># apply smoothing function on 5 cell square</span></span>
<span id="cb10-5"><a href="segmentation-update.html#cb10-5" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">focal</span>(spl[[<span class="dv">1</span>]], <span class="at">w=</span><span class="dv">5</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)</span>
<span id="cb10-6"><a href="segmentation-update.html#cb10-6" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">focal</span>(spl[[<span class="dv">2</span>]], <span class="at">w=</span><span class="dv">5</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)</span>
<span id="cb10-7"><a href="segmentation-update.html#cb10-7" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">focal</span>(spl[[<span class="dv">3</span>]], <span class="at">w=</span><span class="dv">5</span>, <span class="at">fun=</span><span class="st">&quot;mean&quot;</span>)</span>
<span id="cb10-8"><a href="segmentation-update.html#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="segmentation-update.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb10-10"><a href="segmentation-update.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="do">### MASK ROAD AND WATER POLYGONS </span><span class="al">###</span></span>
<span id="cb10-11"><a href="segmentation-update.html#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb10-12"><a href="segmentation-update.html#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="segmentation-update.html#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># create spl template with all values equal to 1</span></span>
<span id="cb10-14"><a href="segmentation-update.html#cb10-14" aria-hidden="true" tabindex="-1"></a>spl_temp <span class="ot">&lt;-</span> spl[[<span class="dv">1</span>]]</span>
<span id="cb10-15"><a href="segmentation-update.html#cb10-15" aria-hidden="true" tabindex="-1"></a>spl_temp[] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-16"><a href="segmentation-update.html#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="segmentation-update.html#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># load photo interpreted polygons</span></span>
<span id="cb10-18"><a href="segmentation-update.html#cb10-18" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_EFI_layers/Polygons Inventory/RMF_PolygonForest.shp&#39;</span>)</span>
<span id="cb10-19"><a href="segmentation-update.html#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="segmentation-update.html#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># reproject whole FRI to match lidar</span></span>
<span id="cb10-21"><a href="segmentation-update.html#cb10-21" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">project</span>(poly, spl)</span>
<span id="cb10-22"><a href="segmentation-update.html#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="segmentation-update.html#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># crop FRI to sample area</span></span>
<span id="cb10-24"><a href="segmentation-update.html#cb10-24" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">crop</span>(poly, rmf_samp)</span>
<span id="cb10-25"><a href="segmentation-update.html#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="segmentation-update.html#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># subset polygons that are WAT OR UCL</span></span>
<span id="cb10-27"><a href="segmentation-update.html#cb10-27" aria-hidden="true" tabindex="-1"></a>poly_sub <span class="ot">&lt;-</span> poly[poly<span class="sc">$</span>POLYTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;WAT&#39;</span>, <span class="st">&#39;UCL&#39;</span>)]</span>
<span id="cb10-28"><a href="segmentation-update.html#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="segmentation-update.html#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through water and unclassified polygons, mask raster, and vectorize</span></span>
<span id="cb10-30"><a href="segmentation-update.html#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(poly_sub)){</span>
<span id="cb10-31"><a href="segmentation-update.html#cb10-31" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> poly_sub<span class="sc">$</span>POLYTYPE[i]</span>
<span id="cb10-32"><a href="segmentation-update.html#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb10-33"><a href="segmentation-update.html#cb10-33" aria-hidden="true" tabindex="-1"></a>    spl_pt <span class="ot">&lt;-</span> spl_temp <span class="sc">%&gt;%</span> <span class="fu">crop</span>(poly_sub[i], <span class="at">snap =</span> <span class="st">&#39;out&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-34"><a href="segmentation-update.html#cb10-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mask</span>(poly_sub[i], <span class="at">touches =</span> T)</span>
<span id="cb10-35"><a href="segmentation-update.html#cb10-35" aria-hidden="true" tabindex="-1"></a>    npix <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">values</span>(spl_pt), <span class="at">na.rm =</span> T)</span>
<span id="cb10-36"><a href="segmentation-update.html#cb10-36" aria-hidden="true" tabindex="-1"></a>    spl_pt <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(spl_pt)</span>
<span id="cb10-37"><a href="segmentation-update.html#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(spl_pt) <span class="ot">&lt;-</span> <span class="st">&#39;POLYTYPE&#39;</span></span>
<span id="cb10-38"><a href="segmentation-update.html#cb10-38" aria-hidden="true" tabindex="-1"></a>    spl_pt<span class="sc">$</span>POLYTYPE <span class="ot">&lt;-</span> pt</span>
<span id="cb10-39"><a href="segmentation-update.html#cb10-39" aria-hidden="true" tabindex="-1"></a>    spl_pt<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> npix</span>
<span id="cb10-40"><a href="segmentation-update.html#cb10-40" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb10-41"><a href="segmentation-update.html#cb10-41" aria-hidden="true" tabindex="-1"></a>    spl_hold <span class="ot">&lt;-</span> spl_temp <span class="sc">%&gt;%</span> <span class="fu">crop</span>(poly_sub[i], <span class="at">snap =</span> <span class="st">&#39;out&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-42"><a href="segmentation-update.html#cb10-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mask</span>(poly_sub[i], <span class="at">touches =</span> T)</span>
<span id="cb10-43"><a href="segmentation-update.html#cb10-43" aria-hidden="true" tabindex="-1"></a>    npix <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">values</span>(spl_hold), <span class="at">na.rm =</span> T)</span>
<span id="cb10-44"><a href="segmentation-update.html#cb10-44" aria-hidden="true" tabindex="-1"></a>    spl_hold <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(spl_hold)</span>
<span id="cb10-45"><a href="segmentation-update.html#cb10-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(spl_hold) <span class="ot">&lt;-</span> <span class="st">&#39;POLYTYPE&#39;</span></span>
<span id="cb10-46"><a href="segmentation-update.html#cb10-46" aria-hidden="true" tabindex="-1"></a>    spl_hold<span class="sc">$</span>POLYTYPE <span class="ot">&lt;-</span> pt</span>
<span id="cb10-47"><a href="segmentation-update.html#cb10-47" aria-hidden="true" tabindex="-1"></a>    spl_hold<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> npix</span>
<span id="cb10-48"><a href="segmentation-update.html#cb10-48" aria-hidden="true" tabindex="-1"></a>    spl_pt <span class="ot">&lt;-</span> <span class="fu">rbind</span>(spl_pt, spl_hold)</span>
<span id="cb10-49"><a href="segmentation-update.html#cb10-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-50"><a href="segmentation-update.html#cb10-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-51"><a href="segmentation-update.html#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="segmentation-update.html#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co"># mask lidar outside of FRI</span></span>
<span id="cb10-53"><a href="segmentation-update.html#cb10-53" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> <span class="fu">mask</span>(spl, poly, <span class="at">inverse =</span> F, <span class="at">touches =</span> T)</span>
<span id="cb10-54"><a href="segmentation-update.html#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="segmentation-update.html#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="co"># mask WAT and UCL polygons</span></span>
<span id="cb10-56"><a href="segmentation-update.html#cb10-56" aria-hidden="true" tabindex="-1"></a>spl <span class="ot">&lt;-</span> <span class="fu">mask</span>(spl, poly_sub, <span class="at">inverse =</span> T, <span class="at">touches =</span> T)</span>
<span id="cb10-57"><a href="segmentation-update.html#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="segmentation-update.html#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################</span></span>
<span id="cb10-59"><a href="segmentation-update.html#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="do">### DEAL WITH MISSING DATA AND RESCALE </span><span class="al">###</span></span>
<span id="cb10-60"><a href="segmentation-update.html#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="do">##########################################</span></span>
<span id="cb10-61"><a href="segmentation-update.html#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="segmentation-update.html#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="co"># if any band is missing values set all to NA</span></span>
<span id="cb10-63"><a href="segmentation-update.html#cb10-63" aria-hidden="true" tabindex="-1"></a>spl[<span class="fu">is.na</span>(spl[[<span class="dv">1</span>]])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-64"><a href="segmentation-update.html#cb10-64" aria-hidden="true" tabindex="-1"></a>spl[<span class="fu">is.na</span>(spl[[<span class="dv">2</span>]])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-65"><a href="segmentation-update.html#cb10-65" aria-hidden="true" tabindex="-1"></a>spl[<span class="fu">is.na</span>(spl[[<span class="dv">3</span>]])] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-66"><a href="segmentation-update.html#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="segmentation-update.html#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co"># create function to rescale values from 0 to 100 using 1 and 99 percentile</span></span>
<span id="cb10-68"><a href="segmentation-update.html#cb10-68" aria-hidden="true" tabindex="-1"></a>scale_100 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb10-69"><a href="segmentation-update.html#cb10-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-70"><a href="segmentation-update.html#cb10-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate 1st and 99th percentile of input raster</span></span>
<span id="cb10-71"><a href="segmentation-update.html#cb10-71" aria-hidden="true" tabindex="-1"></a>  perc <span class="ot">&lt;-</span> <span class="fu">values</span>(x, <span class="at">mat=</span>F) <span class="sc">%&gt;%</span> <span class="fu">quantile</span>(., <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="at">na.rm=</span>T)</span>
<span id="cb10-72"><a href="segmentation-update.html#cb10-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-73"><a href="segmentation-update.html#cb10-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rescale raster using 1st and 99th %</span></span>
<span id="cb10-74"><a href="segmentation-update.html#cb10-74" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> (x<span class="sc">-</span>perc[<span class="dv">1</span>])<span class="sc">/</span>(perc[<span class="dv">2</span>] <span class="sc">-</span> perc[<span class="dv">1</span>]) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb10-75"><a href="segmentation-update.html#cb10-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-76"><a href="segmentation-update.html#cb10-76" aria-hidden="true" tabindex="-1"></a>  <span class="co">#reset values below 0 and above 100</span></span>
<span id="cb10-77"><a href="segmentation-update.html#cb10-77" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-78"><a href="segmentation-update.html#cb10-78" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">&gt;</span> <span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb10-79"><a href="segmentation-update.html#cb10-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-80"><a href="segmentation-update.html#cb10-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb10-81"><a href="segmentation-update.html#cb10-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-82"><a href="segmentation-update.html#cb10-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-83"><a href="segmentation-update.html#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="co"># rescale rasters from 0 to 100</span></span>
<span id="cb10-84"><a href="segmentation-update.html#cb10-84" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">scale_100</span>(spl[[<span class="dv">1</span>]])</span>
<span id="cb10-85"><a href="segmentation-update.html#cb10-85" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">scale_100</span>(spl[[<span class="dv">2</span>]])</span>
<span id="cb10-86"><a href="segmentation-update.html#cb10-86" aria-hidden="true" tabindex="-1"></a>spl[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">scale_100</span>(spl[[<span class="dv">3</span>]])</span>
<span id="cb10-87"><a href="segmentation-update.html#cb10-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-88"><a href="segmentation-update.html#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="co"># plot raster layers</span></span>
<span id="cb10-89"><a href="segmentation-update.html#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spl[[<span class="dv">1</span>]])</span>
<span id="cb10-90"><a href="segmentation-update.html#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">&quot;P95 Height (scaled 0-100)&quot;</span>, <span class="at">cex.main =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="sc">-</span><span class="fl">0.0001</span>)</span></code></pre></div>
<p><img src="04-Segmentation-Update_files/figure-html/create-raster-2.png" width="1728" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="segmentation-update.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spl[[<span class="dv">2</span>]])</span>
<span id="cb11-2"><a href="segmentation-update.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">&quot;Canopy Cover (scaled 0-100)&quot;</span>, <span class="at">cex.main =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="sc">-</span><span class="fl">0.0001</span>)</span></code></pre></div>
<p><img src="04-Segmentation-Update_files/figure-html/create-raster-3.png" width="1728" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="segmentation-update.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spl[[<span class="dv">3</span>]])</span>
<span id="cb12-2"><a href="segmentation-update.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">&quot;Coefficient of Variation (scaled 0-100)&quot;</span>, <span class="at">cex.main =</span> <span class="dv">3</span>, <span class="at">line =</span> <span class="sc">-</span><span class="fl">0.0001</span>)</span></code></pre></div>
<p><img src="04-Segmentation-Update_files/figure-html/create-raster-4.png" width="1728" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="segmentation-update.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write raster to tif</span></span>
<span id="cb13-2"><a href="segmentation-update.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(spl, <span class="at">filename=</span><span class="st">&#39;D:/ontario_inventory/segmentation_ex/spl_stack_grm.tif&#39;</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb13-3"><a href="segmentation-update.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="segmentation-update.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># write masked water and unclassified polygons to shp</span></span>
<span id="cb13-5"><a href="segmentation-update.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">writeVector</span>(spl_pt, <span class="st">&#39;D:/ontario_inventory/segmentation_ex/wat_ucl_polygons.shp&#39;</span>,</span>
<span id="cb13-6"><a href="segmentation-update.html#cb13-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">overwrite =</span> T)</span></code></pre></div>
</div>
<div id="run-segmentation" class="section level2 unnumbered hasAnchor">
<h2>2. Run GRM Segmentation<a href="segmentation-example.html#run-segmentation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="segmentation-update.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">#########################</span></span>
<span id="cb14-2"><a href="segmentation-update.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">### RUN GRM ALGORITHM </span><span class="al">###</span></span>
<span id="cb14-3"><a href="segmentation-update.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="do">#########################</span></span>
<span id="cb14-4"><a href="segmentation-update.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="segmentation-update.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set working directory where temp files will be output</span></span>
<span id="cb14-6"><a href="segmentation-update.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&#39;D:/temp&#39;</span>)</span>
<span id="cb14-7"><a href="segmentation-update.html#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="segmentation-update.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create function to run generic region merging</span></span>
<span id="cb14-9"><a href="segmentation-update.html#cb14-9" aria-hidden="true" tabindex="-1"></a>  grm_otb <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">otb_path =</span> <span class="st">&quot;&quot;</span>, <span class="at">raster_in =</span> <span class="st">&quot;&quot;</span>, <span class="at">out_path =</span> <span class="st">&quot;&quot;</span>, <span class="at">name =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb14-10"><a href="segmentation-update.html#cb14-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">&quot;bs&quot;</span>, <span class="at">thresh =</span> <span class="st">&quot;&quot;</span>, <span class="at">spec =</span> <span class="st">&quot;0.5&quot;</span>, <span class="at">spat =</span> <span class="st">&quot;0.5&quot;</span>){</span>
<span id="cb14-11"><a href="segmentation-update.html#cb14-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-12"><a href="segmentation-update.html#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set configuration</span></span>
<span id="cb14-13"><a href="segmentation-update.html#cb14-13" aria-hidden="true" tabindex="-1"></a>    conf <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;-in&quot;</span>, raster_in, <span class="st">&quot;-out&quot;</span>, <span class="fu">paste</span>(out_path, <span class="st">&quot;/&quot;</span>, name, <span class="st">&quot;.tif&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb14-14"><a href="segmentation-update.html#cb14-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;-criterion&quot;</span>, method, <span class="st">&quot;-threshold&quot;</span>, thresh, <span class="st">&quot;-cw&quot;</span>, spec, <span class="st">&quot;-sw&quot;</span>, spat)</span>
<span id="cb14-15"><a href="segmentation-update.html#cb14-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-16"><a href="segmentation-update.html#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># apply function in command line</span></span>
<span id="cb14-17"><a href="segmentation-update.html#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">system</span>(<span class="fu">paste</span>(otb_path, <span class="st">&quot;/otbcli_GenericRegionMerging&quot;</span>, <span class="st">&quot; &quot;</span>, conf, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb14-18"><a href="segmentation-update.html#cb14-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-19"><a href="segmentation-update.html#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save configuration for further use</span></span>
<span id="cb14-20"><a href="segmentation-update.html#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(<span class="at">x =</span> conf,<span class="at">file =</span> <span class="fu">paste</span>(out_path,<span class="st">&quot;/&quot;</span>,name,<span class="st">&quot;_conf.txt&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),<span class="at">row.names =</span> F, <span class="at">col.names =</span> F)</span>
<span id="cb14-21"><a href="segmentation-update.html#cb14-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-22"><a href="segmentation-update.html#cb14-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-23"><a href="segmentation-update.html#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># run grm</span></span>
<span id="cb14-24"><a href="segmentation-update.html#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="fu">grm_otb</span>(<span class="at">otb_path =</span> <span class="st">&quot;C:/OTB/bin&quot;</span>,</span>
<span id="cb14-25"><a href="segmentation-update.html#cb14-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">raster_in =</span> <span class="st">&quot;D:/ontario_inventory/segmentation_ex/spl_stack_grm.tif&quot;</span>,</span>
<span id="cb14-26"><a href="segmentation-update.html#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">out_path =</span> <span class="st">&quot;D:/ontario_inventory/segmentation_ex&quot;</span>,</span>
<span id="cb14-27"><a href="segmentation-update.html#cb14-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">&quot;grm_ex&quot;</span>,</span>
<span id="cb14-28"><a href="segmentation-update.html#cb14-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">thresh =</span> <span class="st">&quot;10&quot;</span>,</span>
<span id="cb14-29"><a href="segmentation-update.html#cb14-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">spec =</span> <span class="st">&quot;0.1&quot;</span>,</span>
<span id="cb14-30"><a href="segmentation-update.html#cb14-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">spat =</span> <span class="st">&quot;0.5&quot;</span>)</span>
<span id="cb14-31"><a href="segmentation-update.html#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="segmentation-update.html#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb14-33"><a href="segmentation-update.html#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="do">### MASK MISSING VALUES </span><span class="al">###</span></span>
<span id="cb14-34"><a href="segmentation-update.html#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb14-35"><a href="segmentation-update.html#cb14-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-36"><a href="segmentation-update.html#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load grm segments raster</span></span>
<span id="cb14-37"><a href="segmentation-update.html#cb14-37" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;D:/ontario_inventory/segmentation_ex/grm_ex.tif&quot;</span>)</span>
<span id="cb14-38"><a href="segmentation-update.html#cb14-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-39"><a href="segmentation-update.html#cb14-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load single band of raster input for segmentation to use as mask</span></span>
<span id="cb14-40"><a href="segmentation-update.html#cb14-40" aria-hidden="true" tabindex="-1"></a>  mask <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;D:/ontario_inventory/segmentation_ex/spl_stack_grm.tif&quot;</span>) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb14-41"><a href="segmentation-update.html#cb14-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-42"><a href="segmentation-update.html#cb14-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mask grm segments raster</span></span>
<span id="cb14-43"><a href="segmentation-update.html#cb14-43" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">mask</span>(p, mask)</span>
<span id="cb14-44"><a href="segmentation-update.html#cb14-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-45"><a href="segmentation-update.html#cb14-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># re-write masked grm raster</span></span>
<span id="cb14-46"><a href="segmentation-update.html#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeRaster</span>(p, <span class="st">&quot;D:/ontario_inventory/segmentation_ex/grm_ex.tif&quot;</span>,</span>
<span id="cb14-47"><a href="segmentation-update.html#cb14-47" aria-hidden="true" tabindex="-1"></a>              <span class="at">overwrite =</span> T)</span>
<span id="cb14-48"><a href="segmentation-update.html#cb14-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-49"><a href="segmentation-update.html#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb14-50"><a href="segmentation-update.html#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="do">### CONVERT TO POLYGONS AND CALC POLYGON SIZES </span><span class="al">###</span></span>
<span id="cb14-51"><a href="segmentation-update.html#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb14-52"><a href="segmentation-update.html#cb14-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-53"><a href="segmentation-update.html#cb14-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to vector based on cell value</span></span>
<span id="cb14-54"><a href="segmentation-update.html#cb14-54" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span> <span class="fu">as.polygons</span>(p)</span>
<span id="cb14-55"><a href="segmentation-update.html#cb14-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-56"><a href="segmentation-update.html#cb14-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create table of number of pixels in each polygon</span></span>
<span id="cb14-57"><a href="segmentation-update.html#cb14-57" aria-hidden="true" tabindex="-1"></a>  num <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">values</span>(p))</span>
<span id="cb14-58"><a href="segmentation-update.html#cb14-58" aria-hidden="true" tabindex="-1"></a>  num_pix <span class="ot">&lt;-</span> <span class="fu">tabyl</span>(num)</span>
<span id="cb14-59"><a href="segmentation-update.html#cb14-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-60"><a href="segmentation-update.html#cb14-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop na row</span></span>
<span id="cb14-61"><a href="segmentation-update.html#cb14-61" aria-hidden="true" tabindex="-1"></a>  num_pix <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(num_pix)</span>
<span id="cb14-62"><a href="segmentation-update.html#cb14-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-63"><a href="segmentation-update.html#cb14-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get pixel ids from vector</span></span>
<span id="cb14-64"><a href="segmentation-update.html#cb14-64" aria-hidden="true" tabindex="-1"></a>  vec_dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id =</span> <span class="fu">values</span>(vec)[,<span class="dv">1</span>])</span>
<span id="cb14-65"><a href="segmentation-update.html#cb14-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(vec_dat) <span class="ot">&lt;-</span> <span class="st">&#39;id&#39;</span></span>
<span id="cb14-66"><a href="segmentation-update.html#cb14-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-67"><a href="segmentation-update.html#cb14-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through values and add to vector data</span></span>
<span id="cb14-68"><a href="segmentation-update.html#cb14-68" aria-hidden="true" tabindex="-1"></a>  vec_dat<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb14-69"><a href="segmentation-update.html#cb14-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">NROW</span>(vec_dat)){</span>
<span id="cb14-70"><a href="segmentation-update.html#cb14-70" aria-hidden="true" tabindex="-1"></a>    vec_dat<span class="sc">$</span>nbPixels[i] <span class="ot">&lt;-</span> num_pix<span class="sc">$</span>n[num_pix<span class="sc">$</span>num <span class="sc">==</span> vec_dat<span class="sc">$</span>id[i]]</span>
<span id="cb14-71"><a href="segmentation-update.html#cb14-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-72"><a href="segmentation-update.html#cb14-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-73"><a href="segmentation-update.html#cb14-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove current column of data and add id</span></span>
<span id="cb14-74"><a href="segmentation-update.html#cb14-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add nbPixels to vector</span></span>
<span id="cb14-75"><a href="segmentation-update.html#cb14-75" aria-hidden="true" tabindex="-1"></a>  vec <span class="ot">&lt;-</span> vec[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb14-76"><a href="segmentation-update.html#cb14-76" aria-hidden="true" tabindex="-1"></a>  vec<span class="sc">$</span>id <span class="ot">&lt;-</span> vec_dat<span class="sc">$</span>id</span>
<span id="cb14-77"><a href="segmentation-update.html#cb14-77" aria-hidden="true" tabindex="-1"></a>  vec<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> vec_dat<span class="sc">$</span>nbPixels</span></code></pre></div>
</div>
<div id="calculate-stats" class="section level2 unnumbered hasAnchor">
<h2>3a. Calculate Summary Statistics<a href="segmentation-update.html#calculate-stats" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="segmentation-update.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb15-2"><a href="segmentation-update.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">### RE-ADD WATER AND UNCLASSIFIED POLYGONS </span><span class="al">###</span></span>
<span id="cb15-3"><a href="segmentation-update.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb15-4"><a href="segmentation-update.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-5"><a href="segmentation-update.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load polygon dataset as p</span></span>
<span id="cb15-6"><a href="segmentation-update.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> vec</span>
<span id="cb15-7"><a href="segmentation-update.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-8"><a href="segmentation-update.html#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reproject segmented polygons to ensure same crs as wat and ucl polygons</span></span>
<span id="cb15-9"><a href="segmentation-update.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">project</span>(p, spl_pt)</span>
<span id="cb15-10"><a href="segmentation-update.html#cb15-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-11"><a href="segmentation-update.html#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add WAT/UCL POLYTYPE polygons back in</span></span>
<span id="cb15-12"><a href="segmentation-update.html#cb15-12" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">rbind</span>(p, spl_pt)</span>
<span id="cb15-13"><a href="segmentation-update.html#cb15-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="segmentation-update.html#cb15-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-15"><a href="segmentation-update.html#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">#######################################################</span></span>
<span id="cb15-16"><a href="segmentation-update.html#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">### EXTRACT ALS METRICS AND CALCULATE SUMMARY STATS </span><span class="al">###</span></span>
<span id="cb15-17"><a href="segmentation-update.html#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">#######################################################</span></span>
<span id="cb15-18"><a href="segmentation-update.html#cb15-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-19"><a href="segmentation-update.html#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to sf</span></span>
<span id="cb15-20"><a href="segmentation-update.html#cb15-20" aria-hidden="true" tabindex="-1"></a>  p_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(p)</span>
<span id="cb15-21"><a href="segmentation-update.html#cb15-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-22"><a href="segmentation-update.html#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate perimeter</span></span>
<span id="cb15-23"><a href="segmentation-update.html#cb15-23" aria-hidden="true" tabindex="-1"></a>  p<span class="sc">$</span>perim <span class="ot">&lt;-</span> <span class="fu">st_perimeter</span>(p_sf) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb15-24"><a href="segmentation-update.html#cb15-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-25"><a href="segmentation-update.html#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate area</span></span>
<span id="cb15-26"><a href="segmentation-update.html#cb15-26" aria-hidden="true" tabindex="-1"></a>  p<span class="sc">$</span>area <span class="ot">&lt;-</span> <span class="fu">st_area</span>(p_sf) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb15-27"><a href="segmentation-update.html#cb15-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-28"><a href="segmentation-update.html#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate mean shape index</span></span>
<span id="cb15-29"><a href="segmentation-update.html#cb15-29" aria-hidden="true" tabindex="-1"></a>  p<span class="sc">$</span>msi <span class="ot">&lt;-</span> p<span class="sc">$</span>perim<span class="sc">/</span><span class="fu">sqrt</span>(pi <span class="sc">*</span> p<span class="sc">$</span>area)</span>
<span id="cb15-30"><a href="segmentation-update.html#cb15-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-31"><a href="segmentation-update.html#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># write to file to backup</span></span>
<span id="cb15-32"><a href="segmentation-update.html#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">writeVector</span>(p, <span class="st">&quot;D:/ontario_inventory/segmentation_ex/grm_ex.shp&quot;</span>,</span>
<span id="cb15-33"><a href="segmentation-update.html#cb15-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">overwrite =</span> T)</span>
<span id="cb15-34"><a href="segmentation-update.html#cb15-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-35"><a href="segmentation-update.html#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset non masked WAT and UCL polygons</span></span>
<span id="cb15-36"><a href="segmentation-update.html#cb15-36" aria-hidden="true" tabindex="-1"></a>  p2_sf <span class="ot">&lt;-</span> p[<span class="fu">is.na</span>(p<span class="sc">$</span>POLYTYPE)] <span class="sc">%&gt;%</span> st_as_sf</span>
<span id="cb15-37"><a href="segmentation-update.html#cb15-37" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> p[<span class="fu">is.na</span>(p<span class="sc">$</span>POLYTYPE)] <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb15-38"><a href="segmentation-update.html#cb15-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-39"><a href="segmentation-update.html#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load original raster input file</span></span>
<span id="cb15-40"><a href="segmentation-update.html#cb15-40" aria-hidden="true" tabindex="-1"></a>  ras <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&quot;D:/ontario_inventory/segmentation_ex/spl_stack_grm.tif&quot;</span>)</span>
<span id="cb15-41"><a href="segmentation-update.html#cb15-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-42"><a href="segmentation-update.html#cb15-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename bands</span></span>
<span id="cb15-43"><a href="segmentation-update.html#cb15-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ras) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;p95&#39;</span>, <span class="st">&#39;cc&#39;</span>, <span class="st">&#39;cv&#39;</span>)</span>
<span id="cb15-44"><a href="segmentation-update.html#cb15-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-45"><a href="segmentation-update.html#cb15-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract pixel values</span></span>
<span id="cb15-46"><a href="segmentation-update.html#cb15-46" aria-hidden="true" tabindex="-1"></a>  pvals <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(ras, p2_sf)</span>
<span id="cb15-47"><a href="segmentation-update.html#cb15-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-48"><a href="segmentation-update.html#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate SSE</span></span>
<span id="cb15-49"><a href="segmentation-update.html#cb15-49" aria-hidden="true" tabindex="-1"></a>  sse <span class="ot">&lt;-</span> <span class="fu">sapply</span>(pvals, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb15-50"><a href="segmentation-update.html#cb15-50" aria-hidden="true" tabindex="-1"></a>    p95_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>p95, <span class="at">na.rm =</span> T)</span>
<span id="cb15-51"><a href="segmentation-update.html#cb15-51" aria-hidden="true" tabindex="-1"></a>    cc_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>cc, <span class="at">na.rm =</span> T)</span>
<span id="cb15-52"><a href="segmentation-update.html#cb15-52" aria-hidden="true" tabindex="-1"></a>    cv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>cv, <span class="at">na.rm =</span> T)</span>
<span id="cb15-53"><a href="segmentation-update.html#cb15-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-54"><a href="segmentation-update.html#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">sum</span>((x<span class="sc">$</span>p95 <span class="sc">-</span> p95_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb15-55"><a href="segmentation-update.html#cb15-55" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cc <span class="sc">-</span> cc_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb15-56"><a href="segmentation-update.html#cb15-56" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cv <span class="sc">-</span> cv_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T)))</span>
<span id="cb15-57"><a href="segmentation-update.html#cb15-57" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb15-58"><a href="segmentation-update.html#cb15-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-59"><a href="segmentation-update.html#cb15-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transpose</span></span>
<span id="cb15-60"><a href="segmentation-update.html#cb15-60" aria-hidden="true" tabindex="-1"></a>  sse <span class="ot">&lt;-</span> <span class="fu">t</span>(sse)</span>
<span id="cb15-61"><a href="segmentation-update.html#cb15-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-62"><a href="segmentation-update.html#cb15-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate final sums</span></span>
<span id="cb15-63"><a href="segmentation-update.html#cb15-63" aria-hidden="true" tabindex="-1"></a>  sse <span class="ot">&lt;-</span> <span class="fu">colSums</span>(sse)</span>
<span id="cb15-64"><a href="segmentation-update.html#cb15-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-65"><a href="segmentation-update.html#cb15-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unlist values</span></span>
<span id="cb15-66"><a href="segmentation-update.html#cb15-66" aria-hidden="true" tabindex="-1"></a>  pvals2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, pvals)</span>
<span id="cb15-67"><a href="segmentation-update.html#cb15-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-68"><a href="segmentation-update.html#cb15-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate global mean values</span></span>
<span id="cb15-69"><a href="segmentation-update.html#cb15-69" aria-hidden="true" tabindex="-1"></a>  p95_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>p95, <span class="at">na.rm =</span> T)</span>
<span id="cb15-70"><a href="segmentation-update.html#cb15-70" aria-hidden="true" tabindex="-1"></a>  cc_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>cc, <span class="at">na.rm =</span> T)</span>
<span id="cb15-71"><a href="segmentation-update.html#cb15-71" aria-hidden="true" tabindex="-1"></a>  cv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>cv, <span class="at">na.rm =</span> T)</span>
<span id="cb15-72"><a href="segmentation-update.html#cb15-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-73"><a href="segmentation-update.html#cb15-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(pvals2)</span>
<span id="cb15-74"><a href="segmentation-update.html#cb15-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-75"><a href="segmentation-update.html#cb15-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate SST</span></span>
<span id="cb15-76"><a href="segmentation-update.html#cb15-76" aria-hidden="true" tabindex="-1"></a>  sst <span class="ot">&lt;-</span> <span class="fu">sapply</span>(pvals, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb15-77"><a href="segmentation-update.html#cb15-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">sum</span>((x<span class="sc">$</span>p95 <span class="sc">-</span> p95_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb15-78"><a href="segmentation-update.html#cb15-78" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cc <span class="sc">-</span> cc_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb15-79"><a href="segmentation-update.html#cb15-79" aria-hidden="true" tabindex="-1"></a>             <span class="fu">sum</span>((x<span class="sc">$</span>cv <span class="sc">-</span> cv_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T)))</span>
<span id="cb15-80"><a href="segmentation-update.html#cb15-80" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb15-81"><a href="segmentation-update.html#cb15-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-82"><a href="segmentation-update.html#cb15-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transpose</span></span>
<span id="cb15-83"><a href="segmentation-update.html#cb15-83" aria-hidden="true" tabindex="-1"></a>  sst <span class="ot">&lt;-</span> <span class="fu">t</span>(sst)</span>
<span id="cb15-84"><a href="segmentation-update.html#cb15-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-85"><a href="segmentation-update.html#cb15-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate final sums</span></span>
<span id="cb15-86"><a href="segmentation-update.html#cb15-86" aria-hidden="true" tabindex="-1"></a>  sst <span class="ot">&lt;-</span> <span class="fu">colSums</span>(sst)</span>
<span id="cb15-87"><a href="segmentation-update.html#cb15-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-88"><a href="segmentation-update.html#cb15-88" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate r2 values</span></span>
<span id="cb15-89"><a href="segmentation-update.html#cb15-89" aria-hidden="true" tabindex="-1"></a>  r2_p95 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">1</span>]<span class="sc">/</span>sst[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-90"><a href="segmentation-update.html#cb15-90" aria-hidden="true" tabindex="-1"></a>  r2_cc <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">2</span>]<span class="sc">/</span>sst[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-91"><a href="segmentation-update.html#cb15-91" aria-hidden="true" tabindex="-1"></a>  r2_cv <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">3</span>]<span class="sc">/</span>sst[<span class="dv">3</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-92"><a href="segmentation-update.html#cb15-92" aria-hidden="true" tabindex="-1"></a>  r2_all <span class="ot">&lt;-</span> (<span class="fu">sum</span>(r2_p95, r2_cc, r2_cv) <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-93"><a href="segmentation-update.html#cb15-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-94"><a href="segmentation-update.html#cb15-94" aria-hidden="true" tabindex="-1"></a><span class="co"># create standard error function</span></span>
<span id="cb15-95"><a href="segmentation-update.html#cb15-95" aria-hidden="true" tabindex="-1"></a>  se <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">sd</span>(x) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(x))}</span>
<span id="cb15-96"><a href="segmentation-update.html#cb15-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-97"><a href="segmentation-update.html#cb15-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create dataframe of all summary stats</span></span>
<span id="cb15-98"><a href="segmentation-update.html#cb15-98" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-99"><a href="segmentation-update.html#cb15-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">alg =</span> <span class="st">&#39;GRM&#39;</span>,</span>
<span id="cb15-100"><a href="segmentation-update.html#cb15-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_pix =</span> (<span class="fu">min</span>(p2<span class="sc">$</span>nbPixels)),</span>
<span id="cb15-101"><a href="segmentation-update.html#cb15-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_pix =</span> (<span class="fu">max</span>(p2<span class="sc">$</span>nbPixels)),</span>
<span id="cb15-102"><a href="segmentation-update.html#cb15-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_pix =</span> (<span class="fu">mean</span>(p2<span class="sc">$</span>nbPixels)),</span>
<span id="cb15-103"><a href="segmentation-update.html#cb15-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">med_pix =</span> (<span class="fu">median</span>(p2<span class="sc">$</span>nbPixels)),</span>
<span id="cb15-104"><a href="segmentation-update.html#cb15-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_poly =</span> <span class="fu">NROW</span>(p2),</span>
<span id="cb15-105"><a href="segmentation-update.html#cb15-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_area =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>area),</span>
<span id="cb15-106"><a href="segmentation-update.html#cb15-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">se_area =</span> <span class="fu">se</span>(p2<span class="sc">$</span>area),</span>
<span id="cb15-107"><a href="segmentation-update.html#cb15-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_area =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>area),</span>
<span id="cb15-108"><a href="segmentation-update.html#cb15-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_perim =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>perim),</span>
<span id="cb15-109"><a href="segmentation-update.html#cb15-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">se_perim =</span> <span class="fu">se</span>(p2<span class="sc">$</span>perim),</span>
<span id="cb15-110"><a href="segmentation-update.html#cb15-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_perim =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>perim),</span>
<span id="cb15-111"><a href="segmentation-update.html#cb15-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_msi =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>msi),</span>
<span id="cb15-112"><a href="segmentation-update.html#cb15-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">se_msi =</span> <span class="fu">se</span>(p2<span class="sc">$</span>msi),</span>
<span id="cb15-113"><a href="segmentation-update.html#cb15-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_msi =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>msi),</span>
<span id="cb15-114"><a href="segmentation-update.html#cb15-114" aria-hidden="true" tabindex="-1"></a>    r2_p95 <span class="ot">&lt;-</span> r2_p95,</span>
<span id="cb15-115"><a href="segmentation-update.html#cb15-115" aria-hidden="true" tabindex="-1"></a>    r2_cc <span class="ot">&lt;-</span> r2_cc,</span>
<span id="cb15-116"><a href="segmentation-update.html#cb15-116" aria-hidden="true" tabindex="-1"></a>    r2_cv <span class="ot">&lt;-</span> r2_cv,</span>
<span id="cb15-117"><a href="segmentation-update.html#cb15-117" aria-hidden="true" tabindex="-1"></a>    r2_all <span class="ot">&lt;-</span> r2_all</span>
<span id="cb15-118"><a href="segmentation-update.html#cb15-118" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-119"><a href="segmentation-update.html#cb15-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-120"><a href="segmentation-update.html#cb15-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># round numeric columns</span></span>
<span id="cb15-121"><a href="segmentation-update.html#cb15-121" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb15-122"><a href="segmentation-update.html#cb15-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&#39;min_pix&#39;</span>,</span>
<span id="cb15-123"><a href="segmentation-update.html#cb15-123" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;max_pix&#39;</span>, </span>
<span id="cb15-124"><a href="segmentation-update.html#cb15-124" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;mean_pix&#39;</span>, </span>
<span id="cb15-125"><a href="segmentation-update.html#cb15-125" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;med_pix&#39;</span>, </span>
<span id="cb15-126"><a href="segmentation-update.html#cb15-126" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;mean_area&#39;</span>, </span>
<span id="cb15-127"><a href="segmentation-update.html#cb15-127" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;se_area&#39;</span>, </span>
<span id="cb15-128"><a href="segmentation-update.html#cb15-128" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;sd_area&#39;</span>,</span>
<span id="cb15-129"><a href="segmentation-update.html#cb15-129" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;mean_perim&#39;</span>,</span>
<span id="cb15-130"><a href="segmentation-update.html#cb15-130" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;se_perim&#39;</span>,</span>
<span id="cb15-131"><a href="segmentation-update.html#cb15-131" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;sd_perim&#39;</span>), </span>
<span id="cb15-132"><a href="segmentation-update.html#cb15-132" aria-hidden="true" tabindex="-1"></a>              <span class="cf">function</span>(x) <span class="fu">round</span>(x, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-133"><a href="segmentation-update.html#cb15-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&#39;mean_msi&#39;</span>, </span>
<span id="cb15-134"><a href="segmentation-update.html#cb15-134" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;se_msi&#39;</span>, </span>
<span id="cb15-135"><a href="segmentation-update.html#cb15-135" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;sd_msi&#39;</span>), </span>
<span id="cb15-136"><a href="segmentation-update.html#cb15-136" aria-hidden="true" tabindex="-1"></a>              <span class="cf">function</span>(x) <span class="fu">round</span>(x, <span class="dv">4</span>))</span>
<span id="cb15-137"><a href="segmentation-update.html#cb15-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-138"><a href="segmentation-update.html#cb15-138" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb15-139"><a href="segmentation-update.html#cb15-139" aria-hidden="true" tabindex="-1"></a><span class="do">### CALCULATE SUMMARY STATS FOR FRI </span><span class="al">###</span></span>
<span id="cb15-140"><a href="segmentation-update.html#cb15-140" aria-hidden="true" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb15-141"><a href="segmentation-update.html#cb15-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-142"><a href="segmentation-update.html#cb15-142" aria-hidden="true" tabindex="-1"></a><span class="co"># load interpreter derived polygons to extract statistics</span></span>
<span id="cb15-143"><a href="segmentation-update.html#cb15-143" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> poly</span>
<span id="cb15-144"><a href="segmentation-update.html#cb15-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-145"><a href="segmentation-update.html#cb15-145" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to sf</span></span>
<span id="cb15-146"><a href="segmentation-update.html#cb15-146" aria-hidden="true" tabindex="-1"></a>p_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(p)</span>
<span id="cb15-147"><a href="segmentation-update.html#cb15-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-148"><a href="segmentation-update.html#cb15-148" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate perimeter</span></span>
<span id="cb15-149"><a href="segmentation-update.html#cb15-149" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>perim <span class="ot">&lt;-</span> <span class="fu">st_perimeter</span>(p_sf) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb15-150"><a href="segmentation-update.html#cb15-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-151"><a href="segmentation-update.html#cb15-151" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate area</span></span>
<span id="cb15-152"><a href="segmentation-update.html#cb15-152" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>area <span class="ot">&lt;-</span> <span class="fu">st_area</span>(p_sf) <span class="sc">%&gt;%</span> as.numeric</span>
<span id="cb15-153"><a href="segmentation-update.html#cb15-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-154"><a href="segmentation-update.html#cb15-154" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate msi</span></span>
<span id="cb15-155"><a href="segmentation-update.html#cb15-155" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>msi <span class="ot">&lt;-</span> p<span class="sc">$</span>perim<span class="sc">/</span><span class="fu">sqrt</span>(pi <span class="sc">*</span> p<span class="sc">$</span>area)</span>
<span id="cb15-156"><a href="segmentation-update.html#cb15-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-157"><a href="segmentation-update.html#cb15-157" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate nbPixels</span></span>
<span id="cb15-158"><a href="segmentation-update.html#cb15-158" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>nbPixels <span class="ot">&lt;-</span> p<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span></span>
<span id="cb15-159"><a href="segmentation-update.html#cb15-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-160"><a href="segmentation-update.html#cb15-160" aria-hidden="true" tabindex="-1"></a><span class="co"># write to file to backup</span></span>
<span id="cb15-161"><a href="segmentation-update.html#cb15-161" aria-hidden="true" tabindex="-1"></a><span class="fu">writeVector</span>(p,</span>
<span id="cb15-162"><a href="segmentation-update.html#cb15-162" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;D:/ontario_inventory/segmentation_ex/fri_ex.shp&quot;</span>,</span>
<span id="cb15-163"><a href="segmentation-update.html#cb15-163" aria-hidden="true" tabindex="-1"></a>            <span class="at">overwrite =</span> T)</span>
<span id="cb15-164"><a href="segmentation-update.html#cb15-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-165"><a href="segmentation-update.html#cb15-165" aria-hidden="true" tabindex="-1"></a><span class="co"># subset all non water/ucl polygons</span></span>
<span id="cb15-166"><a href="segmentation-update.html#cb15-166" aria-hidden="true" tabindex="-1"></a>p2_sf <span class="ot">&lt;-</span> p[<span class="sc">!</span>(p<span class="sc">$</span>POLYTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;WAT&#39;</span>, <span class="st">&#39;UCL&#39;</span>))] <span class="sc">%&gt;%</span> st_as_sf</span>
<span id="cb15-167"><a href="segmentation-update.html#cb15-167" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p[<span class="sc">!</span>(p<span class="sc">$</span>POLYTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;WAT&#39;</span>, <span class="st">&#39;UCL&#39;</span>))] <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb15-168"><a href="segmentation-update.html#cb15-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-169"><a href="segmentation-update.html#cb15-169" aria-hidden="true" tabindex="-1"></a><span class="co"># extract pixel values</span></span>
<span id="cb15-170"><a href="segmentation-update.html#cb15-170" aria-hidden="true" tabindex="-1"></a>pvals <span class="ot">&lt;-</span> <span class="fu">exact_extract</span>(ras, p2_sf)</span>
<span id="cb15-171"><a href="segmentation-update.html#cb15-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-172"><a href="segmentation-update.html#cb15-172" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate SSE</span></span>
<span id="cb15-173"><a href="segmentation-update.html#cb15-173" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="fu">sapply</span>(pvals, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb15-174"><a href="segmentation-update.html#cb15-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-175"><a href="segmentation-update.html#cb15-175" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset values based on coverage fraction</span></span>
<span id="cb15-176"><a href="segmentation-update.html#cb15-176" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(coverage_fraction <span class="sc">&gt;=</span> <span class="fl">0.5</span>)</span>
<span id="cb15-177"><a href="segmentation-update.html#cb15-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-178"><a href="segmentation-update.html#cb15-178" aria-hidden="true" tabindex="-1"></a>  p95_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>p95, <span class="at">na.rm =</span> T)</span>
<span id="cb15-179"><a href="segmentation-update.html#cb15-179" aria-hidden="true" tabindex="-1"></a>  cc_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>cc, <span class="at">na.rm =</span> T)</span>
<span id="cb15-180"><a href="segmentation-update.html#cb15-180" aria-hidden="true" tabindex="-1"></a>  cv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x<span class="sc">$</span>cv, <span class="at">na.rm =</span> T)</span>
<span id="cb15-181"><a href="segmentation-update.html#cb15-181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-182"><a href="segmentation-update.html#cb15-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">sum</span>((x<span class="sc">$</span>p95 <span class="sc">-</span> p95_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb15-183"><a href="segmentation-update.html#cb15-183" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sum</span>((x<span class="sc">$</span>cc <span class="sc">-</span> cc_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb15-184"><a href="segmentation-update.html#cb15-184" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sum</span>((x<span class="sc">$</span>cv <span class="sc">-</span> cv_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T)))</span>
<span id="cb15-185"><a href="segmentation-update.html#cb15-185" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-186"><a href="segmentation-update.html#cb15-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-187"><a href="segmentation-update.html#cb15-187" aria-hidden="true" tabindex="-1"></a><span class="co"># transpose</span></span>
<span id="cb15-188"><a href="segmentation-update.html#cb15-188" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="fu">t</span>(sse)</span>
<span id="cb15-189"><a href="segmentation-update.html#cb15-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-190"><a href="segmentation-update.html#cb15-190" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate final sums</span></span>
<span id="cb15-191"><a href="segmentation-update.html#cb15-191" aria-hidden="true" tabindex="-1"></a>sse <span class="ot">&lt;-</span> <span class="fu">colSums</span>(sse)</span>
<span id="cb15-192"><a href="segmentation-update.html#cb15-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-193"><a href="segmentation-update.html#cb15-193" aria-hidden="true" tabindex="-1"></a><span class="co"># unlist values</span></span>
<span id="cb15-194"><a href="segmentation-update.html#cb15-194" aria-hidden="true" tabindex="-1"></a>pvals2 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, pvals)</span>
<span id="cb15-195"><a href="segmentation-update.html#cb15-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-196"><a href="segmentation-update.html#cb15-196" aria-hidden="true" tabindex="-1"></a><span class="co"># subset values based on coverage fraction</span></span>
<span id="cb15-197"><a href="segmentation-update.html#cb15-197" aria-hidden="true" tabindex="-1"></a>pvals2 <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(coverage_fraction <span class="sc">&gt;=</span> <span class="fl">0.5</span>)</span>
<span id="cb15-198"><a href="segmentation-update.html#cb15-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-199"><a href="segmentation-update.html#cb15-199" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate global mean values</span></span>
<span id="cb15-200"><a href="segmentation-update.html#cb15-200" aria-hidden="true" tabindex="-1"></a>p95_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>p95, <span class="at">na.rm =</span> T)</span>
<span id="cb15-201"><a href="segmentation-update.html#cb15-201" aria-hidden="true" tabindex="-1"></a>cc_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>cc, <span class="at">na.rm =</span> T)</span>
<span id="cb15-202"><a href="segmentation-update.html#cb15-202" aria-hidden="true" tabindex="-1"></a>cv_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(pvals2<span class="sc">$</span>cv, <span class="at">na.rm =</span> T)</span>
<span id="cb15-203"><a href="segmentation-update.html#cb15-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-204"><a href="segmentation-update.html#cb15-204" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pvals2)</span>
<span id="cb15-205"><a href="segmentation-update.html#cb15-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-206"><a href="segmentation-update.html#cb15-206" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate SST</span></span>
<span id="cb15-207"><a href="segmentation-update.html#cb15-207" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">sapply</span>(pvals, <span class="at">FUN =</span> <span class="cf">function</span>(x){</span>
<span id="cb15-208"><a href="segmentation-update.html#cb15-208" aria-hidden="true" tabindex="-1"></a>  <span class="co"># subset values based on coverage fraction</span></span>
<span id="cb15-209"><a href="segmentation-update.html#cb15-209" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">%&lt;&gt;%</span> <span class="fu">filter</span>(coverage_fraction <span class="sc">&gt;=</span> <span class="fl">0.5</span>)</span>
<span id="cb15-210"><a href="segmentation-update.html#cb15-210" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-211"><a href="segmentation-update.html#cb15-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">sum</span>((x<span class="sc">$</span>p95 <span class="sc">-</span> p95_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb15-212"><a href="segmentation-update.html#cb15-212" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sum</span>((x<span class="sc">$</span>cc <span class="sc">-</span> cc_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T),</span>
<span id="cb15-213"><a href="segmentation-update.html#cb15-213" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sum</span>((x<span class="sc">$</span>cv <span class="sc">-</span> cv_mean)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T)))</span>
<span id="cb15-214"><a href="segmentation-update.html#cb15-214" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-215"><a href="segmentation-update.html#cb15-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-216"><a href="segmentation-update.html#cb15-216" aria-hidden="true" tabindex="-1"></a><span class="co"># transpose</span></span>
<span id="cb15-217"><a href="segmentation-update.html#cb15-217" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">t</span>(sst)</span>
<span id="cb15-218"><a href="segmentation-update.html#cb15-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-219"><a href="segmentation-update.html#cb15-219" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate final sums</span></span>
<span id="cb15-220"><a href="segmentation-update.html#cb15-220" aria-hidden="true" tabindex="-1"></a>sst <span class="ot">&lt;-</span> <span class="fu">colSums</span>(sst)</span>
<span id="cb15-221"><a href="segmentation-update.html#cb15-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-222"><a href="segmentation-update.html#cb15-222" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate r2 values</span></span>
<span id="cb15-223"><a href="segmentation-update.html#cb15-223" aria-hidden="true" tabindex="-1"></a>r2_p95 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">1</span>]<span class="sc">/</span>sst[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-224"><a href="segmentation-update.html#cb15-224" aria-hidden="true" tabindex="-1"></a>r2_cc <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">2</span>]<span class="sc">/</span>sst[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-225"><a href="segmentation-update.html#cb15-225" aria-hidden="true" tabindex="-1"></a>r2_cv <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (sse[<span class="dv">3</span>]<span class="sc">/</span>sst[<span class="dv">3</span>]) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-226"><a href="segmentation-update.html#cb15-226" aria-hidden="true" tabindex="-1"></a>r2_all <span class="ot">&lt;-</span> (<span class="fu">sum</span>(r2_p95, r2_cc, r2_cv) <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span>
<span id="cb15-227"><a href="segmentation-update.html#cb15-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-228"><a href="segmentation-update.html#cb15-228" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe with values wanted</span></span>
<span id="cb15-229"><a href="segmentation-update.html#cb15-229" aria-hidden="true" tabindex="-1"></a>df_fri <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">alg =</span> <span class="st">&#39;FRI&#39;</span>,</span>
<span id="cb15-230"><a href="segmentation-update.html#cb15-230" aria-hidden="true" tabindex="-1"></a>                    <span class="at">min_pix =</span> (<span class="fu">min</span>(p2<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span>)),</span>
<span id="cb15-231"><a href="segmentation-update.html#cb15-231" aria-hidden="true" tabindex="-1"></a>                    <span class="at">max_pix =</span> (<span class="fu">max</span>(p2<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span>)),</span>
<span id="cb15-232"><a href="segmentation-update.html#cb15-232" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mean_pix =</span> (<span class="fu">mean</span>(p2<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span>)),</span>
<span id="cb15-233"><a href="segmentation-update.html#cb15-233" aria-hidden="true" tabindex="-1"></a>                    <span class="at">med_pix =</span> (<span class="fu">median</span>(p2<span class="sc">$</span>area <span class="sc">/</span> <span class="dv">400</span>)),</span>
<span id="cb15-234"><a href="segmentation-update.html#cb15-234" aria-hidden="true" tabindex="-1"></a>                    <span class="at">num_poly =</span> <span class="fu">NROW</span>(p2),</span>
<span id="cb15-235"><a href="segmentation-update.html#cb15-235" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mean_area =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>area),</span>
<span id="cb15-236"><a href="segmentation-update.html#cb15-236" aria-hidden="true" tabindex="-1"></a>                    <span class="at">se_area =</span> <span class="fu">se</span>(p2<span class="sc">$</span>area),</span>
<span id="cb15-237"><a href="segmentation-update.html#cb15-237" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sd_area =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>area),</span>
<span id="cb15-238"><a href="segmentation-update.html#cb15-238" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mean_perim =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>perim),</span>
<span id="cb15-239"><a href="segmentation-update.html#cb15-239" aria-hidden="true" tabindex="-1"></a>                    <span class="at">se_perim =</span> <span class="fu">se</span>(p2<span class="sc">$</span>perim),</span>
<span id="cb15-240"><a href="segmentation-update.html#cb15-240" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sd_perim =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>perim),</span>
<span id="cb15-241"><a href="segmentation-update.html#cb15-241" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mean_msi =</span> <span class="fu">mean</span>(p2<span class="sc">$</span>msi),</span>
<span id="cb15-242"><a href="segmentation-update.html#cb15-242" aria-hidden="true" tabindex="-1"></a>                    <span class="at">se_msi =</span> <span class="fu">se</span>(p2<span class="sc">$</span>msi),</span>
<span id="cb15-243"><a href="segmentation-update.html#cb15-243" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sd_msi =</span> <span class="fu">sd</span>(p2<span class="sc">$</span>msi),</span>
<span id="cb15-244"><a href="segmentation-update.html#cb15-244" aria-hidden="true" tabindex="-1"></a>                    r2_p95 <span class="ot">&lt;-</span> r2_p95,</span>
<span id="cb15-245"><a href="segmentation-update.html#cb15-245" aria-hidden="true" tabindex="-1"></a>                    r2_cc <span class="ot">&lt;-</span> r2_cc,</span>
<span id="cb15-246"><a href="segmentation-update.html#cb15-246" aria-hidden="true" tabindex="-1"></a>                    r2_cv <span class="ot">&lt;-</span> r2_cv,</span>
<span id="cb15-247"><a href="segmentation-update.html#cb15-247" aria-hidden="true" tabindex="-1"></a>                    r2_all <span class="ot">&lt;-</span> r2_all)</span>
<span id="cb15-248"><a href="segmentation-update.html#cb15-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-249"><a href="segmentation-update.html#cb15-249" aria-hidden="true" tabindex="-1"></a><span class="co"># round numeric columns</span></span>
<span id="cb15-250"><a href="segmentation-update.html#cb15-250" aria-hidden="true" tabindex="-1"></a>df_fri <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb15-251"><a href="segmentation-update.html#cb15-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&#39;min_pix&#39;</span>,</span>
<span id="cb15-252"><a href="segmentation-update.html#cb15-252" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;max_pix&#39;</span>, </span>
<span id="cb15-253"><a href="segmentation-update.html#cb15-253" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;mean_pix&#39;</span>, </span>
<span id="cb15-254"><a href="segmentation-update.html#cb15-254" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;med_pix&#39;</span>),</span>
<span id="cb15-255"><a href="segmentation-update.html#cb15-255" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">round</span>(x)) <span class="sc">%&gt;%</span></span>
<span id="cb15-256"><a href="segmentation-update.html#cb15-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&#39;mean_area&#39;</span>, </span>
<span id="cb15-257"><a href="segmentation-update.html#cb15-257" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;se_area&#39;</span>, </span>
<span id="cb15-258"><a href="segmentation-update.html#cb15-258" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;sd_area&#39;</span>,</span>
<span id="cb15-259"><a href="segmentation-update.html#cb15-259" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;mean_perim&#39;</span>,</span>
<span id="cb15-260"><a href="segmentation-update.html#cb15-260" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;se_perim&#39;</span>,</span>
<span id="cb15-261"><a href="segmentation-update.html#cb15-261" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;sd_perim&#39;</span>), </span>
<span id="cb15-262"><a href="segmentation-update.html#cb15-262" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">round</span>(x, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-263"><a href="segmentation-update.html#cb15-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&#39;mean_msi&#39;</span>, </span>
<span id="cb15-264"><a href="segmentation-update.html#cb15-264" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;se_msi&#39;</span>, </span>
<span id="cb15-265"><a href="segmentation-update.html#cb15-265" aria-hidden="true" tabindex="-1"></a>              <span class="st">&#39;sd_msi&#39;</span>), </span>
<span id="cb15-266"><a href="segmentation-update.html#cb15-266" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">round</span>(x, <span class="dv">4</span>))</span>
<span id="cb15-267"><a href="segmentation-update.html#cb15-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-268"><a href="segmentation-update.html#cb15-268" aria-hidden="true" tabindex="-1"></a><span class="co"># bind df</span></span>
<span id="cb15-269"><a href="segmentation-update.html#cb15-269" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df, df_fri)</span>
<span id="cb15-270"><a href="segmentation-update.html#cb15-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-271"><a href="segmentation-update.html#cb15-271" aria-hidden="true" tabindex="-1"></a><span class="co"># write summary stats to csv as backup</span></span>
<span id="cb15-272"><a href="segmentation-update.html#cb15-272" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df,</span>
<span id="cb15-273"><a href="segmentation-update.html#cb15-273" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&#39;D:/ontario_inventory/segmentation_ex/grm_ex_summary_stats.csv&#39;</span>,</span>
<span id="cb15-274"><a href="segmentation-update.html#cb15-274" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> F)</span></code></pre></div>
</div>
<div id="compare-outputs" class="section level2 unnumbered hasAnchor">
<h2>3b. Compare GRM Segmentation Output to FRI<a href="segmentation-update.html#compare-outputs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="segmentation-update.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load base imagery</span></span>
<span id="cb16-2"><a href="segmentation-update.html#cb16-2" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">&#39;D:/ontario_inventory/romeo/RMF_Sample_Base.tif&#39;</span>)</span>
<span id="cb16-3"><a href="segmentation-update.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="segmentation-update.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load FRI and change to raster proj</span></span>
<span id="cb16-5"><a href="segmentation-update.html#cb16-5" aria-hidden="true" tabindex="-1"></a>fri_poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&quot;D:/ontario_inventory/segmentation_ex/fri_ex.shp&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="segmentation-update.html#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., base) <span class="sc">%&gt;%</span> <span class="fu">crop</span>(., base)</span>
<span id="cb16-7"><a href="segmentation-update.html#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="segmentation-update.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># load GRM polygons and change to raster proj</span></span>
<span id="cb16-9"><a href="segmentation-update.html#cb16-9" aria-hidden="true" tabindex="-1"></a>grm_poly <span class="ot">&lt;-</span> <span class="fu">vect</span>(<span class="st">&quot;D:/ontario_inventory/segmentation_ex/grm_ex.shp&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="segmentation-update.html#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">project</span>(., base) <span class="sc">%&gt;%</span> <span class="fu">crop</span>(., base)</span>
<span id="cb16-11"><a href="segmentation-update.html#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="segmentation-update.html#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot base imagery with FRI polygons</span></span>
<span id="cb16-13"><a href="segmentation-update.html#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fri_poly)</span>
<span id="cb16-14"><a href="segmentation-update.html#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRGB</span>(base, <span class="at">stretch =</span> <span class="st">&#39;lin&#39;</span>, <span class="at">add =</span> T)</span>
<span id="cb16-15"><a href="segmentation-update.html#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fri_poly, <span class="at">border =</span> <span class="st">&#39;mediumvioletred&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> T)</span>
<span id="cb16-16"><a href="segmentation-update.html#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">&#39;FRI Polygons Overlaid on True Color Image&#39;</span>, <span class="at">line =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">cex.main =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="04-Segmentation-Update_files/figure-html/compare-datasets1-1.png" width="1728" /></p>
<p><strong><em>The above plot shows the FRI polygons in the sample area, overlaid on recent true color imagery. Note the clean edges around water bodies, rivers/streams, and road features.</em></strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="segmentation-update.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot base imagery with GRM polygons</span></span>
<span id="cb17-2"><a href="segmentation-update.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(grm_poly)</span>
<span id="cb17-3"><a href="segmentation-update.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotRGB</span>(base, <span class="at">stretch =</span> <span class="st">&#39;lin&#39;</span>, <span class="at">add =</span> T)</span>
<span id="cb17-4"><a href="segmentation-update.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(grm_poly, <span class="at">border =</span> <span class="st">&#39;red2&#39;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> T)</span>
<span id="cb17-5"><a href="segmentation-update.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">&#39;GRM Polygons Overlaid on True Color Image&#39;</span>, <span class="at">line =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">cex.main =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="04-Segmentation-Update_files/figure-html/compare-datasets2-1.png" width="1728" /></p>
<p><strong><em>The above plot shows the GRM derived polygons in the sample area. Note that the automated segmentation also has clean edges around water and road features, since these features were masked in the first step, and the polygons re-added after segmentation. The GRM polygons are also much more compact and uniform than the FRI polygons, and generally do not have issues with the line-work (overlapping and parallel lines), which was an important point mentioned in our meetings.</em></strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="segmentation-update.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb18-2"><a href="segmentation-update.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="do">### DISTRIBUTION OF POLYGON SIZE </span><span class="al">###</span></span>
<span id="cb18-3"><a href="segmentation-update.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="do">####################################</span></span>
<span id="cb18-4"><a href="segmentation-update.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="segmentation-update.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># remove wat and ucl polygons and convert to df</span></span>
<span id="cb18-6"><a href="segmentation-update.html#cb18-6" aria-hidden="true" tabindex="-1"></a>fri_poly <span class="ot">&lt;-</span> fri_poly[<span class="sc">!</span>(fri_poly<span class="sc">$</span>POLYTYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;WAT&#39;</span>, <span class="st">&#39;UCL&#39;</span>))] <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb18-7"><a href="segmentation-update.html#cb18-7" aria-hidden="true" tabindex="-1"></a>grm_poly <span class="ot">&lt;-</span> grm_poly[<span class="fu">is.na</span>(grm_poly<span class="sc">$</span>POLYTYPE)] <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb18-8"><a href="segmentation-update.html#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="segmentation-update.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot polygon size FRI in Ha</span></span>
<span id="cb18-10"><a href="segmentation-update.html#cb18-10" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">nbPixels =</span> fri_poly<span class="sc">$</span>nbPixels<span class="sc">/</span><span class="dv">25</span>), <span class="fu">aes</span>(<span class="at">x =</span> nbPixels)) <span class="sc">+</span></span>
<span id="cb18-11"><a href="segmentation-update.html#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-12"><a href="segmentation-update.html#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span><span class="sc">/</span><span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb18-13"><a href="segmentation-update.html#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.17</span>)) <span class="sc">+</span></span>
<span id="cb18-14"><a href="segmentation-update.html#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(nbPixels)),</span>
<span id="cb18-15"><a href="segmentation-update.html#cb18-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb18-16"><a href="segmentation-update.html#cb18-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb18-17"><a href="segmentation-update.html#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-18"><a href="segmentation-update.html#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Number of Hectares&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-19"><a href="segmentation-update.html#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-20"><a href="segmentation-update.html#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;FRI Distribution of Polygon Size&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-21"><a href="segmentation-update.html#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb18-22"><a href="segmentation-update.html#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="segmentation-update.html#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co"># plot polygon size GRM in Ha</span></span>
<span id="cb18-24"><a href="segmentation-update.html#cb18-24" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">nbPixels =</span> grm_poly<span class="sc">$</span>nbPixels<span class="sc">/</span><span class="dv">25</span>), <span class="fu">aes</span>(<span class="at">x =</span> nbPixels)) <span class="sc">+</span></span>
<span id="cb18-25"><a href="segmentation-update.html#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-26"><a href="segmentation-update.html#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span><span class="sc">/</span><span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb18-27"><a href="segmentation-update.html#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.17</span>)) <span class="sc">+</span></span>
<span id="cb18-28"><a href="segmentation-update.html#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(nbPixels)),</span>
<span id="cb18-29"><a href="segmentation-update.html#cb18-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb18-30"><a href="segmentation-update.html#cb18-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb18-31"><a href="segmentation-update.html#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-32"><a href="segmentation-update.html#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Number of Hectares&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-33"><a href="segmentation-update.html#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-34"><a href="segmentation-update.html#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;GRM Distribution of Polygon Size&#39;</span>) <span class="sc">+</span></span>
<span id="cb18-35"><a href="segmentation-update.html#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb18-36"><a href="segmentation-update.html#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="segmentation-update.html#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co"># plot together</span></span>
<span id="cb18-38"><a href="segmentation-update.html#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(g1, g2)</span></code></pre></div>
<p><img src="04-Segmentation-Update_files/figure-html/compare-datasets3-1.png" width="1728" /></p>
<p><strong><em>Above is the distribution of polygon size within the sample area. The dotted line denotes the median values, which are very close between the FRI and GRM polygons. Both distributions have a long tail toward large polygons, but the GRM polygons have a more uniform size and less large polygons. Water and Unclassified polygons are not included.</em></strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="segmentation-update.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb19-2"><a href="segmentation-update.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="do">### DISTRIBUTION OF SHAPE INDEX </span><span class="al">###</span></span>
<span id="cb19-3"><a href="segmentation-update.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb19-4"><a href="segmentation-update.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="segmentation-update.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot shape index FRI</span></span>
<span id="cb19-6"><a href="segmentation-update.html#cb19-6" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">msi =</span> <span class="fu">as.numeric</span>(fri_poly<span class="sc">$</span>msi)), <span class="fu">aes</span>(<span class="at">x =</span> msi)) <span class="sc">+</span></span>
<span id="cb19-7"><a href="segmentation-update.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-8"><a href="segmentation-update.html#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb19-9"><a href="segmentation-update.html#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb19-10"><a href="segmentation-update.html#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(msi)),</span>
<span id="cb19-11"><a href="segmentation-update.html#cb19-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb19-12"><a href="segmentation-update.html#cb19-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a href="segmentation-update.html#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-14"><a href="segmentation-update.html#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Shape Index&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-15"><a href="segmentation-update.html#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-16"><a href="segmentation-update.html#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;FRI Distribution of Shape Index&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-17"><a href="segmentation-update.html#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb19-18"><a href="segmentation-update.html#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="segmentation-update.html#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plot shape index GRM</span></span>
<span id="cb19-20"><a href="segmentation-update.html#cb19-20" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">msi =</span> <span class="fu">as.numeric</span>(grm_poly<span class="sc">$</span>msi)), <span class="fu">aes</span>(<span class="at">x =</span> msi)) <span class="sc">+</span></span>
<span id="cb19-21"><a href="segmentation-update.html#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&#39;grey&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-22"><a href="segmentation-update.html#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb19-23"><a href="segmentation-update.html#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb19-24"><a href="segmentation-update.html#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(msi)),</span>
<span id="cb19-25"><a href="segmentation-update.html#cb19-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb19-26"><a href="segmentation-update.html#cb19-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb19-27"><a href="segmentation-update.html#cb19-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-28"><a href="segmentation-update.html#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Shape Index&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-29"><a href="segmentation-update.html#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;Density&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-30"><a href="segmentation-update.html#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;GRM Distribution of Shape Index&#39;</span>) <span class="sc">+</span></span>
<span id="cb19-31"><a href="segmentation-update.html#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb19-32"><a href="segmentation-update.html#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="segmentation-update.html#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co"># plot together</span></span>
<span id="cb19-34"><a href="segmentation-update.html#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(g1, g2)</span></code></pre></div>
<p><img src="04-Segmentation-Update_files/figure-html/compare-datasets4-1.png" width="1728" /></p>
<p><strong><em>The above plots show Shape Index for FRI and GRM polygons in the sample area (Water and Unclassified polygons are not included). The dotted line is the median value. Shape Index has a value of 1 for circular objects and increases without limits with increased complexity and irregularity. The GRM polygons have a much more compact shape (lower Shape Index) as well as a more uniform and tight distribution. These characteristics are visible in the above plots of the polygons.</em></strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="segmentation-update.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb20-2"><a href="segmentation-update.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Summary Stats and Additional Tables </span><span class="al">###</span></span>
<span id="cb20-3"><a href="segmentation-update.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb20-4"><a href="segmentation-update.html#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="segmentation-update.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Size</span></span>
<span id="cb20-6"><a href="segmentation-update.html#cb20-6" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">as.tibble</span>(df[, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb20-7"><a href="segmentation-update.html#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="segmentation-update.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># change to ha</span></span>
<span id="cb20-9"><a href="segmentation-update.html#cb20-9" aria-hidden="true" tabindex="-1"></a>t1[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(t1[, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>] <span class="sc">/</span> <span class="dv">25</span>, <span class="dv">2</span>)</span>
<span id="cb20-10"><a href="segmentation-update.html#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="segmentation-update.html#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Dataset&#39;</span>, <span class="st">&quot;Min Ha&quot;</span>, <span class="st">&#39;Max Ha&#39;</span>, <span class="st">&quot;Mean Ha&quot;</span>,</span>
<span id="cb20-12"><a href="segmentation-update.html#cb20-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Median Ha&quot;</span>, <span class="st">&quot;Number of Polygons&quot;</span>)</span>
<span id="cb20-13"><a href="segmentation-update.html#cb20-13" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(t1, <span class="at">caption =</span> <span class="st">&quot;Table 1: Polygon Size Stats&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Table 1: Polygon Size Stats</caption>
<thead>
<tr class="header">
<th align="left">Dataset</th>
<th align="right">Min Ha</th>
<th align="right">Max Ha</th>
<th align="right">Mean Ha</th>
<th align="right">Median Ha</th>
<th align="right">Number of Polygons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GRM</td>
<td align="right">0.04</td>
<td align="right">42.84</td>
<td align="right">4.94</td>
<td align="right">4.12</td>
<td align="right">25774</td>
</tr>
<tr class="even">
<td align="left">FRI</td>
<td align="right">0.00</td>
<td align="right">184.00</td>
<td align="right">7.56</td>
<td align="right">3.92</td>
<td align="right">18202</td>
</tr>
</tbody>
</table>
<p><strong><em>Table 1 shows Polygon size stats. The median values are very close, but the mean GRM polygon size is smaller, as is the maximum polygon size. Thus, the GRM output has more polygons overall than the FRI.</em></strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="segmentation-update.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Area and Perim</span></span>
<span id="cb21-2"><a href="segmentation-update.html#cb21-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">as.tibble</span>(df[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>)])</span>
<span id="cb21-3"><a href="segmentation-update.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Dataset&quot;</span>, <span class="st">&quot;Mean Area (m2)&quot;</span>, <span class="st">&quot;SE Area&quot;</span>, <span class="st">&quot;SD Area&quot;</span>,</span>
<span id="cb21-4"><a href="segmentation-update.html#cb21-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Mean Perimeter (m)&quot;</span>, <span class="st">&quot;SE Perimeter&quot;</span>, <span class="st">&quot;SD Perimeter&quot;</span>)</span>
<span id="cb21-5"><a href="segmentation-update.html#cb21-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(t2, <span class="at">caption =</span> <span class="st">&quot;Table 2: Polygon Area and Perimeter Stats&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Table 2: Polygon Area and Perimeter Stats</caption>
<colgroup>
<col width="9%" />
<col width="17%" />
<col width="9%" />
<col width="11%" />
<col width="22%" />
<col width="15%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Dataset</th>
<th align="right">Mean Area (m2)</th>
<th align="right">SE Area</th>
<th align="right">SD Area</th>
<th align="right">Mean Perimeter (m)</th>
<th align="right">SE Perimeter</th>
<th align="right">SD Perimeter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GRM</td>
<td align="right">49366.70</td>
<td align="right">209.81</td>
<td align="right">33682.75</td>
<td align="right">1133.89</td>
<td align="right">2.30</td>
<td align="right">368.70</td>
</tr>
<tr class="even">
<td align="left">FRI</td>
<td align="right">75643.27</td>
<td align="right">830.58</td>
<td align="right">112057.39</td>
<td align="right">1664.71</td>
<td align="right">11.87</td>
<td align="right">1600.98</td>
</tr>
</tbody>
</table>
<p><strong><em>Table 2 shows area and perimeter stats. The mean area and perimeter of GRM polygons are smaller than the FRI. The variation is also smaller, since the GRM polygons are more uniform.</em></strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="segmentation-update.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean Shape Index</span></span>
<span id="cb22-2"><a href="segmentation-update.html#cb22-2" aria-hidden="true" tabindex="-1"></a>t3 <span class="ot">&lt;-</span> <span class="fu">as.tibble</span>(df[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">13</span><span class="sc">:</span><span class="dv">15</span>)])</span>
<span id="cb22-3"><a href="segmentation-update.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t3) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Dataset&quot;</span>, <span class="st">&quot;Mean Shape Index&quot;</span>, <span class="st">&quot;SE Shape Index&quot;</span>, <span class="st">&quot;SD Shape Index&quot;</span>)</span>
<span id="cb22-4"><a href="segmentation-update.html#cb22-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(t3, <span class="at">caption =</span> <span class="st">&quot;Table 3: Polygon Shape Index Stats&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Table 3: Polygon Shape Index Stats</caption>
<thead>
<tr class="header">
<th align="left">Dataset</th>
<th align="right">Mean Shape Index</th>
<th align="right">SE Shape Index</th>
<th align="right">SD Shape Index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GRM</td>
<td align="right">3.0626</td>
<td align="right">0.0028</td>
<td align="right">0.4501</td>
</tr>
<tr class="even">
<td align="left">FRI</td>
<td align="right">3.8114</td>
<td align="right">0.0097</td>
<td align="right">1.3145</td>
</tr>
</tbody>
</table>
<p><strong><em>Table 3 presents Mean Shape Index, an indication of the regularity of polygon shape, with values of 1 representing perfect circles and values increasing without maximum with more complexity. We can see that GRM polygons are less complex (more compact) than FRI polygons and that shape varies less in the GRM output.</em></strong></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="segmentation-update.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R2</span></span>
<span id="cb23-2"><a href="segmentation-update.html#cb23-2" aria-hidden="true" tabindex="-1"></a>t4 <span class="ot">&lt;-</span> <span class="fu">as.tibble</span>(df[,<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>)])</span>
<span id="cb23-3"><a href="segmentation-update.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t4) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Dataset&#39;</span>, <span class="st">&#39;R2 P95&#39;</span>, <span class="st">&#39;R2 Can Cov&#39;</span>, <span class="st">&#39;R2 Coeff Var&#39;</span>, <span class="st">&#39;R2 Overall&#39;</span>)</span>
<span id="cb23-4"><a href="segmentation-update.html#cb23-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(t4, <span class="at">caption =</span> <span class="st">&quot;Table 4: Polygon R2 Stats&quot;</span>, <span class="at">label =</span> <span class="cn">NA</span>)</span></code></pre></div>
<table>
<caption>Table 4: Polygon R2 Stats</caption>
<thead>
<tr class="header">
<th align="left">Dataset</th>
<th align="right">R2 P95</th>
<th align="right">R2 Can Cov</th>
<th align="right">R2 Coeff Var</th>
<th align="right">R2 Overall</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GRM</td>
<td align="right">0.894</td>
<td align="right">0.932</td>
<td align="right">0.847</td>
<td align="right">0.891</td>
</tr>
<tr class="even">
<td align="left">FRI</td>
<td align="right">0.819</td>
<td align="right">0.861</td>
<td align="right">0.701</td>
<td align="right">0.794</td>
</tr>
</tbody>
</table>
<p><strong><em>The last table shows R2 values, which give an indication of how well the segmentation output is explaining the variation among ALS input variables. We can see that the GRM output has a high R2 value of 0.89 (overall R2), which is a strong indicator that the segmentation algorithm is effectively explaining structural differences between polygons. The manually segmented FRI polygons also have a very good R2 value, indicating the skill of interpreters in delineating forest structure.</em></strong></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="segmentation-example.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
